var e,s,t,a,i,n,r,l,c,o,d,u,m,h,x,p,f,g,j,v,y,b,N,w,C,S,T,k,D,E,A,P,_,F,L,I,R,q,O,M,V,U,$,z,B,K,Q,G,W,H,Y,J,X,Z,ee,se,te,ae,ie,ne,re,le,ce,oe,de,ue,me,he,xe,pe,fe,ge,je,ve,ye,be,Ne,we,Ce,Se,Te,ke,De,Ee,Ae,Pe,_e,Fe,Le,Ie,Re,qe,Oe,Me,Ve,Ue,$e,ze,Be,Ke,Qe,Ge,We,He,Ye,Je,Xe,Ze,es,ss,ts,as,is,ns,rs,ls,cs,os,ds,us,ms,hs,xs,ps,fs,gs,js,vs,ys,bs,Ns,ws,Cs,Ss,Ts,ks,Ds,Es,As,Ps,_s,Fs,Ls,Is,Rs,qs,Os,Ms,Vs,Us,$s,zs,Bs,Ks,Qs,Gs,Ws,Hs,Ys,Js,Xs,Zs,et,st,tt,at,it,nt,rt,lt,ct,ot,dt,ut,mt,ht,xt,pt,ft,gt,jt,vt,yt,bt,Nt,wt,Ct,St,Tt,kt,Dt,Et,At,Pt,_t,Ft,Lt,It,Rt,qt,Ot,Mt,Vt,Ut,$t,zt,Bt,Kt,Qt,Gt,Wt,Ht,Yt,Jt,Xt,Zt,ea,sa,ta,aa,ia,na,ra,la,ca,oa,da,ua,ma,ha,xa,pa,fa,ga,ja,va,ya,ba,Na,wa,Ca,Sa,Ta,ka,Da,Ea,Aa,Pa,_a,Fa,La,Ia,Ra,qa,Oa,Ma,Va,Ua,$a,za,Ba,Ka,Qa,Ga,Wa,Ha,Ya,Ja,Xa,Za,ei,si,ti,ai,ii,ni,ri,li,ci,oi,di,ui,mi,hi=Object.defineProperty,xi=e=>{throw TypeError(e)},pi=(e,s,t)=>((e,s,t)=>s in e?hi(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t)(e,"symbol"!=typeof s?s+"":s,t),fi=(e,s,t)=>s.has(e)||xi("Cannot "+t),gi=(e,s,t)=>(fi(e,s,"read from private field"),t?t.call(e):s.get(e)),ji=(e,s,t)=>s.has(e)?xi("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(e):s.set(e,t),vi=(e,s,t,a)=>(fi(e,s,"write to private field"),a?a.call(e,t):s.set(e,t),t),yi=(e,s,t)=>(fi(e,s,"access private method"),t),bi=(e,s,t,a)=>({set _(a){vi(e,s,a,t)},get _(){return gi(e,s,a)}});import{c as Ni,a as wi,u as Ci,j as Si,B as Ti,P as ki,b as Di,d as Ei,e as Ai,f as Pi,V as _i,R as Fi,g as Li,h as Ii,i as Ri,k as qi,D as Oi,C as Mi,l as Vi,m as Ui,n as $i,o as zi,A as Bi,p as Ki,S as Qi,q as Gi,r as Wi,O as Hi,s as Yi,t as Ji,v as Xi,T as Zi,w as en,x as sn,y as tn,L as an,z as nn,E as rn,F as ln,G as cn,I as on,H as dn,J as un,K as mn,M as hn,N as xn,Q as pn,U as fn,W as gn,X as jn,Y as vn,Z as yn,_ as bn,$ as Nn,a0 as wn,a1 as Cn,a2 as Sn,a3 as Tn,a4 as kn,a5 as Dn,a6 as En,a7 as An,a8 as Pn,a9 as _n,aa as Fn,ab as Ln,ac as In,ad as Rn,ae as qn,af as On,ag as Mn,ah as Vn}from"./ui-BMs76Esx.js";import{a as Un,r as $n,c as zn,R as Bn,b as Kn}from"./vendor-DH5OV8M2.js";import{c as Qn,a as Gn,s as Wn,f as Hn,b as Yn,e as Jn,d as Xn,g as Zn,h as er,i as sr,j as tr,k as ar,l as ir,m as nr,n as rr,o as lr,p as cr,q as or,r as dr,t as ur,u as mr,v as hr,w as xr,x as pr,y as fr,z as gr,A as jr,B as vr,C as yr,D as br,E as Nr,F as wr,G as Cr,H as Sr}from"./utils-CDaQTZYo.js";import{X as Tr,L as kr,a as Dr,U as Er,G as Ar,P as Pr,H as _r,M as Fr,b as Lr,Z as Ir,F as Rr,B as qr,T as Or,S as Mr,C as Vr,D as Ur,c as $r,d as zr,e as Br,f as Kr,g as Qr,h as Gr,i as Wr,j as Hr,k as Yr,l as Jr,m as Xr,n as Zr,o as el,p as sl,q as tl,r as al,s as il,t as nl,u as rl,A as ll,v as cl,w as ol,x as dl,R as ul,y as ml,z as hl,E as xl,I as pl,J as fl,K as gl,N as jl,O as vl,Q as yl,V as bl,W as Nl,Y as wl,_ as Cl,$ as Sl,a0 as Tl,a1 as kl,a2 as Dl,a3 as El,a4 as Al,a5 as Pl,a6 as _l,a7 as Fl,a8 as Ll,a9 as Il,aa as Rl,ab as ql,ac as Ol,ad as Ml,ae as Vl,af as Ul,ag as $l,ah as zl,ai as Bl,aj as Kl,ak as Ql,al as Gl,am as Wl,an as Hl,ao as Yl,ap as Jl,aq as Xl,ar as Zl,as as ec,at as sc,au as tc,av as ac,aw as ic,ax as nc,ay as rc,az as lc,aA as cc,aB as oc,aC as dc,aD as uc,aE as mc,aF as hc,aG as xc,aH as pc,aI as fc,aJ as gc,aK as jc,aL as vc,aM as yc,aN as bc}from"./icons-o03LK8eF.js";import{R as Nc,A as wc,C as Cc,X as Sc,Y as Tc,T as kc,a as Dc,P as Ec,b as Ac,c as Pc,L as _c,d as Fc,B as Lc,e as Ic}from"./charts-BSv-uvA2.js";import{o as Rc,r as qc,a as Oc,u as Mc,s as Vc,n as Uc,b as $c,c as zc,d as Bc,e as Kc,f as Qc,g as Gc,h as Wc,z as Hc,i as Yc,F as Jc,C as Xc,j as Zc,k as eo}from"./forms-VwwPkKHl.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&s(e)})).observe(document,{childList:!0,subtree:!0})}function s(e){if(e.ep)return;e.ep=!0;const s=function(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?s.credentials="include":"anonymous"===e.crossOrigin?s.credentials="omit":s.credentials="same-origin",s}(e);fetch(e.href,s)}}();var so=Un;mi=so.createRoot,so.hydrateRoot;var to={exports:{}},ao={},io=$n;var no="function"==typeof Object.is?Object.is:function(e,s){return e===s&&(0!==e||1/e==1/s)||e!=e&&s!=s},ro=io.useState,lo=io.useEffect,co=io.useLayoutEffect,oo=io.useDebugValue;function uo(e){var s=e.getSnapshot;e=e.value;try{var t=s();return!no(e,t)}catch(a){return!0}}var mo="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,s){return s()}:function(e,s){var t=s(),a=ro({inst:{value:t,getSnapshot:s}}),i=a[0].inst,n=a[1];return co((function(){i.value=t,i.getSnapshot=s,uo(i)&&n({inst:i})}),[e,t,s]),lo((function(){return uo(i)&&n({inst:i}),e((function(){uo(i)&&n({inst:i})}))}),[e]),oo(t),t};ao.useSyncExternalStore=void 0!==io.useSyncExternalStore?io.useSyncExternalStore:mo,to.exports=ao;var ho=to.exports;const xo=zn.useInsertionEffect,po=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement)?$n.useLayoutEffect:$n.useEffect,fo=xo||po,go=e=>{const s=$n.useRef([e,(...e)=>s[0](...e)]).current;return fo((()=>{s[0]=e})),s[1]},jo="pushState",vo="replaceState",yo=["popstate",jo,vo,"hashchange"],bo=e=>{for(const s of yo)addEventListener(s,e);return()=>{for(const s of yo)removeEventListener(s,e)}},No=(e,s)=>ho.useSyncExternalStore(bo,e,s),wo=()=>location.search,Co=()=>location.pathname,So=({ssrPath:e}={})=>No(Co,e?()=>e:Co),To=(e,{replace:s=!1,state:t=null}={})=>history[s?vo:jo](t,"",e),ko=Symbol.for("wouter_v3");if("undefined"!=typeof history&&void 0===window[ko]){for(const e of[jo,vo]){const s=history[e];history[e]=function(){const t=s.apply(this,arguments),a=new Event(e);return a.arguments=arguments,dispatchEvent(a),t}}Object.defineProperty(window,ko,{value:!0})}const Do=(e="")=>"/"===e?"":e,Eo=(e="",s)=>((e,s)=>s.toLowerCase().indexOf(e.toLowerCase())?"~"+s:s.slice(e.length)||"/")(Ao(Do(e)),Ao(s)),Ao=e=>{try{return decodeURI(e)}catch(s){return e}},Po={hook:(e={})=>[So(e),To],searchHook:({ssrSearch:e=""}={})=>No(wo,(()=>e)),parser:function(e,s){if(e instanceof RegExp)return{keys:!1,pattern:e};var t,a,i,n,r=[],l="",c=e.split("/");for(c[0]||c.shift();i=c.shift();)"*"===(t=i[0])?(r.push(t),l+="?"===i[1]?"(?:/(.*))?":"/(.*)"):":"===t?(a=i.indexOf("?",1),n=i.indexOf(".",1),r.push(i.substring(1,~a?a:~n?n:i.length)),l+=~a&&!~n?"(?:/([^/]+?))?":"/([^/]+?)",~n&&(l+=(~a?"?":"")+"\\"+i.substring(n))):l+="/"+i;return{keys:r,pattern:new RegExp("^"+l+(s?"(?=$|/)":"/?$"),"i")}},base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:e=>e},_o=$n.createContext(Po),Fo=()=>$n.useContext(_o),Lo={},Io=$n.createContext(Lo),Ro=()=>$n.useContext(Io),qo=e=>{const[s,t]=e.hook(e);return[Eo(e.base,s),go(((s,a)=>t(((e,s)=>"~"===e[0]?e.slice(1):Do(s)+e)(s,e.base),a)))]},Oo=()=>qo(Fo()),Mo=(e,s,t,a)=>{const{pattern:i,keys:n}=s instanceof RegExp?{keys:!1,pattern:s}:e(s||"*",a),r=i.exec(t)||[],[l,...c]=r;return void 0!==l?[!0,(()=>{const e=!1!==n?Object.fromEntries(n.map(((e,s)=>[e,c[s]]))):r.groups;let s={...c};return e&&Object.assign(s,e),s})(),...a?[l]:[]]:[!1,null]},Vo=({children:e,...s})=>{var t,a;const i=Fo(),n=s.hook?Po:i;let r=n;const[l,c]=(null==(t=s.ssrPath)?void 0:t.split("?"))??[];c&&(s.ssrSearch=c,s.ssrPath=l),s.hrefs=s.hrefs??(null==(a=s.hook)?void 0:a.hrefs);let o=$n.useRef({}),d=o.current,u=d;for(let m in n){const e="base"===m?n[m]+(s[m]||""):s[m]||n[m];d===u&&e!==u[m]&&(o.current=u={...u}),u[m]=e,e===n[m]&&e===r[m]||(r=u)}return $n.createElement(_o.Provider,{value:r,children:e})},Uo=({children:e,component:s},t)=>s?$n.createElement(s,{params:t}):"function"==typeof e?e(t):e,$o=({path:e,nest:s,match:t,...a})=>{const i=Fo(),[n]=qo(i),[r,l,c]=t??Mo(i.parser,e,n,s),o=(e=>{let s=$n.useRef(Lo);const t=s.current;return s.current=Object.keys(e).length!==Object.keys(t).length||Object.entries(e).some((([e,s])=>s!==t[e]))?e:t})({...Ro(),...l});if(!r)return null;const d=c?$n.createElement(Vo,{base:c},Uo(a,o)):Uo(a,o);return $n.createElement(Io.Provider,{value:o,children:d})},zo=$n.forwardRef(((e,s)=>{const t=Fo(),[a,i]=qo(t),{to:n="",href:r=n,onClick:l,asChild:c,children:o,className:d,replace:u,state:m,...h}=e,x=go((s=>{s.ctrlKey||s.metaKey||s.altKey||s.shiftKey||0!==s.button||(null==l||l(s),s.defaultPrevented||(s.preventDefault(),i(r,e)))})),p=t.hrefs("~"===r[0]?r.slice(1):t.base+r,t);return c&&$n.isValidElement(o)?$n.cloneElement(o,{onClick:x,href:p}):$n.createElement("a",{...h,onClick:x,href:p,className:(null==d?void 0:d.call)?d(a===r):d,children:o,ref:s})})),Bo=e=>Array.isArray(e)?e.flatMap((e=>Bo(e&&e.type===$n.Fragment?e.props.children:e))):[e],Ko=({children:e,location:s})=>{const t=Fo(),[a]=qo(t);for(const i of Bo(e)){let e=0;if($n.isValidElement(i)&&(e=Mo(t.parser,i.props.path,s||a,i.props.nest))[0])return $n.cloneElement(i,{match:e})}return null},Qo=e=>{const{to:s,href:t=s}=e,a=Fo(),[,i]=qo(a),n=go((()=>i(s||t,e))),{ssrContext:r}=a;return po((()=>{n()}),[]),r&&(r.redirectTo=s),null};let Go=0;const Wo=new Map,Ho=e=>{if(Wo.has(e))return;const s=setTimeout((()=>{Wo.delete(e),Zo({type:"REMOVE_TOAST",toastId:e})}),1e6);Wo.set(e,s)},Yo=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map((e=>e.id===s.toast.id?{...e,...s.toast}:e))};case"DISMISS_TOAST":{const{toastId:t}=s;return t?Ho(t):e.toasts.forEach((e=>{Ho(e.id)})),{...e,toasts:e.toasts.map((e=>e.id===t||void 0===t?{...e,open:!1}:e))}}case"REMOVE_TOAST":return void 0===s.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter((e=>e.id!==s.toastId))}}},Jo=[];let Xo={toasts:[]};function Zo(e){Xo=Yo(Xo,e),Jo.forEach((e=>{e(Xo)}))}function ed({...e}){const s=(Go=(Go+1)%Number.MAX_SAFE_INTEGER,Go.toString()),t=()=>Zo({type:"DISMISS_TOAST",toastId:s});return Zo({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:e=>{e||t()}}}),{id:s,dismiss:t,update:e=>Zo({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function sd(){const[e,s]=$n.useState(Xo);return $n.useEffect((()=>(Jo.push(s),()=>{const e=Jo.indexOf(s);e>-1&&Jo.splice(e,1)})),[e]),{...e,toast:ed,dismiss:e=>Zo({type:"DISMISS_TOAST",toastId:e})}}var td="ToastProvider",[ad,id,nd]=wi("Toast"),[rd,ld]=Ni("Toast",[nd]),[cd,od]=rd(td),dd=e=>{const{__scopeToast:s,label:t="Notification",duration:a=5e3,swipeDirection:i="right",swipeThreshold:n=50,children:r}=e,[l,c]=$n.useState(null),[o,d]=$n.useState(0),u=$n.useRef(!1),m=$n.useRef(!1);return t.trim(),Si.jsx(ad.Provider,{scope:s,children:Si.jsx(cd,{scope:s,label:t,duration:a,swipeDirection:i,swipeThreshold:n,toastCount:o,viewport:l,onViewportChange:c,onToastAdd:$n.useCallback((()=>d((e=>e+1))),[]),onToastRemove:$n.useCallback((()=>d((e=>e-1))),[]),isFocusedToastEscapeKeyDownRef:u,isClosePausedRef:m,children:r})})};dd.displayName=td;var ud="ToastViewport",md=["F8"],hd="toast.viewportPause",xd="toast.viewportResume",pd=$n.forwardRef(((e,s)=>{const{__scopeToast:t,hotkey:a=md,label:i="Notifications ({hotkey})",...n}=e,r=od(ud,t),l=id(t),c=$n.useRef(null),o=$n.useRef(null),d=$n.useRef(null),u=$n.useRef(null),m=Ci(s,u,r.onViewportChange),h=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),x=r.toastCount>0;$n.useEffect((()=>{const e=e=>{var s;0!==a.length&&a.every((s=>e[s]||e.code===s))&&(null==(s=u.current)||s.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[a]),$n.useEffect((()=>{const e=c.current,s=u.current;if(x&&e&&s){const t=()=>{if(!r.isClosePausedRef.current){const e=new CustomEvent(hd);s.dispatchEvent(e),r.isClosePausedRef.current=!0}},a=()=>{if(r.isClosePausedRef.current){const e=new CustomEvent(xd);s.dispatchEvent(e),r.isClosePausedRef.current=!1}},i=s=>{!e.contains(s.relatedTarget)&&a()},n=()=>{e.contains(document.activeElement)||a()};return e.addEventListener("focusin",t),e.addEventListener("focusout",i),e.addEventListener("pointermove",t),e.addEventListener("pointerleave",n),window.addEventListener("blur",t),window.addEventListener("focus",a),()=>{e.removeEventListener("focusin",t),e.removeEventListener("focusout",i),e.removeEventListener("pointermove",t),e.removeEventListener("pointerleave",n),window.removeEventListener("blur",t),window.removeEventListener("focus",a)}}}),[x,r.isClosePausedRef]);const p=$n.useCallback((({tabbingDirection:e})=>{const s=l().map((s=>{const t=s.ref.current,a=[t,...Fd(t)];return"forwards"===e?a:a.reverse()}));return("forwards"===e?s.reverse():s).flat()}),[l]);return $n.useEffect((()=>{const e=u.current;if(e){const s=s=>{var t,a,i;const n=s.altKey||s.ctrlKey||s.metaKey;if("Tab"===s.key&&!n){const n=document.activeElement,r=s.shiftKey;if(s.target===e&&r)return void(null==(t=o.current)||t.focus());const l=p({tabbingDirection:r?"backwards":"forwards"}),c=l.findIndex((e=>e===n));Ld(l.slice(c+1))?s.preventDefault():r?null==(a=o.current)||a.focus():null==(i=d.current)||i.focus()}};return e.addEventListener("keydown",s),()=>e.removeEventListener("keydown",s)}}),[l,p]),Si.jsxs(Ti,{ref:c,role:"region","aria-label":i.replace("{hotkey}",h),tabIndex:-1,style:{pointerEvents:x?void 0:"none"},children:[x&&Si.jsx(gd,{ref:o,onFocusFromOutsideViewport:()=>{Ld(p({tabbingDirection:"forwards"}))}}),Si.jsx(ad.Slot,{scope:t,children:Si.jsx(ki.ol,{tabIndex:-1,...n,ref:m})}),x&&Si.jsx(gd,{ref:d,onFocusFromOutsideViewport:()=>{Ld(p({tabbingDirection:"backwards"}))}})]})}));pd.displayName=ud;var fd="ToastFocusProxy",gd=$n.forwardRef(((e,s)=>{const{__scopeToast:t,onFocusFromOutsideViewport:a,...i}=e,n=od(fd,t);return Si.jsx(_i,{"aria-hidden":!0,tabIndex:0,...i,ref:s,style:{position:"fixed"},onFocus:e=>{var s;const t=e.relatedTarget;!(null==(s=n.viewport)?void 0:s.contains(t))&&a()}})}));gd.displayName=fd;var jd="Toast",vd=$n.forwardRef(((e,s)=>{const{forceMount:t,open:a,defaultOpen:i,onOpenChange:n,...r}=e,[l,c]=Di({prop:a,defaultProp:i??!0,onChange:n,caller:jd});return Si.jsx(Ei,{present:t||l,children:Si.jsx(Nd,{open:l,...r,ref:s,onClose:()=>c(!1),onPause:Pi(e.onPause),onResume:Pi(e.onResume),onSwipeStart:Ai(e.onSwipeStart,(e=>{e.currentTarget.setAttribute("data-swipe","start")})),onSwipeMove:Ai(e.onSwipeMove,(e=>{const{x:s,y:t}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${s}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${t}px`)})),onSwipeCancel:Ai(e.onSwipeCancel,(e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")})),onSwipeEnd:Ai(e.onSwipeEnd,(e=>{const{x:s,y:t}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${s}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${t}px`),c(!1)}))})})}));vd.displayName=jd;var[yd,bd]=rd(jd,{onClose(){}}),Nd=$n.forwardRef(((e,s)=>{const{__scopeToast:t,type:a="foreground",duration:i,open:n,onClose:r,onEscapeKeyDown:l,onPause:c,onResume:o,onSwipeStart:d,onSwipeMove:u,onSwipeCancel:m,onSwipeEnd:h,...x}=e,p=od(jd,t),[f,g]=$n.useState(null),j=Ci(s,(e=>g(e))),v=$n.useRef(null),y=$n.useRef(null),b=i||p.duration,N=$n.useRef(0),w=$n.useRef(b),C=$n.useRef(0),{onToastAdd:S,onToastRemove:T}=p,k=Pi((()=>{var e;(null==f?void 0:f.contains(document.activeElement))&&(null==(e=p.viewport)||e.focus()),r()})),D=$n.useCallback((e=>{e&&e!==1/0&&(window.clearTimeout(C.current),N.current=(new Date).getTime(),C.current=window.setTimeout(k,e))}),[k]);$n.useEffect((()=>{const e=p.viewport;if(e){const s=()=>{D(w.current),null==o||o()},t=()=>{const e=(new Date).getTime()-N.current;w.current=w.current-e,window.clearTimeout(C.current),null==c||c()};return e.addEventListener(hd,t),e.addEventListener(xd,s),()=>{e.removeEventListener(hd,t),e.removeEventListener(xd,s)}}}),[p.viewport,b,c,o,D]),$n.useEffect((()=>{n&&!p.isClosePausedRef.current&&D(b)}),[n,b,p.isClosePausedRef,D]),$n.useEffect((()=>(S(),()=>T())),[S,T]);const E=$n.useMemo((()=>f?Ad(f):null),[f]);return p.viewport?Si.jsxs(Si.Fragment,{children:[E&&Si.jsx(wd,{__scopeToast:t,role:"status","aria-live":"foreground"===a?"assertive":"polite","aria-atomic":!0,children:E}),Si.jsx(yd,{scope:t,onClose:k,children:Un.createPortal(Si.jsx(ad.ItemSlot,{scope:t,children:Si.jsx(Fi,{asChild:!0,onEscapeKeyDown:Ai(l,(()=>{p.isFocusedToastEscapeKeyDownRef.current||k(),p.isFocusedToastEscapeKeyDownRef.current=!1})),children:Si.jsx(ki.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":n?"open":"closed","data-swipe-direction":p.swipeDirection,...x,ref:j,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Ai(e.onKeyDown,(e=>{"Escape"===e.key&&(null==l||l(e.nativeEvent),e.nativeEvent.defaultPrevented||(p.isFocusedToastEscapeKeyDownRef.current=!0,k()))})),onPointerDown:Ai(e.onPointerDown,(e=>{0===e.button&&(v.current={x:e.clientX,y:e.clientY})})),onPointerMove:Ai(e.onPointerMove,(e=>{if(!v.current)return;const s=e.clientX-v.current.x,t=e.clientY-v.current.y,a=Boolean(y.current),i=["left","right"].includes(p.swipeDirection),n=["left","up"].includes(p.swipeDirection)?Math.min:Math.max,r=i?n(0,s):0,l=i?0:n(0,t),c="touch"===e.pointerType?10:2,o={x:r,y:l},m={originalEvent:e,delta:o};a?(y.current=o,Pd("toast.swipeMove",u,m,{discrete:!1})):_d(o,p.swipeDirection,c)?(y.current=o,Pd("toast.swipeStart",d,m,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(s)>c||Math.abs(t)>c)&&(v.current=null)})),onPointerUp:Ai(e.onPointerUp,(e=>{const s=y.current,t=e.target;if(t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),y.current=null,v.current=null,s){const t=e.currentTarget,a={originalEvent:e,delta:s};_d(s,p.swipeDirection,p.swipeThreshold)?Pd("toast.swipeEnd",h,a,{discrete:!0}):Pd("toast.swipeCancel",m,a,{discrete:!0}),t.addEventListener("click",(e=>e.preventDefault()),{once:!0})}}))})})}),p.viewport)})]}):null})),wd=e=>{const{__scopeToast:s,children:t,...a}=e,i=od(jd,s),[n,r]=$n.useState(!1),[l,c]=$n.useState(!1);return function(e=()=>{}){const s=Pi(e);Ii((()=>{let e=0,t=0;return e=window.requestAnimationFrame((()=>t=window.requestAnimationFrame(s))),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(t)}}),[s])}((()=>r(!0))),$n.useEffect((()=>{const e=window.setTimeout((()=>c(!0)),1e3);return()=>window.clearTimeout(e)}),[]),l?null:Si.jsx(Li,{asChild:!0,children:Si.jsx(_i,{...a,children:n&&Si.jsxs(Si.Fragment,{children:[i.label," ",t]})})})},Cd=$n.forwardRef(((e,s)=>{const{__scopeToast:t,...a}=e;return Si.jsx(ki.div,{...a,ref:s})}));Cd.displayName="ToastTitle";var Sd=$n.forwardRef(((e,s)=>{const{__scopeToast:t,...a}=e;return Si.jsx(ki.div,{...a,ref:s})}));Sd.displayName="ToastDescription";var Td=$n.forwardRef(((e,s)=>{const{altText:t,...a}=e;return t.trim()?Si.jsx(Ed,{altText:t,asChild:!0,children:Si.jsx(Dd,{...a,ref:s})}):null}));Td.displayName="ToastAction";var kd="ToastClose",Dd=$n.forwardRef(((e,s)=>{const{__scopeToast:t,...a}=e,i=bd(kd,t);return Si.jsx(Ed,{asChild:!0,children:Si.jsx(ki.button,{type:"button",...a,ref:s,onClick:Ai(e.onClick,i.onClose)})})}));Dd.displayName=kd;var Ed=$n.forwardRef(((e,s)=>{const{__scopeToast:t,altText:a,...i}=e;return Si.jsx(ki.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0,...i,ref:s})}));function Ad(e){const s=[];return Array.from(e.childNodes).forEach((e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&s.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const t=e.ariaHidden||e.hidden||"none"===e.style.display,a=""===e.dataset.radixToastAnnounceExclude;if(!t)if(a){const t=e.dataset.radixToastAnnounceAlt;t&&s.push(t)}else s.push(...Ad(e))}})),s}function Pd(e,s,t,{discrete:a}){const i=t.originalEvent.currentTarget,n=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:t});s&&i.addEventListener(e,s,{once:!0}),a?Ri(i,n):i.dispatchEvent(n)}var _d=(e,s,t=0)=>{const a=Math.abs(e.x),i=Math.abs(e.y),n=a>i;return"left"===s||"right"===s?n&&a>t:!n&&i>t};function Fd(e){const s=[],t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const s="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||s?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)s.push(t.currentNode);return s}function Ld(e){const s=document.activeElement;return e.some((e=>e===s||(e.focus(),document.activeElement!==s)))}var Id=dd,Rd=pd,qd=vd,Od=Cd,Md=Sd,Vd=Td,Ud=Dd;const $d=e=>{const s=Qd(e),{conflictingClassGroups:t,conflictingClassGroupModifiers:a}=e;return{getClassGroupId:e=>{const t=e.split("-");return""===t[0]&&1!==t.length&&t.shift(),zd(t,s)||Kd(e)},getConflictingClassGroupIds:(e,s)=>{const i=t[e]||[];return s&&a[e]?[...i,...a[e]]:i}}},zd=(e,s)=>{var t;if(0===e.length)return s.classGroupId;const a=e[0],i=s.nextPart.get(a),n=i?zd(e.slice(1),i):void 0;if(n)return n;if(0===s.validators.length)return;const r=e.join("-");return null==(t=s.validators.find((({validator:e})=>e(r))))?void 0:t.classGroupId},Bd=/^\[(.+)\]$/,Kd=e=>{if(Bd.test(e)){const s=Bd.exec(e)[1],t=null==s?void 0:s.substring(0,s.indexOf(":"));if(t)return"arbitrary.."+t}},Qd=e=>{const{theme:s,prefix:t}=e,a={nextPart:new Map,validators:[]};return Yd(Object.entries(e.classGroups),t).forEach((([e,t])=>{Gd(t,a,e,s)})),a},Gd=(e,s,t,a)=>{e.forEach((e=>{if("string"!=typeof e){if("function"==typeof e)return Hd(e)?void Gd(e(a),s,t,a):void s.validators.push({validator:e,classGroupId:t});Object.entries(e).forEach((([e,i])=>{Gd(i,Wd(s,e),t,a)}))}else{(""===e?s:Wd(s,e)).classGroupId=t}}))},Wd=(e,s)=>{let t=e;return s.split("-").forEach((e=>{t.nextPart.has(e)||t.nextPart.set(e,{nextPart:new Map,validators:[]}),t=t.nextPart.get(e)})),t},Hd=e=>e.isThemeGetter,Yd=(e,s)=>s?e.map((([e,t])=>[e,t.map((e=>"string"==typeof e?s+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map((([e,t])=>[s+e,t]))):e))])):e,Jd=e=>{if(e<1)return{get:()=>{},set:()=>{}};let s=0,t=new Map,a=new Map;const i=(i,n)=>{t.set(i,n),s++,s>e&&(s=0,a=t,t=new Map)};return{get(e){let s=t.get(e);return void 0!==s?s:void 0!==(s=a.get(e))?(i(e,s),s):void 0},set(e,s){t.has(e)?t.set(e,s):i(e,s)}}},Xd=e=>{const{separator:s,experimentalParseClassName:t}=e,a=1===s.length,i=s[0],n=s.length,r=e=>{const t=[];let r,l=0,c=0;for(let u=0;u<e.length;u++){let o=e[u];if(0===l){if(o===i&&(a||e.slice(u,u+n)===s)){t.push(e.slice(c,u)),c=u+n;continue}if("/"===o){r=u;continue}}"["===o?l++:"]"===o&&l--}const o=0===t.length?e:e.substring(c),d=o.startsWith("!");return{modifiers:t,hasImportantModifier:d,baseClassName:d?o.substring(1):o,maybePostfixModifierPosition:r&&r>c?r-c:void 0}};return t?e=>t({className:e,parseClassName:r}):r},Zd=e=>{if(e.length<=1)return e;const s=[];let t=[];return e.forEach((e=>{"["===e[0]?(s.push(...t.sort(),e),t=[]):t.push(e)})),s.push(...t.sort()),s},eu=/\s+/;function su(){let e,s,t=0,a="";for(;t<arguments.length;)(e=arguments[t++])&&(s=tu(e))&&(a&&(a+=" "),a+=s);return a}const tu=e=>{if("string"==typeof e)return e;let s,t="";for(let a=0;a<e.length;a++)e[a]&&(s=tu(e[a]))&&(t&&(t+=" "),t+=s);return t};function au(e,...s){let t,a,i,n=function(l){const c=s.reduce(((e,s)=>s(e)),e());return t=(e=>({cache:Jd(e.cacheSize),parseClassName:Xd(e),...$d(e)}))(c),a=t.cache.get,i=t.cache.set,n=r,r(l)};function r(e){const s=a(e);if(s)return s;const n=((e,s)=>{const{parseClassName:t,getClassGroupId:a,getConflictingClassGroupIds:i}=s,n=[],r=e.trim().split(eu);let l="";for(let c=r.length-1;c>=0;c-=1){const e=r[c],{modifiers:s,hasImportantModifier:o,baseClassName:d,maybePostfixModifierPosition:u}=t(e);let m=Boolean(u),h=a(m?d.substring(0,u):d);if(!h){if(!m){l=e+(l.length>0?" "+l:l);continue}if(h=a(d),!h){l=e+(l.length>0?" "+l:l);continue}m=!1}const x=Zd(s).join(":"),p=o?x+"!":x,f=p+h;if(n.includes(f))continue;n.push(f);const g=i(h,m);for(let t=0;t<g.length;++t){const e=g[t];n.push(p+e)}l=e+(l.length>0?" "+l:l)}return l})(e,t);return i(e,n),n}return function(){return n(su.apply(null,arguments))}}const iu=e=>{const s=s=>s[e]||[];return s.isThemeGetter=!0,s},nu=/^\[(?:([a-z-]+):)?(.+)\]$/i,ru=/^\d+\/\d+$/,lu=new Set(["px","full","screen"]),cu=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,ou=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,du=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,uu=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,mu=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,hu=e=>pu(e)||lu.has(e)||ru.test(e),xu=e=>Du(e,"length",Eu),pu=e=>Boolean(e)&&!Number.isNaN(Number(e)),fu=e=>Du(e,"number",pu),gu=e=>Boolean(e)&&Number.isInteger(Number(e)),ju=e=>e.endsWith("%")&&pu(e.slice(0,-1)),vu=e=>nu.test(e),yu=e=>cu.test(e),bu=new Set(["length","size","percentage"]),Nu=e=>Du(e,bu,Au),wu=e=>Du(e,"position",Au),Cu=new Set(["image","url"]),Su=e=>Du(e,Cu,_u),Tu=e=>Du(e,"",Pu),ku=()=>!0,Du=(e,s,t)=>{const a=nu.exec(e);return!!a&&(a[1]?"string"==typeof s?a[1]===s:s.has(a[1]):t(a[2]))},Eu=e=>ou.test(e)&&!du.test(e),Au=()=>!1,Pu=e=>uu.test(e),_u=e=>mu.test(e),Fu=au((()=>{const e=iu("colors"),s=iu("spacing"),t=iu("blur"),a=iu("brightness"),i=iu("borderColor"),n=iu("borderRadius"),r=iu("borderSpacing"),l=iu("borderWidth"),c=iu("contrast"),o=iu("grayscale"),d=iu("hueRotate"),u=iu("invert"),m=iu("gap"),h=iu("gradientColorStops"),x=iu("gradientColorStopPositions"),p=iu("inset"),f=iu("margin"),g=iu("opacity"),j=iu("padding"),v=iu("saturate"),y=iu("scale"),b=iu("sepia"),N=iu("skew"),w=iu("space"),C=iu("translate"),S=()=>["auto",vu,s],T=()=>[vu,s],k=()=>["",hu,xu],D=()=>["auto",pu,vu],E=()=>["","0",vu],A=()=>[pu,vu];return{cacheSize:500,separator:":",theme:{colors:[ku],spacing:[hu,xu],blur:["none","",yu,vu],brightness:A(),borderColor:[e],borderRadius:["none","","full",yu,vu],borderSpacing:T(),borderWidth:k(),contrast:A(),grayscale:E(),hueRotate:A(),invert:E(),gap:T(),gradientColorStops:[e],gradientColorStopPositions:[ju,xu],inset:S(),margin:S(),opacity:A(),padding:T(),saturate:A(),scale:A(),sepia:E(),skew:A(),space:T(),translate:T()},classGroups:{aspect:[{aspect:["auto","square","video",vu]}],container:["container"],columns:[{columns:[yu]}],"break-after":[{"break-after":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-before":[{"break-before":["auto","avoid","all","avoid-page","page","left","right","column"]}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",vu]}],overflow:[{overflow:["auto","hidden","clip","visible","scroll"]}],"overflow-x":[{"overflow-x":["auto","hidden","clip","visible","scroll"]}],"overflow-y":[{"overflow-y":["auto","hidden","clip","visible","scroll"]}],overscroll:[{overscroll:["auto","contain","none"]}],"overscroll-x":[{"overscroll-x":["auto","contain","none"]}],"overscroll-y":[{"overscroll-y":["auto","contain","none"]}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[p]}],"inset-x":[{"inset-x":[p]}],"inset-y":[{"inset-y":[p]}],start:[{start:[p]}],end:[{end:[p]}],top:[{top:[p]}],right:[{right:[p]}],bottom:[{bottom:[p]}],left:[{left:[p]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",gu,vu]}],basis:[{basis:S()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",vu]}],grow:[{grow:E()}],shrink:[{shrink:E()}],order:[{order:["first","last","none",gu,vu]}],"grid-cols":[{"grid-cols":[ku]}],"col-start-end":[{col:["auto",{span:["full",gu,vu]},vu]}],"col-start":[{"col-start":D()}],"col-end":[{"col-end":D()}],"grid-rows":[{"grid-rows":[ku]}],"row-start-end":[{row:["auto",{span:[gu,vu]},vu]}],"row-start":[{"row-start":D()}],"row-end":[{"row-end":D()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",vu]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",vu]}],gap:[{gap:[m]}],"gap-x":[{"gap-x":[m]}],"gap-y":[{"gap-y":[m]}],"justify-content":[{justify:["normal","start","end","center","between","around","evenly","stretch"]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal","start","end","center","between","around","evenly","stretch","baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":["start","end","center","between","around","evenly","stretch","baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[j]}],px:[{px:[j]}],py:[{py:[j]}],ps:[{ps:[j]}],pe:[{pe:[j]}],pt:[{pt:[j]}],pr:[{pr:[j]}],pb:[{pb:[j]}],pl:[{pl:[j]}],m:[{m:[f]}],mx:[{mx:[f]}],my:[{my:[f]}],ms:[{ms:[f]}],me:[{me:[f]}],mt:[{mt:[f]}],mr:[{mr:[f]}],mb:[{mb:[f]}],ml:[{ml:[f]}],"space-x":[{"space-x":[w]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[w]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",vu,s]}],"min-w":[{"min-w":[vu,s,"min","max","fit"]}],"max-w":[{"max-w":[vu,s,"none","full","min","max","fit","prose",{screen:[yu]},yu]}],h:[{h:[vu,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[vu,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[vu,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[vu,s,"auto","min","max","fit"]}],"font-size":[{text:["base",yu,xu]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",fu]}],"font-family":[{font:[ku]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",vu]}],"line-clamp":[{"line-clamp":["none",pu,fu]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",hu,vu]}],"list-image":[{"list-image":["none",vu]}],"list-style-type":[{list:["none","disc","decimal",vu]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[g]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[g]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:["solid","dashed","dotted","double","none","wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",hu,xu]}],"underline-offset":[{"underline-offset":["auto",hu,vu]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:T()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",vu]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",vu]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[g]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top",wu]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Nu]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Su]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[h]}],"gradient-via":[{via:[h]}],"gradient-to":[{to:[h]}],rounded:[{rounded:[n]}],"rounded-s":[{"rounded-s":[n]}],"rounded-e":[{"rounded-e":[n]}],"rounded-t":[{"rounded-t":[n]}],"rounded-r":[{"rounded-r":[n]}],"rounded-b":[{"rounded-b":[n]}],"rounded-l":[{"rounded-l":[n]}],"rounded-ss":[{"rounded-ss":[n]}],"rounded-se":[{"rounded-se":[n]}],"rounded-ee":[{"rounded-ee":[n]}],"rounded-es":[{"rounded-es":[n]}],"rounded-tl":[{"rounded-tl":[n]}],"rounded-tr":[{"rounded-tr":[n]}],"rounded-br":[{"rounded-br":[n]}],"rounded-bl":[{"rounded-bl":[n]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[g]}],"border-style":[{border:["solid","dashed","dotted","double","none","hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[g]}],"divide-style":[{divide:["solid","dashed","dotted","double","none"]}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["","solid","dashed","dotted","double","none"]}],"outline-offset":[{"outline-offset":[hu,vu]}],"outline-w":[{outline:[hu,xu]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:k()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[g]}],"ring-offset-w":[{"ring-offset":[hu,xu]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",yu,Tu]}],"shadow-color":[{shadow:[ku]}],opacity:[{opacity:[g]}],"mix-blend":[{"mix-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"]}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[a]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",yu,vu]}],grayscale:[{grayscale:[o]}],"hue-rotate":[{"hue-rotate":[d]}],invert:[{invert:[u]}],saturate:[{saturate:[v]}],sepia:[{sepia:[b]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[o]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[d]}],"backdrop-invert":[{"backdrop-invert":[u]}],"backdrop-opacity":[{"backdrop-opacity":[g]}],"backdrop-saturate":[{"backdrop-saturate":[v]}],"backdrop-sepia":[{"backdrop-sepia":[b]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[r]}],"border-spacing-x":[{"border-spacing-x":[r]}],"border-spacing-y":[{"border-spacing-y":[r]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",vu]}],duration:[{duration:A()}],ease:[{ease:["linear","in","out","in-out",vu]}],delay:[{delay:A()}],animate:[{animate:["none","spin","ping","pulse","bounce",vu]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[y]}],"scale-x":[{"scale-x":[y]}],"scale-y":[{"scale-y":[y]}],rotate:[{rotate:[gu,vu]}],"translate-x":[{"translate-x":[C]}],"translate-y":[{"translate-y":[C]}],"skew-x":[{"skew-x":[N]}],"skew-y":[{"skew-y":[N]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",vu]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",vu]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":T()}],"scroll-mx":[{"scroll-mx":T()}],"scroll-my":[{"scroll-my":T()}],"scroll-ms":[{"scroll-ms":T()}],"scroll-me":[{"scroll-me":T()}],"scroll-mt":[{"scroll-mt":T()}],"scroll-mr":[{"scroll-mr":T()}],"scroll-mb":[{"scroll-mb":T()}],"scroll-ml":[{"scroll-ml":T()}],"scroll-p":[{"scroll-p":T()}],"scroll-px":[{"scroll-px":T()}],"scroll-py":[{"scroll-py":T()}],"scroll-ps":[{"scroll-ps":T()}],"scroll-pe":[{"scroll-pe":T()}],"scroll-pt":[{"scroll-pt":T()}],"scroll-pr":[{"scroll-pr":T()}],"scroll-pb":[{"scroll-pb":T()}],"scroll-pl":[{"scroll-pl":T()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",vu]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[hu,xu,fu]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}));function Lu(...e){return Fu(Qn(e))}function Iu(e){if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][s]}function Ru(e){if(!e)return"";const s="string"==typeof e?new Date(e):e;return isNaN(s.getTime())?"":s.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function qu(e,s="USD"){const t="string"==typeof e?parseFloat(e):e;if(isNaN(t))return"0";const a={USD:{symbol:"$",locale:"en-US"},SAR:{symbol:"ر.س",locale:"ar-SA"},EUR:{symbol:"€",locale:"de-DE"},GBP:{symbol:"£",locale:"en-GB"},AED:{symbol:"د.إ",locale:"ar-AE"}},i=a[s]||a.USD,n=new Intl.NumberFormat(i.locale,{minimumFractionDigits:2,maximumFractionDigits:2}).format(t);return"SAR"===s||"AED"===s?`${n} ${i.symbol}`:`${i.symbol}${n}`}function Ou(e){const s=[];if(e.domain&&s.push(e.domain),e.shortName&&s.push(e.shortName),s.push(e.name),e.domain||e.shortName){const s=[];return e.domain&&s.push(e.domain),e.shortName&&s.push(e.shortName),`(${s.join(", ")}) ${e.name}`}return e.name}const Mu=Id,Vu=$n.forwardRef((({className:e,...s},t)=>Si.jsx(Rd,{ref:t,className:Lu("fixed top-0 z-[10100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...s})));Vu.displayName=Rd.displayName;const Uu=Gn("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full select-text",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),$u=$n.forwardRef((({className:e,variant:s,...t},a)=>Si.jsx(qd,{ref:a,className:Lu(Uu({variant:s}),e),...t})));$u.displayName=qd.displayName;$n.forwardRef((({className:e,...s},t)=>Si.jsx(Vd,{ref:t,className:Lu("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive select-none",e),...s}))).displayName=Vd.displayName;const zu=$n.forwardRef((({className:e,...s},t)=>Si.jsx(Ud,{ref:t,className:Lu("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...s,children:Si.jsx(Tr,{className:"h-4 w-4"})})));zu.displayName=Ud.displayName;const Bu=$n.forwardRef((({className:e,...s},t)=>Si.jsx(Od,{ref:t,className:Lu("text-sm font-semibold select-text",e),...s})));Bu.displayName=Od.displayName;const Ku=$n.forwardRef((({className:e,...s},t)=>Si.jsx(Md,{ref:t,className:Lu("text-sm opacity-90 select-text whitespace-pre-wrap",e),...s})));function Qu(){const{toasts:e}=sd();return Si.jsxs(Mu,{children:[e.map((function({id:e,title:s,description:t,action:a,...i}){return Si.jsxs($u,{...i,children:[Si.jsxs("div",{className:"grid gap-1",children:[s&&Si.jsx(Bu,{children:s}),t&&Si.jsx(Ku,{children:t})]}),a,Si.jsx(zu,{})]},e)})),Si.jsx(Vu,{})]})}Ku.displayName=Md.displayName;const Gu=Array(12).fill(0),Wu=({visible:e,className:s})=>Bn.createElement("div",{className:["sonner-loading-wrapper",s].filter(Boolean).join(" "),"data-visible":e},Bn.createElement("div",{className:"sonner-spinner"},Gu.map(((e,s)=>Bn.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${s}`}))))),Hu=Bn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Bn.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Yu=Bn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Bn.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Ju=Bn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Bn.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Xu=Bn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Bn.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Zu=Bn.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Bn.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Bn.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}));let em=1;const sm=new class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{const s=this.subscribers.indexOf(e);this.subscribers.splice(s,1)}),this.publish=e=>{this.subscribers.forEach((s=>s(e)))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var s;const{message:t,...a}=e,i="number"==typeof(null==e?void 0:e.id)||(null==(s=e.id)?void 0:s.length)>0?e.id:em++,n=this.toasts.find((e=>e.id===i)),r=void 0===e.dismissible||e.dismissible;return this.dismissedToasts.has(i)&&this.dismissedToasts.delete(i),n?this.toasts=this.toasts.map((s=>s.id===i?(this.publish({...s,...e,id:i,title:t}),{...s,...e,id:i,dismissible:r,title:t}):s)):this.addToast({title:t,...a,dismissible:r,id:i}),i},this.dismiss=e=>(e?(this.dismissedToasts.add(e),requestAnimationFrame((()=>this.subscribers.forEach((s=>s({id:e,dismiss:!0})))))):this.toasts.forEach((e=>{this.subscribers.forEach((s=>s({id:e.id,dismiss:!0})))})),e),this.message=(e,s)=>this.create({...s,message:e}),this.error=(e,s)=>this.create({...s,message:e,type:"error"}),this.success=(e,s)=>this.create({...s,type:"success",message:e}),this.info=(e,s)=>this.create({...s,type:"info",message:e}),this.warning=(e,s)=>this.create({...s,type:"warning",message:e}),this.loading=(e,s)=>this.create({...s,type:"loading",message:e}),this.promise=(e,s)=>{if(!s)return;let t;void 0!==s.loading&&(t=this.create({...s,promise:e,type:"loading",message:s.loading,description:"function"!=typeof s.description?s.description:void 0}));const a=Promise.resolve(e instanceof Function?e():e);let i,n=void 0!==t;const r=a.then((async e=>{i=["resolve",e];if(Bn.isValidElement(e))n=!1,this.create({id:t,type:"default",message:e});else if(tm(e)&&!e.ok){n=!1;const a="function"==typeof s.error?await s.error(`HTTP error! status: ${e.status}`):s.error,i="function"==typeof s.description?await s.description(`HTTP error! status: ${e.status}`):s.description,r="object"==typeof a&&!Bn.isValidElement(a)?a:{message:a};this.create({id:t,type:"error",description:i,...r})}else if(e instanceof Error){n=!1;const a="function"==typeof s.error?await s.error(e):s.error,i="function"==typeof s.description?await s.description(e):s.description,r="object"==typeof a&&!Bn.isValidElement(a)?a:{message:a};this.create({id:t,type:"error",description:i,...r})}else if(void 0!==s.success){n=!1;const a="function"==typeof s.success?await s.success(e):s.success,i="function"==typeof s.description?await s.description(e):s.description,r="object"==typeof a&&!Bn.isValidElement(a)?a:{message:a};this.create({id:t,type:"success",description:i,...r})}})).catch((async e=>{if(i=["reject",e],void 0!==s.error){n=!1;const a="function"==typeof s.error?await s.error(e):s.error,i="function"==typeof s.description?await s.description(e):s.description,r="object"==typeof a&&!Bn.isValidElement(a)?a:{message:a};this.create({id:t,type:"error",description:i,...r})}})).finally((()=>{n&&(this.dismiss(t),t=void 0),null==s.finally||s.finally.call(s)})),l=()=>new Promise(((e,s)=>r.then((()=>"reject"===i[0]?s(i[1]):e(i[1]))).catch(s)));return"string"!=typeof t&&"number"!=typeof t?{unwrap:l}:Object.assign(t,{unwrap:l})},this.custom=(e,s)=>{const t=(null==s?void 0:s.id)||em++;return this.create({jsx:e(t),id:t,...s}),t},this.getActiveToasts=()=>this.toasts.filter((e=>!this.dismissedToasts.has(e.id))),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},tm=e=>e&&"object"==typeof e&&"ok"in e&&"boolean"==typeof e.ok&&"status"in e&&"number"==typeof e.status,am=(e,s)=>{const t=(null==s?void 0:s.id)||em++;return sm.addToast({title:e,...s,id:t}),t},im=Object.assign(am,{success:sm.success,info:sm.info,warning:sm.warning,error:sm.error,custom:sm.custom,message:sm.message,promise:sm.promise,dismiss:sm.dismiss,loading:sm.loading},{getHistory:()=>sm.toasts,getToasts:()=>sm.getActiveToasts()});function nm(e){return void 0!==e.label}!function(e){if("undefined"==typeof document)return;let s=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",s.appendChild(t),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");const rm=3,lm=14;function cm(...e){return e.filter(Boolean).join(" ")}const om=e=>{var s,t,a,i,n,r,l,c,o;const{invert:d,toast:u,unstyled:m,interacting:h,setHeights:x,visibleToasts:p,heights:f,index:g,toasts:j,expanded:v,removeToast:y,defaultRichColors:b,closeButton:N,style:w,cancelButtonStyle:C,actionButtonStyle:S,className:T="",descriptionClassName:k="",duration:D,position:E,gap:A,expandByDefault:P,classNames:_,icons:F,closeButtonAriaLabel:L="Close toast"}=e,[I,R]=Bn.useState(null),[q,O]=Bn.useState(null),[M,V]=Bn.useState(!1),[U,$]=Bn.useState(!1),[z,B]=Bn.useState(!1),[K,Q]=Bn.useState(!1),[G,W]=Bn.useState(!1),[H,Y]=Bn.useState(0),[J,X]=Bn.useState(0),Z=Bn.useRef(u.duration||D||4e3),ee=Bn.useRef(null),se=Bn.useRef(null),te=0===g,ae=g+1<=p,ie=u.type,ne=!1!==u.dismissible,re=u.className||"",le=u.descriptionClassName||"",ce=Bn.useMemo((()=>f.findIndex((e=>e.toastId===u.id))||0),[f,u.id]),oe=Bn.useMemo((()=>{var e;return null!=(e=u.closeButton)?e:N}),[u.closeButton,N]),de=Bn.useMemo((()=>u.duration||D||4e3),[u.duration,D]),ue=Bn.useRef(0),me=Bn.useRef(0),he=Bn.useRef(0),xe=Bn.useRef(null),[pe,fe]=E.split("-"),ge=Bn.useMemo((()=>f.reduce(((e,s,t)=>t>=ce?e:e+s.height),0)),[f,ce]),je=(()=>{const[e,s]=Bn.useState(document.hidden);return Bn.useEffect((()=>{const e=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",e),()=>window.removeEventListener("visibilitychange",e)}),[]),e})(),ve=u.invert||d,ye="loading"===ie;me.current=Bn.useMemo((()=>ce*A+ge),[ce,ge]),Bn.useEffect((()=>{Z.current=de}),[de]),Bn.useEffect((()=>{V(!0)}),[]),Bn.useEffect((()=>{const e=se.current;if(e){const s=e.getBoundingClientRect().height;return X(s),x((e=>[{toastId:u.id,height:s,position:u.position},...e])),()=>x((e=>e.filter((e=>e.toastId!==u.id))))}}),[x,u.id]),Bn.useLayoutEffect((()=>{if(!M)return;const e=se.current,s=e.style.height;e.style.height="auto";const t=e.getBoundingClientRect().height;e.style.height=s,X(t),x((e=>e.find((e=>e.toastId===u.id))?e.map((e=>e.toastId===u.id?{...e,height:t}:e)):[{toastId:u.id,height:t,position:u.position},...e]))}),[M,u.title,u.description,x,u.id,u.jsx,u.action,u.cancel]);const be=Bn.useCallback((()=>{$(!0),Y(me.current),x((e=>e.filter((e=>e.toastId!==u.id)))),setTimeout((()=>{y(u)}),200)}),[u,y,x,me]);Bn.useEffect((()=>{if(u.promise&&"loading"===ie||u.duration===1/0||"loading"===u.type)return;let e;return v||h||je?(()=>{if(he.current<ue.current){const e=(new Date).getTime()-ue.current;Z.current=Z.current-e}he.current=(new Date).getTime()})():Z.current!==1/0&&(ue.current=(new Date).getTime(),e=setTimeout((()=>{null==u.onAutoClose||u.onAutoClose.call(u,u),be()}),Z.current)),()=>clearTimeout(e)}),[v,h,u,ie,je,be]),Bn.useEffect((()=>{u.delete&&(be(),null==u.onDismiss||u.onDismiss.call(u,u))}),[be,u.delete]);const Ne=u.icon||(null==F?void 0:F[ie])||(e=>{switch(e){case"success":return Hu;case"info":return Ju;case"warning":return Yu;case"error":return Xu;default:return null}})(ie);var we,Ce,Se,Te;return Bn.createElement("li",{tabIndex:0,ref:se,className:cm(T,re,null==_?void 0:_.toast,null==u||null==(s=u.classNames)?void 0:s.toast,null==_?void 0:_.default,null==_?void 0:_[ie],null==u||null==(t=u.classNames)?void 0:t[ie]),"data-sonner-toast":"","data-rich-colors":null!=(we=u.richColors)?we:b,"data-styled":!Boolean(u.jsx||u.unstyled||m),"data-mounted":M,"data-promise":Boolean(u.promise),"data-swiped":G,"data-removed":U,"data-visible":ae,"data-y-position":pe,"data-x-position":fe,"data-index":g,"data-front":te,"data-swiping":z,"data-dismissible":ne,"data-type":ie,"data-invert":ve,"data-swipe-out":K,"data-swipe-direction":q,"data-expanded":Boolean(v||P&&M),style:{"--index":g,"--toasts-before":g,"--z-index":j.length-g,"--offset":`${U?H:me.current}px`,"--initial-height":P?"auto":`${J}px`,...w,...u.style},onDragEnd:()=>{B(!1),R(null),xe.current=null},onPointerDown:e=>{!ye&&ne&&(ee.current=new Date,Y(me.current),e.target.setPointerCapture(e.pointerId),"BUTTON"!==e.target.tagName&&(B(!0),xe.current={x:e.clientX,y:e.clientY}))},onPointerUp:()=>{var e,s,t;if(K||!ne)return;xe.current=null;const a=Number((null==(e=se.current)?void 0:e.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),i=Number((null==(s=se.current)?void 0:s.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),n=(new Date).getTime()-(null==(t=ee.current)?void 0:t.getTime()),r="x"===I?a:i,l=Math.abs(r)/n;if(Math.abs(r)>=45||l>.11)return Y(me.current),null==u.onDismiss||u.onDismiss.call(u,u),O("x"===I?a>0?"right":"left":i>0?"down":"up"),be(),void Q(!0);var c,o;null==(c=se.current)||c.style.setProperty("--swipe-amount-x","0px"),null==(o=se.current)||o.style.setProperty("--swipe-amount-y","0px"),W(!1),B(!1),R(null)},onPointerMove:s=>{var t,a,i;if(!xe.current||!ne)return;if((null==(t=window.getSelection())?void 0:t.toString().length)>0)return;const n=s.clientY-xe.current.y,r=s.clientX-xe.current.x;var l;const c=null!=(l=e.swipeDirections)?l:function(e){const[s,t]=e.split("-"),a=[];return s&&a.push(s),t&&a.push(t),a}(E);!I&&(Math.abs(r)>1||Math.abs(n)>1)&&R(Math.abs(r)>Math.abs(n)?"x":"y");let o={x:0,y:0};const d=e=>1/(1.5+Math.abs(e)/20);if("y"===I){if(c.includes("top")||c.includes("bottom"))if(c.includes("top")&&n<0||c.includes("bottom")&&n>0)o.y=n;else{const e=n*d(n);o.y=Math.abs(e)<Math.abs(n)?e:n}}else if("x"===I&&(c.includes("left")||c.includes("right")))if(c.includes("left")&&r<0||c.includes("right")&&r>0)o.x=r;else{const e=r*d(r);o.x=Math.abs(e)<Math.abs(r)?e:r}(Math.abs(o.x)>0||Math.abs(o.y)>0)&&W(!0),null==(a=se.current)||a.style.setProperty("--swipe-amount-x",`${o.x}px`),null==(i=se.current)||i.style.setProperty("--swipe-amount-y",`${o.y}px`)}},oe&&!u.jsx&&"loading"!==ie?Bn.createElement("button",{"aria-label":L,"data-disabled":ye,"data-close-button":!0,onClick:ye||!ne?()=>{}:()=>{be(),null==u.onDismiss||u.onDismiss.call(u,u)},className:cm(null==_?void 0:_.closeButton,null==u||null==(a=u.classNames)?void 0:a.closeButton)},null!=(Ce=null==F?void 0:F.close)?Ce:Zu):null,(ie||u.icon||u.promise)&&null!==u.icon&&(null!==(null==F?void 0:F[ie])||u.icon)?Bn.createElement("div",{"data-icon":"",className:cm(null==_?void 0:_.icon,null==u||null==(i=u.classNames)?void 0:i.icon)},u.promise||"loading"===u.type&&!u.icon?u.icon||((null==F?void 0:F.loading)?Bn.createElement("div",{className:cm(null==_?void 0:_.loader,null==u||null==(Te=u.classNames)?void 0:Te.loader,"sonner-loader"),"data-visible":"loading"===ie},F.loading):Bn.createElement(Wu,{className:cm(null==_?void 0:_.loader,null==u||null==(Se=u.classNames)?void 0:Se.loader),visible:"loading"===ie})):null,"loading"!==u.type?Ne:null):null,Bn.createElement("div",{"data-content":"",className:cm(null==_?void 0:_.content,null==u||null==(n=u.classNames)?void 0:n.content)},Bn.createElement("div",{"data-title":"",className:cm(null==_?void 0:_.title,null==u||null==(r=u.classNames)?void 0:r.title)},u.jsx?u.jsx:"function"==typeof u.title?u.title():u.title),u.description?Bn.createElement("div",{"data-description":"",className:cm(k,le,null==_?void 0:_.description,null==u||null==(l=u.classNames)?void 0:l.description)},"function"==typeof u.description?u.description():u.description):null),Bn.isValidElement(u.cancel)?u.cancel:u.cancel&&nm(u.cancel)?Bn.createElement("button",{"data-button":!0,"data-cancel":!0,style:u.cancelButtonStyle||C,onClick:e=>{nm(u.cancel)&&ne&&(null==u.cancel.onClick||u.cancel.onClick.call(u.cancel,e),be())},className:cm(null==_?void 0:_.cancelButton,null==u||null==(c=u.classNames)?void 0:c.cancelButton)},u.cancel.label):null,Bn.isValidElement(u.action)?u.action:u.action&&nm(u.action)?Bn.createElement("button",{"data-button":!0,"data-action":!0,style:u.actionButtonStyle||S,onClick:e=>{nm(u.action)&&(null==u.action.onClick||u.action.onClick.call(u.action,e),e.defaultPrevented||be())},className:cm(null==_?void 0:_.actionButton,null==u||null==(o=u.classNames)?void 0:o.actionButton)},u.action.label):null)};function dm(){if("undefined"==typeof window)return"ltr";if("undefined"==typeof document)return"ltr";const e=document.documentElement.getAttribute("dir");return"auto"!==e&&e?e:window.getComputedStyle(document.documentElement).direction}function um(e,s){const t={};return[e,s].forEach(((e,s)=>{const a=1===s,i=a?"--mobile-offset":"--offset",n=a?"16px":"24px";function r(e){["top","right","bottom","left"].forEach((s=>{t[`${i}-${s}`]="number"==typeof e?`${e}px`:e}))}"number"==typeof e||"string"==typeof e?r(e):"object"==typeof e?["top","right","bottom","left"].forEach((s=>{void 0===e[s]?t[`${i}-${s}`]=n:t[`${i}-${s}`]="number"==typeof e[s]?`${e[s]}px`:e[s]})):r(n)})),t}const mm=Bn.forwardRef((function(e,s){const{invert:t,position:a="bottom-right",hotkey:i=["altKey","KeyT"],expand:n,closeButton:r,className:l,offset:c,mobileOffset:o,theme:d="light",richColors:u,duration:m,style:h,visibleToasts:x=rm,toastOptions:p,dir:f=dm(),gap:g=lm,icons:j,containerAriaLabel:v="Notifications"}=e,[y,b]=Bn.useState([]),N=Bn.useMemo((()=>Array.from(new Set([a].concat(y.filter((e=>e.position)).map((e=>e.position)))))),[y,a]),[w,C]=Bn.useState([]),[S,T]=Bn.useState(!1),[k,D]=Bn.useState(!1),[E,A]=Bn.useState("system"!==d?d:"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),P=Bn.useRef(null),_=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),F=Bn.useRef(null),L=Bn.useRef(!1),I=Bn.useCallback((e=>{b((s=>{var t;return(null==(t=s.find((s=>s.id===e.id)))?void 0:t.delete)||sm.dismiss(e.id),s.filter((({id:s})=>s!==e.id))}))}),[]);return Bn.useEffect((()=>sm.subscribe((e=>{e.dismiss?requestAnimationFrame((()=>{b((s=>s.map((s=>s.id===e.id?{...s,delete:!0}:s))))})):setTimeout((()=>{Kn.flushSync((()=>{b((s=>{const t=s.findIndex((s=>s.id===e.id));return-1!==t?[...s.slice(0,t),{...s[t],...e},...s.slice(t+1)]:[e,...s]}))}))}))}))),[y]),Bn.useEffect((()=>{if("system"!==d)return void A(d);if("system"===d&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?A("dark"):A("light")),"undefined"==typeof window)return;const e=window.matchMedia("(prefers-color-scheme: dark)");try{e.addEventListener("change",(({matches:e})=>{A(e?"dark":"light")}))}catch(s){e.addListener((({matches:e})=>{try{A(e?"dark":"light")}catch(s){}}))}}),[d]),Bn.useEffect((()=>{y.length<=1&&T(!1)}),[y]),Bn.useEffect((()=>{const e=e=>{var s;var t;i.every((s=>e[s]||e.code===s))&&(T(!0),null==(t=P.current)||t.focus());"Escape"!==e.code||document.activeElement!==P.current&&!(null==(s=P.current)?void 0:s.contains(document.activeElement))||T(!1)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[i]),Bn.useEffect((()=>{if(P.current)return()=>{F.current&&(F.current.focus({preventScroll:!0}),F.current=null,L.current=!1)}}),[P.current]),Bn.createElement("section",{ref:s,"aria-label":`${v} ${_}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},N.map(((s,a)=>{var i;const[d,v]=s.split("-");return y.length?Bn.createElement("ol",{key:s,dir:"auto"===f?dm():f,tabIndex:-1,ref:P,className:l,"data-sonner-toaster":!0,"data-sonner-theme":E,"data-y-position":d,"data-x-position":v,style:{"--front-toast-height":`${(null==(i=w[0])?void 0:i.height)||0}px`,"--width":"356px","--gap":`${g}px`,...h,...um(c,o)},onBlur:e=>{L.current&&!e.currentTarget.contains(e.relatedTarget)&&(L.current=!1,F.current&&(F.current.focus({preventScroll:!0}),F.current=null))},onFocus:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||L.current||(L.current=!0,F.current=e.relatedTarget)},onMouseEnter:()=>T(!0),onMouseMove:()=>T(!0),onMouseLeave:()=>{k||T(!1)},onDragEnd:()=>T(!1),onPointerDown:e=>{e.target instanceof HTMLElement&&"false"===e.target.dataset.dismissible||D(!0)},onPointerUp:()=>D(!1)},y.filter((e=>!e.position&&0===a||e.position===s)).map(((a,i)=>{var l,c;return Bn.createElement(om,{key:a.id,icons:j,index:i,toast:a,defaultRichColors:u,duration:null!=(l=null==p?void 0:p.duration)?l:m,className:null==p?void 0:p.className,descriptionClassName:null==p?void 0:p.descriptionClassName,invert:t,visibleToasts:x,closeButton:null!=(c=null==p?void 0:p.closeButton)?c:r,interacting:k,position:s,style:null==p?void 0:p.style,unstyled:null==p?void 0:p.unstyled,classNames:null==p?void 0:p.classNames,cancelButtonStyle:null==p?void 0:p.cancelButtonStyle,actionButtonStyle:null==p?void 0:p.actionButtonStyle,closeButtonAriaLabel:null==p?void 0:p.closeButtonAriaLabel,removeToast:I,toasts:y.filter((e=>e.position==a.position)),heights:w.filter((e=>e.position==a.position)),setHeights:C,expandByDefault:n,gap:g,expanded:S,swipeDirections:e.swipeDirections})}))):null})))}));var hm=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},xm="undefined"==typeof window||"Deno"in globalThis;function pm(){}function fm(e){return"number"==typeof e&&e>=0&&e!==1/0}function gm(e,s){return Math.max(e+(s||0)-Date.now(),0)}function jm(e,s){return"function"==typeof e?e(s):e}function vm(e,s){return"function"==typeof e?e(s):e}function ym(e,s){const{type:t="all",exact:a,fetchStatus:i,predicate:n,queryKey:r,stale:l}=e;if(r)if(a){if(s.queryHash!==Nm(r,s.options))return!1}else if(!Cm(s.queryKey,r))return!1;if("all"!==t){const e=s.isActive();if("active"===t&&!e)return!1;if("inactive"===t&&e)return!1}return("boolean"!=typeof l||s.isStale()===l)&&((!i||i===s.state.fetchStatus)&&!(n&&!n(s)))}function bm(e,s){const{exact:t,status:a,predicate:i,mutationKey:n}=e;if(n){if(!s.options.mutationKey)return!1;if(t){if(wm(s.options.mutationKey)!==wm(n))return!1}else if(!Cm(s.options.mutationKey,n))return!1}return(!a||s.state.status===a)&&!(i&&!i(s))}function Nm(e,s){return((null==s?void 0:s.queryKeyHashFn)||wm)(e)}function wm(e){return JSON.stringify(e,((e,s)=>Dm(s)?Object.keys(s).sort().reduce(((e,t)=>(e[t]=s[t],e)),{}):s))}function Cm(e,s){return e===s||typeof e==typeof s&&(!(!e||!s||"object"!=typeof e||"object"!=typeof s)&&Object.keys(s).every((t=>Cm(e[t],s[t]))))}function Sm(e,s){if(e===s)return e;const t=km(e)&&km(s);if(t||Dm(e)&&Dm(s)){const a=t?e:Object.keys(e),i=a.length,n=t?s:Object.keys(s),r=n.length,l=t?[]:{},c=new Set(a);let o=0;for(let d=0;d<r;d++){const a=t?d:n[d];(!t&&c.has(a)||t)&&void 0===e[a]&&void 0===s[a]?(l[a]=void 0,o++):(l[a]=Sm(e[a],s[a]),l[a]===e[a]&&void 0!==e[a]&&o++)}return i===r&&o===i?e:l}return s}function Tm(e,s){if(!s||Object.keys(e).length!==Object.keys(s).length)return!1;for(const t in e)if(e[t]!==s[t])return!1;return!0}function km(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function Dm(e){if(!Em(e))return!1;const s=e.constructor;if(void 0===s)return!0;const t=s.prototype;return!!Em(t)&&(!!t.hasOwnProperty("isPrototypeOf")&&Object.getPrototypeOf(e)===Object.prototype)}function Em(e){return"[object Object]"===Object.prototype.toString.call(e)}function Am(e,s,t){return"function"==typeof t.structuralSharing?t.structuralSharing(e,s):!1!==t.structuralSharing?Sm(e,s):s}function Pm(e,s,t=0){const a=[...e,s];return t&&a.length>t?a.slice(1):a}function _m(e,s,t=0){const a=[s,...e];return t&&a.length>t?a.slice(0,-1):a}var Fm=Symbol();function Lm(e,s){return!e.queryFn&&(null==s?void 0:s.initialPromise)?()=>s.initialPromise:e.queryFn&&e.queryFn!==Fm?e.queryFn:()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`))}function Im(e,s){return"function"==typeof e?e(...s):!!e}var Rm=new(a=class extends hm{constructor(){super(),ji(this,e),ji(this,s),ji(this,t),vi(this,t,(e=>{if(!xm&&window.addEventListener){const s=()=>e();return window.addEventListener("visibilitychange",s,!1),()=>{window.removeEventListener("visibilitychange",s)}}}))}onSubscribe(){gi(this,s)||this.setEventListener(gi(this,t))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=gi(this,s))||e.call(this),vi(this,s,void 0))}setEventListener(e){var a;vi(this,t,e),null==(a=gi(this,s))||a.call(this),vi(this,s,e((e=>{"boolean"==typeof e?this.setFocused(e):this.onFocus()})))}setFocused(s){gi(this,e)!==s&&(vi(this,e,s),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach((s=>{s(e)}))}isFocused(){var s;return"boolean"==typeof gi(this,e)?gi(this,e):"hidden"!==(null==(s=globalThis.document)?void 0:s.visibilityState)}},e=new WeakMap,s=new WeakMap,t=new WeakMap,a),qm=new(l=class extends hm{constructor(){super(),ji(this,i,!0),ji(this,n),ji(this,r),vi(this,r,(e=>{if(!xm&&window.addEventListener){const s=()=>e(!0),t=()=>e(!1);return window.addEventListener("online",s,!1),window.addEventListener("offline",t,!1),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",t)}}}))}onSubscribe(){gi(this,n)||this.setEventListener(gi(this,r))}onUnsubscribe(){var e;this.hasListeners()||(null==(e=gi(this,n))||e.call(this),vi(this,n,void 0))}setEventListener(e){var s;vi(this,r,e),null==(s=gi(this,n))||s.call(this),vi(this,n,e(this.setOnline.bind(this)))}setOnline(e){gi(this,i)!==e&&(vi(this,i,e),this.listeners.forEach((s=>{s(e)})))}isOnline(){return gi(this,i)}},i=new WeakMap,n=new WeakMap,r=new WeakMap,l);function Om(){let e,s;const t=new Promise(((t,a)=>{e=t,s=a}));function a(e){Object.assign(t,e),delete t.resolve,delete t.reject}return t.status="pending",t.catch((()=>{})),t.resolve=s=>{a({status:"fulfilled",value:s}),e(s)},t.reject=e=>{a({status:"rejected",reason:e}),s(e)},t}function Mm(e){return Math.min(1e3*2**e,3e4)}function Vm(e){return"online"!==(e??"online")||qm.isOnline()}var Um=class extends Error{constructor(e){super("CancelledError"),this.revert=null==e?void 0:e.revert,this.silent=null==e?void 0:e.silent}};function $m(e){return e instanceof Um}function zm(e){let s,t=!1,a=0,i=!1;const n=Om(),r=()=>Rm.isFocused()&&("always"===e.networkMode||qm.isOnline())&&e.canRun(),l=()=>Vm(e.networkMode)&&e.canRun(),c=t=>{var a;i||(i=!0,null==(a=e.onSuccess)||a.call(e,t),null==s||s(),n.resolve(t))},o=t=>{var a;i||(i=!0,null==(a=e.onError)||a.call(e,t),null==s||s(),n.reject(t))},d=()=>new Promise((t=>{var a;s=e=>{(i||r())&&t(e)},null==(a=e.onPause)||a.call(e)})).then((()=>{var t;s=void 0,i||null==(t=e.onContinue)||t.call(e)})),u=()=>{if(i)return;let s;const n=0===a?e.initialPromise:void 0;try{s=n??e.fn()}catch(l){s=Promise.reject(l)}Promise.resolve(s).then(c).catch((s=>{var n;if(i)return;const l=e.retry??(xm?0:3),c=e.retryDelay??Mm,m="function"==typeof c?c(a,s):c,h=!0===l||"number"==typeof l&&a<l||"function"==typeof l&&l(a,s);var x;!t&&h?(a++,null==(n=e.onFail)||n.call(e,a,s),(x=m,new Promise((e=>{setTimeout(e,x)}))).then((()=>r()?void 0:d())).then((()=>{t?o(s):u()}))):o(s)}))};return{promise:n,cancel:s=>{var t;i||(o(new Um(s)),null==(t=e.abort)||t.call(e))},continue:()=>(null==s||s(),n),cancelRetry:()=>{t=!0},continueRetry:()=>{t=!1},canStart:l,start:()=>(l()?u():d().then(u),n)}}var Bm=e=>setTimeout(e,0);var Km=function(){let e=[],s=0,t=e=>{e()},a=e=>{e()},i=Bm;const n=a=>{s?e.push(a):i((()=>{t(a)}))};return{batch:n=>{let r;s++;try{r=n()}finally{s--,s||(()=>{const s=e;e=[],s.length&&i((()=>{a((()=>{s.forEach((e=>{t(e)}))}))}))})()}return r},batchCalls:e=>(...s)=>{n((()=>{e(...s)}))},schedule:n,setNotifyFunction:e=>{t=e},setBatchNotifyFunction:e=>{a=e},setScheduler:e=>{i=e}}}(),Qm=(o=class{constructor(){ji(this,c)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),fm(this.gcTime)&&vi(this,c,setTimeout((()=>{this.optionalRemove()}),this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(xm?1/0:3e5))}clearGcTimeout(){gi(this,c)&&(clearTimeout(gi(this,c)),vi(this,c,void 0))}},c=new WeakMap,o),Gm=(v=class extends Qm{constructor(e){super(),ji(this,g),ji(this,d),ji(this,u),ji(this,m),ji(this,h),ji(this,x),ji(this,p),ji(this,f),vi(this,f,!1),vi(this,p,e.defaultOptions),this.setOptions(e.options),this.observers=[],vi(this,h,e.client),vi(this,m,gi(this,h).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,vi(this,d,function(e){const s="function"==typeof e.initialData?e.initialData():e.initialData,t=void 0!==s,a=t?"function"==typeof e.initialDataUpdatedAt?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:t?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}(this.options)),this.state=e.state??gi(this,d),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return null==(e=gi(this,x))?void 0:e.promise}setOptions(e){this.options={...gi(this,p),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){this.observers.length||"idle"!==this.state.fetchStatus||gi(this,m).remove(this)}setData(e,s){const t=Am(this.state.data,e,this.options);return yi(this,g,j).call(this,{data:t,type:"success",dataUpdatedAt:null==s?void 0:s.updatedAt,manual:null==s?void 0:s.manual}),t}setState(e,s){yi(this,g,j).call(this,{type:"setState",state:e,setStateOptions:s})}cancel(e){var s,t;const a=null==(s=gi(this,x))?void 0:s.promise;return null==(t=gi(this,x))||t.cancel(e),a?a.then(pm).catch(pm):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(gi(this,d))}isActive(){return this.observers.some((e=>!1!==vm(e.options.enabled,this)))}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Fm||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0&&this.observers.some((e=>"static"===jm(e.options.staleTime,this)))}isStale(){return this.getObserversCount()>0?this.observers.some((e=>e.getCurrentResult().isStale)):void 0===this.state.data||this.state.isInvalidated}isStaleByTime(e=0){return void 0===this.state.data||"static"!==e&&(!!this.state.isInvalidated||!gm(this.state.dataUpdatedAt,e))}onFocus(){var e;const s=this.observers.find((e=>e.shouldFetchOnWindowFocus()));null==s||s.refetch({cancelRefetch:!1}),null==(e=gi(this,x))||e.continue()}onOnline(){var e;const s=this.observers.find((e=>e.shouldFetchOnReconnect()));null==s||s.refetch({cancelRefetch:!1}),null==(e=gi(this,x))||e.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),gi(this,m).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter((s=>s!==e)),this.observers.length||(gi(this,x)&&(gi(this,f)?gi(this,x).cancel({revert:!0}):gi(this,x).cancelRetry()),this.scheduleGc()),gi(this,m).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||yi(this,g,j).call(this,{type:"invalidate"})}fetch(e,s){var t,a,i;if("idle"!==this.state.fetchStatus)if(void 0!==this.state.data&&(null==s?void 0:s.cancelRefetch))this.cancel({silent:!0});else if(gi(this,x))return gi(this,x).continueRetry(),gi(this,x).promise;if(e&&this.setOptions(e),!this.options.queryFn){const e=this.observers.find((e=>e.options.queryFn));e&&this.setOptions(e.options)}const n=new AbortController,r=e=>{Object.defineProperty(e,"signal",{enumerable:!0,get:()=>(vi(this,f,!0),n.signal)})},l=()=>{const e=Lm(this.options,s),t=(()=>{const e={client:gi(this,h),queryKey:this.queryKey,meta:this.meta};return r(e),e})();return vi(this,f,!1),this.options.persister?this.options.persister(e,t,this):e(t)},c=(()=>{const e={fetchOptions:s,options:this.options,queryKey:this.queryKey,client:gi(this,h),state:this.state,fetchFn:l};return r(e),e})();null==(t=this.options.behavior)||t.onFetch(c,this),vi(this,u,this.state),"idle"!==this.state.fetchStatus&&this.state.fetchMeta===(null==(a=c.fetchOptions)?void 0:a.meta)||yi(this,g,j).call(this,{type:"fetch",meta:null==(i=c.fetchOptions)?void 0:i.meta});const o=e=>{var s,t,a,i;$m(e)&&e.silent||yi(this,g,j).call(this,{type:"error",error:e}),$m(e)||(null==(t=(s=gi(this,m).config).onError)||t.call(s,e,this),null==(i=(a=gi(this,m).config).onSettled)||i.call(a,this.state.data,e,this)),this.scheduleGc()};return vi(this,x,zm({initialPromise:null==s?void 0:s.initialPromise,fn:c.fetchFn,abort:n.abort.bind(n),onSuccess:e=>{var s,t,a,i;if(void 0!==e){try{this.setData(e)}catch(n){return void o(n)}null==(t=(s=gi(this,m).config).onSuccess)||t.call(s,e,this),null==(i=(a=gi(this,m).config).onSettled)||i.call(a,e,this.state.error,this),this.scheduleGc()}else o(new Error(`${this.queryHash} data is undefined`))},onError:o,onFail:(e,s)=>{yi(this,g,j).call(this,{type:"failed",failureCount:e,error:s})},onPause:()=>{yi(this,g,j).call(this,{type:"pause"})},onContinue:()=>{yi(this,g,j).call(this,{type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0})),gi(this,x).start()}},d=new WeakMap,u=new WeakMap,m=new WeakMap,h=new WeakMap,x=new WeakMap,p=new WeakMap,f=new WeakMap,g=new WeakSet,j=function(e){this.state=(s=>{switch(e.type){case"failed":return{...s,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...Wm(s.data,this.options),fetchMeta:e.meta??null};case"success":return{...s,data:e.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const t=e.error;return $m(t)&&t.revert&&gi(this,u)?{...gi(this,u),fetchStatus:"idle"}:{...s,error:t,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:t,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...e.state}}})(this.state),Km.batch((()=>{this.observers.forEach((e=>{e.onQueryUpdate()})),gi(this,m).notify({query:this,type:"updated",action:e})}))},v);function Wm(e,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Vm(s.networkMode)?"fetching":"paused",...void 0===e&&{error:null,status:"pending"}}}var Hm=(b=class extends hm{constructor(e={}){super(),ji(this,y),this.config=e,vi(this,y,new Map)}build(e,s,t){const a=s.queryKey,i=s.queryHash??Nm(a,s);let n=this.get(i);return n||(n=new Gm({client:e,queryKey:a,queryHash:i,options:e.defaultQueryOptions(s),state:t,defaultOptions:e.getQueryDefaults(a)}),this.add(n)),n}add(e){gi(this,y).has(e.queryHash)||(gi(this,y).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const s=gi(this,y).get(e.queryHash);s&&(e.destroy(),s===e&&gi(this,y).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Km.batch((()=>{this.getAll().forEach((e=>{this.remove(e)}))}))}get(e){return gi(this,y).get(e)}getAll(){return[...gi(this,y).values()]}find(e){const s={exact:!0,...e};return this.getAll().find((e=>ym(s,e)))}findAll(e={}){const s=this.getAll();return Object.keys(e).length>0?s.filter((s=>ym(e,s))):s}notify(e){Km.batch((()=>{this.listeners.forEach((s=>{s(e)}))}))}onFocus(){Km.batch((()=>{this.getAll().forEach((e=>{e.onFocus()}))}))}onOnline(){Km.batch((()=>{this.getAll().forEach((e=>{e.onOnline()}))}))}},y=new WeakMap,b),Ym=(k=class extends Qm{constructor(e){super(),ji(this,S),ji(this,N),ji(this,w),ji(this,C),this.mutationId=e.mutationId,vi(this,w,e.mutationCache),vi(this,N,[]),this.state=e.state||{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0},this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){gi(this,N).includes(e)||(gi(this,N).push(e),this.clearGcTimeout(),gi(this,w).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){vi(this,N,gi(this,N).filter((s=>s!==e))),this.scheduleGc(),gi(this,w).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){gi(this,N).length||("pending"===this.state.status?this.scheduleGc():gi(this,w).remove(this))}continue(){var e;return(null==(e=gi(this,C))?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var s,t,a,i,n,r,l,c,o,d,u,m,h,x,p,f,g,j,v,y;const b=()=>{yi(this,S,T).call(this,{type:"continue"})};vi(this,C,zm({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(e,s)=>{yi(this,S,T).call(this,{type:"failed",failureCount:e,error:s})},onPause:()=>{yi(this,S,T).call(this,{type:"pause"})},onContinue:b,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>gi(this,w).canRun(this)}));const N="pending"===this.state.status,k=!gi(this,C).canStart();try{if(N)b();else{yi(this,S,T).call(this,{type:"pending",variables:e,isPaused:k}),await(null==(t=(s=gi(this,w).config).onMutate)?void 0:t.call(s,e,this));const n=await(null==(i=(a=this.options).onMutate)?void 0:i.call(a,e));n!==this.state.context&&yi(this,S,T).call(this,{type:"pending",context:n,variables:e,isPaused:k})}const h=await gi(this,C).start();return await(null==(r=(n=gi(this,w).config).onSuccess)?void 0:r.call(n,h,e,this.state.context,this)),await(null==(c=(l=this.options).onSuccess)?void 0:c.call(l,h,e,this.state.context)),await(null==(d=(o=gi(this,w).config).onSettled)?void 0:d.call(o,h,null,this.state.variables,this.state.context,this)),await(null==(m=(u=this.options).onSettled)?void 0:m.call(u,h,null,e,this.state.context)),yi(this,S,T).call(this,{type:"success",data:h}),h}catch(D){try{throw await(null==(x=(h=gi(this,w).config).onError)?void 0:x.call(h,D,e,this.state.context,this)),await(null==(f=(p=this.options).onError)?void 0:f.call(p,D,e,this.state.context)),await(null==(j=(g=gi(this,w).config).onSettled)?void 0:j.call(g,void 0,D,this.state.variables,this.state.context,this)),await(null==(y=(v=this.options).onSettled)?void 0:y.call(v,void 0,D,e,this.state.context)),D}finally{yi(this,S,T).call(this,{type:"error",error:D})}}finally{gi(this,w).runNext(this)}}},N=new WeakMap,w=new WeakMap,C=new WeakMap,S=new WeakSet,T=function(e){this.state=(s=>{switch(e.type){case"failed":return{...s,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...s,isPaused:!0};case"continue":return{...s,isPaused:!1};case"pending":return{...s,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...s,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...s,data:void 0,error:e.error,failureCount:s.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}})(this.state),Km.batch((()=>{gi(this,N).forEach((s=>{s.onMutationUpdate(e)})),gi(this,w).notify({mutation:this,type:"updated",action:e})}))},k);var Jm=(P=class extends hm{constructor(e={}){super(),ji(this,D),ji(this,E),ji(this,A),this.config=e,vi(this,D,new Set),vi(this,E,new Map),vi(this,A,0)}build(e,s,t){const a=new Ym({mutationCache:this,mutationId:++bi(this,A)._,options:e.defaultMutationOptions(s),state:t});return this.add(a),a}add(e){gi(this,D).add(e);const s=Xm(e);if("string"==typeof s){const t=gi(this,E).get(s);t?t.push(e):gi(this,E).set(s,[e])}this.notify({type:"added",mutation:e})}remove(e){if(gi(this,D).delete(e)){const s=Xm(e);if("string"==typeof s){const t=gi(this,E).get(s);if(t)if(t.length>1){const s=t.indexOf(e);-1!==s&&t.splice(s,1)}else t[0]===e&&gi(this,E).delete(s)}}this.notify({type:"removed",mutation:e})}canRun(e){const s=Xm(e);if("string"==typeof s){const t=gi(this,E).get(s),a=null==t?void 0:t.find((e=>"pending"===e.state.status));return!a||a===e}return!0}runNext(e){var s;const t=Xm(e);if("string"==typeof t){const a=null==(s=gi(this,E).get(t))?void 0:s.find((s=>s!==e&&s.state.isPaused));return(null==a?void 0:a.continue())??Promise.resolve()}return Promise.resolve()}clear(){Km.batch((()=>{gi(this,D).forEach((e=>{this.notify({type:"removed",mutation:e})})),gi(this,D).clear(),gi(this,E).clear()}))}getAll(){return Array.from(gi(this,D))}find(e){const s={exact:!0,...e};return this.getAll().find((e=>bm(s,e)))}findAll(e={}){return this.getAll().filter((s=>bm(e,s)))}notify(e){Km.batch((()=>{this.listeners.forEach((s=>{s(e)}))}))}resumePausedMutations(){const e=this.getAll().filter((e=>e.state.isPaused));return Km.batch((()=>Promise.all(e.map((e=>e.continue().catch(pm))))))}},D=new WeakMap,E=new WeakMap,A=new WeakMap,P);function Xm(e){var s;return null==(s=e.options.scope)?void 0:s.id}function Zm(e){return{onFetch:(s,t)=>{var a,i,n,r,l;const c=s.options,o=null==(n=null==(i=null==(a=s.fetchOptions)?void 0:a.meta)?void 0:i.fetchMore)?void 0:n.direction,d=(null==(r=s.state.data)?void 0:r.pages)||[],u=(null==(l=s.state.data)?void 0:l.pageParams)||[];let m={pages:[],pageParams:[]},h=0;const x=async()=>{let t=!1;const a=Lm(s.options,s.fetchOptions),i=async(e,i,n)=>{if(t)return Promise.reject();if(null==i&&e.pages.length)return Promise.resolve(e);const r=(()=>{const e={client:s.client,queryKey:s.queryKey,pageParam:i,direction:n?"backward":"forward",meta:s.options.meta};var a;return a=e,Object.defineProperty(a,"signal",{enumerable:!0,get:()=>(s.signal.aborted?t=!0:s.signal.addEventListener("abort",(()=>{t=!0})),s.signal)}),e})(),l=await a(r),{maxPages:c}=s.options,o=n?_m:Pm;return{pages:o(e.pages,l,c),pageParams:o(e.pageParams,i,c)}};if(o&&d.length){const e="backward"===o,s={pages:d,pageParams:u},t=(e?sh:eh)(c,s);m=await i(s,t,e)}else{const s=e??d.length;do{const e=0===h?u[0]??c.initialPageParam:eh(c,m);if(h>0&&null==e)break;m=await i(m,e),h++}while(h<s)}return m};s.options.persister?s.fetchFn=()=>{var e,a;return null==(a=(e=s.options).persister)?void 0:a.call(e,x,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},t)}:s.fetchFn=x}}}function eh(e,{pages:s,pageParams:t}){const a=s.length-1;return s.length>0?e.getNextPageParam(s[a],s,t[a],t):void 0}function sh(e,{pages:s,pageParams:t}){var a;return s.length>0?null==(a=e.getPreviousPageParam)?void 0:a.call(e,s[0],s,t[0],t):void 0}var th=(V=class{constructor(e={}){ji(this,_),ji(this,F),ji(this,L),ji(this,I),ji(this,R),ji(this,q),ji(this,O),ji(this,M),vi(this,_,e.queryCache||new Hm),vi(this,F,e.mutationCache||new Jm),vi(this,L,e.defaultOptions||{}),vi(this,I,new Map),vi(this,R,new Map),vi(this,q,0)}mount(){bi(this,q)._++,1===gi(this,q)&&(vi(this,O,Rm.subscribe((async e=>{e&&(await this.resumePausedMutations(),gi(this,_).onFocus())}))),vi(this,M,qm.subscribe((async e=>{e&&(await this.resumePausedMutations(),gi(this,_).onOnline())}))))}unmount(){var e,s;bi(this,q)._--,0===gi(this,q)&&(null==(e=gi(this,O))||e.call(this),vi(this,O,void 0),null==(s=gi(this,M))||s.call(this),vi(this,M,void 0))}isFetching(e){return gi(this,_).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return gi(this,F).findAll({...e,status:"pending"}).length}getQueryData(e){var s;const t=this.defaultQueryOptions({queryKey:e});return null==(s=gi(this,_).get(t.queryHash))?void 0:s.state.data}ensureQueryData(e){const s=this.defaultQueryOptions(e),t=gi(this,_).build(this,s),a=t.state.data;return void 0===a?this.fetchQuery(e):(e.revalidateIfStale&&t.isStaleByTime(jm(s.staleTime,t))&&this.prefetchQuery(s),Promise.resolve(a))}getQueriesData(e){return gi(this,_).findAll(e).map((({queryKey:e,state:s})=>[e,s.data]))}setQueryData(e,s,t){const a=this.defaultQueryOptions({queryKey:e}),i=gi(this,_).get(a.queryHash),n=function(e,s){return"function"==typeof e?e(s):e}(s,null==i?void 0:i.state.data);if(void 0!==n)return gi(this,_).build(this,a).setData(n,{...t,manual:!0})}setQueriesData(e,s,t){return Km.batch((()=>gi(this,_).findAll(e).map((({queryKey:e})=>[e,this.setQueryData(e,s,t)]))))}getQueryState(e){var s;const t=this.defaultQueryOptions({queryKey:e});return null==(s=gi(this,_).get(t.queryHash))?void 0:s.state}removeQueries(e){const s=gi(this,_);Km.batch((()=>{s.findAll(e).forEach((e=>{s.remove(e)}))}))}resetQueries(e,s){const t=gi(this,_);return Km.batch((()=>(t.findAll(e).forEach((e=>{e.reset()})),this.refetchQueries({type:"active",...e},s))))}cancelQueries(e,s={}){const t={revert:!0,...s},a=Km.batch((()=>gi(this,_).findAll(e).map((e=>e.cancel(t)))));return Promise.all(a).then(pm).catch(pm)}invalidateQueries(e,s={}){return Km.batch((()=>(gi(this,_).findAll(e).forEach((e=>{e.invalidate()})),"none"===(null==e?void 0:e.refetchType)?Promise.resolve():this.refetchQueries({...e,type:(null==e?void 0:e.refetchType)??(null==e?void 0:e.type)??"active"},s))))}refetchQueries(e,s={}){const t={...s,cancelRefetch:s.cancelRefetch??!0},a=Km.batch((()=>gi(this,_).findAll(e).filter((e=>!e.isDisabled()&&!e.isStatic())).map((e=>{let s=e.fetch(void 0,t);return t.throwOnError||(s=s.catch(pm)),"paused"===e.state.fetchStatus?Promise.resolve():s}))));return Promise.all(a).then(pm)}fetchQuery(e){const s=this.defaultQueryOptions(e);void 0===s.retry&&(s.retry=!1);const t=gi(this,_).build(this,s);return t.isStaleByTime(jm(s.staleTime,t))?t.fetch(s):Promise.resolve(t.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(pm).catch(pm)}fetchInfiniteQuery(e){return e.behavior=Zm(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(pm).catch(pm)}ensureInfiniteQueryData(e){return e.behavior=Zm(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return qm.isOnline()?gi(this,F).resumePausedMutations():Promise.resolve()}getQueryCache(){return gi(this,_)}getMutationCache(){return gi(this,F)}getDefaultOptions(){return gi(this,L)}setDefaultOptions(e){vi(this,L,e)}setQueryDefaults(e,s){gi(this,I).set(wm(e),{queryKey:e,defaultOptions:s})}getQueryDefaults(e){const s=[...gi(this,I).values()],t={};return s.forEach((s=>{Cm(e,s.queryKey)&&Object.assign(t,s.defaultOptions)})),t}setMutationDefaults(e,s){gi(this,R).set(wm(e),{mutationKey:e,defaultOptions:s})}getMutationDefaults(e){const s=[...gi(this,R).values()],t={};return s.forEach((s=>{Cm(e,s.mutationKey)&&Object.assign(t,s.defaultOptions)})),t}defaultQueryOptions(e){if(e._defaulted)return e;const s={...gi(this,L).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return s.queryHash||(s.queryHash=Nm(s.queryKey,s)),void 0===s.refetchOnReconnect&&(s.refetchOnReconnect="always"!==s.networkMode),void 0===s.throwOnError&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===Fm&&(s.enabled=!1),s}defaultMutationOptions(e){return(null==e?void 0:e._defaulted)?e:{...gi(this,L).mutations,...(null==e?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){gi(this,_).clear(),gi(this,F).clear()}},_=new WeakMap,F=new WeakMap,L=new WeakMap,I=new WeakMap,R=new WeakMap,q=new WeakMap,O=new WeakMap,M=new WeakMap,V),ah=(me=class extends hm{constructor(e,s){super(),ji(this,te),ji(this,U),ji(this,$),ji(this,z),ji(this,B),ji(this,K),ji(this,Q),ji(this,G),ji(this,W),ji(this,H),ji(this,Y),ji(this,J),ji(this,X),ji(this,Z),ji(this,ee),ji(this,se,new Set),this.options=s,vi(this,U,e),vi(this,W,null),vi(this,G,Om()),this.options.experimental_prefetchInRender||gi(this,G).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(gi(this,$).addObserver(this),ih(gi(this,$),this.options)?yi(this,te,ae).call(this):this.updateResult(),yi(this,te,le).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return nh(gi(this,$),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return nh(gi(this,$),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,yi(this,te,ce).call(this),yi(this,te,oe).call(this),gi(this,$).removeObserver(this)}setOptions(e){const s=this.options,t=gi(this,$);if(this.options=gi(this,U).defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof vm(this.options.enabled,gi(this,$)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");yi(this,te,de).call(this),gi(this,$).setOptions(this.options),s._defaulted&&!Tm(this.options,s)&&gi(this,U).getQueryCache().notify({type:"observerOptionsUpdated",query:gi(this,$),observer:this});const a=this.hasListeners();a&&rh(gi(this,$),t,this.options,s)&&yi(this,te,ae).call(this),this.updateResult(),!a||gi(this,$)===t&&vm(this.options.enabled,gi(this,$))===vm(s.enabled,gi(this,$))&&jm(this.options.staleTime,gi(this,$))===jm(s.staleTime,gi(this,$))||yi(this,te,ie).call(this);const i=yi(this,te,ne).call(this);!a||gi(this,$)===t&&vm(this.options.enabled,gi(this,$))===vm(s.enabled,gi(this,$))&&i===gi(this,ee)||yi(this,te,re).call(this,i)}getOptimisticResult(e){const s=gi(this,U).getQueryCache().build(gi(this,U),e),t=this.createResult(s,e);return function(e,s){if(!Tm(e.getCurrentResult(),s))return!0;return!1}(this,t)&&(vi(this,B,t),vi(this,Q,this.options),vi(this,K,gi(this,$).state)),t}getCurrentResult(){return gi(this,B)}trackResult(e,s){return new Proxy(e,{get:(e,t)=>(this.trackProp(t),null==s||s(t),Reflect.get(e,t))})}trackProp(e){gi(this,se).add(e)}getCurrentQuery(){return gi(this,$)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const s=gi(this,U).defaultQueryOptions(e),t=gi(this,U).getQueryCache().build(gi(this,U),s);return t.fetch().then((()=>this.createResult(t,s)))}fetch(e){return yi(this,te,ae).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then((()=>(this.updateResult(),gi(this,B))))}createResult(e,s){var t;const a=gi(this,$),i=this.options,n=gi(this,B),r=gi(this,K),l=gi(this,Q),c=e!==a?e.state:gi(this,z),{state:o}=e;let d,u={...o},m=!1;if(s._optimisticResults){const t=this.hasListeners(),n=!t&&ih(e,s),r=t&&rh(e,a,s,i);(n||r)&&(u={...u,...Wm(o.data,e.options)}),"isRestoring"===s._optimisticResults&&(u.fetchStatus="idle")}let{error:h,errorUpdatedAt:x,status:p}=u;d=u.data;let f=!1;if(void 0!==s.placeholderData&&void 0===d&&"pending"===p){let e;(null==n?void 0:n.isPlaceholderData)&&s.placeholderData===(null==l?void 0:l.placeholderData)?(e=n.data,f=!0):e="function"==typeof s.placeholderData?s.placeholderData(null==(t=gi(this,J))?void 0:t.state.data,gi(this,J)):s.placeholderData,void 0!==e&&(p="success",d=Am(null==n?void 0:n.data,e,s),m=!0)}if(s.select&&void 0!==d&&!f)if(n&&d===(null==r?void 0:r.data)&&s.select===gi(this,H))d=gi(this,Y);else try{vi(this,H,s.select),d=s.select(d),d=Am(null==n?void 0:n.data,d,s),vi(this,Y,d),vi(this,W,null)}catch(w){vi(this,W,w)}gi(this,W)&&(h=gi(this,W),d=gi(this,Y),x=Date.now(),p="error");const g="fetching"===u.fetchStatus,j="pending"===p,v="error"===p,y=j&&g,b=void 0!==d,N={status:p,fetchStatus:u.fetchStatus,isPending:j,isSuccess:"success"===p,isError:v,isInitialLoading:y,isLoading:y,data:d,dataUpdatedAt:u.dataUpdatedAt,error:h,errorUpdatedAt:x,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>c.dataUpdateCount||u.errorUpdateCount>c.errorUpdateCount,isFetching:g,isRefetching:g&&!j,isLoadingError:v&&!b,isPaused:"paused"===u.fetchStatus,isPlaceholderData:m,isRefetchError:v&&b,isStale:lh(e,s),refetch:this.refetch,promise:gi(this,G)};if(this.options.experimental_prefetchInRender){const s=e=>{"error"===N.status?e.reject(N.error):void 0!==N.data&&e.resolve(N.data)},t=()=>{const e=vi(this,G,N.promise=Om());s(e)},i=gi(this,G);switch(i.status){case"pending":e.queryHash===a.queryHash&&s(i);break;case"fulfilled":"error"!==N.status&&N.data===i.value||t();break;case"rejected":"error"===N.status&&N.error===i.reason||t()}}return N}updateResult(){const e=gi(this,B),s=this.createResult(gi(this,$),this.options);if(vi(this,K,gi(this,$).state),vi(this,Q,this.options),void 0!==gi(this,K).data&&vi(this,J,gi(this,$)),Tm(s,e))return;vi(this,B,s);yi(this,te,ue).call(this,{listeners:(()=>{if(!e)return!0;const{notifyOnChangeProps:s}=this.options,t="function"==typeof s?s():s;if("all"===t||!t&&!gi(this,se).size)return!0;const a=new Set(t??gi(this,se));return this.options.throwOnError&&a.add("error"),Object.keys(gi(this,B)).some((s=>{const t=s;return gi(this,B)[t]!==e[t]&&a.has(t)}))})()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&yi(this,te,le).call(this)}},U=new WeakMap,$=new WeakMap,z=new WeakMap,B=new WeakMap,K=new WeakMap,Q=new WeakMap,G=new WeakMap,W=new WeakMap,H=new WeakMap,Y=new WeakMap,J=new WeakMap,X=new WeakMap,Z=new WeakMap,ee=new WeakMap,se=new WeakMap,te=new WeakSet,ae=function(e){yi(this,te,de).call(this);let s=gi(this,$).fetch(this.options,e);return(null==e?void 0:e.throwOnError)||(s=s.catch(pm)),s},ie=function(){yi(this,te,ce).call(this);const e=jm(this.options.staleTime,gi(this,$));if(xm||gi(this,B).isStale||!fm(e))return;const s=gm(gi(this,B).dataUpdatedAt,e);vi(this,X,setTimeout((()=>{gi(this,B).isStale||this.updateResult()}),s+1))},ne=function(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(gi(this,$)):this.options.refetchInterval)??!1},re=function(e){yi(this,te,oe).call(this),vi(this,ee,e),!xm&&!1!==vm(this.options.enabled,gi(this,$))&&fm(gi(this,ee))&&0!==gi(this,ee)&&vi(this,Z,setInterval((()=>{(this.options.refetchIntervalInBackground||Rm.isFocused())&&yi(this,te,ae).call(this)}),gi(this,ee)))},le=function(){yi(this,te,ie).call(this),yi(this,te,re).call(this,yi(this,te,ne).call(this))},ce=function(){gi(this,X)&&(clearTimeout(gi(this,X)),vi(this,X,void 0))},oe=function(){gi(this,Z)&&(clearInterval(gi(this,Z)),vi(this,Z,void 0))},de=function(){const e=gi(this,U).getQueryCache().build(gi(this,U),this.options);if(e===gi(this,$))return;const s=gi(this,$);vi(this,$,e),vi(this,z,e.state),this.hasListeners()&&(null==s||s.removeObserver(this),e.addObserver(this))},ue=function(e){Km.batch((()=>{e.listeners&&this.listeners.forEach((e=>{e(gi(this,B))})),gi(this,U).getQueryCache().notify({query:gi(this,$),type:"observerResultsUpdated"})}))},me);function ih(e,s){return function(e,s){return!1!==vm(s.enabled,e)&&void 0===e.state.data&&!("error"===e.state.status&&!1===s.retryOnMount)}(e,s)||void 0!==e.state.data&&nh(e,s,s.refetchOnMount)}function nh(e,s,t){if(!1!==vm(s.enabled,e)&&"static"!==jm(s.staleTime,e)){const a="function"==typeof t?t(e):t;return"always"===a||!1!==a&&lh(e,s)}return!1}function rh(e,s,t,a){return(e!==s||!1===vm(a.enabled,e))&&(!t.suspense||"error"!==e.state.status)&&lh(e,t)}function lh(e,s){return!1!==vm(s.enabled,e)&&e.isStaleByTime(jm(s.staleTime,e))}var ch=(ye=class extends hm{constructor(e,s){super(),ji(this,ge),ji(this,he),ji(this,xe),ji(this,pe),ji(this,fe),vi(this,he,e),this.setOptions(s),this.bindMethods(),yi(this,ge,je).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var s;const t=this.options;this.options=gi(this,he).defaultMutationOptions(e),Tm(this.options,t)||gi(this,he).getMutationCache().notify({type:"observerOptionsUpdated",mutation:gi(this,pe),observer:this}),(null==t?void 0:t.mutationKey)&&this.options.mutationKey&&wm(t.mutationKey)!==wm(this.options.mutationKey)?this.reset():"pending"===(null==(s=gi(this,pe))?void 0:s.state.status)&&gi(this,pe).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||null==(e=gi(this,pe))||e.removeObserver(this)}onMutationUpdate(e){yi(this,ge,je).call(this),yi(this,ge,ve).call(this,e)}getCurrentResult(){return gi(this,xe)}reset(){var e;null==(e=gi(this,pe))||e.removeObserver(this),vi(this,pe,void 0),yi(this,ge,je).call(this),yi(this,ge,ve).call(this)}mutate(e,s){var t;return vi(this,fe,s),null==(t=gi(this,pe))||t.removeObserver(this),vi(this,pe,gi(this,he).getMutationCache().build(gi(this,he),this.options)),gi(this,pe).addObserver(this),gi(this,pe).execute(e)}},he=new WeakMap,xe=new WeakMap,pe=new WeakMap,fe=new WeakMap,ge=new WeakSet,je=function(){var e;const s=(null==(e=gi(this,pe))?void 0:e.state)??{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0};vi(this,xe,{...s,isPending:"pending"===s.status,isSuccess:"success"===s.status,isError:"error"===s.status,isIdle:"idle"===s.status,mutate:this.mutate,reset:this.reset})},ve=function(e){Km.batch((()=>{var s,t,a,i,n,r,l,c;if(gi(this,fe)&&this.hasListeners()){const o=gi(this,xe).variables,d=gi(this,xe).context;"success"===(null==e?void 0:e.type)?(null==(t=(s=gi(this,fe)).onSuccess)||t.call(s,e.data,o,d),null==(i=(a=gi(this,fe)).onSettled)||i.call(a,e.data,null,o,d)):"error"===(null==e?void 0:e.type)&&(null==(r=(n=gi(this,fe)).onError)||r.call(n,e.error,o,d),null==(c=(l=gi(this,fe)).onSettled)||c.call(l,void 0,e.error,o,d))}this.listeners.forEach((e=>{e(gi(this,xe))}))}))},ye),oh=$n.createContext(void 0),dh=e=>{const s=$n.useContext(oh);if(!s)throw new Error("No QueryClient set, use QueryClientProvider to set one");return s},uh=({client:e,children:s})=>($n.useEffect((()=>(e.mount(),()=>{e.unmount()})),[e]),Si.jsx(oh.Provider,{value:e,children:s})),mh=$n.createContext(!1);mh.Provider;var hh=$n.createContext(function(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}()),xh=(e,s,t)=>s.fetchOptimistic(e).catch((()=>{t.clearReset()}));function ph(e,s,t){var a,i,n,r,l;const c=$n.useContext(mh),o=$n.useContext(hh),d=dh(),u=d.defaultQueryOptions(e);null==(i=null==(a=d.getDefaultOptions().queries)?void 0:a._experimental_beforeQuery)||i.call(a,u),u._optimisticResults=c?"isRestoring":"optimistic",(e=>{if(e.suspense){const s=e=>"static"===e?e:Math.max(e??1e3,1e3),t=e.staleTime;e.staleTime="function"==typeof t?(...e)=>s(t(...e)):s(t),"number"==typeof e.gcTime&&(e.gcTime=Math.max(e.gcTime,1e3))}})(u),((e,s)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(s.isReset()||(e.retryOnMount=!1))})(u,o),(e=>{$n.useEffect((()=>{e.clearReset()}),[e])})(o);const m=!d.getQueryCache().get(u.queryHash),[h]=$n.useState((()=>new s(d,u))),x=h.getOptimisticResult(u),p=!c&&!1!==e.subscribed;if($n.useSyncExternalStore($n.useCallback((e=>{const s=p?h.subscribe(Km.batchCalls(e)):pm;return h.updateResult(),s}),[h,p]),(()=>h.getCurrentResult()),(()=>h.getCurrentResult())),$n.useEffect((()=>{h.setOptions(u)}),[u,h]),((e,s)=>(null==e?void 0:e.suspense)&&s.isPending)(u,x))throw xh(u,h,o);if((({result:e,errorResetBoundary:s,throwOnError:t,query:a,suspense:i})=>e.isError&&!s.isReset()&&!e.isFetching&&a&&(i&&void 0===e.data||Im(t,[e.error,a])))({result:x,errorResetBoundary:o,throwOnError:u.throwOnError,query:d.getQueryCache().get(u.queryHash),suspense:u.suspense}))throw x.error;if(null==(r=null==(n=d.getDefaultOptions().queries)?void 0:n._experimental_afterQuery)||r.call(n,u,x),u.experimental_prefetchInRender&&!xm&&((e,s)=>e.isLoading&&e.isFetching&&!s)(x,c)){const e=m?xh(u,h,o):null==(l=d.getQueryCache().get(u.queryHash))?void 0:l.promise;null==e||e.catch(pm).finally((()=>{h.updateResult()}))}return u.notifyOnChangeProps?x:h.trackResult(x)}function fh(e,s){return ph(e,ah)}function gh(e,s){const t=dh(),[a]=$n.useState((()=>new ch(t,e)));$n.useEffect((()=>{a.setOptions(e)}),[a,e]);const i=$n.useSyncExternalStore($n.useCallback((e=>a.subscribe(Km.batchCalls(e))),[a]),(()=>a.getCurrentResult()),(()=>a.getCurrentResult())),n=$n.useCallback(((e,s)=>{a.mutate(e,s).catch(pm)}),[a]);if(i.error&&Im(a.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:n,mutateAsync:i.mutate}}async function jh(e){if(!e.ok){const s=await e.text()||e.statusText;throw new Error(`${e.status}: ${s}`)}}async function vh(e,s,t){const a=await fetch(s,{method:e,headers:t?{"Content-Type":"application/json"}:{},body:t?JSON.stringify(t):void 0,credentials:"include"});return await jh(a),a}const yh=({on401:e})=>async({queryKey:s})=>{const t=await fetch(s[0],{credentials:"include"});return"returnNull"===e&&401===t.status?null:(await jh(t),await t.json())},bh=e=>new th({defaultOptions:{queries:{queryFn:yh({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1,onError:e?s=>{e(s,{type:"query_error",timestamp:(new Date).toISOString()})}:void 0},mutations:{retry:!1,onError:e?(s,t,a)=>{e(s,{type:"mutation_error",variables:t,context:a,timestamp:(new Date).toISOString()})}:void 0}}}),Nh=bh(),wh=e=>async s=>{const t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)});if(!t.ok){const e=await t.text()||t.statusText;throw new Error(`${t.status}: ${e}`)}return await t.json()},Ch="admin",Sh="manager",Th="engineer",kh="user",Dh=$n.createContext(void 0);function Eh({children:e}){const{toast:s}=sd(),{data:t,error:a,isLoading:i}=fh({queryKey:["/api/user"],queryFn:yh({on401:"returnNull"})}),n=dh(),r=gh({mutationFn:wh("/api/login"),onSuccess:e=>{n.invalidateQueries({queryKey:["/api/user"]});const t=e.rememberMe?"Welcome back! (Session extended)":"Welcome back!";s({title:"Login successful",description:t})},onError:e=>{s({title:"Login failed",description:e.message,variant:"destructive"})}}),l=gh({mutationFn:wh("/api/auth/ldap/login"),onSuccess:e=>{n.invalidateQueries({queryKey:["/api/user"]});const t=e.rememberMe?`Welcome back, ${e.firstName||e.username}! (Session extended)`:`Welcome back, ${e.firstName||e.username}!`;s({title:"LDAP Login successful",description:t})},onError:e=>{s({title:"LDAP Login failed",description:e.message||"Invalid LDAP credentials or server unavailable",variant:"destructive"})}}),c=gh({mutationFn:wh("/api/logout"),onSuccess:()=>{n.clear(),window.location.href="/login",s({title:"Logged out",description:"You have been logged out successfully."})},onError:e=>{s({title:"Logout failed",description:e.message,variant:"destructive"})}}),o=gh({mutationFn:wh("/api/register"),onSuccess:()=>{n.invalidateQueries({queryKey:["/api/user"]}),s({title:"Registration successful",description:"Welcome! You can now log in."})},onError:e=>{s({title:"Registration failed",description:e.message,variant:"destructive"})}}),d=e=>(null==t?void 0:t.role)===e,u=e=>!!(null==t?void 0:t.role)&&e.includes(t.role);return Si.jsx(Dh.Provider,{value:{user:t??null,isLoading:i,error:a,loginMutation:r,ldapLoginMutation:l,logoutMutation:c,registerMutation:o,hasRole:d,hasAnyRole:u,hasAllRoles:e=>!!(null==t?void 0:t.role)&&e.every((e=>t.role===e)),isAdmin:()=>d(Ch),isManager:()=>d(Sh),isEngineer:()=>d(Th),isUser:()=>d(kh),canManageUsers:()=>d(Ch),canAccessFinancials:()=>u([Ch,Sh]),canManageClients:()=>u([Ch,Sh]),canManageTechnical:()=>u([Ch,Th]),canViewAuditLogs:()=>u([Ch,Sh]),canManageSystem:()=>d(Ch)},children:e})}function Ah(){const e=$n.useContext(Dh);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e}const Ph=$n.createContext(void 0);function _h({children:e,defaultTheme:s="light",storageKey:t="theme"}){const{user:a}=Ah(),[i,n]=$n.useState(s),{data:r}=fh({queryKey:["/api/user/settings"],enabled:!!a}),l=gh({mutationFn:async e=>(await vh("PUT","/api/user/settings",{darkMode:e})).json(),onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/user/settings"]})}});$n.useEffect((()=>{const e=window.document.documentElement;e.classList.remove("light","dark"),e.classList.add(i),t&&localStorage.setItem(t,i)}),[i,t]),$n.useEffect((()=>{if(r){const e=r.darkMode?"dark":"light";n(e)}else if(t){const e=localStorage.getItem(t);!e||"light"!==e&&"dark"!==e||n(e)}}),[r,t]);const c=e=>{n(e),a?l.mutate("dark"===e):t&&localStorage.setItem(t,e)};return Si.jsx(Ph.Provider,{value:{theme:i,setTheme:c,toggleTheme:()=>{c("light"===i?"dark":"light")}},children:e})}const Fh=new Map;const Lh={USD:{code:"USD",symbol:"$",name:"US Dollar",decimals:2,symbolPosition:"before",thousandsSeparator:",",decimalSeparator:".",locale:"en-US"},EUR:{code:"EUR",symbol:"€",name:"Euro",decimals:2,symbolPosition:"after",thousandsSeparator:".",decimalSeparator:",",locale:"de-DE"},GBP:{code:"GBP",symbol:"£",name:"British Pound",decimals:2,symbolPosition:"before",thousandsSeparator:",",decimalSeparator:".",locale:"en-GB"},CAD:{code:"CAD",symbol:"C$",name:"Canadian Dollar",decimals:2,symbolPosition:"before",thousandsSeparator:",",decimalSeparator:".",locale:"en-CA"},JPY:{code:"JPY",symbol:"¥",name:"Japanese Yen",decimals:0,symbolPosition:"before",thousandsSeparator:",",decimalSeparator:".",locale:"ja-JP"},AUD:{code:"AUD",symbol:"A$",name:"Australian Dollar",decimals:2,symbolPosition:"before",thousandsSeparator:",",decimalSeparator:".",locale:"en-AU"},CHF:{code:"CHF",symbol:"CHF",name:"Swiss Franc",decimals:2,symbolPosition:"after",thousandsSeparator:"'",decimalSeparator:".",locale:"de-CH"},CNY:{code:"CNY",symbol:"¥",name:"Chinese Yuan",decimals:2,symbolPosition:"before",thousandsSeparator:",",decimalSeparator:".",locale:"zh-CN"},SAR:{code:"SAR",symbol:"ر.س",name:"Saudi Riyal",decimals:2,symbolPosition:"after",thousandsSeparator:",",decimalSeparator:".",locale:"ar-SA"},AED:{code:"AED",symbol:"د.إ",name:"UAE Dirham",decimals:2,symbolPosition:"after",thousandsSeparator:",",decimalSeparator:".",locale:"ar-AE"}};class Ih{constructor(){this.currentCurrency="USD",this.userLocale="en-US",this.userLocale="undefined"!=typeof window&&navigator.language||"en-US",this.currentCurrency=this.getDefaultCurrency()}static getInstance(){return Ih.instance||(Ih.instance=new Ih),Ih.instance}getDefaultCurrency(){if("undefined"!=typeof window){const e=localStorage.getItem("currency");if(e&&Lh[e])return e}const e=this.userLocale;return e.includes("en-US")||e.includes("en-CA")?"USD":e.includes("en-GB")?"GBP":e.includes("de")||e.includes("fr")||e.includes("it")?"EUR":e.includes("ja")?"JPY":e.includes("au")?"AUD":e.includes("ch")?"CHF":e.includes("cn")?"CNY":e.includes("sa")?"SAR":e.includes("ae")?"AED":"USD"}setCurrency(e){Lh[e]&&(this.currentCurrency=e,"undefined"!=typeof window&&localStorage.setItem("currency",e))}getCurrentCurrency(){return this.currentCurrency}getCurrencyConfig(e){const s=e||this.currentCurrency;return Lh[s]||Lh.USD}format(e,s={}){const t="string"==typeof e?parseFloat(e):e;if(isNaN(t))return"0";const{currency:a=this.currentCurrency,showSymbol:i=!0,showCode:n=!1,decimals:r,useGrouping:l=!0}=s,c=this.getCurrencyConfig(a),o=void 0!==r?r:c.decimals,d=new Intl.NumberFormat(c.locale||this.userLocale,{style:"decimal",minimumFractionDigits:o,maximumFractionDigits:o,useGrouping:l}).format(t);let u=d;return i&&(u="before"===c.symbolPosition?`${c.symbol}${d}`:`${d} ${c.symbol}`),n&&(u=i?`${u} (${c.code})`:`${u} ${c.code}`),u}formatCompact(e,s={}){const t="string"==typeof e?parseFloat(e):e;if(isNaN(t))return"0";const{currency:a=this.currentCurrency,showSymbol:i=!0,showCode:n=!1}=s,r=this.getCurrencyConfig(a),l=new Intl.NumberFormat(r.locale||this.userLocale,{notation:"compact",compactDisplay:"short",minimumFractionDigits:1,maximumFractionDigits:1}).format(t);let c=l;return i&&(c="before"===r.symbolPosition?`${r.symbol}${l}`:`${l} ${r.symbol}`),n&&(c=`${c} (${r.code})`),c}parse(e,s){const t=this.getCurrencyConfig(s),a=e.replace(t.symbol,"").replace(new RegExp(`\\${t.thousandsSeparator}`,"g"),"").replace(t.decimalSeparator,".").trim();return parseFloat(a)||0}getSymbol(e){return this.getCurrencyConfig(e).symbol}getSupportedCurrencies(){return Object.values(Lh)}getRevenueRanges(){return[{value:"0-1000",label:this.format(0)+" - "+this.format(1e3,{showSymbol:!1})},{value:"1000-10000",label:this.format(1e3)+" - "+this.format(1e4,{showSymbol:!1})},{value:"10000-50000",label:this.format(1e4)+" - "+this.format(5e4,{showSymbol:!1})},{value:"50000-250000",label:this.format(5e4)+" - "+this.format(25e4,{showSymbol:!1})},{value:"250000+",label:this.format(25e4)+"+"}]}mockConversion(e,s,t){return e*({USD_EUR:.92,EUR_USD:1.08,USD_GBP:.79,GBP_USD:1.27}[`${s}_${t}`]||1)}async convert(e,s,t,a){if(s===t)return e;if(a)return e*a;try{const a=(await async function(e){const s=Fh.get(e);if(s&&Date.now()-s.timestamp<36e5)return s.data.rates;try{const s=await fetch(`https://open.er-api.com/v6/latest/${e}`);if(!s.ok){const e=await s.json().catch((()=>({})));throw im.error(`Failed to fetch exchange rates: ${e.message||s.statusText}`),new Error(`Failed to fetch exchange rates: ${s.statusText}`)}const t=await s.json();if("error"===t.result)throw im.error(`Error fetching exchange rates: ${t["error-type"]}`),new Error(`Error fetching exchange rates: ${t["error-type"]}`);return Fh.set(e,{data:t,timestamp:Date.now()}),t.rates}catch(t){if(im.error("Failed to fetch up-to-date exchange rates. Conversion might be incorrect."),s)return s.data.rates;throw t}}(s))[t];return a?e*a:(im.error(`Real-time exchange rate not available for ${s} to ${t}.`),this.mockConversion(e,s,t))}catch(i){return im.error("Using mock conversion rate due to API failure."),this.mockConversion(e,s,t)}}formatPercentage(e,s=1){return`${(100*e).toFixed(s)}%`}formatForInput(e,s){const t="string"==typeof e?parseFloat(e):e;if(isNaN(t))return"";const a=this.getCurrencyConfig(s);return t.toFixed(a.decimals)}}const Rh=Ih.getInstance(),qh=(e,s)=>Rh.formatPercentage(e,s),Oh=$n.createContext(void 0);function Mh({children:e,defaultCurrency:s="USD"}){const{user:t}=Ah(),[a,i]=$n.useState(s),[n,r]=$n.useState(!0),{data:l,isLoading:c}=fh({queryKey:["/api/user/settings"],enabled:!!t}),{data:o}=fh({queryKey:["/api/company/settings"],enabled:!!t}),d=gh({mutationFn:async e=>(await vh("PUT","/api/user/settings",{preferredCurrency:e})).json(),onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/user/settings"]})}});$n.useEffect((()=>{let e=s;e=(null==l?void 0:l.preferredCurrency)?l.preferredCurrency:(null==o?void 0:o.currency)?o.currency:Rh.getCurrentCurrency(),Lh[e]&&(i(e),Rh.setCurrency(e)),r(!1)}),[l,o,s]),$n.useEffect((()=>{r(c)}),[c]);return Si.jsx(Oh.Provider,{value:{currency:a,setCurrency:e=>{Lh[e]&&(i(e),Rh.setCurrency(e),t&&d.mutate(e))},format:(e,s={})=>((e,s)=>Rh.format(e,s))(e,{currency:a,...s}),formatCompact:(e,s={})=>((e,s)=>Rh.formatCompact(e,s))(e,{currency:a,...s}),parse:(e,s)=>((e,s)=>Rh.parse(e,s))(e,s||a),getSymbol:e=>(e=>Rh.getSymbol(e))(e||a),formatPercentage:qh,getSupportedCurrencies:()=>Rh.getSupportedCurrencies(),getRevenueRanges:()=>Rh.getRevenueRanges(),getCurrencyConfig:e=>Rh.getCurrencyConfig(e||a),isLoading:n},children:e})}function Vh(){const e=$n.useContext(Oh);if(void 0===e)throw new Error("useCurrency must be used within a CurrencyProvider");return e}var[Uh,$h]=Ni("Tooltip",[qi]),zh=qi(),Bh="TooltipProvider",Kh=700,Qh="tooltip.open",[Gh,Wh]=Uh(Bh),Hh=e=>{const{__scopeTooltip:s,delayDuration:t=Kh,skipDelayDuration:a=300,disableHoverableContent:i=!1,children:n}=e,r=$n.useRef(!0),l=$n.useRef(!1),c=$n.useRef(0);return $n.useEffect((()=>{const e=c.current;return()=>window.clearTimeout(e)}),[]),Si.jsx(Gh,{scope:s,isOpenDelayedRef:r,delayDuration:t,onOpen:$n.useCallback((()=>{window.clearTimeout(c.current),r.current=!1}),[]),onClose:$n.useCallback((()=>{window.clearTimeout(c.current),c.current=window.setTimeout((()=>r.current=!0),a)}),[a]),isPointerInTransitRef:l,onPointerInTransitChange:$n.useCallback((e=>{l.current=e}),[]),disableHoverableContent:i,children:n})};Hh.displayName=Bh;var Yh="Tooltip",[Jh,Xh]=Uh(Yh),Zh=e=>{const{__scopeTooltip:s,children:t,open:a,defaultOpen:i,onOpenChange:n,disableHoverableContent:r,delayDuration:l}=e,c=Wh(Yh,e.__scopeTooltip),o=zh(s),[d,u]=$n.useState(null),m=$i(),h=$n.useRef(0),x=r??c.disableHoverableContent,p=l??c.delayDuration,f=$n.useRef(!1),[g,j]=Di({prop:a,defaultProp:i??!1,onChange:e=>{e?(c.onOpen(),document.dispatchEvent(new CustomEvent(Qh))):c.onClose(),null==n||n(e)},caller:Yh}),v=$n.useMemo((()=>g?f.current?"delayed-open":"instant-open":"closed"),[g]),y=$n.useCallback((()=>{window.clearTimeout(h.current),h.current=0,f.current=!1,j(!0)}),[j]),b=$n.useCallback((()=>{window.clearTimeout(h.current),h.current=0,j(!1)}),[j]),N=$n.useCallback((()=>{window.clearTimeout(h.current),h.current=window.setTimeout((()=>{f.current=!0,j(!0),h.current=0}),p)}),[p,j]);return $n.useEffect((()=>()=>{h.current&&(window.clearTimeout(h.current),h.current=0)}),[]),Si.jsx(zi,{...o,children:Si.jsx(Jh,{scope:s,contentId:m,open:g,stateAttribute:v,trigger:d,onTriggerChange:u,onTriggerEnter:$n.useCallback((()=>{c.isOpenDelayedRef.current?N():y()}),[c.isOpenDelayedRef,N,y]),onTriggerLeave:$n.useCallback((()=>{x?b():(window.clearTimeout(h.current),h.current=0)}),[b,x]),onOpen:y,onClose:b,disableHoverableContent:x,children:t})})};Zh.displayName=Yh;var ex="TooltipTrigger",sx=$n.forwardRef(((e,s)=>{const{__scopeTooltip:t,...a}=e,i=Xh(ex,t),n=Wh(ex,t),r=zh(t),l=$n.useRef(null),c=Ci(s,l,i.onTriggerChange),o=$n.useRef(!1),d=$n.useRef(!1),u=$n.useCallback((()=>o.current=!1),[]);return $n.useEffect((()=>()=>document.removeEventListener("pointerup",u)),[u]),Si.jsx(Bi,{asChild:!0,...r,children:Si.jsx(ki.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...a,ref:c,onPointerMove:Ai(e.onPointerMove,(e=>{"touch"!==e.pointerType&&(d.current||n.isPointerInTransitRef.current||(i.onTriggerEnter(),d.current=!0))})),onPointerLeave:Ai(e.onPointerLeave,(()=>{i.onTriggerLeave(),d.current=!1})),onPointerDown:Ai(e.onPointerDown,(()=>{i.open&&i.onClose(),o.current=!0,document.addEventListener("pointerup",u,{once:!0})})),onFocus:Ai(e.onFocus,(()=>{o.current||i.onOpen()})),onBlur:Ai(e.onBlur,i.onClose),onClick:Ai(e.onClick,i.onClose)})})}));sx.displayName=ex;var[tx,ax]=Uh("TooltipPortal",{forceMount:void 0}),ix="TooltipContent",nx=$n.forwardRef(((e,s)=>{const t=ax(ix,e.__scopeTooltip),{forceMount:a=t.forceMount,side:i="top",...n}=e,r=Xh(ix,e.__scopeTooltip);return Si.jsx(Ei,{present:a||r.open,children:r.disableHoverableContent?Si.jsx(dx,{side:i,...n,ref:s}):Si.jsx(rx,{side:i,...n,ref:s})})})),rx=$n.forwardRef(((e,s)=>{const t=Xh(ix,e.__scopeTooltip),a=Wh(ix,e.__scopeTooltip),i=$n.useRef(null),n=Ci(s,i),[r,l]=$n.useState(null),{trigger:c,onClose:o}=t,d=i.current,{onPointerInTransitChange:u}=a,m=$n.useCallback((()=>{l(null),u(!1)}),[u]),h=$n.useCallback(((e,s)=>{const t=e.currentTarget,a={x:e.clientX,y:e.clientY},i=function(e,s,t=5){const a=[];switch(s){case"top":a.push({x:e.x-t,y:e.y+t},{x:e.x+t,y:e.y+t});break;case"bottom":a.push({x:e.x-t,y:e.y-t},{x:e.x+t,y:e.y-t});break;case"left":a.push({x:e.x+t,y:e.y-t},{x:e.x+t,y:e.y+t});break;case"right":a.push({x:e.x-t,y:e.y-t},{x:e.x-t,y:e.y+t})}return a}(a,function(e,s){const t=Math.abs(s.top-e.y),a=Math.abs(s.bottom-e.y),i=Math.abs(s.right-e.x),n=Math.abs(s.left-e.x);switch(Math.min(t,a,i,n)){case n:return"left";case i:return"right";case t:return"top";case a:return"bottom";default:throw new Error("unreachable")}}(a,t.getBoundingClientRect())),n=function(e){const s=e.slice();return s.sort(((e,s)=>e.x<s.x?-1:e.x>s.x?1:e.y<s.y?-1:e.y>s.y?1:0)),function(e){if(e.length<=1)return e.slice();const s=[];for(let a=0;a<e.length;a++){const t=e[a];for(;s.length>=2;){const e=s[s.length-1],a=s[s.length-2];if(!((e.x-a.x)*(t.y-a.y)>=(e.y-a.y)*(t.x-a.x)))break;s.pop()}s.push(t)}s.pop();const t=[];for(let a=e.length-1;a>=0;a--){const s=e[a];for(;t.length>=2;){const e=t[t.length-1],a=t[t.length-2];if(!((e.x-a.x)*(s.y-a.y)>=(e.y-a.y)*(s.x-a.x)))break;t.pop()}t.push(s)}return t.pop(),1===s.length&&1===t.length&&s[0].x===t[0].x&&s[0].y===t[0].y?s:s.concat(t)}(s)}([...i,...function(e){const{top:s,right:t,bottom:a,left:i}=e;return[{x:i,y:s},{x:t,y:s},{x:t,y:a},{x:i,y:a}]}(s.getBoundingClientRect())]);l(n),u(!0)}),[u]);return $n.useEffect((()=>()=>m()),[m]),$n.useEffect((()=>{if(c&&d){const e=e=>h(e,d),s=e=>h(e,c);return c.addEventListener("pointerleave",e),d.addEventListener("pointerleave",s),()=>{c.removeEventListener("pointerleave",e),d.removeEventListener("pointerleave",s)}}}),[c,d,h,m]),$n.useEffect((()=>{if(r){const e=e=>{const s=e.target,t={x:e.clientX,y:e.clientY},a=(null==c?void 0:c.contains(s))||(null==d?void 0:d.contains(s)),i=!function(e,s){const{x:t,y:a}=e;let i=!1;for(let n=0,r=s.length-1;n<s.length;r=n++){const e=s[n],l=s[r],c=e.x,o=e.y,d=l.x,u=l.y;o>a!=u>a&&t<(d-c)*(a-o)/(u-o)+c&&(i=!i)}return i}(t,r);a?m():i&&(m(),o())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}}),[c,d,r,o,m]),Si.jsx(dx,{...e,ref:n})})),[lx,cx]=Uh(Yh,{isInside:!1}),ox=Vi("TooltipContent"),dx=$n.forwardRef(((e,s)=>{const{__scopeTooltip:t,children:a,"aria-label":i,onEscapeKeyDown:n,onPointerDownOutside:r,...l}=e,c=Xh(ix,t),o=zh(t),{onClose:d}=c;return $n.useEffect((()=>(document.addEventListener(Qh,d),()=>document.removeEventListener(Qh,d))),[d]),$n.useEffect((()=>{if(c.trigger){const e=e=>{const s=e.target;(null==s?void 0:s.contains(c.trigger))&&d()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}}),[c.trigger,d]),Si.jsx(Oi,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:n,onPointerDownOutside:r,onFocusOutside:e=>e.preventDefault(),onDismiss:d,children:Si.jsxs(Mi,{"data-state":c.stateAttribute,...o,...l,ref:s,style:{...l.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[Si.jsx(ox,{children:a}),Si.jsx(lx,{scope:t,isInside:!0,children:Si.jsx(Ui,{id:c.contentId,role:"tooltip",children:i||a})})]})})}));nx.displayName=ix;var ux="TooltipArrow";$n.forwardRef(((e,s)=>{const{__scopeTooltip:t,...a}=e,i=zh(t);return cx(ux,t).isInside?null:Si.jsx(Ki,{...i,...a,ref:s})})).displayName=ux;var mx=nx;const hx=Hh,xx=Zh,px=sx,fx=$n.forwardRef((({className:e,sideOffset:s=4,...t},a)=>Si.jsx(mx,{ref:a,sideOffset:s,className:Lu("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",e),...t})));function gx({children:e}){const{user:s,isLoading:t}=Ah(),[a,i]=Oo();return t?Si.jsx("div",{className:"flex items-center justify-center min-h-screen",children:Si.jsx(kr,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):s||"/login"===a?Si.jsx(Si.Fragment,{children:e}):(window.location.href="/login",null)}fx.displayName=mx.displayName;const jx={Shield:Gr,Building:Qr,FileText:Kr,ServerCog:Br,Server:zr,Users:$r,DollarSign:Ur,BarChart3:Vr,Settings:Mr,LayoutDashboard:Dr,Target:Or,BookOpen:qr,FolderOpen:Rr,Zap:Ir,Upload:Lr,Menu:Fr,HardDrive:_r,Plug:Pr,Grid3X3:Ar,UserPlus:Er};function vx({onNavigate:e,className:s,showCategories:t=!0,compact:a=!1}){const[i,n]=Oo(),{user:r,isLoading:l}=Ah(),{data:c=[],isLoading:o}=fh({queryKey:["/api/user/accessible-pages","missing-pages-added-2025-06-15"],enabled:!!r,staleTime:3e5,gcTime:6e5,refetchOnWindowFocus:!1,refetchOnMount:!1});if(l||o)return Si.jsx("nav",{className:Lu("p-4 space-y-1",s),children:[...Array(6)].map(((e,s)=>Si.jsxs("div",{className:"flex items-center space-x-3 px-3 py-2",children:[Si.jsx("div",{className:"w-5 h-5 bg-gray-200 rounded animate-pulse"}),!a&&Si.jsx("div",{className:"w-24 h-4 bg-gray-200 rounded animate-pulse"})]},s)))});if(!r||0===c.length)return Si.jsx("nav",{className:Lu("p-4",s),children:Si.jsx("div",{className:"text-sm text-gray-500 px-3 py-2",children:"No accessible pages"})});const d=t?c.reduce(((e,s)=>{const t=s.category||"other";return e[t]||(e[t]=[]),e[t].push(s),e}),{}):{all:c},u=["main","advanced","integration","reports","admin","other"],m=Object.keys(d).sort(((e,s)=>{const t=u.indexOf(e),a=u.indexOf(s);return(-1===t?999:t)-(-1===a?999:a)}));return Si.jsx("nav",{className:Lu("p-4 space-y-1",s),children:m.map(((s,r)=>Si.jsxs("div",{children:[t&&"all"!==s&&d[s].length>0&&Si.jsx("div",{className:"px-3 py-2",children:Si.jsx("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"main"===s?"Core":s})}),d[s].sort(((e,s)=>e.sortOrder-s.sortOrder)).map((s=>{const t=i===s.pageUrl,r=(l=s.icon)&&jx[l]||Dr;var l;return Si.jsxs("button",{onClick:()=>{return t=s.pageUrl,void(e?e(t):n(t));var t},className:Lu("w-full flex items-center space-x-3 px-3 py-2 rounded-lg font-medium transition-colors text-left",t?"bg-primary/10 text-primary":"text-gray-700 hover:bg-gray-50"),title:a?s.displayName:s.description,children:[Si.jsx(r,{className:"h-5 w-5 flex-shrink-0"}),!a&&Si.jsx("span",{className:"flex-1",children:s.displayName})]},s.pageName)})),t&&r<m.length-1&&Si.jsx("div",{className:"h-4"})]},s)))})}function yx(){const{data:e=[]}=function(){const{user:e}=Ah();return fh({queryKey:["/api/user/accessible-pages","missing-pages-added-2025-06-15"],enabled:!!e,staleTime:3e5,gcTime:6e5,refetchOnWindowFocus:!1,refetchOnMount:!1})}();return{hasPageAccess:s=>e.some((e=>e.pageUrl===s)),getAccessiblePageUrls:()=>e.map((e=>e.pageUrl)),accessiblePages:e}}const bx=Gn("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Nx=$n.forwardRef((({className:e,variant:s,...t},a)=>Si.jsx("div",{ref:a,role:"alert",className:Lu(bx({variant:s}),e),...t})));Nx.displayName="Alert";$n.forwardRef((({className:e,...s},t)=>Si.jsx("h5",{ref:t,className:Lu("mb-1 font-medium leading-none tracking-tight",e),...s}))).displayName="AlertTitle";const wx=$n.forwardRef((({className:e,...s},t)=>Si.jsx("div",{ref:t,className:Lu("text-sm [&_p]:leading-relaxed",e),...s})));wx.displayName="AlertDescription";const Cx=Gn("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-600 text-white hover:bg-green-700"}},defaultVariants:{variant:"default"}}),Sx=$n.forwardRef((({className:e,variant:s,...t},a)=>Si.jsx("span",{ref:a,className:Lu(Cx({variant:s}),e),...t})));function Tx(){const{isEnabled:e,getTimeRemaining:s}=function(e={}){const{user:s,logout:t}=Ah(),{toast:a}=sd(),{timeoutMinutes:i=1440,warningMinutes:n=5,checkIntervalSeconds:r=60}=e,l=$n.useRef(Date.now()),c=$n.useRef(null),o=$n.useRef(!1),{data:d}=fh({queryKey:["/api/user/settings"],enabled:!!s}),u=$n.useCallback((()=>{l.current=Date.now(),o.current=!1}),[]),m=$n.useCallback((()=>{if(!(null==d?void 0:d.sessionTimeout)||!s)return;const e=Date.now()-l.current,r=60*i*1e3,c=60*n*1e3;if(e>=r)return a({title:"Session Expired",description:"You have been logged out due to inactivity.",variant:"destructive"}),void t();if(e>=r-c&&!o.current){const s=Math.ceil((r-e)/6e4);a({title:"Session Warning",description:`Your session will expire in ${s} minutes due to inactivity.`,duration:1e4}),o.current=!0}}),[null==d?void 0:d.sessionTimeout,s,i,n,a,t]);return $n.useEffect((()=>{if(!(null==d?void 0:d.sessionTimeout)||!s)return;const e=["mousedown","mousemove","keypress","scroll","touchstart","click"];let t=null;const a=()=>{t&&clearTimeout(t),t=setTimeout((()=>{u()}),1e3)};return e.forEach((e=>{document.addEventListener(e,a,!0)})),()=>{e.forEach((e=>{document.removeEventListener(e,a,!0)})),t&&clearTimeout(t)}}),[null==d?void 0:d.sessionTimeout,s,u]),$n.useEffect((()=>{if((null==d?void 0:d.sessionTimeout)&&s)return c.current=setInterval(m,1e3*r),()=>{c.current&&(clearInterval(c.current),c.current=null)};c.current&&(clearInterval(c.current),c.current=null)}),[null==d?void 0:d.sessionTimeout,s,m,r]),$n.useEffect((()=>{s&&u()}),[s,u]),{isEnabled:(null==d?void 0:d.sessionTimeout)||!1,updateActivity:u,getTimeRemaining:()=>{if(!(null==d?void 0:d.sessionTimeout)||!s)return null;const e=Date.now()-l.current,t=60*i*1e3-e;return Math.max(0,t)}}}(),[t,a]=$n.useState(null);if($n.useEffect((()=>{if(!e)return void a(null);const t=()=>{a(s())};t();const i=setInterval(t,6e4);return()=>clearInterval(i)}),[e,s]),!e||null===t)return null;const i=e=>{const s=Math.floor(e/36e5),t=Math.floor(e%36e5/6e4);return s>0?`${s}h ${t}m`:`${t}m`};return Si.jsxs(xx,{children:[Si.jsx(px,{asChild:!0,children:Si.jsxs(Sx,{variant:(e=>{const s=e/6e4;return s<=5?"destructive":s<=30?"secondary":"default"})(t),className:"flex items-center space-x-1 cursor-help",children:[Si.jsx(Wr,{className:"h-3 w-3"}),Si.jsx("span",{children:i(t)})]})}),Si.jsx(fx,{children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Gr,{className:"h-4 w-4"}),Si.jsxs("span",{children:["Session expires in ",i(t)]})]})})]})}Sx.displayName="Badge";const kx=$n.forwardRef((({className:e,type:s,...t},a)=>Si.jsx("input",{type:s,className:Lu("flex h-10 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-500 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...t})));kx.displayName="Input";const Dx=Gn("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Ex=$n.forwardRef((({className:e,variant:s,size:t,asChild:a=!1,...i},n)=>{const r=a?Qi:"button";return Si.jsx(r,{className:Lu(Dx({variant:s,size:t,className:e})),ref:n,...i})}));Ex.displayName="Button";const Ax=$n.forwardRef((({className:e,...s},t)=>Si.jsx("div",{ref:t,className:Lu("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s})));Ax.displayName="Card";const Px=$n.forwardRef((({className:e,...s},t)=>Si.jsx("div",{ref:t,className:Lu("flex flex-col space-y-1.5 p-6",e),...s})));Px.displayName="CardHeader";const _x=$n.forwardRef((({className:e,...s},t)=>Si.jsx("div",{ref:t,className:Lu("text-2xl font-semibold leading-none tracking-tight",e),...s})));_x.displayName="CardTitle";const Fx=$n.forwardRef((({className:e,...s},t)=>Si.jsx("div",{ref:t,className:Lu("text-sm text-muted-foreground",e),...s})));Fx.displayName="CardDescription";const Lx=$n.forwardRef((({className:e,...s},t)=>Si.jsx("div",{ref:t,className:Lu("p-6 pt-0",e),...s})));Lx.displayName="CardContent";$n.forwardRef((({className:e,...s},t)=>Si.jsx("div",{ref:t,className:Lu("flex items-center p-6 pt-0",e),...s}))).displayName="CardFooter";var Ix="ScrollArea",[Rx,qx]=Ni(Ix),[Ox,Mx]=Rx(Ix),Vx=$n.forwardRef(((e,s)=>{const{__scopeScrollArea:t,type:a="hover",dir:i,scrollHideDelay:n=600,...r}=e,[l,c]=$n.useState(null),[o,d]=$n.useState(null),[u,m]=$n.useState(null),[h,x]=$n.useState(null),[p,f]=$n.useState(null),[g,j]=$n.useState(0),[v,y]=$n.useState(0),[b,N]=$n.useState(!1),[w,C]=$n.useState(!1),S=Ci(s,(e=>c(e))),T=Gi(i);return Si.jsx(Ox,{scope:t,type:a,dir:T,scrollHideDelay:n,scrollArea:l,viewport:o,onViewportChange:d,content:u,onContentChange:m,scrollbarX:h,onScrollbarXChange:x,scrollbarXEnabled:b,onScrollbarXEnabledChange:N,scrollbarY:p,onScrollbarYChange:f,scrollbarYEnabled:w,onScrollbarYEnabledChange:C,onCornerWidthChange:j,onCornerHeightChange:y,children:Si.jsx(ki.div,{dir:T,...r,ref:S,style:{position:"relative","--radix-scroll-area-corner-width":g+"px","--radix-scroll-area-corner-height":v+"px",...e.style}})})}));Vx.displayName=Ix;var Ux="ScrollAreaViewport",$x=$n.forwardRef(((e,s)=>{const{__scopeScrollArea:t,children:a,nonce:i,...n}=e,r=Mx(Ux,t),l=$n.useRef(null),c=Ci(s,l,r.onViewportChange);return Si.jsxs(Si.Fragment,{children:[Si.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),Si.jsx(ki.div,{"data-radix-scroll-area-viewport":"",...n,ref:c,style:{overflowX:r.scrollbarXEnabled?"scroll":"hidden",overflowY:r.scrollbarYEnabled?"scroll":"hidden",...e.style},children:Si.jsx("div",{ref:r.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})}));$x.displayName=Ux;var zx="ScrollAreaScrollbar",Bx=$n.forwardRef(((e,s)=>{const{forceMount:t,...a}=e,i=Mx(zx,e.__scopeScrollArea),{onScrollbarXEnabledChange:n,onScrollbarYEnabledChange:r}=i,l="horizontal"===e.orientation;return $n.useEffect((()=>(l?n(!0):r(!0),()=>{l?n(!1):r(!1)})),[l,n,r]),"hover"===i.type?Si.jsx(Kx,{...a,ref:s,forceMount:t}):"scroll"===i.type?Si.jsx(Qx,{...a,ref:s,forceMount:t}):"auto"===i.type?Si.jsx(Gx,{...a,ref:s,forceMount:t}):"always"===i.type?Si.jsx(Wx,{...a,ref:s}):null}));Bx.displayName=zx;var Kx=$n.forwardRef(((e,s)=>{const{forceMount:t,...a}=e,i=Mx(zx,e.__scopeScrollArea),[n,r]=$n.useState(!1);return $n.useEffect((()=>{const e=i.scrollArea;let s=0;if(e){const t=()=>{window.clearTimeout(s),r(!0)},a=()=>{s=window.setTimeout((()=>r(!1)),i.scrollHideDelay)};return e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",a),()=>{window.clearTimeout(s),e.removeEventListener("pointerenter",t),e.removeEventListener("pointerleave",a)}}}),[i.scrollArea,i.scrollHideDelay]),Si.jsx(Ei,{present:t||n,children:Si.jsx(Gx,{"data-state":n?"visible":"hidden",...a,ref:s})})})),Qx=$n.forwardRef(((e,s)=>{const{forceMount:t,...a}=e,i=Mx(zx,e.__scopeScrollArea),n="horizontal"===e.orientation,r=hp((()=>c("SCROLL_END")),100),[l,c]=(o="hidden",d={hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}},$n.useReducer(((e,s)=>d[e][s]??e),o));var o,d;return $n.useEffect((()=>{if("idle"===l){const e=window.setTimeout((()=>c("HIDE")),i.scrollHideDelay);return()=>window.clearTimeout(e)}}),[l,i.scrollHideDelay,c]),$n.useEffect((()=>{const e=i.viewport,s=n?"scrollLeft":"scrollTop";if(e){let t=e[s];const a=()=>{const a=e[s];t!==a&&(c("SCROLL"),r()),t=a};return e.addEventListener("scroll",a),()=>e.removeEventListener("scroll",a)}}),[i.viewport,n,c,r]),Si.jsx(Ei,{present:t||"hidden"!==l,children:Si.jsx(Wx,{"data-state":"hidden"===l?"hidden":"visible",...a,ref:s,onPointerEnter:Ai(e.onPointerEnter,(()=>c("POINTER_ENTER"))),onPointerLeave:Ai(e.onPointerLeave,(()=>c("POINTER_LEAVE")))})})})),Gx=$n.forwardRef(((e,s)=>{const t=Mx(zx,e.__scopeScrollArea),{forceMount:a,...i}=e,[n,r]=$n.useState(!1),l="horizontal"===e.orientation,c=hp((()=>{if(t.viewport){const e=t.viewport.offsetWidth<t.viewport.scrollWidth,s=t.viewport.offsetHeight<t.viewport.scrollHeight;r(l?e:s)}}),10);return xp(t.viewport,c),xp(t.content,c),Si.jsx(Ei,{present:a||n,children:Si.jsx(Wx,{"data-state":n?"visible":"hidden",...i,ref:s})})})),Wx=$n.forwardRef(((e,s)=>{const{orientation:t="vertical",...a}=e,i=Mx(zx,e.__scopeScrollArea),n=$n.useRef(null),r=$n.useRef(0),[l,c]=$n.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),o=lp(l.viewport,l.content),d={...a,sizes:l,onSizesChange:c,hasThumb:Boolean(o>0&&o<1),onThumbChange:e=>n.current=e,onThumbPointerUp:()=>r.current=0,onThumbPointerDown:e=>r.current=e};function u(e,s){return function(e,s,t,a="ltr"){const i=cp(t),n=i/2,r=s||n,l=i-r,c=t.scrollbar.paddingStart+r,o=t.scrollbar.size-t.scrollbar.paddingEnd-l,d=t.content-t.viewport,u="ltr"===a?[0,d]:[-1*d,0];return dp([c,o],u)(e)}(e,r.current,l,s)}return"horizontal"===t?Si.jsx(Hx,{...d,ref:s,onThumbPositionChange:()=>{if(i.viewport&&n.current){const e=op(i.viewport.scrollLeft,l,i.dir);n.current.style.transform=`translate3d(${e}px, 0, 0)`}},onWheelScroll:e=>{i.viewport&&(i.viewport.scrollLeft=e)},onDragScroll:e=>{i.viewport&&(i.viewport.scrollLeft=u(e,i.dir))}}):"vertical"===t?Si.jsx(Yx,{...d,ref:s,onThumbPositionChange:()=>{if(i.viewport&&n.current){const e=op(i.viewport.scrollTop,l);n.current.style.transform=`translate3d(0, ${e}px, 0)`}},onWheelScroll:e=>{i.viewport&&(i.viewport.scrollTop=e)},onDragScroll:e=>{i.viewport&&(i.viewport.scrollTop=u(e))}}):null})),Hx=$n.forwardRef(((e,s)=>{const{sizes:t,onSizesChange:a,...i}=e,n=Mx(zx,e.__scopeScrollArea),[r,l]=$n.useState(),c=$n.useRef(null),o=Ci(s,c,n.onScrollbarXChange);return $n.useEffect((()=>{c.current&&l(getComputedStyle(c.current))}),[c]),Si.jsx(Zx,{"data-orientation":"horizontal",...i,ref:o,sizes:t,style:{bottom:0,left:"rtl"===n.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===n.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":cp(t)+"px",...e.style},onThumbPointerDown:s=>e.onThumbPointerDown(s.x),onDragScroll:s=>e.onDragScroll(s.x),onWheelScroll:(s,t)=>{if(n.viewport){const a=n.viewport.scrollLeft+s.deltaX;e.onWheelScroll(a),up(a,t)&&s.preventDefault()}},onResize:()=>{c.current&&n.viewport&&r&&a({content:n.viewport.scrollWidth,viewport:n.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:rp(r.paddingLeft),paddingEnd:rp(r.paddingRight)}})}})})),Yx=$n.forwardRef(((e,s)=>{const{sizes:t,onSizesChange:a,...i}=e,n=Mx(zx,e.__scopeScrollArea),[r,l]=$n.useState(),c=$n.useRef(null),o=Ci(s,c,n.onScrollbarYChange);return $n.useEffect((()=>{c.current&&l(getComputedStyle(c.current))}),[c]),Si.jsx(Zx,{"data-orientation":"vertical",...i,ref:o,sizes:t,style:{top:0,right:"ltr"===n.dir?0:void 0,left:"rtl"===n.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":cp(t)+"px",...e.style},onThumbPointerDown:s=>e.onThumbPointerDown(s.y),onDragScroll:s=>e.onDragScroll(s.y),onWheelScroll:(s,t)=>{if(n.viewport){const a=n.viewport.scrollTop+s.deltaY;e.onWheelScroll(a),up(a,t)&&s.preventDefault()}},onResize:()=>{c.current&&n.viewport&&r&&a({content:n.viewport.scrollHeight,viewport:n.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:rp(r.paddingTop),paddingEnd:rp(r.paddingBottom)}})}})})),[Jx,Xx]=Rx(zx),Zx=$n.forwardRef(((e,s)=>{const{__scopeScrollArea:t,sizes:a,hasThumb:i,onThumbChange:n,onThumbPointerUp:r,onThumbPointerDown:l,onThumbPositionChange:c,onDragScroll:o,onWheelScroll:d,onResize:u,...m}=e,h=Mx(zx,t),[x,p]=$n.useState(null),f=Ci(s,(e=>p(e))),g=$n.useRef(null),j=$n.useRef(""),v=h.viewport,y=a.content-a.viewport,b=Pi(d),N=Pi(c),w=hp(u,10);function C(e){if(g.current){const s=e.clientX-g.current.left,t=e.clientY-g.current.top;o({x:s,y:t})}}return $n.useEffect((()=>{const e=e=>{const s=e.target;(null==x?void 0:x.contains(s))&&b(e,y)};return document.addEventListener("wheel",e,{passive:!1}),()=>document.removeEventListener("wheel",e,{passive:!1})}),[v,x,y,b]),$n.useEffect(N,[a,N]),xp(x,w),xp(h.content,w),Si.jsx(Jx,{scope:t,scrollbar:x,hasThumb:i,onThumbChange:Pi(n),onThumbPointerUp:Pi(r),onThumbPositionChange:N,onThumbPointerDown:Pi(l),children:Si.jsx(ki.div,{...m,ref:f,style:{position:"absolute",...m.style},onPointerDown:Ai(e.onPointerDown,(e=>{if(0===e.button){e.target.setPointerCapture(e.pointerId),g.current=x.getBoundingClientRect(),j.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",h.viewport&&(h.viewport.style.scrollBehavior="auto"),C(e)}})),onPointerMove:Ai(e.onPointerMove,C),onPointerUp:Ai(e.onPointerUp,(e=>{const s=e.target;s.hasPointerCapture(e.pointerId)&&s.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=j.current,h.viewport&&(h.viewport.style.scrollBehavior=""),g.current=null}))})})})),ep="ScrollAreaThumb",sp=$n.forwardRef(((e,s)=>{const{forceMount:t,...a}=e,i=Xx(ep,e.__scopeScrollArea);return Si.jsx(Ei,{present:t||i.hasThumb,children:Si.jsx(tp,{ref:s,...a})})})),tp=$n.forwardRef(((e,s)=>{const{__scopeScrollArea:t,style:a,...i}=e,n=Mx(ep,t),r=Xx(ep,t),{onThumbPositionChange:l}=r,c=Ci(s,(e=>r.onThumbChange(e))),o=$n.useRef(void 0),d=hp((()=>{o.current&&(o.current(),o.current=void 0)}),100);return $n.useEffect((()=>{const e=n.viewport;if(e){const s=()=>{if(d(),!o.current){const s=mp(e,l);o.current=s,l()}};return l(),e.addEventListener("scroll",s),()=>e.removeEventListener("scroll",s)}}),[n.viewport,d,l]),Si.jsx(ki.div,{"data-state":r.hasThumb?"visible":"hidden",...i,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:Ai(e.onPointerDownCapture,(e=>{const s=e.target.getBoundingClientRect(),t=e.clientX-s.left,a=e.clientY-s.top;r.onThumbPointerDown({x:t,y:a})})),onPointerUp:Ai(e.onPointerUp,r.onThumbPointerUp)})}));sp.displayName=ep;var ap="ScrollAreaCorner",ip=$n.forwardRef(((e,s)=>{const t=Mx(ap,e.__scopeScrollArea),a=Boolean(t.scrollbarX&&t.scrollbarY);return"scroll"!==t.type&&a?Si.jsx(np,{...e,ref:s}):null}));ip.displayName=ap;var np=$n.forwardRef(((e,s)=>{const{__scopeScrollArea:t,...a}=e,i=Mx(ap,t),[n,r]=$n.useState(0),[l,c]=$n.useState(0),o=Boolean(n&&l);return xp(i.scrollbarX,(()=>{var e;const s=(null==(e=i.scrollbarX)?void 0:e.offsetHeight)||0;i.onCornerHeightChange(s),c(s)})),xp(i.scrollbarY,(()=>{var e;const s=(null==(e=i.scrollbarY)?void 0:e.offsetWidth)||0;i.onCornerWidthChange(s),r(s)})),o?Si.jsx(ki.div,{...a,ref:s,style:{width:n,height:l,position:"absolute",right:"ltr"===i.dir?0:void 0,left:"rtl"===i.dir?0:void 0,bottom:0,...e.style}}):null}));function rp(e){return e?parseInt(e,10):0}function lp(e,s){const t=e/s;return isNaN(t)?0:t}function cp(e){const s=lp(e.viewport,e.content),t=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,a=(e.scrollbar.size-t)*s;return Math.max(a,18)}function op(e,s,t="ltr"){const a=cp(s),i=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,n=s.scrollbar.size-i,r=s.content-s.viewport,l=n-a,c=Wi(e,"ltr"===t?[0,r]:[-1*r,0]);return dp([0,r],[0,l])(c)}function dp(e,s){return t=>{if(e[0]===e[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(e[1]-e[0]);return s[0]+a*(t-e[0])}}function up(e,s){return e>0&&e<s}var mp=(e,s=()=>{})=>{let t={left:e.scrollLeft,top:e.scrollTop},a=0;return function i(){const n={left:e.scrollLeft,top:e.scrollTop},r=t.left!==n.left,l=t.top!==n.top;(r||l)&&s(),t=n,a=window.requestAnimationFrame(i)}(),()=>window.cancelAnimationFrame(a)};function hp(e,s){const t=Pi(e),a=$n.useRef(0);return $n.useEffect((()=>()=>window.clearTimeout(a.current)),[]),$n.useCallback((()=>{window.clearTimeout(a.current),a.current=window.setTimeout(t,s)}),[t,s])}function xp(e,s){const t=Pi(s);Ii((()=>{let s=0;if(e){const a=new ResizeObserver((()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(t)}));return a.observe(e),()=>{window.cancelAnimationFrame(s),a.unobserve(e)}}}),[e,t])}var pp=Vx,fp=$x,gp=ip;const jp=$n.forwardRef((({className:e,children:s,...t},a)=>Si.jsxs(pp,{ref:a,className:Lu("relative overflow-hidden",e),...t,children:[Si.jsx(fp,{className:"h-full w-full rounded-[inherit]",children:s}),Si.jsx(vp,{}),Si.jsx(gp,{})]})));jp.displayName=pp.displayName;const vp=$n.forwardRef((({className:e,orientation:s="vertical",...t},a)=>Si.jsx(Bx,{ref:a,orientation:s,className:Lu("flex touch-none select-none transition-colors","vertical"===s&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...t,children:Si.jsx(sp,{className:"relative flex-1 rounded-full bg-border"})})));vp.displayName=Bx.displayName;var yp="horizontal",bp=["horizontal","vertical"],Np=$n.forwardRef(((e,s)=>{const{decorative:t,orientation:a=yp,...i}=e,n=function(e){return bp.includes(e)}(a)?a:yp,r=t?{role:"none"}:{"aria-orientation":"vertical"===n?n:void 0,role:"separator"};return Si.jsx(ki.div,{"data-orientation":n,...r,...i,ref:s})}));Np.displayName="Separator";var wp=Np;const Cp=$n.forwardRef((({className:e,orientation:s="horizontal",decorative:t=!0,...a},i)=>Si.jsx(wp,{ref:i,decorative:t,orientation:s,className:Lu("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...a})));Cp.displayName=wp.displayName;const Sp=sn,Tp=tn,kp=Yi,Dp=$n.forwardRef((({className:e,...s},t)=>Si.jsx(Hi,{ref:t,className:Lu("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s})));Dp.displayName=Hi.displayName;const Ep=$n.forwardRef((({className:e,children:s,...t},a)=>Si.jsxs(kp,{children:[Si.jsx(Dp,{}),Si.jsxs(Ji,{ref:a,className:Lu("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg max-h-[85vh] translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 overflow-hidden data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[Si.jsx("div",{className:"flex flex-col max-h-full overflow-hidden",children:s}),Si.jsxs(Xi,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground z-10",children:[Si.jsx(Tr,{className:"h-4 w-4"}),Si.jsx("span",{className:"sr-only",children:"Close"})]})]})]})));Ep.displayName=Ji.displayName;const Ap=({className:e,...s})=>Si.jsx("div",{className:Lu("flex flex-col space-y-1.5 text-center sm:text-left flex-shrink-0",e),...s});Ap.displayName="DialogHeader";const Pp=({className:e,...s})=>Si.jsx("div",{className:Lu("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 flex-shrink-0 pt-4 border-t border-gray-200 mt-auto",e),...s});Pp.displayName="DialogFooter";const _p=$n.forwardRef((({className:e,...s},t)=>Si.jsx(Zi,{ref:t,className:Lu("text-lg font-semibold leading-none tracking-tight",e),...s})));_p.displayName=Zi.displayName;const Fp=$n.forwardRef((({className:e,...s},t)=>Si.jsx(en,{ref:t,className:Lu("text-sm text-muted-foreground",e),...s})));Fp.displayName=en.displayName;const Lp=({className:e,...s})=>Si.jsx("div",{className:Lu("flex-1 overflow-y-auto min-h-0 px-1 -mx-1",e),...s});Lp.displayName="DialogBody";var Ip=$n.forwardRef(((e,s)=>Si.jsx(ki.label,{...e,ref:s,onMouseDown:s=>{var t;s.target.closest("button, input, select, textarea")||(null==(t=e.onMouseDown)||t.call(e,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}})));Ip.displayName="Label";var Rp=Ip;const qp=Gn("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Op=$n.forwardRef((({className:e,...s},t)=>Si.jsx(Rp,{ref:t,className:Lu(qp(),e),...s})));Op.displayName=Rp.displayName;const Mp=ln,Vp=$n.forwardRef((({className:e,...s},t)=>Si.jsx(an,{ref:t,className:Lu("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s})));Vp.displayName=an.displayName;const Up=$n.forwardRef((({className:e,...s},t)=>Si.jsx(nn,{ref:t,className:Lu("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s})));Up.displayName=nn.displayName;const $p=$n.forwardRef((({className:e,...s},t)=>Si.jsx(rn,{ref:t,className:Lu("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s})));$p.displayName=rn.displayName;const zp=yn,Bp=bn,Kp=$n.forwardRef((({className:e,children:s,...t},a)=>Si.jsxs(cn,{ref:a,className:Lu("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...t,children:[s,Si.jsx(on,{asChild:!0,children:Si.jsx(Hr,{className:"h-4 w-4 opacity-50"})})]})));Kp.displayName=cn.displayName;const Qp=$n.forwardRef((({className:e,...s},t)=>Si.jsx(dn,{ref:t,className:Lu("flex cursor-default items-center justify-center py-1",e),...s,children:Si.jsx(Yr,{className:"h-4 w-4"})})));Qp.displayName=dn.displayName;const Gp=$n.forwardRef((({className:e,...s},t)=>Si.jsx(un,{ref:t,className:Lu("flex cursor-default items-center justify-center py-1",e),...s,children:Si.jsx(Hr,{className:"h-4 w-4"})})));Gp.displayName=un.displayName;const Wp=$n.forwardRef((({className:e,children:s,position:t="popper",...a},i)=>Si.jsx(mn,{children:Si.jsxs(hn,{ref:i,className:Lu("relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...a,children:[Si.jsx(Qp,{}),Si.jsx(xn,{className:Lu("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),Si.jsx(Gp,{})]})})));Wp.displayName=hn.displayName;$n.forwardRef((({className:e,...s},t)=>Si.jsx(pn,{ref:t,className:Lu("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...s}))).displayName=pn.displayName;const Hp=$n.forwardRef((({className:e,children:s,...t},a)=>Si.jsxs(fn,{ref:a,className:Lu("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[Si.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:Si.jsx(gn,{children:Si.jsx(Jr,{className:"h-4 w-4"})})}),Si.jsx(jn,{children:s})]})));Hp.displayName=fn.displayName;$n.forwardRef((({className:e,...s},t)=>Si.jsx(vn,{ref:t,className:Lu("-mx-1 my-1 h-px bg-muted",e),...s}))).displayName=vn.displayName;const Yp=$n.forwardRef((({className:e,...s},t)=>Si.jsx("textarea",{className:Lu("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:t,...s})));Yp.displayName="Textarea";var Jp="Switch",[Xp,Zp]=Ni(Jp),[ef,sf]=Xp(Jp),tf=$n.forwardRef(((e,s)=>{const{__scopeSwitch:t,name:a,checked:i,defaultChecked:n,required:r,disabled:l,value:c="on",onCheckedChange:o,form:d,...u}=e,[m,h]=$n.useState(null),x=Ci(s,(e=>h(e))),p=$n.useRef(!1),f=!m||(d||!!m.closest("form")),[g,j]=Di({prop:i,defaultProp:n??!1,onChange:o,caller:Jp});return Si.jsxs(ef,{scope:t,checked:g,disabled:l,children:[Si.jsx(ki.button,{type:"button",role:"switch","aria-checked":g,"aria-required":r,"data-state":lf(g),"data-disabled":l?"":void 0,disabled:l,value:c,...u,ref:x,onClick:Ai(e.onClick,(e=>{j((e=>!e)),f&&(p.current=e.isPropagationStopped(),p.current||e.stopPropagation())}))}),f&&Si.jsx(rf,{control:m,bubbles:!p.current,name:a,value:c,checked:g,required:r,disabled:l,form:d,style:{transform:"translateX(-100%)"}})]})}));tf.displayName=Jp;var af="SwitchThumb",nf=$n.forwardRef(((e,s)=>{const{__scopeSwitch:t,...a}=e,i=sf(af,t);return Si.jsx(ki.span,{"data-state":lf(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:s})}));nf.displayName=af;var rf=$n.forwardRef((({__scopeSwitch:e,control:s,checked:t,bubbles:a=!0,...i},n)=>{const r=$n.useRef(null),l=Ci(r,n),c=Nn(t),o=wn(s);return $n.useEffect((()=>{const e=r.current;if(!e)return;const s=window.HTMLInputElement.prototype,i=Object.getOwnPropertyDescriptor(s,"checked").set;if(c!==t&&i){const s=new Event("click",{bubbles:a});i.call(e,t),e.dispatchEvent(s)}}),[c,t,a]),Si.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...i,tabIndex:-1,ref:l,style:{...i.style,...o,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})}));function lf(e){return e?"checked":"unchecked"}rf.displayName="SwitchBubbleInput";var cf=tf,of=nf;const df=$n.forwardRef((({className:e,...s},t)=>Si.jsx(cf,{className:Lu("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...s,ref:t,children:Si.jsx(of,{className:Lu("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})));df.displayName=cf.displayName;const uf=[{value:"clients",label:"Clients",icon:Qr,color:"bg-blue-500"},{value:"contracts",label:"Contracts",icon:Kr,color:"bg-green-500"},{value:"services",label:"Services",icon:Gr,color:"bg-purple-500"},{value:"financial_transactions",label:"Financial",icon:Ur,color:"bg-yellow-500"},{value:"service_authorization_forms",label:"SAFs",icon:Kr,color:"bg-orange-500"},{value:"certificates_of_compliance",label:"COCs",icon:Gr,color:"bg-red-500"},{value:"hardware_assets",label:"Hardware",icon:Mr,color:"bg-gray-500"},{value:"users",label:"Users",icon:$r,color:"bg-indigo-500"}],mf={clients:[{field:"name",label:"Client Name",type:"text"},{field:"industry",label:"Industry",type:"select",options:["Technology","Healthcare","Finance","Manufacturing","Retail"]},{field:"status",label:"Status",type:"select",options:["active","prospect","inactive"]},{field:"companySize",label:"Company Size",type:"select",options:["1-50","51-200","201-1000","1000+"]},{field:"created_at",label:"Created Date",type:"date"}],contracts:[{field:"name",label:"Contract Name",type:"text"},{field:"status",label:"Status",type:"select",options:["active","pending","expired","cancelled"]},{field:"value",label:"Contract Value",type:"number"},{field:"start_date",label:"Start Date",type:"date"},{field:"end_date",label:"End Date",type:"date"}],services:[{field:"name",label:"Service Name",type:"text"},{field:"category",label:"Category",type:"text"},{field:"deliveryModel",label:"Delivery Model",type:"text"},{field:"isActive",label:"Is Active",type:"boolean"}]},hf={text:[{value:"contains",label:"Contains"},{value:"equals",label:"Equals"},{value:"starts_with",label:"Starts with"},{value:"ends_with",label:"Ends with"},{value:"not_contains",label:"Does not contain"}],number:[{value:"equals",label:"Equals"},{value:"greater_than",label:"Greater than"},{value:"less_than",label:"Less than"},{value:"between",label:"Between"}],date:[{value:"equals",label:"On date"},{value:"before",label:"Before"},{value:"after",label:"After"},{value:"between",label:"Between"},{value:"last_7_days",label:"Last 7 days"},{value:"last_30_days",label:"Last 30 days"},{value:"this_month",label:"This month"},{value:"this_year",label:"This year"}],boolean:[{value:"equals",label:"Is"}],select:[{value:"equals",label:"Is"},{value:"not_equals",label:"Is not"},{value:"in",label:"Is one of"}]},xf=[{name:"Active Clients",description:"Clients with active status",icon:Qr,color:"bg-green-500",config:{conditions:[{field:"status",operator:"equals",value:"active",entityType:"clients"}],entityTypes:["clients"]}},{name:"Expiring Contracts",description:"Contracts expiring in next 30 days",icon:Kr,color:"bg-orange-500",config:{conditions:[{field:"end_date",operator:"between",value:[new Date,Wn(new Date,-30)],entityType:"contracts"},{field:"status",operator:"equals",value:"active",entityType:"contracts"}],entityTypes:["contracts"]}},{name:"High Value Contracts",description:"Contracts over $100,000",icon:Ur,color:"bg-yellow-500",config:{conditions:[{field:"value",operator:"greater_than",value:1e5,entityType:"contracts"}],entityTypes:["contracts"]}},{name:"Recent Activity",description:"Items created in last 7 days",icon:Wr,color:"bg-blue-500",config:{conditions:[{field:"created_at",operator:"last_7_days",value:null,entityType:"all"}],entityTypes:["clients","contracts","services"]}}];function pf({onSearchResults:e,onClose:s,initialConfig:t,showQuickAccess:a=!0,className:i}){const[n,r]=$n.useState({globalQuery:"",conditions:[],entityTypes:["clients"],sortBy:"relevance",sortOrder:"desc",limit:50,...t}),[l,c]=$n.useState("global"),[o,d]=$n.useState(!1),[u,m]=$n.useState(""),[h,x]=$n.useState(""),[p,f]=$n.useState(!1),[g,j]=$n.useState([]),[v,y]=$n.useState([]),[b,N]=$n.useState(!1),[w,C]=$n.useState([]),S=dh(),{data:T=[]}=fh({queryKey:["/api/search/saved"],queryFn:async()=>(await vh("GET","/api/search/saved")).json()}),{data:k=[]}=fh({queryKey:["/api/search/history"],queryFn:async()=>(await vh("GET","/api/search/history?limit=10")).json()}),D=gh({mutationFn:async e=>(await vh("POST","/api/search/execute",e)).json(),onSuccess:s=>{y(s),null==e||e(s)}}),E=gh({mutationFn:async e=>(await vh("POST","/api/search/save",e)).json(),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/search/saved"]}),d(!1),m(""),x("")}}),A=$n.useCallback((async()=>{if(n.globalQuery||0!==n.conditions.length){N(!0);try{await D.mutateAsync(n)}catch(e){}finally{N(!1)}}}),[n,D]),P=()=>{const e={id:Date.now().toString(),field:"",operator:"contains",value:"",entityType:n.entityTypes[0]||"clients"};r((s=>({...s,conditions:[...s.conditions,e]})))},_=(e,s)=>{r((t=>({...t,conditions:t.conditions.map((t=>t.id===e?{...t,...s}:t))})))},F=e=>{r(e.searchConfig),A()},L=()=>Si.jsx(jp,{className:"h-96",children:Si.jsxs("div",{className:"space-y-2",children:[v.map((e=>{const s=uf.find((s=>s.value===e.entityType)),t=(null==s?void 0:s.icon)||Kr;return Si.jsx(Ax,{className:"p-3 hover:shadow-md transition-shadow cursor-pointer",children:Si.jsxs("div",{className:"flex items-start space-x-3",children:[Si.jsx("div",{className:Lu("p-2 rounded-lg",(null==s?void 0:s.color)||"bg-gray-500"),children:Si.jsx(t,{className:"h-4 w-4 text-white"})}),Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("h4",{className:"text-sm font-medium truncate",children:e.title}),Si.jsx(Sx,{variant:"secondary",className:"text-xs",children:null==s?void 0:s.label})]}),Si.jsx("p",{className:"text-sm text-muted-foreground truncate",children:e.subtitle}),Si.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:e.description}),e.highlightedContent&&Si.jsx("div",{className:"text-xs text-muted-foreground mt-1",dangerouslySetInnerHTML:{__html:e.highlightedContent}})]}),Si.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(100*e.relevanceScore),"%"]})]})},`${e.entityType}-${e.entityId}`)})),0===v.length&&!b&&Si.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[Si.jsx(Xr,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),Si.jsx("p",{children:"No results found"}),Si.jsx("p",{className:"text-sm",children:"Try adjusting your search criteria"})]})]})});return Si.jsxs("div",{className:Lu("w-full max-w-6xl mx-auto",i),children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Xr,{className:"h-5 w-5 mr-2"}),"Advanced Search"]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>d(!0),disabled:!n.globalQuery&&0===n.conditions.length,children:[Si.jsx(Zr,{className:"h-4 w-4 mr-2"}),"Save Search"]}),s&&Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:s,children:Si.jsx(Tr,{className:"h-4 w-4"})})]})]})}),Si.jsx(Lx,{children:Si.jsxs(Mp,{value:l,onValueChange:c,children:[Si.jsxs(Vp,{className:"grid w-full grid-cols-4",children:[Si.jsx(Up,{value:"global",children:"Global Search"}),Si.jsx(Up,{value:"advanced",children:"Query Builder"}),Si.jsx(Up,{value:"saved",children:"Saved Searches"}),Si.jsx(Up,{value:"quick",children:"Quick Filters"})]}),Si.jsxs($p,{value:"global",className:"space-y-4",children:[Si.jsxs("div",{className:"flex gap-4",children:[Si.jsx("div",{className:"flex-1",children:Si.jsx(kx,{placeholder:"Search across all entities...",value:n.globalQuery,onChange:e=>r((s=>({...s,globalQuery:e.target.value}))),onKeyDown:e=>{"Enter"===e.key&&A()},className:"text-lg"})}),Si.jsx(Ex,{onClick:A,disabled:b,children:b?Si.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):Si.jsx(Xr,{className:"h-4 w-4"})})]}),Si.jsxs("div",{className:"flex flex-wrap gap-2",children:[Si.jsx(Op,{className:"text-sm font-medium mr-4",children:"Search in:"}),uf.map((e=>Si.jsxs(Sx,{variant:n.entityTypes.includes(e.value)?"default":"outline",className:"cursor-pointer",onClick:()=>{r((s=>({...s,entityTypes:s.entityTypes.includes(e.value)?s.entityTypes.filter((s=>s!==e.value)):[...s.entityTypes,e.value]})))},children:[Si.jsx(e.icon,{className:"h-3 w-3 mr-1"}),e.label]},e.value)))]}),L()]}),Si.jsxs($p,{value:"advanced",className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{children:"Entity Types"}),Si.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:uf.map((e=>Si.jsxs(Sx,{variant:n.entityTypes.includes(e.value)?"default":"outline",className:"cursor-pointer",onClick:()=>{r((s=>({...s,entityTypes:s.entityTypes.includes(e.value)?s.entityTypes.filter((s=>s!==e.value)):[...s.entityTypes,e.value]})))},children:[Si.jsx(e.icon,{className:"h-3 w-3 mr-1"}),e.label]},e.value)))})]}),Si.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[Si.jsxs("div",{children:[Si.jsx(Op,{children:"Sort By"}),Si.jsxs(zp,{value:n.sortBy,onValueChange:e=>r((s=>({...s,sortBy:e}))),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"relevance",children:"Relevance"}),Si.jsx(Hp,{value:"created_at",children:"Created Date"}),Si.jsx(Hp,{value:"updated_at",children:"Updated Date"}),Si.jsx(Hp,{value:"name",children:"Name"})]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{children:"Order"}),Si.jsxs(zp,{value:n.sortOrder,onValueChange:e=>r((s=>({...s,sortOrder:e}))),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"desc",children:"Descending"}),Si.jsx(Hp,{value:"asc",children:"Ascending"})]})]})]})]})]}),Si.jsx(Cp,{}),Si.jsxs("div",{children:[Si.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Si.jsx(Op,{className:"text-lg font-medium",children:"Search Conditions"}),Si.jsxs(Ex,{variant:"outline",onClick:A,disabled:b||0===n.conditions.length,children:[b?Si.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"}):Si.jsx(el,{className:"h-4 w-4 mr-2"}),"Execute Search"]})]}),Si.jsxs("div",{className:"space-y-4",children:[n.conditions.map(((e,s)=>Si.jsx(Ax,{className:"p-4",children:Si.jsxs("div",{className:"grid grid-cols-12 gap-3 items-center",children:[Si.jsx("div",{className:"col-span-2",children:Si.jsxs(zp,{value:e.entityType,onValueChange:s=>_(e.id,{entityType:s,field:"",value:""}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:uf.map((e=>Si.jsx(Hp,{value:e.value,children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(e.icon,{className:"h-4 w-4 mr-2"}),e.label]})},e.value)))})]})}),Si.jsx("div",{className:"col-span-3",children:Si.jsxs(zp,{value:e.field,onValueChange:s=>_(e.id,{field:s,value:""}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select field"})}),Si.jsx(Wp,{children:(mf[e.entityType]||[]).map((e=>Si.jsx(Hp,{value:e.field,children:e.label},e.field)))})]})}),Si.jsx("div",{className:"col-span-2",children:Si.jsxs(zp,{value:e.operator,onValueChange:s=>_(e.id,{operator:s}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:(()=>{const s=(mf[e.entityType]||[]).find((s=>s.field===e.field)),t=(null==s?void 0:s.type)||"text";return(hf[t]||hf.text).map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})()})]})}),Si.jsx("div",{className:"col-span-4",children:(()=>{var s,t,a;const i=(mf[e.entityType]||[]).find((s=>s.field===e.field)),n=(null==i?void 0:i.type)||"text";return"boolean"===n?Si.jsxs(zp,{value:null==(s=e.value)?void 0:s.toString(),onValueChange:s=>_(e.id,{value:"true"===s}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"true",children:"True"}),Si.jsx(Hp,{value:"false",children:"False"})]})]}):"select"===n&&(null==i?void 0:i.options)?Si.jsxs(zp,{value:e.value,onValueChange:s=>_(e.id,{value:s}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:i.options.map((e=>Si.jsx(Hp,{value:e,children:e},e)))})]}):"date"===n?"between"===e.operator?Si.jsxs("div",{className:"flex gap-1",children:[Si.jsx(kx,{type:"date",value:(null==(t=e.value)?void 0:t[0])?Hn(new Date(e.value[0]),"yyyy-MM-dd"):"",onChange:s=>{var t;const a=[new Date(s.target.value),(null==(t=e.value)?void 0:t[1])||new Date];_(e.id,{value:a})}}),Si.jsx(kx,{type:"date",value:(null==(a=e.value)?void 0:a[1])?Hn(new Date(e.value[1]),"yyyy-MM-dd"):"",onChange:s=>{var t;const a=[(null==(t=e.value)?void 0:t[0])||new Date,new Date(s.target.value)];_(e.id,{value:a})}})]}):e.operator.includes("_days")||e.operator.includes("_month")||e.operator.includes("_year")?Si.jsx("div",{className:"text-sm text-muted-foreground px-3 py-2",children:"Relative date"}):Si.jsx(kx,{type:"date",value:e.value?Hn(new Date(e.value),"yyyy-MM-dd"):"",onChange:s=>_(e.id,{value:new Date(s.target.value)})}):Si.jsx(kx,{type:"number"===n?"number":"text",value:e.value,onChange:s=>_(e.id,{value:"number"===n?parseFloat(s.target.value)||0:s.target.value}),placeholder:"Enter value"})})()}),Si.jsx("div",{className:"col-span-1",children:Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void r((e=>({...e,conditions:e.conditions.filter((e=>e.id!==s))})));var s},className:"text-red-500 hover:text-red-700",children:Si.jsx(Tr,{className:"h-4 w-4"})})})]})},e.id))),Si.jsxs(Ex,{variant:"outline",onClick:P,className:"w-full",children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Condition"]})]})]}),v.length>0&&Si.jsxs(Si.Fragment,{children:[Si.jsx(Cp,{}),Si.jsxs("div",{children:[Si.jsxs(Op,{className:"text-lg font-medium",children:["Results (",v.length,")"]}),L()]})]})]}),Si.jsx($p,{value:"saved",className:"space-y-4",children:Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:T.map((e=>Si.jsx(Ax,{className:"p-4 hover:shadow-md transition-shadow",children:Si.jsxs("div",{className:"flex items-start justify-between",children:[Si.jsxs("div",{className:"flex-1",children:[Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx("h4",{className:"font-medium",children:e.name}),e.isQuickFilter&&Si.jsxs(Sx,{variant:"secondary",className:"text-xs",children:[Si.jsx(Ir,{className:"h-3 w-3 mr-1"}),"Quick"]}),e.isPublic&&Si.jsxs(Sx,{variant:"outline",className:"text-xs",children:[Si.jsx(sl,{className:"h-3 w-3 mr-1"}),"Public"]})]}),Si.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.description}),Si.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[Si.jsxs("span",{children:["Used ",e.useCount," times"]}),e.lastUsed&&Si.jsxs("span",{children:["Last used ",Hn(new Date(e.lastUsed),"MMM dd")]})]}),e.tags&&e.tags.length>0&&Si.jsx("div",{className:"flex gap-1 mt-2",children:e.tags.map((e=>Si.jsx(Sx,{variant:"outline",className:"text-xs",children:e},e)))})]}),Si.jsxs("div",{className:"flex gap-1",children:[Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>F(e),children:Si.jsx(el,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",children:Si.jsx(tl,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",className:"text-red-500",children:Si.jsx(al,{className:"h-4 w-4"})})]})]})},e.id)))})}),Si.jsxs($p,{value:"quick",className:"space-y-4",children:[Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:xf.map(((e,s)=>Si.jsx(Ax,{className:"p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>(e=>{const s={...n,...e.config,conditions:e.config.conditions.map((e=>({...e,id:Date.now().toString()+Math.random()})))};r(s),setTimeout((()=>A()),100)})(e),children:Si.jsxs("div",{className:"flex items-center gap-3",children:[Si.jsx("div",{className:Lu("p-3 rounded-lg",e.color),children:Si.jsx(e.icon,{className:"h-5 w-5 text-white"})}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:e.name}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:e.description})]})]})},s)))}),T.filter((e=>e.isQuickFilter)).length>0&&Si.jsxs(Si.Fragment,{children:[Si.jsx(Cp,{}),Si.jsxs("div",{children:[Si.jsx(Op,{className:"text-lg font-medium",children:"Your Quick Filters"}),Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:T.filter((e=>e.isQuickFilter)).map((e=>Si.jsx(Ax,{className:"p-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>F(e),children:Si.jsxs("div",{className:"flex items-center gap-3",children:[Si.jsx("div",{className:"p-3 rounded-lg bg-indigo-500",children:Si.jsx(il,{className:"h-5 w-5 text-white"})}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:e.name}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:e.description})]})]})},e.id)))})]})]})]})]})})]}),Si.jsx(Sp,{open:o,onOpenChange:d,children:Si.jsxs(Ep,{className:"max-w-md max-h-[85vh] overflow-hidden",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Save Search"})}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"search-name",children:"Name *"}),Si.jsx(kx,{id:"search-name",value:u,onChange:e=>m(e.target.value),placeholder:"Enter search name"})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"search-description",children:"Description"}),Si.jsx(Yp,{id:"search-description",value:h,onChange:e=>x(e.target.value),placeholder:"Describe what this search finds",rows:3})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(df,{id:"public-search",checked:p,onCheckedChange:f}),Si.jsx(Op,{htmlFor:"public-search",children:"Make this search public (visible to all users)"})]}),Si.jsxs("div",{className:"flex justify-end space-x-2",children:[Si.jsx(Ex,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),Si.jsx(Ex,{onClick:()=>{E.mutate({name:u,description:h,searchConfig:n,isPublic:p,tags:g})},disabled:!u||E.isPending,children:E.isPending?"Saving...":"Save Search"})]})]})]})})]})}const ff={clients:Qr,contracts:Kr,services:Gr,financial_transactions:Ur,users:$r,hardware_assets:Mr,service_authorization_forms:Kr,certificates_of_compliance:Gr},gf={clients:"bg-blue-500",contracts:"bg-green-500",services:"bg-purple-500",financial_transactions:"bg-yellow-500",users:"bg-indigo-500",hardware_assets:"bg-gray-500",service_authorization_forms:"bg-orange-500",certificates_of_compliance:"bg-red-500"};function jf({className:e}){const[s,t]=$n.useState(""),[a,i]=$n.useState(!1),[n,r]=$n.useState(!1),[l,c]=$n.useState([]),[o,d]=$n.useState(!1),u=$n.useRef(null),[m,h]=Oo(),x=gh({mutationFn:async e=>{if(!e||e.length<2)return[];return(await vh("POST","/api/search/execute",{globalQuery:e,entityTypes:["clients","contracts","services","users"],limit:8})).json()},onSuccess:e=>{c(e),d(!0)}}),{data:p=[]}=fh({queryKey:["/api/search/history"],queryFn:async()=>(await vh("GET","/api/search/history?limit=5")).json()}),{data:f=[]}=fh({queryKey:["/api/search/saved-quick"],queryFn:async()=>{const e=await vh("GET","/api/search/saved");return(await e.json()).filter((e=>e.isQuickFilter))}});$n.useEffect((()=>{const e=setTimeout((()=>{s.length>=2?x.mutate(s):(c([]),d(!1))}),300);return()=>clearTimeout(e)}),[s]),$n.useEffect((()=>{const e=e=>{(e.metaKey||e.ctrlKey)&&"k"===e.key&&(e.preventDefault(),i(!0),setTimeout((()=>{var e;return null==(e=u.current)?void 0:e.focus()}),100)),"Escape"===e.key&&(i(!1),d(!1))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[]);const g=e=>{switch(e.entityType){case"clients":h(`/clients/${e.entityId}`);break;case"contracts":h(`/contracts/${e.entityId}`);break;case"services":h(`/services/${e.entityId}`);break;case"users":h(`/users/${e.entityId}`)}i(!1),d(!1),t("")};return Si.jsxs(Si.Fragment,{children:[Si.jsxs("div",{className:Lu("flex items-center space-x-2",e),children:[Si.jsxs("div",{className:"relative flex-1 max-w-md",children:[Si.jsx(kx,{ref:u,placeholder:"Search everything... (⌘K)",value:s,onChange:e=>t(e.target.value),onFocus:()=>i(!0),className:"pl-10 pr-4"}),Si.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),o&&l.length>0&&Si.jsx(Ax,{className:"absolute top-full left-0 right-0 mt-1 z-50 shadow-lg",children:Si.jsx(Lx,{className:"p-2",children:Si.jsx(jp,{className:"max-h-96",children:Si.jsxs("div",{className:"space-y-1",children:[l.map((e=>{const s=ff[e.entityType]||Kr,t=gf[e.entityType]||"bg-gray-500";return Si.jsxs("div",{className:"flex items-center space-x-3 p-2 rounded-md hover:bg-accent cursor-pointer",onClick:()=>g(e),children:[Si.jsx("div",{className:Lu("p-1.5 rounded",t),children:Si.jsx(s,{className:"h-3 w-3 text-white"})}),Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsx("div",{className:"text-sm font-medium truncate",children:e.title}),Si.jsx("div",{className:"text-xs text-muted-foreground truncate",children:e.subtitle})]}),Si.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(100*e.relevanceScore),"%"]})]},`${e.entityType}-${e.entityId}`)})),s.length>=2&&Si.jsxs(Si.Fragment,{children:[Si.jsx(Cp,{}),Si.jsxs(Ex,{variant:"ghost",className:"w-full justify-start text-sm",onClick:()=>r(!0),children:[Si.jsx(rl,{className:"h-4 w-4 mr-2"}),'Advanced Search for "',s,'"',Si.jsx(ll,{className:"h-4 w-4 ml-auto"})]})]})]})})})})]}),Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>r(!0),className:"hidden sm:flex",children:[Si.jsx(rl,{className:"h-4 w-4 mr-2"}),"Advanced"]})]}),a&&Si.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 sm:hidden",children:Si.jsx("div",{className:"container mx-auto p-4",children:Si.jsx(Ax,{className:"w-full",children:Si.jsxs(Lx,{className:"p-4",children:[Si.jsxs("div",{className:"relative mb-4",children:[Si.jsx(kx,{placeholder:"Search everything...",value:s,onChange:e=>t(e.target.value),className:"pl-10",autoFocus:!0}),Si.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"})]}),f.length>0&&Si.jsxs("div",{className:"mb-4",children:[Si.jsx("h4",{className:"text-sm font-medium mb-2",children:"Quick Filters"}),Si.jsx("div",{className:"flex flex-wrap gap-2",children:f.slice(0,4).map((e=>Si.jsxs(Sx,{variant:"outline",className:"cursor-pointer",onClick:()=>{},children:[Si.jsx(Ir,{className:"h-3 w-3 mr-1"}),e.name]},e.id)))})]}),p.length>0&&Si.jsxs("div",{className:"mb-4",children:[Si.jsx("h4",{className:"text-sm font-medium mb-2",children:"Recent Searches"}),Si.jsx("div",{className:"space-y-2",children:p.slice(0,3).map((e=>Si.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded-md hover:bg-accent cursor-pointer",onClick:()=>{return s=e.searchConfig,t(s.globalQuery||""),void(s.globalQuery&&x.mutate(s.globalQuery));var s},children:[Si.jsx(Wr,{className:"h-4 w-4 text-muted-foreground"}),Si.jsx("span",{className:"text-sm",children:e.searchQuery})]},e.id)))})]}),l.length>0&&Si.jsxs("div",{children:[Si.jsx("h4",{className:"text-sm font-medium mb-2",children:"Results"}),Si.jsx(jp,{className:"max-h-64",children:Si.jsx("div",{className:"space-y-2",children:l.map((e=>{const s=ff[e.entityType]||Kr,t=gf[e.entityType]||"bg-gray-500";return Si.jsxs("div",{className:"flex items-center space-x-3 p-2 rounded-md hover:bg-accent cursor-pointer",onClick:()=>g(e),children:[Si.jsx("div",{className:Lu("p-1.5 rounded",t),children:Si.jsx(s,{className:"h-3 w-3 text-white"})}),Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsx("div",{className:"text-sm font-medium truncate",children:e.title}),Si.jsx("div",{className:"text-xs text-muted-foreground truncate",children:e.subtitle})]})]},`${e.entityType}-${e.entityId}`)}))})})]}),Si.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t",children:[Si.jsxs(Ex,{variant:"outline",onClick:()=>r(!0),children:[Si.jsx(rl,{className:"h-4 w-4 mr-2"}),"Advanced Search"]}),Si.jsx(Ex,{variant:"ghost",onClick:()=>i(!1),children:"Close"})]})]})})})}),Si.jsx(Sp,{open:n,onOpenChange:r,children:Si.jsx(Ep,{className:"max-w-6xl max-h-[85vh] overflow-hidden",children:Si.jsx(pf,{onClose:()=>r(!1),initialConfig:{globalQuery:s,entityTypes:["clients","contracts","services"]},onSearchResults:e=>{}})})})]})}function vf({children:e,title:s,subtitle:t}){const{user:a,logoutMutation:i}=Ah(),[n,r]=$n.useState(!0),[l,c]=$n.useState(""),[o,d]=$n.useState("MSSP Platform"),{data:u}=fh({queryKey:["/api/company/settings"],queryFn:async()=>{try{return(await vh("GET","/api/company/settings")).json()}catch(e){return{companyName:"MSSP Platform",logoUrl:null}}}}),m=()=>{r(!n)};return Si.jsxs("div",{className:"flex h-screen bg-gray-50",children:[Si.jsxs("div",{className:Lu("bg-white shadow-sm border-r border-gray-200 flex flex-col transition-all duration-300 ease-in-out","hidden md:flex",n?"w-64":"w-16"),children:[Si.jsx("div",{className:"p-4 lg:p-6 border-b border-gray-200",children:Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx("div",{className:"w-8 h-8 bg-primary rounded-lg flex items-center justify-center overflow-hidden flex-shrink-0",children:l?Si.jsx("img",{src:l,alt:"Company Logo",className:"w-full h-full object-contain"}):Si.jsx(Gr,{className:"h-4 w-4 text-white"})}),n&&Si.jsxs("div",{className:"min-w-0",children:[Si.jsx("h1",{className:"text-lg font-semibold text-gray-900 truncate",children:o}),Si.jsx("p",{className:"text-xs text-gray-600 truncate",children:"Client Management"})]})]})}),Si.jsx("div",{className:"flex-1 overflow-y-auto",children:Si.jsx(vx,{compact:!n,showCategories:n,className:n?"p-4 space-y-1":"p-2 space-y-1"})}),Si.jsx("div",{className:"border-t border-gray-200 p-4",children:Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx("div",{className:"w-8 h-8 bg-primary rounded-full flex items-center justify-center flex-shrink-0",children:Si.jsx("span",{className:"text-white text-sm font-medium",children:a?`${a.firstName[0]}${a.lastName[0]}`:"U"})}),n&&Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a?`${a.firstName} ${a.lastName}`:"User"}),Si.jsx("p",{className:"text-xs text-gray-600 truncate capitalize",children:(null==a?void 0:a.role)||"User"})]}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{i.mutate()},disabled:i.isPending,className:"flex-shrink-0",title:"Logout",children:Si.jsx(cl,{className:"h-4 w-4"})})]})})]}),Si.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden min-w-0",children:[Si.jsx("header",{className:"bg-white border-b border-gray-200 px-4 sm:px-6 py-3 sm:py-4 flex-shrink-0",children:Si.jsxs("div",{className:"flex items-center justify-between gap-2 sm:gap-4",children:[Si.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4 min-w-0 flex-1",children:[Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:m,className:"p-2 flex-shrink-0 md:hidden","aria-label":"Toggle sidebar",children:Si.jsx(Fr,{className:"h-5 w-5"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:m,className:"p-2 flex-shrink-0 hidden md:flex","aria-label":"Toggle sidebar",children:Si.jsx(Fr,{className:"h-5 w-5"})}),Si.jsxs("div",{className:"min-w-0 flex-1",children:[Si.jsx("h1",{className:"text-lg sm:text-xl font-semibold text-gray-900 truncate",children:s}),t&&Si.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:t})]})]}),Si.jsx("div",{className:"hidden sm:flex flex-1 max-w-md lg:max-w-2xl mx-4",children:Si.jsx(jf,{className:"w-full"})}),Si.jsx("div",{className:"flex items-center space-x-2 sm:space-x-4 flex-shrink-0",children:Si.jsx(Tx,{})})]})}),Si.jsx("main",{className:"flex-1 overflow-auto",children:Si.jsx("div",{className:"h-full",children:e})})]}),!n&&Si.jsx("div",{className:"md:hidden"})]})}function yf({pageUrl:e}){const[,s]=Oo(),{user:t}=Ah();return Si.jsx(vf,{title:"Access Denied",subtitle:"Insufficient permissions",children:Si.jsx("div",{className:"flex items-center justify-center min-h-[60vh] p-6",children:Si.jsxs("div",{className:"max-w-md mx-auto text-center space-y-6",children:[Si.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto",children:Si.jsx(ol,{className:"h-8 w-8 text-red-600"})}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Access Denied"}),Si.jsx("p",{className:"text-gray-600",children:"You don't have permission to access this page."})]}),Si.jsxs(Nx,{className:"text-left",children:[Si.jsx(ol,{className:"h-4 w-4"}),Si.jsx(wx,{children:Si.jsxs("div",{className:"space-y-2",children:[Si.jsxs("p",{children:[Si.jsx("strong",{children:"Current Role:"})," ",(null==t?void 0:t.role)||"Unknown"]}),Si.jsxs("p",{children:[Si.jsx("strong",{children:"Requested Page:"})," ",e||"Unknown"]}),Si.jsx("p",{children:"Contact your administrator if you believe you should have access to this page."})]})})]}),Si.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[Si.jsxs(Ex,{variant:"outline",onClick:()=>s(-1),className:"flex items-center",children:[Si.jsx(dl,{className:"h-4 w-4 mr-2"}),"Go Back"]}),Si.jsx(Ex,{onClick:()=>s("/"),children:"Go to Dashboard"})]})]})})})}function bf({children:e,pageUrl:s,fallbackPath:t="/",showUnauthorizedPage:a=!0}){const[i]=Oo(),{user:n,isLoading:r}=Ah(),{hasPageAccess:l,accessiblePages:c}=yx(),o=s||i;if(r||!c)return Si.jsx("div",{className:"flex items-center justify-center min-h-screen",children:Si.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(!n)return Si.jsx(Qo,{to:"/login",replace:!0});return l(o)?Si.jsx(Si.Fragment,{children:e}):a?Si.jsx(yf,{pageUrl:o}):Si.jsx(Qo,{to:t,replace:!0})}class Nf extends $n.Component{constructor(e){super(e),this.handleRetry=()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})},this.handleGoHome=()=>{window.location.href="/"},this.handleReportBug=()=>{var e,s,t;const a={error:null==(e=this.state.error)?void 0:e.message,stack:null==(s=this.state.error)?void 0:s.stack,componentStack:null==(t=this.state.errorInfo)?void 0:t.componentStack,timestamp:(new Date).toISOString(),userAgent:navigator.userAgent,url:window.location.href};navigator.clipboard.writeText(JSON.stringify(a,null,2)).then((()=>{alert("Error details copied to clipboard. Please share with support.")}))},this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){this.setState({error:e,errorInfo:s}),this.props.onError&&this.props.onError(e,s)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:Si.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-background p-4",children:Si.jsxs(Ax,{className:"w-full max-w-2xl mx-auto",children:[Si.jsxs(Px,{className:"text-center",children:[Si.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:Si.jsx(ol,{className:"h-8 w-8 text-red-600"})}),Si.jsx(_x,{className:"text-2xl",children:"Something went wrong"}),Si.jsx(Fx,{children:"An unexpected error occurred. We apologize for the inconvenience."})]}),Si.jsxs(Lx,{className:"space-y-6",children:[Si.jsxs("div",{className:"text-center space-y-2",children:[Si.jsx("p",{className:"text-sm text-muted-foreground",children:"The application encountered an unexpected error and couldn't recover."}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Please try refreshing the page or contact support if the problem persists."})]}),!1,Si.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[Si.jsxs(Ex,{variant:"outline",onClick:this.handleRetry,className:"flex items-center",children:[Si.jsx(ul,{className:"h-4 w-4 mr-2"}),"Try Again"]}),Si.jsxs(Ex,{onClick:this.handleGoHome,className:"flex items-center",children:[Si.jsx(ml,{className:"h-4 w-4 mr-2"}),"Go to Dashboard"]}),Si.jsxs(Ex,{variant:"outline",onClick:this.handleReportBug,className:"flex items-center",children:[Si.jsx(hl,{className:"h-4 w-4 mr-2"}),"Report Bug"]})]}),Si.jsxs("div",{className:"pt-4 border-t text-center",children:[Si.jsxs("p",{className:"text-xs text-muted-foreground",children:["Error ID: ",Date.now().toString(36).toUpperCase()]}),Si.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Please include this ID when contacting support."})]})]})]})}):this.props.children}}const wf=$n.createContext(null);class Cf extends Error{constructor(e,s){var t;super(e),this.name="DetailedError",this.originalError=null==s?void 0:s.originalError,this.additionalInfo=null==s?void 0:s.additionalInfo,this.timestamp=(new Date).toISOString(),this.userAgent=navigator.userAgent,this.url=window.location.href,this.apiResponse=null==s?void 0:s.apiResponse,this.requestDetails=null==s?void 0:s.requestDetails,(null==(t=null==s?void 0:s.originalError)?void 0:t.stack)&&(this.stack=s.originalError.stack)}}const Sf=({children:e})=>{const[s,t]=Bn.useState(null),a=Bn.useCallback(((e,s)=>{const a=new Cf(e.message,{originalError:e,additionalInfo:s});t(a)}),[]),i=Bn.useCallback((()=>{t(null)}),[]);return Bn.useEffect((()=>{if(s)throw s}),[s]),Si.jsx(wf.Provider,{value:{captureError:a,clearError:i},children:e})};var Tf="Checkbox",[kf,Df]=Ni(Tf),[Ef,Af]=kf(Tf);function Pf(e){const{__scopeCheckbox:s,checked:t,children:a,defaultChecked:i,disabled:n,form:r,name:l,onCheckedChange:c,required:o,value:d="on",internal_do_not_use_render:u}=e,[m,h]=Di({prop:t,defaultProp:i??!1,onChange:c,caller:Tf}),[x,p]=$n.useState(null),[f,g]=$n.useState(null),j=$n.useRef(!1),v=!x||(!!r||!!x.closest("form")),y={checked:m,disabled:n,setChecked:h,control:x,setControl:p,name:l,form:r,value:d,hasConsumerStoppedPropagationRef:j,required:o,defaultChecked:!Vf(i)&&i,isFormControl:v,bubbleInput:f,setBubbleInput:g};return Si.jsx(Ef,{scope:s,...y,children:Mf(u)?u(y):a})}var _f="CheckboxTrigger",Ff=$n.forwardRef((({__scopeCheckbox:e,onKeyDown:s,onClick:t,...a},i)=>{const{control:n,value:r,disabled:l,checked:c,required:o,setControl:d,setChecked:u,hasConsumerStoppedPropagationRef:m,isFormControl:h,bubbleInput:x}=Af(_f,e),p=Ci(i,d),f=$n.useRef(c);return $n.useEffect((()=>{const e=null==n?void 0:n.form;if(e){const s=()=>u(f.current);return e.addEventListener("reset",s),()=>e.removeEventListener("reset",s)}}),[n,u]),Si.jsx(ki.button,{type:"button",role:"checkbox","aria-checked":Vf(c)?"mixed":c,"aria-required":o,"data-state":Uf(c),"data-disabled":l?"":void 0,disabled:l,value:r,...a,ref:p,onKeyDown:Ai(s,(e=>{"Enter"===e.key&&e.preventDefault()})),onClick:Ai(t,(e=>{u((e=>!!Vf(e)||!e)),x&&h&&(m.current=e.isPropagationStopped(),m.current||e.stopPropagation())}))})}));Ff.displayName=_f;var Lf=$n.forwardRef(((e,s)=>{const{__scopeCheckbox:t,name:a,checked:i,defaultChecked:n,required:r,disabled:l,value:c,onCheckedChange:o,form:d,...u}=e;return Si.jsx(Pf,{__scopeCheckbox:t,checked:i,defaultChecked:n,disabled:l,required:r,onCheckedChange:o,name:a,form:d,value:c,internal_do_not_use_render:({isFormControl:e})=>Si.jsxs(Si.Fragment,{children:[Si.jsx(Ff,{...u,ref:s,__scopeCheckbox:t}),e&&Si.jsx(Of,{__scopeCheckbox:t})]})})}));Lf.displayName=Tf;var If="CheckboxIndicator",Rf=$n.forwardRef(((e,s)=>{const{__scopeCheckbox:t,forceMount:a,...i}=e,n=Af(If,t);return Si.jsx(Ei,{present:a||Vf(n.checked)||!0===n.checked,children:Si.jsx(ki.span,{"data-state":Uf(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:s,style:{pointerEvents:"none",...e.style}})})}));Rf.displayName=If;var qf="CheckboxBubbleInput",Of=$n.forwardRef((({__scopeCheckbox:e,...s},t)=>{const{control:a,hasConsumerStoppedPropagationRef:i,checked:n,defaultChecked:r,required:l,disabled:c,name:o,value:d,form:u,bubbleInput:m,setBubbleInput:h}=Af(qf,e),x=Ci(t,h),p=Nn(n),f=wn(a);$n.useEffect((()=>{const e=m;if(!e)return;const s=window.HTMLInputElement.prototype,t=Object.getOwnPropertyDescriptor(s,"checked").set,a=!i.current;if(p!==n&&t){const s=new Event("click",{bubbles:a});e.indeterminate=Vf(n),t.call(e,!Vf(n)&&n),e.dispatchEvent(s)}}),[m,p,n,i]);const g=$n.useRef(!Vf(n)&&n);return Si.jsx(ki.input,{type:"checkbox","aria-hidden":!0,defaultChecked:r??g.current,required:l,disabled:c,name:o,value:d,form:u,...s,tabIndex:-1,ref:x,style:{...s.style,...f,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})}));function Mf(e){return"function"==typeof e}function Vf(e){return"indeterminate"===e}function Uf(e){return Vf(e)?"indeterminate":e?"checked":"unchecked"}Of.displayName=qf;const $f=$n.forwardRef((({className:e,...s},t)=>Si.jsx(Lf,{ref:t,className:Lu("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:Si.jsx(Rf,{className:Lu("flex items-center justify-center text-current"),children:Si.jsx(Jr,{className:"h-4 w-4"})})})));function zf(){const{user:e,loginMutation:s,ldapLoginMutation:t}=Ah(),[,a]=Oo(),[i,n]=$n.useState({email:"",password:"",rememberMe:!1}),[r,l]=$n.useState({username:"",password:"",rememberMe:!1}),[c,o]=$n.useState("local"),d=!1;$n.useEffect((()=>{e&&a("/")}),[e,a]),$n.useEffect((()=>{s.isSuccess&&s.data&&a("/")}),[s.isSuccess,s.data,a]),$n.useEffect((()=>{t.isSuccess&&t.data&&a("/")}),[t.isSuccess,t.data,a]);const u=e=>{const{name:s,value:t}=e.target;n((e=>({...e,[s]:t})))},m=e=>{const{name:s,value:t}=e.target;l((e=>({...e,[s]:t})))},h=s.isPending||t.isPending,x="local"===c?s.error:t.error;return Si.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:Si.jsxs(Ax,{className:"w-full max-w-md",children:[Si.jsxs(Px,{className:"text-center",children:[Si.jsx("div",{className:"flex items-center justify-center mb-4",children:Si.jsx(Gr,{className:"h-12 w-12 text-blue-600"})}),Si.jsx(_x,{className:"text-2xl",children:"MSSP Platform"}),Si.jsx(Fx,{children:"Sign in to your account to continue"})]}),Si.jsxs(Lx,{children:[Si.jsxs(Mp,{value:c,onValueChange:e=>o(e),className:"w-full",children:[Si.jsxs(Vp,{className:"grid w-full grid-cols-2",children:[Si.jsxs(Up,{value:"local",className:"flex items-center space-x-2",children:[Si.jsx(xl,{className:"h-4 w-4"}),Si.jsx("span",{children:"Local Account"})]}),Si.jsxs(Up,{value:"ldap",className:"flex items-center space-x-2",children:[Si.jsx(pl,{className:"h-4 w-4"}),Si.jsx("span",{children:"Company Account"})]})]}),Si.jsx($p,{value:"local",className:"mt-6",children:Si.jsxs("form",{onSubmit:e=>{e.preventDefault(),s.mutate(i)},className:"space-y-4",children:[Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"email",children:"Email"}),Si.jsx(kx,{id:"email",name:"email",type:"email",value:i.email,onChange:u,placeholder:"Enter your email",required:!0,disabled:h})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"password",children:"Password"}),Si.jsx(kx,{id:"password",name:"password",type:"password",value:i.password,onChange:u,placeholder:"Enter your password",required:!0,disabled:h})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"rememberMe",children:"Remember Me"}),Si.jsx($f,{id:"rememberMe",name:"rememberMe",checked:i.rememberMe,onCheckedChange:e=>n((s=>({...s,rememberMe:e})))})]}),Si.jsx(Ex,{type:"submit",className:"w-full",disabled:h,children:h&&"local"===c?Si.jsxs(Si.Fragment,{children:[Si.jsx(kr,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):"Sign In"}),d]})}),Si.jsx($p,{value:"ldap",className:"mt-6",children:Si.jsxs("form",{onSubmit:e=>{e.preventDefault(),t.mutate(r)},className:"space-y-4",children:[Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldap-username",children:"LDAP Username"}),Si.jsx(kx,{id:"ldap-username",name:"username",type:"text",value:r.username,onChange:m,placeholder:"Enter your LDAP username",required:!0,disabled:h})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldap-password",children:"Password"}),Si.jsx(kx,{id:"ldap-password",name:"password",type:"password",value:r.password,onChange:m,placeholder:"Enter your password",required:!0,disabled:h})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"rememberMe",children:"Remember Me"}),Si.jsx($f,{id:"rememberMe",name:"rememberMe",checked:r.rememberMe,onCheckedChange:e=>l((s=>({...s,rememberMe:e})))})]}),Si.jsx(Ex,{type:"submit",className:"w-full",disabled:h,children:h&&"ldap"===c?Si.jsxs(Si.Fragment,{children:[Si.jsx(kr,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):"Sign in with Company Account"}),d]})})]}),x&&Si.jsx("p",{className:"text-sm text-red-600 text-center mt-4",children:x.message}),Si.jsxs("div",{className:"mt-6 text-center space-y-4",children:[Si.jsxs("div",{className:"space-y-2",children:[Si.jsx("p",{className:"text-xs text-gray-600 font-medium",children:"Test Accounts:"}),Si.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[Si.jsxs("p",{children:[Si.jsx("strong",{children:"Admin:"})," admin@mssp.local"]}),Si.jsxs("p",{children:[Si.jsx("strong",{children:"Manager:"})," manager@mssp.local"]}),Si.jsxs("p",{children:[Si.jsx("strong",{children:"Engineer:"})," engineer@mssp.local"]}),Si.jsxs("p",{children:[Si.jsx("strong",{children:"User:"})," user@mssp.local"]}),Si.jsx("p",{className:"text-gray-400",children:"Password: admin123"})]}),Si.jsxs("p",{className:"text-xs text-gray-500 pt-2",children:[Si.jsx("strong",{children:"Test LDAP Account:"})," einstein / password"]})]}),Si.jsx("div",{className:"pt-4 border-t border-gray-200",children:Si.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",Si.jsx(Ex,{variant:"link",className:"p-0 h-auto text-blue-600 hover:text-blue-800",onClick:()=>a("/register"),children:"Sign up here"})]})})]})]})]})})}function Bf(){const{user:e}=Ah(),[,s]=Oo(),[t,a]=$n.useState({username:"",email:"",firstName:"",lastName:"",password:"",confirmPassword:""}),[i,n]=$n.useState({});$n.useEffect((()=>{e&&s("/")}),[e,s]);const r=gh({mutationFn:async e=>{const s=await fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!s.ok){const e=await s.text();throw new Error(e||"Registration failed")}return s.json()},onSuccess:()=>{s("/")}}),l=e=>{const{name:s,value:t}=e.target;a((e=>({...e,[s]:t}))),i[s]&&n((e=>({...e,[s]:void 0})))};return Si.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:Si.jsxs(Ax,{className:"w-full max-w-md",children:[Si.jsxs(Px,{className:"text-center",children:[Si.jsx("div",{className:"flex items-center justify-center mb-4",children:Si.jsx(Gr,{className:"h-12 w-12 text-blue-600"})}),Si.jsx(_x,{className:"text-2xl",children:"Create Account"}),Si.jsx(Fx,{children:"Join the MSSP Platform to get started"})]}),Si.jsxs(Lx,{children:[Si.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!(()=>{const e={};return t.username.trim()?t.username.length<3&&(e.username="Username must be at least 3 characters"):e.username="Username is required",t.email.trim()?/\S+@\S+\.\S+/.test(t.email)||(e.email="Email is invalid"):e.email="Email is required",t.firstName.trim()||(e.firstName="First name is required"),t.lastName.trim()||(e.lastName="Last name is required"),t.password?t.password.length<6&&(e.password="Password must be at least 6 characters"):e.password="Password is required",t.confirmPassword?t.password!==t.confirmPassword&&(e.confirmPassword="Passwords do not match"):e.confirmPassword="Please confirm your password",n(e),0===Object.keys(e).length})())return;const{confirmPassword:s,...a}=t;r.mutate(a)},className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"firstName",children:"First Name"}),Si.jsx(kx,{id:"firstName",name:"firstName",type:"text",value:t.firstName,onChange:l,placeholder:"John",required:!0,className:i.firstName?"border-red-500":""}),i.firstName&&Si.jsx("p",{className:"text-sm text-red-600",children:i.firstName})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"lastName",children:"Last Name"}),Si.jsx(kx,{id:"lastName",name:"lastName",type:"text",value:t.lastName,onChange:l,placeholder:"Doe",required:!0,className:i.lastName?"border-red-500":""}),i.lastName&&Si.jsx("p",{className:"text-sm text-red-600",children:i.lastName})]})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"username",children:"Username"}),Si.jsx(kx,{id:"username",name:"username",type:"text",value:t.username,onChange:l,placeholder:"johndoe",required:!0,className:i.username?"border-red-500":""}),i.username&&Si.jsx("p",{className:"text-sm text-red-600",children:i.username})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"email",children:"Email"}),Si.jsx(kx,{id:"email",name:"email",type:"email",value:t.email,onChange:l,placeholder:"john@example.com",required:!0,className:i.email?"border-red-500":""}),i.email&&Si.jsx("p",{className:"text-sm text-red-600",children:i.email})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"password",children:"Password"}),Si.jsx(kx,{id:"password",name:"password",type:"password",value:t.password,onChange:l,placeholder:"Enter your password",required:!0,className:i.password?"border-red-500":""}),i.password&&Si.jsx("p",{className:"text-sm text-red-600",children:i.password})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"confirmPassword",children:"Confirm Password"}),Si.jsx(kx,{id:"confirmPassword",name:"confirmPassword",type:"password",value:t.confirmPassword,onChange:l,placeholder:"Confirm your password",required:!0,className:i.confirmPassword?"border-red-500":""}),i.confirmPassword&&Si.jsx("p",{className:"text-sm text-red-600",children:i.confirmPassword})]}),Si.jsx(Ex,{type:"submit",className:"w-full",disabled:r.isPending,children:r.isPending?Si.jsxs(Si.Fragment,{children:[Si.jsx(kr,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Account..."]}):"Create Account"}),r.error&&Si.jsx("p",{className:"text-sm text-red-600 text-center",children:r.error.message})]}),Si.jsx("div",{className:"mt-6 text-center",children:Si.jsxs(Ex,{variant:"ghost",onClick:()=>s("/login"),className:"text-sm text-gray-600 hover:text-gray-900",children:[Si.jsx(dl,{className:"mr-2 h-4 w-4"}),"Back to Sign In"]})})]})]})})}$f.displayName=Lf.displayName;var Kf=function(){return Kf=Object.assign||function(e){for(var s,t=1,a=arguments.length;t<a;t++)for(var i in s=arguments[t])Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i]);return e},Kf.apply(this,arguments)};function Qf(e,s,t){for(var a,i=0,n=s.length;i<n;i++)!a&&i in s||(a||(a=Array.prototype.slice.call(s,0,i)),a[i]=s[i]);return e.concat(a||Array.prototype.slice.call(s))}function Gf(e){return"multiple"===e.mode}function Wf(e){return"range"===e.mode}function Hf(e){return"single"===e.mode}"function"==typeof SuppressedError&&SuppressedError;var Yf={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};var Jf=Object.freeze({__proto__:null,formatCaption:function(e,s){return Hn(e,"LLLL y",s)},formatDay:function(e,s){return Hn(e,"d",s)},formatMonthCaption:function(e,s){return Hn(e,"LLLL",s)},formatWeekNumber:function(e){return"".concat(e)},formatWeekdayName:function(e,s){return Hn(e,"cccccc",s)},formatYearCaption:function(e,s){return Hn(e,"yyyy",s)}}),Xf=Object.freeze({__proto__:null,labelDay:function(e,s,t){return Hn(e,"do MMMM (EEEE)",t)},labelMonthDropdown:function(){return"Month: "},labelNext:function(){return"Go to next month"},labelPrevious:function(){return"Go to previous month"},labelWeekNumber:function(e){return"Week n. ".concat(e)},labelWeekday:function(e,s){return Hn(e,"cccc",s)},labelYearDropdown:function(){return"Year: "}});var Zf=$n.createContext(void 0);function eg(e){var s,t,a=e.initialProps,i={captionLayout:"buttons",classNames:Yf,formatters:Jf,labels:Xf,locale:Zn,modifiersClassNames:{},modifiers:{},numberOfMonths:1,styles:{},today:new Date,mode:"default"},n=function(e){var s=e.fromYear,t=e.toYear,a=e.fromMonth,i=e.toMonth,n=e.fromDate,r=e.toDate;return a?n=Yn(a):s&&(n=new Date(s,0,1)),i?r=Jn(i):t&&(r=new Date(t,11,31)),{fromDate:n?Xn(n):void 0,toDate:r?Xn(r):void 0}}(a),r=n.fromDate,l=n.toDate,c=null!==(s=a.captionLayout)&&void 0!==s?s:i.captionLayout;"buttons"===c||r&&l||(c="buttons"),(Hf(a)||Gf(a)||Wf(a))&&(t=a.onSelect);var o=Kf(Kf(Kf({},i),a),{captionLayout:c,classNames:Kf(Kf({},i.classNames),a.classNames),components:Kf({},a.components),formatters:Kf(Kf({},i.formatters),a.formatters),fromDate:r,labels:Kf(Kf({},i.labels),a.labels),mode:a.mode||i.mode,modifiers:Kf(Kf({},i.modifiers),a.modifiers),modifiersClassNames:Kf(Kf({},i.modifiersClassNames),a.modifiersClassNames),onSelect:t,styles:Kf(Kf({},i.styles),a.styles),toDate:l});return Si.jsx(Zf.Provider,{value:o,children:e.children})}function sg(){var e=$n.useContext(Zf);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function tg(e){var s=sg(),t=s.locale,a=s.classNames,i=s.styles,n=s.formatters.formatCaption;return Si.jsx("div",{className:a.caption_label,style:i.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:n(e.displayMonth,{locale:t})})}function ag(e){return Si.jsx("svg",Kf({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:Si.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function ig(e){var s,t,a=e.onChange,i=e.value,n=e.children,r=e.caption,l=e.className,c=e.style,o=sg(),d=null!==(t=null===(s=o.components)||void 0===s?void 0:s.IconDropdown)&&void 0!==t?t:ag;return Si.jsxs("div",{className:l,style:c,children:[Si.jsx("span",{className:o.classNames.vhidden,children:e["aria-label"]}),Si.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:o.classNames.dropdown,style:o.styles.dropdown,value:i,onChange:a,children:n}),Si.jsxs("div",{className:o.classNames.caption_label,style:o.styles.caption_label,"aria-hidden":"true",children:[r,Si.jsx(d,{className:o.classNames.dropdown_icon,style:o.styles.dropdown_icon})]})]})}function ng(e){var s,t=sg(),a=t.fromDate,i=t.toDate,n=t.styles,r=t.locale,l=t.formatters.formatMonthCaption,c=t.classNames,o=t.components,d=t.labels.labelMonthDropdown;if(!a)return Si.jsx(Si.Fragment,{});if(!i)return Si.jsx(Si.Fragment,{});var u=[];if(xr(a,i))for(var m=Yn(a),h=a.getMonth();h<=i.getMonth();h++)u.push(pr(m,h));else for(m=Yn(new Date),h=0;h<=11;h++)u.push(pr(m,h));var x=null!==(s=null==o?void 0:o.Dropdown)&&void 0!==s?s:ig;return Si.jsx(x,{name:"months","aria-label":d(),className:c.dropdown_month,style:n.dropdown_month,onChange:function(s){var t=Number(s.target.value),a=pr(Yn(e.displayMonth),t);e.onChange(a)},value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:r}),children:u.map((function(e){return Si.jsx("option",{value:e.getMonth(),children:l(e,{locale:r})},e.getMonth())}))})}function rg(e){var s,t=e.displayMonth,a=sg(),i=a.fromDate,n=a.toDate,r=a.locale,l=a.styles,c=a.classNames,o=a.components,d=a.formatters.formatYearCaption,u=a.labels.labelYearDropdown,m=[];if(!i)return Si.jsx(Si.Fragment,{});if(!n)return Si.jsx(Si.Fragment,{});for(var h=i.getFullYear(),x=n.getFullYear(),p=h;p<=x;p++)m.push(fr(gr(new Date),p));var f=null!==(s=null==o?void 0:o.Dropdown)&&void 0!==s?s:ig;return Si.jsx(f,{name:"years","aria-label":u(),className:c.dropdown_year,style:l.dropdown_year,onChange:function(s){var a=fr(Yn(t),Number(s.target.value));e.onChange(a)},value:t.getFullYear(),caption:d(t,{locale:r}),children:m.map((function(e){return Si.jsx("option",{value:e.getFullYear(),children:d(e,{locale:r})},e.getFullYear())}))})}function lg(){var e=sg(),s=function(e){var s=e.month,t=e.defaultMonth,a=e.today,i=s||t||a||new Date,n=e.toDate,r=e.fromDate,l=e.numberOfMonths,c=void 0===l?1:l;return n&&sr(n,i)<0&&(i=er(n,-1*(c-1))),r&&sr(i,r)<0&&(i=r),Yn(i)}(e),t=function(e,s){var t=$n.useState(e),a=t[0];return[void 0===s?a:s,t[1]]}(s,e.month),a=t[0],i=t[1];return[a,function(s){var t;if(!e.disableNavigation){var a=Yn(s);i(a),null===(t=e.onMonthChange)||void 0===t||t.call(e,a)}}]}var cg=$n.createContext(void 0);function og(e){var s=sg(),t=lg(),a=t[0],i=t[1],n=function(e,s){for(var t=s.reverseMonths,a=s.numberOfMonths,i=Yn(e),n=Yn(er(i,a)),r=sr(n,i),l=[],c=0;c<r;c++){var o=er(i,c);l.push(o)}return t&&(l=l.reverse()),l}(a,s),r=function(e,s){if(!s.disableNavigation){var t=s.toDate,a=s.pagedNavigation,i=s.numberOfMonths,n=void 0===i?1:i,r=a?n:1,l=Yn(e);if(!t)return er(l,r);if(!(sr(t,e)<n))return er(l,r)}}(a,s),l=function(e,s){if(!s.disableNavigation){var t=s.fromDate,a=s.pagedNavigation,i=s.numberOfMonths,n=a?void 0===i?1:i:1,r=Yn(e);if(!t)return er(r,-n);if(!(sr(r,t)<=0))return er(r,-n)}}(a,s),c=function(e){return n.some((function(s){return tr(e,s)}))},o={currentMonth:a,displayMonths:n,goToMonth:i,goToDate:function(e,t){c(e)||(t&&ar(e,t)?i(er(e,1+-1*s.numberOfMonths)):i(e))},previousMonth:l,nextMonth:r,isDateDisplayed:c};return Si.jsx(cg.Provider,{value:o,children:e.children})}function dg(){var e=$n.useContext(cg);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function ug(e){var s,t=sg(),a=t.classNames,i=t.styles,n=t.components,r=dg().goToMonth,l=function(s){r(er(s,e.displayIndex?-e.displayIndex:0))},c=null!==(s=null==n?void 0:n.CaptionLabel)&&void 0!==s?s:tg,o=Si.jsx(c,{id:e.id,displayMonth:e.displayMonth});return Si.jsxs("div",{className:a.caption_dropdowns,style:i.caption_dropdowns,children:[Si.jsx("div",{className:a.vhidden,children:o}),Si.jsx(ng,{onChange:l,displayMonth:e.displayMonth}),Si.jsx(rg,{onChange:l,displayMonth:e.displayMonth})]})}function mg(e){return Si.jsx("svg",Kf({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:Si.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function hg(e){return Si.jsx("svg",Kf({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:Si.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var xg=$n.forwardRef((function(e,s){var t=sg(),a=t.classNames,i=t.styles,n=[a.button_reset,a.button];e.className&&n.push(e.className);var r=n.join(" "),l=Kf(Kf({},i.button_reset),i.button);return e.style&&Object.assign(l,e.style),Si.jsx("button",Kf({},e,{ref:s,type:"button",className:r,style:l}))}));function pg(e){var s,t,a=sg(),i=a.dir,n=a.locale,r=a.classNames,l=a.styles,c=a.labels,o=c.labelPrevious,d=c.labelNext,u=a.components;if(!e.nextMonth&&!e.previousMonth)return Si.jsx(Si.Fragment,{});var m=o(e.previousMonth,{locale:n}),h=[r.nav_button,r.nav_button_previous].join(" "),x=d(e.nextMonth,{locale:n}),p=[r.nav_button,r.nav_button_next].join(" "),f=null!==(s=null==u?void 0:u.IconRight)&&void 0!==s?s:hg,g=null!==(t=null==u?void 0:u.IconLeft)&&void 0!==t?t:mg;return Si.jsxs("div",{className:r.nav,style:l.nav,children:[!e.hidePrevious&&Si.jsx(xg,{name:"previous-month","aria-label":m,className:h,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:"rtl"===i?Si.jsx(f,{className:r.nav_icon,style:l.nav_icon}):Si.jsx(g,{className:r.nav_icon,style:l.nav_icon})}),!e.hideNext&&Si.jsx(xg,{name:"next-month","aria-label":x,className:p,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:"rtl"===i?Si.jsx(g,{className:r.nav_icon,style:l.nav_icon}):Si.jsx(f,{className:r.nav_icon,style:l.nav_icon})})]})}function fg(e){var s=sg().numberOfMonths,t=dg(),a=t.previousMonth,i=t.nextMonth,n=t.goToMonth,r=t.displayMonths,l=r.findIndex((function(s){return tr(e.displayMonth,s)})),c=0===l,o=l===r.length-1,d=s>1&&(c||!o),u=s>1&&(o||!c);return Si.jsx(pg,{displayMonth:e.displayMonth,hideNext:d,hidePrevious:u,nextMonth:i,previousMonth:a,onPreviousClick:function(){a&&n(a)},onNextClick:function(){i&&n(i)}})}function gg(e){var s,t,a=sg(),i=a.classNames,n=a.disableNavigation,r=a.styles,l=a.captionLayout,c=a.components,o=null!==(s=null==c?void 0:c.CaptionLabel)&&void 0!==s?s:tg;return t=n?Si.jsx(o,{id:e.id,displayMonth:e.displayMonth}):"dropdown"===l?Si.jsx(ug,{displayMonth:e.displayMonth,id:e.id}):"dropdown-buttons"===l?Si.jsxs(Si.Fragment,{children:[Si.jsx(ug,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),Si.jsx(fg,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):Si.jsxs(Si.Fragment,{children:[Si.jsx(o,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),Si.jsx(fg,{displayMonth:e.displayMonth,id:e.id})]}),Si.jsx("div",{className:i.caption,style:r.caption,children:t})}function jg(e){var s=sg(),t=s.footer,a=s.styles,i=s.classNames.tfoot;return t?Si.jsx("tfoot",{className:i,style:a.tfoot,children:Si.jsx("tr",{children:Si.jsx("td",{colSpan:8,children:t})})}):Si.jsx(Si.Fragment,{})}function vg(){var e=sg(),s=e.classNames,t=e.styles,a=e.showWeekNumber,i=e.locale,n=e.weekStartsOn,r=e.ISOWeek,l=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,o=function(e,s,t){for(var a=t?yr(new Date):br(new Date,{locale:e,weekStartsOn:s}),i=[],n=0;n<7;n++){var r=nr(a,n);i.push(r)}return i}(i,n,r);return Si.jsxs("tr",{style:t.head_row,className:s.head_row,children:[a&&Si.jsx("td",{style:t.head_cell,className:s.head_cell}),o.map((function(e,a){return Si.jsx("th",{scope:"col",className:s.head_cell,style:t.head_cell,"aria-label":c(e,{locale:i}),children:l(e,{locale:i})},a)}))]})}function yg(){var e,s=sg(),t=s.classNames,a=s.styles,i=s.components,n=null!==(e=null==i?void 0:i.HeadRow)&&void 0!==e?e:vg;return Si.jsx("thead",{style:a.head,className:t.head,children:Si.jsx(n,{})})}function bg(e){var s=sg(),t=s.locale,a=s.formatters.formatDay;return Si.jsx(Si.Fragment,{children:a(e.date,{locale:t})})}var Ng=$n.createContext(void 0);function wg(e){if(!Gf(e.initialProps)){return Si.jsx(Ng.Provider,{value:{selected:void 0,modifiers:{disabled:[]}},children:e.children})}return Si.jsx(Cg,{initialProps:e.initialProps,children:e.children})}function Cg(e){var s=e.initialProps,t=e.children,a=s.selected,i=s.min,n=s.max,r={disabled:[]};a&&r.disabled.push((function(e){var s=n&&a.length>n-1,t=a.some((function(s){return ir(s,e)}));return Boolean(s&&!t)}));var l={selected:a,onDayClick:function(e,t,r){var l,c;if((null===(l=s.onDayClick)||void 0===l||l.call(s,e,t,r),!Boolean(t.selected&&i&&(null==a?void 0:a.length)===i))&&!Boolean(!t.selected&&n&&(null==a?void 0:a.length)===n)){var o=a?Qf([],a):[];if(t.selected){var d=o.findIndex((function(s){return ir(e,s)}));o.splice(d,1)}else o.push(e);null===(c=s.onSelect)||void 0===c||c.call(s,o,e,t,r)}},modifiers:r};return Si.jsx(Ng.Provider,{value:l,children:t})}function Sg(){var e=$n.useContext(Ng);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}var Tg,kg,Dg=$n.createContext(void 0);function Eg(e){if(!Wf(e.initialProps)){return Si.jsx(Dg.Provider,{value:{selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}},children:e.children})}return Si.jsx(Ag,{initialProps:e.initialProps,children:e.children})}function Ag(e){var s=e.initialProps,t=e.children,a=s.selected,i=a||{},n=i.from,r=i.to,l=s.min,c=s.max,o={range_start:[],range_end:[],range_middle:[],disabled:[]};if(n?(o.range_start=[n],r?(o.range_end=[r],ir(n,r)||(o.range_middle=[{after:n,before:r}])):o.range_end=[n]):r&&(o.range_start=[r],o.range_end=[r]),l&&(n&&!r&&o.disabled.push({after:Wn(n,l-1),before:nr(n,l-1)}),n&&r&&o.disabled.push({after:n,before:nr(n,l-1)}),!n&&r&&o.disabled.push({after:Wn(r,l-1),before:nr(r,l-1)})),c){if(n&&!r&&(o.disabled.push({before:nr(n,1-c)}),o.disabled.push({after:nr(n,c-1)})),n&&r){var d=c-(rr(r,n)+1);o.disabled.push({before:Wn(n,d)}),o.disabled.push({after:nr(r,d)})}!n&&r&&(o.disabled.push({before:nr(r,1-c)}),o.disabled.push({after:nr(r,c-1)}))}return Si.jsx(Dg.Provider,{value:{selected:a,onDayClick:function(e,t,i){var n,r;null===(n=s.onDayClick)||void 0===n||n.call(s,e,t,i);var l=function(e,s){var t=s||{},a=t.from,i=t.to;if(a&&i){if(ir(i,e)&&ir(a,e))return;if(ir(i,e))return{from:i,to:void 0};if(ir(a,e))return;return dr(a,e)?{from:e,to:i}:{from:a,to:e}}return i?dr(e,i)?{from:i,to:e}:{from:e,to:i}:a?ar(e,a)?{from:e,to:a}:{from:a,to:e}:{from:e,to:void 0}}(e,a);null===(r=s.onSelect)||void 0===r||r.call(s,l,e,t,i)},modifiers:o},children:t})}function Pg(){var e=$n.useContext(Dg);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function _g(e){return Array.isArray(e)?Qf([],e):void 0!==e?[e]:[]}(kg=Tg||(Tg={})).Outside="outside",kg.Disabled="disabled",kg.Selected="selected",kg.Hidden="hidden",kg.Today="today",kg.RangeStart="range_start",kg.RangeEnd="range_end",kg.RangeMiddle="range_middle";var Fg=Tg.Selected,Lg=Tg.Disabled,Ig=Tg.Hidden,Rg=Tg.Today,qg=Tg.RangeEnd,Og=Tg.RangeMiddle,Mg=Tg.RangeStart,Vg=Tg.Outside;var Ug=$n.createContext(void 0);function $g(e){var s=sg(),t=function(e,s,t){var a,i=((a={})[Fg]=_g(e.selected),a[Lg]=_g(e.disabled),a[Ig]=_g(e.hidden),a[Rg]=[e.today],a[qg]=[],a[Og]=[],a[Mg]=[],a[Vg]=[],a);return e.fromDate&&i[Lg].push({before:e.fromDate}),e.toDate&&i[Lg].push({after:e.toDate}),Gf(e)?i[Lg]=i[Lg].concat(s.modifiers[Lg]):Wf(e)&&(i[Lg]=i[Lg].concat(t.modifiers[Lg]),i[Mg]=t.modifiers[Mg],i[Og]=t.modifiers[Og],i[qg]=t.modifiers[qg]),i}(s,Sg(),Pg()),a=function(e){var s={};return Object.entries(e).forEach((function(e){var t=e[0],a=e[1];s[t]=_g(a)})),s}(s.modifiers),i=Kf(Kf({},t),a);return Si.jsx(Ug.Provider,{value:i,children:e.children})}function zg(){var e=$n.useContext(Ug);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function Bg(e,s){return s.some((function(s){if("boolean"==typeof s)return s;if(Cr(s))return ir(e,s);var t,a,i,n,r;if(function(e){return Array.isArray(e)&&e.every(Cr)}(s))return s.includes(e);if(function(e){return Boolean(e&&"object"==typeof e&&"from"in e)}(s))return t=e,n=(a=s).from,r=a.to,n&&r?(rr(r,n)<0&&(n=(i=[r,n])[0],r=i[1]),rr(t,n)>=0&&rr(r,t)>=0):r?ir(r,t):!!n&&ir(n,t);if(function(e){return Boolean(e&&"object"==typeof e&&"dayOfWeek"in e)}(s))return s.dayOfWeek.includes(e.getDay());if(function(e){return Boolean(e&&"object"==typeof e&&"before"in e&&"after"in e)}(s)){var l=rr(s.before,e)>0,c=rr(s.after,e)<0;return dr(s.before,s.after)?c&&l:l||c}return function(e){return Boolean(e&&"object"==typeof e&&"after"in e)}(s)?rr(e,s.after)>0:function(e){return Boolean(e&&"object"==typeof e&&"before"in e)}(s)?rr(s.before,e)>0:"function"==typeof s&&s(e)}))}function Kg(e,s,t){var a=Object.keys(s).reduce((function(t,a){var i=s[a];return Bg(e,i)&&t.push(a),t}),[]),i={};return a.forEach((function(e){return i[e]=!0})),t&&!tr(e,t)&&(i.outside=!0),i}function Qg(e,s){var t=s.moveBy,a=s.direction,i=s.context,n=s.modifiers,r=s.retry,l=void 0===r?{count:0,lastFocused:e}:r,c=i.weekStartsOn,o=i.fromDate,d=i.toDate,u=i.locale,m={day:nr,week:cr,month:er,year:ur,startOfWeek:function(e){return i.ISOWeek?yr(e):br(e,{locale:u,weekStartsOn:c})},endOfWeek:function(e){return i.ISOWeek?jr(e):vr(e,{locale:u,weekStartsOn:c})}}[t](e,"after"===a?1:-1);"before"===a&&o?m=mr([o,m]):"after"===a&&d&&(m=hr([d,m]));var h=!0;if(n){var x=Kg(m,n);h=!x.disabled&&!x.hidden}return h?m:l.count>365?l.lastFocused:Qg(m,{moveBy:t,direction:a,context:i,modifiers:n,retry:Kf(Kf({},l),{count:l.count+1})})}var Gg=$n.createContext(void 0);function Wg(e){var s=dg(),t=zg(),a=$n.useState(),i=a[0],n=a[1],r=$n.useState(),l=r[0],c=r[1],o=function(e,s){for(var t,a,i=Yn(e[0]),n=Jn(e[e.length-1]),r=i;r<=n;){var l=Kg(r,s);if(l.disabled||l.hidden)r=nr(r,1);else{if(l.selected)return r;l.today&&!a&&(a=r),t||(t=r),r=nr(r,1)}}return a||t}(s.displayMonths,t),d=(null!=i?i:l&&s.isDateDisplayed(l))?l:o,u=function(e){n(e)},m=sg(),h=function(e,a){if(i){var n=Qg(i,{moveBy:e,direction:a,context:m,modifiers:t});ir(i,n)||(s.goToDate(n,i),u(n))}},x={focusedDay:i,focusTarget:d,blur:function(){c(i),n(void 0)},focus:u,focusDayAfter:function(){return h("day","after")},focusDayBefore:function(){return h("day","before")},focusWeekAfter:function(){return h("week","after")},focusWeekBefore:function(){return h("week","before")},focusMonthBefore:function(){return h("month","before")},focusMonthAfter:function(){return h("month","after")},focusYearBefore:function(){return h("year","before")},focusYearAfter:function(){return h("year","after")},focusStartOfWeek:function(){return h("startOfWeek","before")},focusEndOfWeek:function(){return h("endOfWeek","after")}};return Si.jsx(Gg.Provider,{value:x,children:e.children})}function Hg(){var e=$n.useContext(Gg);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}var Yg=$n.createContext(void 0);function Jg(e){if(!Hf(e.initialProps)){return Si.jsx(Yg.Provider,{value:{selected:void 0},children:e.children})}return Si.jsx(Xg,{initialProps:e.initialProps,children:e.children})}function Xg(e){var s=e.initialProps,t=e.children,a={selected:s.selected,onDayClick:function(e,t,a){var i,n,r;null===(i=s.onDayClick)||void 0===i||i.call(s,e,t,a),!t.selected||s.required?null===(r=s.onSelect)||void 0===r||r.call(s,e,e,t,a):null===(n=s.onSelect)||void 0===n||n.call(s,void 0,e,t,a)}};return Si.jsx(Yg.Provider,{value:a,children:t})}function Zg(){var e=$n.useContext(Yg);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function ej(e,s){var t=[e.classNames.day];return Object.keys(s).forEach((function(s){var a=e.modifiersClassNames[s];if(a)t.push(a);else if(function(e){return Object.values(Tg).includes(e)}(s)){var i=e.classNames["day_".concat(s)];i&&t.push(i)}})),t}function sj(e,s,t){var a,i,n,r=sg(),l=Hg(),c=function(e,s){return Kg(e,zg(),s)}(e,s),o=function(e,s){var t=sg(),a=Zg(),i=Sg(),n=Pg(),r=Hg(),l=r.focusDayAfter,c=r.focusDayBefore,o=r.focusWeekAfter,d=r.focusWeekBefore,u=r.blur,m=r.focus,h=r.focusMonthBefore,x=r.focusMonthAfter,p=r.focusYearBefore,f=r.focusYearAfter,g=r.focusStartOfWeek,j=r.focusEndOfWeek;return{onClick:function(r){var l,c,o,d;Hf(t)?null===(l=a.onDayClick)||void 0===l||l.call(a,e,s,r):Gf(t)?null===(c=i.onDayClick)||void 0===c||c.call(i,e,s,r):Wf(t)?null===(o=n.onDayClick)||void 0===o||o.call(n,e,s,r):null===(d=t.onDayClick)||void 0===d||d.call(t,e,s,r)},onFocus:function(a){var i;m(e),null===(i=t.onDayFocus)||void 0===i||i.call(t,e,s,a)},onBlur:function(a){var i;u(),null===(i=t.onDayBlur)||void 0===i||i.call(t,e,s,a)},onKeyDown:function(a){var i;switch(a.key){case"ArrowLeft":a.preventDefault(),a.stopPropagation(),"rtl"===t.dir?l():c();break;case"ArrowRight":a.preventDefault(),a.stopPropagation(),"rtl"===t.dir?c():l();break;case"ArrowDown":a.preventDefault(),a.stopPropagation(),o();break;case"ArrowUp":a.preventDefault(),a.stopPropagation(),d();break;case"PageUp":a.preventDefault(),a.stopPropagation(),a.shiftKey?p():h();break;case"PageDown":a.preventDefault(),a.stopPropagation(),a.shiftKey?f():x();break;case"Home":a.preventDefault(),a.stopPropagation(),g();break;case"End":a.preventDefault(),a.stopPropagation(),j()}null===(i=t.onDayKeyDown)||void 0===i||i.call(t,e,s,a)},onKeyUp:function(a){var i;null===(i=t.onDayKeyUp)||void 0===i||i.call(t,e,s,a)},onMouseEnter:function(a){var i;null===(i=t.onDayMouseEnter)||void 0===i||i.call(t,e,s,a)},onMouseLeave:function(a){var i;null===(i=t.onDayMouseLeave)||void 0===i||i.call(t,e,s,a)},onPointerEnter:function(a){var i;null===(i=t.onDayPointerEnter)||void 0===i||i.call(t,e,s,a)},onPointerLeave:function(a){var i;null===(i=t.onDayPointerLeave)||void 0===i||i.call(t,e,s,a)},onTouchCancel:function(a){var i;null===(i=t.onDayTouchCancel)||void 0===i||i.call(t,e,s,a)},onTouchEnd:function(a){var i;null===(i=t.onDayTouchEnd)||void 0===i||i.call(t,e,s,a)},onTouchMove:function(a){var i;null===(i=t.onDayTouchMove)||void 0===i||i.call(t,e,s,a)},onTouchStart:function(a){var i;null===(i=t.onDayTouchStart)||void 0===i||i.call(t,e,s,a)}}}(e,c),d=function(){var e=sg(),s=Zg(),t=Sg(),a=Pg();return Hf(e)?s.selected:Gf(e)?t.selected:Wf(e)?a.selected:void 0}(),u=Boolean(r.onDayClick||"default"!==r.mode);$n.useEffect((function(){var s;c.outside||l.focusedDay&&u&&ir(l.focusedDay,e)&&(null===(s=t.current)||void 0===s||s.focus())}),[l.focusedDay,e,t,u,c.outside]);var m=ej(r,c).join(" "),h=function(e,s){var t=Kf({},e.styles.day);return Object.keys(s).forEach((function(s){var a;t=Kf(Kf({},t),null===(a=e.modifiersStyles)||void 0===a?void 0:a[s])})),t}(r,c),x=Boolean(c.outside&&!r.showOutsideDays||c.hidden),p=null!==(n=null===(i=r.components)||void 0===i?void 0:i.DayContent)&&void 0!==n?n:bg,f={style:h,className:m,children:Si.jsx(p,{date:e,displayMonth:s,activeModifiers:c}),role:"gridcell"},g=l.focusTarget&&ir(l.focusTarget,e)&&!c.outside,j=l.focusedDay&&ir(l.focusedDay,e),v=Kf(Kf(Kf({},f),((a={disabled:c.disabled,role:"gridcell"})["aria-selected"]=c.selected,a.tabIndex=j||g?0:-1,a)),o);return{isButton:u,isHidden:x,activeModifiers:c,selectedDays:d,buttonProps:v,divProps:f}}function tj(e){var s=$n.useRef(null),t=sj(e.date,e.displayMonth,s);return t.isHidden?Si.jsx("div",{role:"gridcell"}):t.isButton?Si.jsx(xg,Kf({name:"day",ref:s},t.buttonProps)):Si.jsx("div",Kf({},t.divProps))}function aj(e){var s=e.number,t=e.dates,a=sg(),i=a.onWeekNumberClick,n=a.styles,r=a.classNames,l=a.locale,c=a.labels.labelWeekNumber,o=(0,a.formatters.formatWeekNumber)(Number(s),{locale:l});if(!i)return Si.jsx("span",{className:r.weeknumber,style:n.weeknumber,children:o});var d=c(Number(s),{locale:l});return Si.jsx(xg,{name:"week-number","aria-label":d,className:r.weeknumber,style:n.weeknumber,onClick:function(e){i(s,t,e)},children:o})}function ij(e){var s,t,a,i=sg(),n=i.styles,r=i.classNames,l=i.showWeekNumber,c=i.components,o=null!==(s=null==c?void 0:c.Day)&&void 0!==s?s:tj,d=null!==(t=null==c?void 0:c.WeekNumber)&&void 0!==t?t:aj;return l&&(a=Si.jsx("td",{className:r.cell,style:n.cell,children:Si.jsx(d,{number:e.weekNumber,dates:e.dates})})),Si.jsxs("tr",{className:r.row,style:n.row,children:[a,e.dates.map((function(s){return Si.jsx("td",{className:r.cell,style:n.cell,role:"presentation",children:Si.jsx(o,{displayMonth:e.displayMonth,date:s})},or(s))}))]})}function nj(e,s,t){for(var a=(null==t?void 0:t.ISOWeek)?jr(s):vr(s,t),i=(null==t?void 0:t.ISOWeek)?yr(e):br(e,t),n=rr(a,i),r=[],l=0;l<=n;l++)r.push(nr(i,l));return r.reduce((function(e,s){var a=(null==t?void 0:t.ISOWeek)?Nr(s):wr(s,t),i=e.find((function(e){return e.weekNumber===a}));return i?(i.dates.push(s),e):(e.push({weekNumber:a,dates:[s]}),e)}),[])}function rj(e){var s,t,a,i=sg(),n=i.locale,r=i.classNames,l=i.styles,c=i.hideHead,o=i.fixedWeeks,d=i.components,u=i.weekStartsOn,m=i.firstWeekContainsDate,h=i.ISOWeek,x=function(e,s){var t=nj(Yn(e),Jn(e),s);if(null==s?void 0:s.useFixedWeeks){var a=lr(e,s);if(a<6){var i=t[t.length-1],n=i.dates[i.dates.length-1],r=cr(n,6-a),l=nj(cr(n,1),r,s);t.push.apply(t,l)}}return t}(e.displayMonth,{useFixedWeeks:Boolean(o),ISOWeek:h,locale:n,weekStartsOn:u,firstWeekContainsDate:m}),p=null!==(s=null==d?void 0:d.Head)&&void 0!==s?s:yg,f=null!==(t=null==d?void 0:d.Row)&&void 0!==t?t:ij,g=null!==(a=null==d?void 0:d.Footer)&&void 0!==a?a:jg;return Si.jsxs("table",{id:e.id,className:r.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&Si.jsx(p,{}),Si.jsx("tbody",{className:r.tbody,style:l.tbody,children:x.map((function(s){return Si.jsx(f,{displayMonth:e.displayMonth,dates:s.dates,weekNumber:s.weekNumber},s.weekNumber)}))}),Si.jsx(g,{displayMonth:e.displayMonth})]})}var lj="undefined"!=typeof window&&window.document&&window.document.createElement?$n.useLayoutEffect:$n.useEffect,cj=!1,oj=0;function dj(){return"react-day-picker-".concat(++oj)}function uj(e){var s,t,a=sg(),i=a.dir,n=a.classNames,r=a.styles,l=a.components,c=dg().displayMonths,o=function(e){var s,t=null!=e?e:cj?dj():null,a=$n.useState(t),i=a[0],n=a[1];return lj((function(){null===i&&n(dj())}),[]),$n.useEffect((function(){!1===cj&&(cj=!0)}),[]),null!==(s=null!=e?e:i)&&void 0!==s?s:void 0}(a.id?"".concat(a.id,"-").concat(e.displayIndex):void 0),d=a.id?"".concat(a.id,"-grid-").concat(e.displayIndex):void 0,u=[n.month],m=r.month,h=0===e.displayIndex,x=e.displayIndex===c.length-1,p=!h&&!x;"rtl"===i&&(x=(s=[h,x])[0],h=s[1]),h&&(u.push(n.caption_start),m=Kf(Kf({},m),r.caption_start)),x&&(u.push(n.caption_end),m=Kf(Kf({},m),r.caption_end)),p&&(u.push(n.caption_between),m=Kf(Kf({},m),r.caption_between));var f=null!==(t=null==l?void 0:l.Caption)&&void 0!==t?t:gg;return Si.jsxs("div",{className:u.join(" "),style:m,children:[Si.jsx(f,{id:o,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),Si.jsx(rj,{id:d,"aria-labelledby":o,displayMonth:e.displayMonth})]},e.displayIndex)}function mj(e){var s=sg(),t=s.classNames,a=s.styles;return Si.jsx("div",{className:t.months,style:a.months,children:e.children})}function hj(e){var s,t,a=e.initialProps,i=sg(),n=Hg(),r=dg(),l=$n.useState(!1),c=l[0],o=l[1];$n.useEffect((function(){i.initialFocus&&n.focusTarget&&(c||(n.focus(n.focusTarget),o(!0)))}),[i.initialFocus,c,n.focus,n.focusTarget,n]);var d=[i.classNames.root,i.className];i.numberOfMonths>1&&d.push(i.classNames.multiple_months),i.showWeekNumber&&d.push(i.classNames.with_weeknumber);var u=Kf(Kf({},i.styles.root),i.style),m=Object.keys(a).filter((function(e){return e.startsWith("data-")})).reduce((function(e,s){var t;return Kf(Kf({},e),((t={})[s]=a[s],t))}),{}),h=null!==(t=null===(s=a.components)||void 0===s?void 0:s.Months)&&void 0!==t?t:mj;return Si.jsx("div",Kf({className:d.join(" "),style:u,dir:i.dir,id:i.id,nonce:a.nonce,title:a.title,lang:a.lang},m,{children:Si.jsx(h,{children:r.displayMonths.map((function(e,s){return Si.jsx(uj,{displayIndex:s,displayMonth:e},s)}))})}))}function xj(e){var s=e.children,t=function(e,s){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&s.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(a=Object.getOwnPropertySymbols(e);i<a.length;i++)s.indexOf(a[i])<0&&Object.prototype.propertyIsEnumerable.call(e,a[i])&&(t[a[i]]=e[a[i]])}return t}(e,["children"]);return Si.jsx(eg,{initialProps:t,children:Si.jsx(og,{children:Si.jsx(Jg,{initialProps:t,children:Si.jsx(wg,{initialProps:t,children:Si.jsx(Eg,{initialProps:t,children:Si.jsx($g,{children:Si.jsx(Wg,{children:s})})})})})})})}function pj(e){return Si.jsx(xj,Kf({},e,{children:Si.jsx(hj,{initialProps:e})}))}function fj({className:e,classNames:s,showOutsideDays:t=!0,...a}){return Si.jsx(pj,{showOutsideDays:t,className:Lu("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Lu(Dx({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Lu(Dx({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:({className:e,...s})=>Si.jsx(gl,{className:Lu("h-4 w-4",e),...s}),IconRight:({className:e,...s})=>Si.jsx(fl,{className:Lu("h-4 w-4",e),...s})},...a})}fj.displayName="Calendar";var gj="Popover",[jj,vj]=Ni(gj,[qi]),yj=qi(),[bj,Nj]=jj(gj),wj=e=>{const{__scopePopover:s,children:t,open:a,defaultOpen:i,onOpenChange:n,modal:r=!1}=e,l=yj(s),c=$n.useRef(null),[o,d]=$n.useState(!1),[u,m]=Di({prop:a,defaultProp:i??!1,onChange:n,caller:gj});return Si.jsx(zi,{...l,children:Si.jsx(bj,{scope:s,contentId:$i(),triggerRef:c,open:u,onOpenChange:m,onOpenToggle:$n.useCallback((()=>m((e=>!e))),[m]),hasCustomAnchor:o,onCustomAnchorAdd:$n.useCallback((()=>d(!0)),[]),onCustomAnchorRemove:$n.useCallback((()=>d(!1)),[]),modal:r,children:t})})};wj.displayName=gj;var Cj="PopoverAnchor";$n.forwardRef(((e,s)=>{const{__scopePopover:t,...a}=e,i=Nj(Cj,t),n=yj(t),{onCustomAnchorAdd:r,onCustomAnchorRemove:l}=i;return $n.useEffect((()=>(r(),()=>l())),[r,l]),Si.jsx(Bi,{...n,...a,ref:s})})).displayName=Cj;var Sj="PopoverTrigger",Tj=$n.forwardRef(((e,s)=>{const{__scopePopover:t,...a}=e,i=Nj(Sj,t),n=yj(t),r=Ci(s,i.triggerRef),l=Si.jsx(ki.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":Oj(i.open),...a,ref:r,onClick:Ai(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?l:Si.jsx(Bi,{asChild:!0,...n,children:l})}));Tj.displayName=Sj;var kj="PopoverPortal",[Dj,Ej]=jj(kj,{forceMount:void 0}),Aj=e=>{const{__scopePopover:s,forceMount:t,children:a,container:i}=e,n=Nj(kj,s);return Si.jsx(Dj,{scope:s,forceMount:t,children:Si.jsx(Ei,{present:t||n.open,children:Si.jsx(Li,{asChild:!0,container:i,children:a})})})};Aj.displayName=kj;var Pj="PopoverContent",_j=$n.forwardRef(((e,s)=>{const t=Ej(Pj,e.__scopePopover),{forceMount:a=t.forceMount,...i}=e,n=Nj(Pj,e.__scopePopover);return Si.jsx(Ei,{present:a||n.open,children:n.modal?Si.jsx(Lj,{...i,ref:s}):Si.jsx(Ij,{...i,ref:s})})}));_j.displayName=Pj;var Fj=Tn("PopoverContent.RemoveScroll"),Lj=$n.forwardRef(((e,s)=>{const t=Nj(Pj,e.__scopePopover),a=$n.useRef(null),i=Ci(s,a),n=$n.useRef(!1);return $n.useEffect((()=>{const e=a.current;if(e)return Cn(e)}),[]),Si.jsx(Sn,{as:Fj,allowPinchZoom:!0,children:Si.jsx(Rj,{...e,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ai(e.onCloseAutoFocus,(e=>{var s;e.preventDefault(),n.current||null==(s=t.triggerRef.current)||s.focus()})),onPointerDownOutside:Ai(e.onPointerDownOutside,(e=>{const s=e.detail.originalEvent,t=0===s.button&&!0===s.ctrlKey,a=2===s.button||t;n.current=a}),{checkForDefaultPrevented:!1}),onFocusOutside:Ai(e.onFocusOutside,(e=>e.preventDefault()),{checkForDefaultPrevented:!1})})})})),Ij=$n.forwardRef(((e,s)=>{const t=Nj(Pj,e.__scopePopover),a=$n.useRef(!1),i=$n.useRef(!1);return Si.jsx(Rj,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var n,r;null==(n=e.onCloseAutoFocus)||n.call(e,s),s.defaultPrevented||(a.current||null==(r=t.triggerRef.current)||r.focus(),s.preventDefault()),a.current=!1,i.current=!1},onInteractOutside:s=>{var n,r;null==(n=e.onInteractOutside)||n.call(e,s),s.defaultPrevented||(a.current=!0,"pointerdown"===s.detail.originalEvent.type&&(i.current=!0));const l=s.target;(null==(r=t.triggerRef.current)?void 0:r.contains(l))&&s.preventDefault(),"focusin"===s.detail.originalEvent.type&&i.current&&s.preventDefault()}})})),Rj=$n.forwardRef(((e,s)=>{const{__scopePopover:t,trapFocus:a,onOpenAutoFocus:i,onCloseAutoFocus:n,disableOutsidePointerEvents:r,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:o,onInteractOutside:d,...u}=e,m=Nj(Pj,t),h=yj(t);return kn(),Si.jsx(Dn,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:i,onUnmountAutoFocus:n,children:Si.jsx(Oi,{asChild:!0,disableOutsidePointerEvents:r,onInteractOutside:d,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:o,onDismiss:()=>m.onOpenChange(!1),children:Si.jsx(Mi,{"data-state":Oj(m.open),role:"dialog",id:m.contentId,...h,...u,ref:s,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})})),qj="PopoverClose";$n.forwardRef(((e,s)=>{const{__scopePopover:t,...a}=e,i=Nj(qj,t);return Si.jsx(ki.button,{type:"button",...a,ref:s,onClick:Ai(e.onClick,(()=>i.onOpenChange(!1)))})})).displayName=qj;function Oj(e){return e?"open":"closed"}$n.forwardRef(((e,s)=>{const{__scopePopover:t,...a}=e,i=yj(t);return Si.jsx(Ki,{...i,...a,ref:s})})).displayName="PopoverArrow";var Mj=Aj,Vj=_j;const Uj=wj,$j=Tj,zj=$n.forwardRef((({className:e,align:s="center",sideOffset:t=4,...a},i)=>Si.jsx(Mj,{children:Si.jsx(Vj,{ref:i,align:s,sideOffset:t,className:Lu("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]",e),...a})})));function Bj({date:e,onDateChange:s,placeholder:t="Pick a date",className:a,disabled:i=!1}){return Si.jsxs(Uj,{children:[Si.jsx($j,{asChild:!0,children:Si.jsxs(Ex,{variant:"outline",className:Lu("w-full justify-start text-left font-normal",!e&&"text-muted-foreground",a),disabled:i,children:[Si.jsx(jl,{className:"mr-2 h-4 w-4"}),e?Hn(e,"PPP"):Si.jsx("span",{children:t})]})}),Si.jsx(zj,{className:"w-auto p-0",children:Si.jsx(fj,{mode:"single",selected:e,onSelect:s,initialFocus:!0})})]})}function Kj({filters:e,values:s,onChange:t,onClear:a,className:i,showCount:n=!0,compact:r=!1}){const[l,c]=$n.useState(!1),o=Object.keys(s).filter((e=>{const t=s[e];return Array.isArray(t)?t.length>0:"string"==typeof t?""!==t.trim():"number"==typeof t?0!==t:"boolean"==typeof t?!0===t:t instanceof Date||null!=t&&""!==t})).length,d=(e,a)=>{const i={...s};""===a||null==a||!1===a||Array.isArray(a)&&0===a.length?delete i[e]:i[e]=a,t(i)},u=()=>{a(),c(!1)},m=e=>{var t,a;const i=s[e.key],n=e.icon;switch(e.type){case"text":return Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:e.key,children:e.label}),Si.jsxs("div",{className:"relative",children:[n&&Si.jsx(n,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),Si.jsx(kx,{id:e.key,placeholder:e.placeholder,value:i||"",onChange:s=>d(e.key,s.target.value),className:n?"pl-10":""})]})]});case"number":return Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:e.key,children:e.label}),Si.jsxs("div",{className:"relative",children:[n&&Si.jsx(n,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),Si.jsx(kx,{id:e.key,type:"number",placeholder:e.placeholder,value:i||"",onChange:s=>d(e.key,parseFloat(s.target.value)||""),className:n?"pl-10":""})]})]});case"select":return Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{children:e.label}),Si.jsxs(zp,{value:i||"",onValueChange:s=>d(e.key,s),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:e.placeholder||`Select ${e.label}`})}),Si.jsx(Wp,{children:null==(t=e.options)?void 0:t.map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})]})]});case"multiselect":const s=i||[];return Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{children:e.label}),Si.jsx("div",{className:"space-y-2",children:null==(a=e.options)?void 0:a.map((t=>Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx($f,{id:`${e.key}-${t.value}`,checked:s.includes(t.value),onCheckedChange:a=>{const i=a?[...s,t.value]:s.filter((e=>e!==t.value));d(e.key,i)}}),Si.jsx(Op,{htmlFor:`${e.key}-${t.value}`,className:"text-sm",children:t.label})]},t.value)))})]});case"date":return Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{children:e.label}),Si.jsx(Bj,{date:i,onDateChange:s=>d(e.key,s),placeholder:e.placeholder})]});case"dateRange":const r=i||{};return Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{children:e.label}),Si.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[Si.jsx(Bj,{date:r.from,onDateChange:s=>d(e.key,{...r,from:s}),placeholder:"From date"}),Si.jsx(Bj,{date:r.to,onDateChange:s=>d(e.key,{...r,to:s}),placeholder:"To date"})]})]});case"checkbox":return Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx($f,{id:e.key,checked:Boolean(i),onCheckedChange:s=>d(e.key,s)}),Si.jsx(Op,{htmlFor:e.key,children:e.label})]});default:return null}},h=()=>{const t=Object.entries(s).filter((([e,s])=>Array.isArray(s)?s.length>0:"string"==typeof s?""!==s.trim():"number"==typeof s?0!==s:"boolean"==typeof s?!0===s:s instanceof Date||null!=s&&""!==s));return 0===t.length?null:Si.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[t.map((([s,t])=>{const a=e.find((e=>e.key===s));if(!a)return null;let i=t;return Array.isArray(t)?i=t.join(", "):t instanceof Date?i=t.toLocaleDateString():"object"==typeof t&&t.from&&t.to&&(i=`${t.from.toLocaleDateString()} - ${t.to.toLocaleDateString()}`),Si.jsxs(Sx,{variant:"secondary",className:"flex items-center gap-1",children:[Si.jsxs("span",{className:"text-xs",children:[a.label,":"]}),Si.jsx("span",{className:"text-xs font-medium",children:String(i)}),Si.jsx(Ex,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-transparent",onClick:()=>d(s,""),children:Si.jsx(Tr,{className:"h-3 w-3"})})]},s)})),t.length>1&&Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:u,className:"h-6 px-2 text-xs",children:"Clear all"})]})};return r?Si.jsxs("div",{className:Lu("flex items-center gap-2",i),children:[Si.jsxs(Uj,{open:l,onOpenChange:c,children:[Si.jsx($j,{asChild:!0,children:Si.jsxs(Ex,{variant:"outline",size:"sm",className:"h-8",children:[Si.jsx(rl,{className:"h-4 w-4 mr-2"}),"Filters",n&&o>0&&Si.jsx(Sx,{variant:"secondary",className:"ml-2 h-5 px-1 text-xs",children:o})]})}),Si.jsx(zj,{className:"w-80 p-0",align:"start",children:Si.jsxs(Ax,{className:"border-0 shadow-none",children:[Si.jsx(Px,{className:"pb-3",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx(_x,{className:"text-sm",children:"Filters"}),o>0&&Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:u,children:"Clear all"})]})}),Si.jsx(Lx,{className:"space-y-4",children:e.map((e=>Si.jsx("div",{children:m(e)},e.key)))})]})})]}),h()]}):Si.jsxs("div",{className:Lu("space-y-4",i),children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{className:"pb-3",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(rl,{className:"h-4 w-4"}),"Filters",n&&o>0&&Si.jsxs(Sx,{variant:"secondary",className:"ml-2",children:[o," active"]})]}),o>0&&Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:u,children:"Clear all"})]})}),Si.jsx(Lx,{children:Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:e.map((e=>Si.jsx("div",{children:m(e)},e.key)))})})]}),h()]})}function Qj({className:e,...s}){return Si.jsx("div",{className:Lu("animate-pulse rounded-md bg-muted",e),...s})}zj.displayName=Vj.displayName;const Gj=({widget:e,clientShortName:s,clientName:t,clientDomain:a,onEdit:i,onDelete:n,onRefresh:r,className:l="",previewData:c})=>{var o,d;const[u,m]=$n.useState(null),[h,x]=$n.useState(!0),[p,f]=$n.useState(null),[g,j]=$n.useState(null);$n.useEffect((()=>{if(c)return m(c),j(new Date),void x(!1);if(v(),e.refreshInterval>0&&!c){const s=setInterval(v,1e3*e.refreshInterval);return()=>clearInterval(s)}}),[e,s,t,a,c]);const v=async()=>{var i,n,r,l,c;try{x(!0),f(null);let o="",d=null;const u={},h=window.location.pathname.split("/");if(h.includes("clients")&&h.length>2){const e=h.indexOf("clients"),s=h[e+1];s&&!isNaN(Number(s))&&(u.clientId=Number(s))}if(h.includes("contracts")&&h.length>2){const e=h.indexOf("contracts"),s=h[e+1];s&&!isNaN(Number(s))&&(u.contractId=Number(s))}if(s&&(u.clientShortName=s),t&&(u.clientName=t),a&&(u.clientDomain=a),e.queryParameters&&Object.keys(e.queryParameters).length>0&&Object.entries(e.queryParameters).forEach((([e,s])=>{})),"default"===e.queryType&&e.queryId)o=`/api/plugins/${e.pluginName}/instances/${e.instanceId}/default-query/${e.queryId}`,d={parameters:e.queryParameters,filters:e.filters||[],context:u};else{if("custom"!==e.queryType||!e.customQuery)throw new Error("Invalid widget configuration");o=`/api/plugins/${e.pluginName}/instances/${e.instanceId}/query`,d={query:e.customQuery,method:e.queryMethod,parameters:e.queryParameters,filters:e.filters||[],context:u}}const p=await vh("POST",o,d),g=await p.json();g.success?(m(g.data),j(new Date),null==(i=g.metadata)||i.parameters,null==(n=g.metadata)||n.query,null==(r=g.metadata)||r.originalQuery):(f(g.message||"Failed to fetch data"),(null==(l=g.message)?void 0:l.includes("parameter"))||null==(c=g.message)||c.includes("Parameter"))}catch(o){const e=o instanceof Error?o.message:"Failed to fetch data";f(e)}finally{x(!1)}},y=()=>{if(!Array.isArray(u))return Si.jsx("div",{className:"text-gray-500",children:"Data is not in table format"});if(0===u.length)return Si.jsx("div",{className:"text-gray-500",children:"No data to display"});const e=Object.keys(u[0]);return Si.jsxs("div",{className:"overflow-auto",children:[Si.jsxs("table",{className:"w-full text-sm",children:[Si.jsx("thead",{children:Si.jsx("tr",{className:"border-b",children:e.map((e=>Si.jsx("th",{className:"text-left p-2 font-medium",children:e},e)))})}),Si.jsx("tbody",{children:u.slice(0,10).map(((s,t)=>Si.jsx("tr",{className:"border-b hover:bg-gray-50",children:e.map((e=>Si.jsx("td",{className:"p-2",children:String(s[e])},e)))},t)))})]}),u.length>10&&Si.jsxs("div",{className:"text-xs text-gray-500 mt-2 text-center",children:["Showing 10 of ",u.length," rows"]})]})},b=()=>{var s,t;let a=u;e.groupBy&&Array.isArray(u)&&u.length>0?a=N(u,e.groupBy):Array.isArray(u)&&u.length>0?a="object"==typeof u[0]?u:u.map(((e,s)=>({name:`Item ${s+1}`,value:e}))):"object"==typeof u&&(a=Object.entries(u).map((([e,s])=>({name:e,value:s}))));const i=["#3b82f6","#1e40af","#60a5fa","#93c5fd","#dbeafe","#f97316","#ea580c","#dc2626"],n=(null==(s=e.groupBy)?void 0:s.field)||"name",r=(null==(t=e.groupBy)?void 0:t.valueField)||"value";switch(e.chartType){case"bar":return Si.jsx(Nc,{width:"100%",height:"100%",children:Si.jsxs(Lc,{data:a,children:[Si.jsx(Cc,{strokeDasharray:"3 3"}),Si.jsx(Sc,{dataKey:n,angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),Si.jsx(Tc,{}),Si.jsx(kc,{formatter:(e,s)=>[w(e),s],labelFormatter:s=>{var t;return`${(null==(t=e.groupBy)?void 0:t.field)||"Category"}: ${s}`}}),Si.jsx(Ic,{dataKey:r,fill:i[0]})]})});case"line":return Si.jsx(Nc,{width:"100%",height:"100%",children:Si.jsxs(_c,{data:a,children:[Si.jsx(Cc,{strokeDasharray:"3 3"}),Si.jsx(Sc,{dataKey:n,angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),Si.jsx(Tc,{}),Si.jsx(kc,{formatter:(e,s)=>[w(e),s],labelFormatter:s=>{var t;return`${(null==(t=e.groupBy)?void 0:t.field)||"Category"}: ${s}`}}),Si.jsx(Fc,{type:"monotone",dataKey:r,stroke:i[0],strokeWidth:2})]})});case"pie":return Si.jsx(Nc,{width:"100%",height:"100%",children:Si.jsxs(Ec,{children:[Si.jsx(Ac,{data:a,cx:"50%",cy:"50%",labelLine:!1,label:({name:e,percent:s})=>`${e} ${(100*s).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:r,children:a.map(((e,s)=>Si.jsx(Pc,{fill:i[s%i.length]},`cell-${s}`)))}),Si.jsx(kc,{formatter:e=>w(e)})]})});case"area":return Si.jsx(Nc,{width:"100%",height:"100%",children:Si.jsxs(wc,{data:a,children:[Si.jsx(Cc,{strokeDasharray:"3 3"}),Si.jsx(Sc,{dataKey:n,angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),Si.jsx(Tc,{}),Si.jsx(kc,{formatter:(e,s)=>[w(e),s],labelFormatter:s=>{var t;return`${(null==(t=e.groupBy)?void 0:t.field)||"Category"}: ${s}`}}),Si.jsx(Dc,{type:"monotone",dataKey:r,stroke:i[0],fill:i[0],fillOpacity:.3})]})});default:return y()}},N=(e,s)=>{const{field:t,valueField:a,aggregationFunction:i="count",limit:n=10,sortBy:r="desc"}=s,l={};e.forEach((e=>{const s=String(e[t]||"Unknown");l[s]||(l[s]=[]),l[s].push(e)}));return Object.keys(l).map((e=>{const s=l[e];let n=0;switch(i){case"count":default:n=s.length;break;case"sum":n=a?s.reduce(((e,s)=>e+(Number(s[a])||0)),0):s.length;break;case"avg":if(a){const e=s.map((e=>Number(e[a]))).filter((e=>!isNaN(e)));n=e.length>0?e.reduce(((e,s)=>e+s),0)/e.length:0}else n=s.length;break;case"min":if(a){const e=s.map((e=>Number(e[a]))).filter((e=>!isNaN(e)));n=e.length>0?Math.min(...e):0}else n=s.length;break;case"max":if(a){const e=s.map((e=>Number(e[a]))).filter((e=>!isNaN(e)));n=e.length>0?Math.max(...e):0}else n=s.length}return{[t]:e,name:e,value:n,[a||"value"]:n,count:s.length}})).sort(((e,s)=>"asc"===r?e.value-s.value:s.value-e.value)).slice(0,n)},w=e=>"number"==typeof e?e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:e.toLocaleString():String(e),C=()=>{let s=u,t="Value";Array.isArray(u)?(s=u.length,t="Count"):"object"==typeof u&&null!==u&&("count"in u?(s=u.count,t="Count"):"total"in u?(s=u.total,t="Total"):"value"in u?(s=u.value,t="Value"):(s=Object.keys(u).length,t="Properties"));return Si.jsxs("div",{className:"text-center py-8",children:[Si.jsx("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:(a=s,"number"==typeof a?a.toLocaleString():String(a))}),Si.jsx("div",{className:"text-lg text-gray-600",children:t}),e.description&&Si.jsx("div",{className:"text-sm text-gray-500 mt-2",children:e.description})]});var a},S=()=>{let e=u;return Array.isArray(u)||(e="object"==typeof u&&null!==u?Object.entries(u).map((([e,s])=>({key:e,value:String(s)}))):[{key:"Value",value:String(u)}]),Si.jsxs("div",{className:"space-y-2",children:[e.slice(0,10).map(((e,s)=>Si.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-gray-50 rounded",children:[Si.jsx("span",{className:"text-sm",children:"object"==typeof e?e.key||`Item ${s+1}`:String(e)}),Si.jsx("span",{className:"text-sm font-medium",children:"object"==typeof e?e.value:""})]},s))),e.length>10&&Si.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["Showing 10 of ",e.length," items"]})]})},T=()=>{let s=0,t=100;"number"==typeof u?s=u:Array.isArray(u)?s=u.length:"object"==typeof u&&null!==u&&("value"in u&&(s=u.value),"max"in u&&(t=u.max),"percentage"in u&&(s=u.percentage,t=100));const a=Math.min(s/t*100,100);return Si.jsxs("div",{className:"text-center py-8",children:[Si.jsx("div",{className:"inline-flex items-center justify-center w-24 h-24 rounded-full "+(a>=80?"text-red-600 bg-red-100":a>=60?"text-yellow-600 bg-yellow-100":"text-green-600 bg-green-100"),children:Si.jsx("div",{className:"text-center",children:Si.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(a),"%"]})})}),Si.jsxs("div",{className:"mt-4",children:[Si.jsxs("div",{className:"text-lg font-medium",children:[s," / ",t]}),Si.jsx("div",{className:"text-sm text-gray-500",children:e.name})]})]})},k=()=>{const s="object"==typeof u;return Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{variant:"secondary",className:"text-xs",children:"custom"===e.queryType?"Custom Query":"Default Query"}),Si.jsx(Sx,{variant:"outline",className:"text-xs",children:e.queryMethod})]}),Si.jsx("div",{className:"text-xs text-gray-500",children:Array.isArray(u)?`${u.length} results`:s?"Object response":"Simple response"})]}),"custom"===e.queryType&&e.customQuery&&Si.jsxs("div",{className:"bg-gray-900 text-green-400 p-3 rounded-lg font-mono text-xs",children:[Si.jsx("div",{className:"text-gray-400 mb-2",children:"Query:"}),Si.jsx("pre",{className:"whitespace-pre-wrap",children:e.customQuery})]}),Si.jsxs("div",{className:"bg-white border rounded-lg",children:[Si.jsx("div",{className:"px-3 py-2 border-b bg-gray-50",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Query Results"}),Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>navigator.clipboard.writeText(JSON.stringify(u,null,2)),className:"text-xs",children:"Copy JSON"})]})}),Si.jsx("div",{className:"p-3",children:s?Si.jsx("pre",{className:"text-xs font-mono bg-gray-50 p-3 rounded border overflow-auto max-h-64",children:JSON.stringify(u,null,2)}):Si.jsx("div",{className:"text-sm",children:Si.jsx("span",{className:"font-mono bg-gray-100 px-2 py-1 rounded",children:String(u)})})})]}),Array.isArray(u)&&u.length>0&&Si.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[Si.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border",children:[Si.jsx("div",{className:"text-lg font-bold text-blue-600",children:u.length}),Si.jsx("div",{className:"text-xs text-blue-800",children:"Total Records"})]}),Si.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border",children:[Si.jsx("div",{className:"text-lg font-bold text-green-600",children:"object"==typeof u[0]?Object.keys(u[0]).length:1}),Si.jsx("div",{className:"text-xs text-green-800",children:"Fields"})]}),Si.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg border",children:[Si.jsx("div",{className:"text-lg font-bold text-purple-600",children:(new Date).toLocaleTimeString()}),Si.jsx("div",{className:"text-xs text-purple-800",children:"Last Updated"})]})]})]})},D=()=>{let s=u,t="Count";e.aggregation?"object"==typeof u&&null!==u?"count"===e.aggregation.function?(s=u.totalResults||u.length||u.count||0,t="Total Count"):"sum"===e.aggregation.function&&(s=u.sum||u.total||0,t="Total Sum"):Array.isArray(u)&&(s=u.length,t="Count"):Array.isArray(u)?(s=u.length,t="Count"):"object"==typeof u&&null!==u&&"totalResults"in u&&(s=u.totalResults,t="Total Results");return Si.jsxs("div",{className:"text-center py-8",children:[Si.jsxs("div",{className:"flex items-center justify-center mb-4",children:[Si.jsx(Cl,{className:"h-6 w-6 text-blue-500 mr-2"}),Si.jsx("div",{className:"text-6xl font-bold text-blue-600",children:(a=s,"number"==typeof a?a.toLocaleString():String(a))})]}),Si.jsx("div",{className:"text-xl text-gray-600 font-medium",children:t}),e.description&&Si.jsx("div",{className:"text-sm text-gray-500 mt-2",children:e.description})]});var a},E=()=>{let s=0,t="Percentage";if(e.aggregation){if("object"==typeof u&&null!==u)if("avg"===e.aggregation.function)s=u.average||u.avg||0,t="Average";else if("count"===e.aggregation.function){const e=u.count||u.length||0,a=u.total||100;s=a>0?e/a*100:0,t="Completion Rate"}}else"number"==typeof u?s=u:"object"==typeof u&&null!==u&&("percentage"in u?s=u.percentage:"percent"in u?s=u.percent:"rate"in u&&(s=u.rate));return Si.jsxs("div",{className:"text-center py-8",children:[Si.jsxs("div",{className:"flex items-center justify-center mb-4",children:[Si.jsx(wl,{className:"h-6 w-6 text-green-500 mr-2"}),Si.jsxs("div",{className:"text-6xl font-bold "+(s>=90?"text-green-600":s>=70?"text-blue-600":s>=50?"text-yellow-600":"text-red-600"),children:[Math.round(s),"%"]})]}),Si.jsx("div",{className:"text-xl text-gray-600 font-medium",children:t}),e.description&&Si.jsx("div",{className:"text-sm text-gray-500 mt-2",children:e.description})]})},A=()=>{let s=0,t=100,a="Progress";"object"==typeof u&&null!==u?("value"in u&&(s=u.value),"max"in u&&(t=u.max),"current"in u&&(s=u.current),"target"in u&&(t=u.target),"completed"in u&&"total"in u&&(s=u.completed,t=u.total,a="Completion")):"number"==typeof u?s=u:Array.isArray(u)&&(s=u.length,t=100);const i=t>0?Math.min(s/t*100,100):0;return Si.jsxs("div",{className:"py-8 px-4",children:[Si.jsxs("div",{className:"mb-4",children:[Si.jsxs("div",{className:"flex justify-between items-center mb-2",children:[Si.jsx("span",{className:"text-lg font-medium text-gray-700",children:a}),Si.jsxs("span",{className:"text-2xl font-bold text-gray-900",children:[s," / ",t]})]}),Si.jsx("div",{className:"w-full bg-gray-200 rounded-full h-6",children:Si.jsx("div",{className:"h-6 rounded-full transition-all duration-500 "+(i>=80?"bg-green-500":i>=60?"bg-blue-500":i>=40?"bg-yellow-500":"bg-red-500"),style:{width:`${i}%`},children:Si.jsxs("div",{className:"h-full flex items-center justify-center text-white font-medium text-sm",children:[Math.round(i),"%"]})})})]}),e.description&&Si.jsx("div",{className:"text-sm text-gray-500 text-center",children:e.description})]})},P=()=>{let e=0,s=0,t="Trend";if("object"==typeof u&&null!==u){if("current"in u&&(e=u.current),"previous"in u&&(s=u.previous),"value"in u&&(e=u.value),"baseline"in u&&(s=u.baseline),"trend"in u){const e=u.trend;return Si.jsxs("div",{className:"text-center py-8",children:[Si.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e>0?Si.jsx(yl,{className:"h-8 w-8 text-green-500 mr-2"}):e<0?Si.jsx(bl,{className:"h-8 w-8 text-red-500 mr-2"}):Si.jsx(Nl,{className:"h-8 w-8 text-gray-500 mr-2"}),Si.jsxs("div",{className:"text-4xl font-bold "+(e>0?"text-green-600":e<0?"text-red-600":"text-gray-600"),children:[e>0?"+":"",e,"%"]})]}),Si.jsx("div",{className:"text-lg text-gray-600",children:t})]})}}else"number"==typeof u&&(e=u);const a=0!==s?(e-s)/s*100:0,i=a>0,n=a<0;return Si.jsxs("div",{className:"text-center py-8",children:[Si.jsxs("div",{className:"flex items-center justify-center mb-4",children:[i?Si.jsx(yl,{className:"h-8 w-8 text-green-500 mr-2"}):n?Si.jsx(bl,{className:"h-8 w-8 text-red-500 mr-2"}):Si.jsx(Nl,{className:"h-8 w-8 text-gray-500 mr-2"}),Si.jsxs("div",{className:"text-4xl font-bold "+(i?"text-green-600":n?"text-red-600":"text-gray-600"),children:[a>0?"+":"",Math.round(a),"%"]})]}),Si.jsx("div",{className:"text-lg text-gray-600",children:t}),Si.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:["Current: ",e.toLocaleString()," | Previous: ",s.toLocaleString()]})]})},_=()=>{let s={min:0,max:0,avg:0,count:0};if(e.aggregation&&"object"==typeof u&&null!==u)"min"in u&&(s.min=u.min),"max"in u&&(s.max=u.max),("avg"in u||"average"in u)&&(s.avg=u.avg||u.average),"count"in u&&(s.count=u.count);else if(Array.isArray(u)){const e=u.filter((e=>"number"==typeof e));e.length>0&&(s.min=Math.min(...e),s.max=Math.max(...e),s.avg=e.reduce(((e,s)=>e+s),0)/e.length,s.count=e.length)}return Si.jsxs("div",{className:"py-6",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg border",children:[Si.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.min.toLocaleString()}),Si.jsx("div",{className:"text-sm text-blue-800",children:"Minimum"})]}),Si.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border",children:[Si.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.max.toLocaleString()}),Si.jsx("div",{className:"text-sm text-green-800",children:"Maximum"})]}),Si.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-lg border",children:[Si.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:Math.round(s.avg).toLocaleString()}),Si.jsx("div",{className:"text-sm text-yellow-800",children:"Average"})]}),Si.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg border",children:[Si.jsx("div",{className:"text-2xl font-bold text-purple-600",children:s.count.toLocaleString()}),Si.jsx("div",{className:"text-sm text-purple-800",children:"Count"})]})]}),e.description&&Si.jsx("div",{className:"text-sm text-gray-500 text-center mt-4",children:e.description})]})},F=()=>{let s={};return s="object"==typeof u&&null!==u?u:Array.isArray(u)?{"Total Items":u.length,"Data Type":"Array","First Item":u[0]?"object"==typeof u[0]?"Object":String(u[0]).substring(0,30):"None"}:{Value:String(u),Type:typeof u},Si.jsxs("div",{className:"py-6",children:[Si.jsx("div",{className:"space-y-3",children:Object.entries(s).slice(0,6).map((([e,s],t)=>Si.jsxs("div",{className:"flex justify-between items-center p-3 bg-gray-50 rounded-lg border",children:[Si.jsx("span",{className:"font-medium text-gray-700",children:e}),Si.jsx("span",{className:"text-gray-900 font-semibold",children:"number"==typeof s?s.toLocaleString():String(s)})]},t)))}),e.description&&Si.jsx("div",{className:"text-sm text-gray-500 text-center mt-4",children:e.description})]})},L=[l,(()=>{var s;switch((null==(s=e.styling)?void 0:s.width)||"full"){case"full":default:return"w-full";case"half":return"w-1/2";case"third":return"w-1/3";case"quarter":return"w-1/4"}})(),!1!==(null==(o=e.styling)?void 0:o.showBorder)?"border":"border-0","transition-all duration-200 hover:shadow-md"].filter(Boolean).join(" "),I=[(()=>{var s;switch((null==(s=e.styling)?void 0:s.height)||"medium"){case"small":return"h-48";case"medium":default:return"h-72";case"large":return"h-96"}})(),"overflow-hidden"].join(" ");return Si.jsxs(Ax,{className:L,children:[!1!==(null==(d=e.styling)?void 0:d.showHeader)&&Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:e.name}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{variant:"outline",className:"text-xs",children:e.pluginName}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{v(),r&&r()},disabled:h,children:Si.jsx(ul,{className:"h-4 w-4 "+(h?"animate-spin":"")})}),i&&Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>i(e),children:Si.jsx(Mr,{className:"h-4 w-4"})})]})]}),Si.jsxs(Lx,{className:I,children:[(()=>{if(h)return Si.jsxs("div",{className:"flex items-center justify-center h-32",children:[Si.jsx(kr,{className:"h-8 w-8 animate-spin text-blue-500"}),Si.jsx("span",{className:"ml-2 text-gray-600",children:"Loading..."})]});if(p)return Si.jsxs(Nx,{className:"border-red-200 bg-red-50",children:[Si.jsx(vl,{className:"h-4 w-4 text-red-600"}),Si.jsx(wx,{className:"text-red-800",children:p})]});if(!u)return Si.jsx("div",{className:"text-center text-gray-500 py-8",children:"No data available"});switch(e.displayType){case"table":return y();case"chart":return b();case"metric":return C();case"list":return S();case"gauge":return T();case"query":return k();case"number":return D();case"percentage":return E();case"progress":return A();case"trend":return P();case"statistic":return _();case"summary":return F();default:return Si.jsxs("div",{children:["Unsupported display type: ",e.displayType]})}})(),g&&Si.jsxs("div",{className:"text-xs text-gray-500 mt-2 text-center",children:["Last updated: ",g.toLocaleTimeString()]})]})]})},Wj=$n.forwardRef((({className:e,...s},t)=>Si.jsx("div",{className:"relative w-full overflow-auto",children:Si.jsx("table",{ref:t,className:Lu("w-full caption-bottom text-sm",e),...s})})));Wj.displayName="Table";const Hj=$n.forwardRef((({className:e,...s},t)=>Si.jsx("thead",{ref:t,className:Lu("[&_tr]:border-b",e),...s})));Hj.displayName="TableHeader";const Yj=$n.forwardRef((({className:e,...s},t)=>Si.jsx("tbody",{ref:t,className:Lu("[&_tr:last-child]:border-0",e),...s})));Yj.displayName="TableBody";$n.forwardRef((({className:e,...s},t)=>Si.jsx("tfoot",{ref:t,className:Lu("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...s}))).displayName="TableFooter";const Jj=$n.forwardRef((({className:e,...s},t)=>Si.jsx("tr",{ref:t,className:Lu("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...s})));Jj.displayName="TableRow";const Xj=$n.forwardRef((({className:e,...s},t)=>Si.jsx("th",{ref:t,className:Lu("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...s})));Xj.displayName="TableHead";const Zj=$n.forwardRef((({className:e,...s},t)=>Si.jsx("td",{ref:t,className:Lu("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...s})));Zj.displayName="TableCell";function ev({card:e,onClick:s}){var t;const[a,i]=$n.useState((null==(t=e.config.filters)?void 0:t.expiring_in_months)||3),[n,r]=$n.useState(!1),[,l]=Oo(),{data:c=[],isLoading:o,refetch:d}=fh({queryKey:["/api/contracts/expiring",a],queryFn:async()=>{const e=await fetch(`/api/contracts/expiring?months=${a}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch expiring contracts");return e.json()},refetchInterval:3e5}),u=c.reduce(((e,s)=>e+parseFloat(s.totalValue||"0")),0);return Si.jsxs(Ax,{className:"h-full cursor-pointer hover:shadow-md transition-shadow",onClick:s,children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsxs(_x,{className:"text-sm font-medium flex items-center gap-2",children:[Si.jsx(vl,{className:"h-4 w-4 text-orange-500"}),e.title]}),Si.jsxs(zp,{value:a.toString(),onValueChange:e=>{const s=parseInt(e);i(s)},children:[Si.jsx(Kp,{className:"w-20 h-8 text-xs",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"1",children:"1M"}),Si.jsx(Hp,{value:"2",children:"2M"}),Si.jsx(Hp,{value:"3",children:"3M"}),Si.jsx(Hp,{value:"6",children:"6M"}),Si.jsx(Hp,{value:"12",children:"12M"})]})]})]}),Si.jsx(Lx,{children:Si.jsxs("div",{className:"flex flex-col space-y-2",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("div",{className:"text-2xl font-bold text-orange-600",children:o?"...":c.length}),Si.jsxs(Sp,{open:n,onOpenChange:r,children:[Si.jsx(Tp,{asChild:!0,onClick:e=>e.stopPropagation(),children:Si.jsxs(Ex,{variant:"outline",size:"sm",className:"h-8",children:[Si.jsx(Sl,{className:"h-3 w-3 mr-1"}),"View"]})}),Si.jsxs(Ep,{className:"max-w-4xl max-h-[80vh] overflow-auto",children:[Si.jsx(Ap,{children:Si.jsxs(_p,{children:["Contracts Expiring in ",a," Month",a>1?"s":""]})}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[Si.jsxs("div",{className:"text-center p-2 bg-orange-50 rounded",children:[Si.jsx("div",{className:"font-semibold text-orange-600",children:c.length}),Si.jsx("div",{className:"text-gray-600",children:"Total Contracts"})]}),Si.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded",children:[Si.jsx("div",{className:"font-semibold text-blue-600",children:new Set(c.map((e=>e.clientId))).size}),Si.jsx("div",{className:"text-gray-600",children:"Affected Clients"})]}),Si.jsxs("div",{className:"text-center p-2 bg-green-50 rounded",children:[Si.jsxs("div",{className:"font-semibold text-green-600",children:["$",u.toLocaleString()]}),Si.jsx("div",{className:"text-gray-600",children:"Total Value"})]})]}),c.length>0?Si.jsxs(Wj,{children:[Si.jsx(Hj,{children:Si.jsxs(Jj,{children:[Si.jsx(Xj,{children:"Client"}),Si.jsx(Xj,{children:"Contract"}),Si.jsx(Xj,{children:"End Date"}),Si.jsx(Xj,{children:"Days Left"}),Si.jsx(Xj,{children:"Value"}),Si.jsx(Xj,{children:"Status"}),Si.jsx(Xj,{children:"Actions"})]})}),Si.jsx(Yj,{children:c.map((e=>{return Si.jsxs(Jj,{children:[Si.jsx(Zj,{children:Si.jsx("button",{className:"text-blue-600 hover:underline",onClick:()=>{return s=e.clientId,l(`/clients/${s}`),void r(!1);var s},children:e.clientName})}),Si.jsx(Zj,{className:"font-medium",children:e.name}),Si.jsx(Zj,{children:Ru(e.endDate)}),Si.jsxs(Zj,{children:[e.daysUntilExpiry," days"]}),Si.jsx(Zj,{children:e.totalValue?`$${parseFloat(e.totalValue).toLocaleString()}`:"N/A"}),Si.jsx(Zj,{children:(s=e.daysUntilExpiry,s<=7?Si.jsx(Sx,{variant:"destructive",children:"Critical"}):s<=30?Si.jsx(Sx,{className:"bg-orange-500 text-white",children:"Urgent"}):s<=60?Si.jsx(Sx,{className:"bg-yellow-500 text-white",children:"Warning"}):Si.jsx(Sx,{variant:"secondary",children:"Notice"}))}),Si.jsx(Zj,{children:Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>{return s=e.id,l(`/contracts/${s}`),void r(!1);var s},children:[Si.jsx(Tl,{className:"h-3 w-3 mr-1"}),"View"]})})]},e.id);var s}))})]}):Si.jsxs("div",{className:"text-center py-8 text-gray-500",children:[Si.jsx(vl,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),Si.jsxs("p",{children:["No contracts expiring in the next ",a," month",a>1?"s":""]})]})]})]})]})]}),Si.jsxs("p",{className:"text-xs text-muted-foreground",children:["Expiring in ",a," month",a>1?"s":""]}),c.length>0&&Si.jsxs("div",{className:"text-xs text-gray-600",children:[new Set(c.map((e=>e.clientId))).size," clients affected"]})]})})]})}function sv({card:e}){var s,t,a,i;const{data:n,isLoading:r,error:l,refetch:c}=fh({queryKey:["widget",e.config.widgetId],queryFn:async()=>{const s=await fetch(`/api/widgets/manage/${e.config.widgetId}`,{credentials:"include",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch widget: ${s.status}`);return s.json()},enabled:!!e.config.widgetId,staleTime:6e4,refetchInterval:12e4,refetchOnWindowFocus:!0});if(r)return Si.jsx("div",{className:av(e.size),children:Si.jsxs(Ax,{className:"h-full",children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center space-x-2",children:[Si.jsx(Qj,{className:"h-4 w-4"}),Si.jsx(Qj,{className:"h-4 w-32"})]})}),Si.jsx(Lx,{children:Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Qj,{className:"h-4 w-full"}),Si.jsx(Qj,{className:"h-4 w-3/4"}),Si.jsx(Qj,{className:"h-32 w-full"})]})})]})});if(l||!n)return Si.jsx("div",{className:av(e.size),children:Si.jsx(Ax,{className:"h-full border-red-200",children:Si.jsx(Lx,{className:"flex items-center justify-center h-full",children:Si.jsxs("div",{className:"text-center text-red-600",children:[Si.jsx(vl,{className:"h-8 w-8 mx-auto mb-2"}),Si.jsx("p",{className:"text-sm",children:"Widget not found"}),Si.jsxs("p",{className:"text-xs text-red-500 mt-1",children:["ID: ",e.config.widgetId]})]})})})});const o={id:n.id,name:n.name,description:n.description||"",pluginName:n.pluginName,instanceId:"jira"===n.pluginName?1===n.systemId?"jira-main":`jira-system-${n.systemId}`:`${n.pluginName}-main`,queryType:"custom",customQuery:n.query,queryMethod:n.method||"GET",queryParameters:n.parameters||{},displayType:n.widgetType,chartType:n.chartType,refreshInterval:n.refreshInterval||30,placement:"global-dashboard",styling:{width:(null==(s=n.displayConfig)?void 0:s.width)||"full",height:(null==(t=n.displayConfig)?void 0:t.height)||"medium",showBorder:!1!==(null==(a=n.displayConfig)?void 0:a.showBorder),showHeader:!1!==(null==(i=n.displayConfig)?void 0:i.showHeader)},enabled:!1!==n.isActive,updatedAt:n.updatedAt};return Si.jsx("div",{className:av(e.size),children:Si.jsx(Gj,{widget:o,className:"h-full",onRefresh:()=>c(),showTitle:!0,enableCredentials:!0},`widget-${n.id}-${n.query}-${n.updatedAt||Date.now()}`)})}$n.forwardRef((({className:e,...s},t)=>Si.jsx("caption",{ref:t,className:Lu("mt-4 text-sm text-muted-foreground",e),...s}))).displayName="TableCaption";const tv={Building:Qr,FileText:Kr,Users:$r,DollarSign:Ur,AlertCircle:vl,BarChart3:Vr,Target:Or,Clock:Wr,TrendingUp:yl,Shield:Gr,Server:zr,CheckCircle:Dl,Database:kl,ExternalLink:Tl},av=e=>{switch(e){case"small":default:return"col-span-1";case"medium":return"col-span-1 md:col-span-2";case"large":return"col-span-1 md:col-span-2 lg:col-span-3";case"xlarge":return"col-span-1 md:col-span-2 lg:col-span-3 xl:col-span-4"}};function iv({card:e,onClick:s}){if("expiring-contracts"===e.id)return Si.jsx(ev,{card:e,onClick:s});if("widget"===e.type&&e.config.widgetId)return Si.jsx(sv,{card:e});Bn.useMemo((()=>({refreshInterval:e.config.refreshInterval||60,dataParams:{}})),[e.config]);const{data:t,isLoading:a,error:i,refetch:n}=fh({queryKey:["dashboard-card",e.id,e.dataSource,e.config],queryFn:async()=>{const s=new URLSearchParams;s.append("table",e.dataSource),s.append("aggregation",e.config.aggregation||"count"),e.config.filters&&Object.entries(e.config.filters).forEach((([e,t])=>{s.append(`filter_${e}`,String(t))}));return(await vh("GET",`/api/dashboard/card-data?${s.toString()}`)).json()},staleTime:12e4,refetchInterval:6e4,refetchOnWindowFocus:!1,refetchOnMount:!0}),r=(e,s)=>{const t="string"==typeof e?parseFloat(e):e;switch(s){case"currency":return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t);case"percentage":return`${t.toFixed(1)}%`;default:return new Intl.NumberFormat("en-US").format(t)}},l=(c=e.config.icon||"Building",tv[c]||Qr);var c;const o=(e=>{const s={blue:{bg:"bg-blue-100",text:"text-blue-600",border:"border-blue-200",cardBg:"bg-blue-50"},green:{bg:"bg-green-100",text:"text-green-600",border:"border-green-200",cardBg:"bg-green-50"},emerald:{bg:"bg-emerald-100",text:"text-emerald-600",border:"border-emerald-200",cardBg:"bg-emerald-50"},orange:{bg:"bg-orange-100",text:"text-orange-600",border:"border-orange-200",cardBg:"bg-orange-50"},purple:{bg:"bg-purple-100",text:"text-purple-600",border:"border-purple-200",cardBg:"bg-purple-50"},indigo:{bg:"bg-indigo-100",text:"text-indigo-600",border:"border-indigo-200",cardBg:"bg-indigo-50"},cyan:{bg:"bg-cyan-100",text:"text-cyan-600",border:"border-cyan-200",cardBg:"bg-cyan-50"},violet:{bg:"bg-violet-100",text:"text-violet-600",border:"border-violet-200",cardBg:"bg-violet-50"},slate:{bg:"bg-slate-100",text:"text-slate-600",border:"border-slate-200",cardBg:"bg-slate-50"}};return s[e]||s.blue})(e.config.color||"blue");if(!e.visible)return null;const d=`cursor-pointer hover:shadow-lg transition-all ${"small"===e.size?"h-auto min-h-[100px]":"min-h-[120px]"} ${o.cardBg} ${o.border}`;if(a)return Si.jsxs(Ax,{className:d,children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-1 px-3 pt-3",children:[Si.jsx(_x,{className:"text-xs font-medium truncate",children:e.title}),Si.jsx("div",{className:`p-1.5 rounded-md ${o.bg}`,children:Si.jsx(l,{className:`h-3.5 w-3.5 ${o.text}`})})]}),Si.jsxs(Lx,{className:"px-3 pb-3",children:[Si.jsx(Qj,{className:"h-6 w-16 mb-1"}),Si.jsx(Qj,{className:"h-3 w-20"})]})]});if(i)return Si.jsxs(Ax,{className:d,children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-1 px-3 pt-3",children:[Si.jsx(_x,{className:"text-xs font-medium truncate",children:e.title}),Si.jsx("div",{className:`p-1.5 rounded-md ${o.bg}`,children:Si.jsx(l,{className:`h-3.5 w-3.5 ${o.text}`})})]}),Si.jsx(Lx,{className:"px-3 pb-3",children:Si.jsx("div",{className:"text-xs text-red-600",children:"Error loading data"})})]});const u=(null==t?void 0:t.value)||0,m=(s=>{const t=e.id.split("").reduce(((e,s)=>e+s.charCodeAt(0)),0),a=s*(.8+.4*((Math.sin(t)+1)/2));if(0===a)return 0;const i=(s-a)/a*100;return Math.round(10*i)/10})(u);return Si.jsxs(Ax,{className:d,onClick:s,children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-1 px-3 pt-3",children:[Si.jsx(_x,{className:"text-xs font-medium truncate",children:e.title}),Si.jsx("div",{className:`p-1.5 rounded-md ${o.bg}`,children:Si.jsx(l,{className:`h-3.5 w-3.5 ${o.text}`})})]}),Si.jsxs(Lx,{className:"px-3 pb-3",children:[Si.jsx("div",{className:`text-lg font-bold ${o.text} leading-tight`,children:r(u,e.config.format)}),e.config.trend&&Si.jsxs("div",{className:"flex items-center text-xs text-muted-foreground mt-1",children:[m>=0?Si.jsx(yl,{className:"h-3 w-3 mr-1 text-green-500"}):Si.jsx(bl,{className:"h-3 w-3 mr-1 text-red-500"}),Math.abs(m),"% vs prev"]}),"small"!==e.size&&(null==t?void 0:t.metadata)&&Si.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:Object.entries(t.metadata).slice(0,2).map((([e,s])=>Si.jsxs("div",{className:"truncate",children:[e,": ","number"==typeof s?r(s,"number"):String(s)]},e)))}),e.config.filters&&Object.keys(e.config.filters).length>0&&"small"!==e.size&&Si.jsx("div",{className:"mt-1",children:Object.entries(e.config.filters).slice(0,2).map((([e,s])=>Si.jsxs(Sx,{variant:"outline",className:"text-xs mr-1 px-1 py-0",children:[e,": ",String(s)]},e)))})]})]})}const nv=[{id:"builtin-new-clients",title:"New Clients",type:"builtin",category:"kpi",dataSource:"clients",size:"small",visible:!0,position:0,config:{icon:"Building",color:"blue",format:"number",aggregation:"count",trend:!0},isBuiltIn:!0,isRemovable:!0},{id:"builtin-contracts-signed",title:"Contracts Signed",type:"builtin",category:"kpi",dataSource:"contracts",size:"small",visible:!0,position:1,config:{icon:"FileText",color:"green",format:"number",aggregation:"count",trend:!0},isBuiltIn:!0,isRemovable:!0},{id:"builtin-period-revenue",title:"Period Revenue",type:"builtin",category:"kpi",dataSource:"contracts",size:"small",visible:!0,position:2,config:{icon:"DollarSign",color:"emerald",format:"currency",aggregation:"sum",trend:!0},isBuiltIn:!0,isRemovable:!0},{id:"builtin-tasks-progress",title:"Tasks Progress",type:"builtin",category:"kpi",dataSource:"tasks",size:"small",visible:!0,position:3,config:{icon:"Users",color:"purple",format:"number",aggregation:"count",trend:!0},isBuiltIn:!0,isRemovable:!0},{id:"total-clients",title:"Total Clients",type:"metric",category:"dashboard",dataSource:"clients",size:"small",visible:!0,position:4,config:{icon:"Building",color:"blue",format:"number",aggregation:"count"},isBuiltIn:!1,isRemovable:!0},{id:"active-contracts",title:"Active Contracts",type:"metric",category:"dashboard",dataSource:"contracts",size:"small",visible:!0,position:5,config:{icon:"FileText",color:"green",format:"number",aggregation:"count",filters:{status:"active"}},isBuiltIn:!1,isRemovable:!0},{id:"total-revenue",title:"Total Revenue",type:"metric",category:"dashboard",dataSource:"contracts",size:"small",visible:!0,position:6,config:{icon:"DollarSign",color:"emerald",format:"currency",aggregation:"sum"},isBuiltIn:!1,isRemovable:!0},{id:"license-pools",title:"License Pools",type:"metric",category:"dashboard",dataSource:"license_pools",size:"small",visible:!0,position:7,config:{icon:"Server",color:"violet",format:"number",aggregation:"count"},isBuiltIn:!1,isRemovable:!0},{id:"expiring-contracts",title:"Expiring Contracts",type:"custom",category:"dashboard",dataSource:"contracts",size:"medium",visible:!0,position:8,config:{icon:"AlertTriangle",color:"orange",format:"number",customApiEndpoint:"/api/contracts/expiring",refreshInterval:300},isBuiltIn:!1,isRemovable:!0}];function rv(){const{user:e}=Ah(),{toast:s}=sd(),t=dh(),{data:a=nv,isLoading:i,error:n,refetch:r}=fh({queryKey:["user-dashboard-settings",null==e?void 0:e.id],queryFn:async()=>{if(!(null==e?void 0:e.id))return nv;try{const e=await vh("GET","/api/user-dashboard-settings"),s=await e.json();return s&&s.length>0?s.map((e=>({id:e.cardId,title:e.title,type:e.type,category:e.category,dataSource:e.dataSource,size:e.size,visible:e.visible,position:e.position,config:e.config||{},isBuiltIn:e.isBuiltIn,isRemovable:e.isRemovable}))):nv}catch(s){return nv}},enabled:!!(null==e?void 0:e.id),staleTime:3e5}),l=gh({mutationFn:async e=>(await vh("POST","/api/user-dashboard-settings",{cards:e})).json(),onSuccess:()=>{t.invalidateQueries({queryKey:["user-dashboard-settings"]}),t.invalidateQueries({queryKey:["dashboard-card"]}),t.invalidateQueries({queryKey:["/api/global-widgets"]}),t.refetchQueries({queryKey:["user-dashboard-settings",null==e?void 0:e.id]}),s({title:"Success",description:"Dashboard settings saved successfully!"})},onError:e=>{s({title:"Error",description:"Failed to save dashboard settings. Please try again.",variant:"destructive"})}}),c=gh({mutationFn:async()=>(await vh("POST","/api/user-dashboard-settings/reset")).json(),onSuccess:()=>{t.invalidateQueries({queryKey:["user-dashboard-settings"]}),s({title:"Success",description:"Dashboard settings reset to defaults!"})},onError:e=>{s({title:"Error",description:"Failed to reset dashboard settings. Please try again.",variant:"destructive"})}}),o=gh({mutationFn:async({cardId:e,updates:s})=>(await vh("PUT",`/api/user-dashboard-settings/${e}`,s)).json(),onSuccess:()=>{t.invalidateQueries({queryKey:["user-dashboard-settings"]})},onError:e=>{s({title:"Error",description:"Failed to update dashboard card. Please try again.",variant:"destructive"})}}),d=gh({mutationFn:async e=>(await vh("DELETE",`/api/user-dashboard-settings/${e}`)).json(),onSuccess:()=>{t.invalidateQueries({queryKey:["user-dashboard-settings"]}),s({title:"Success",description:"Dashboard card removed successfully!"})},onError:e=>{s({title:"Error",description:"Failed to remove dashboard card. Please try again.",variant:"destructive"})}}),u=s=>{t.setQueryData(["user-dashboard-settings",null==e?void 0:e.id],s)},m=a.filter((e=>e.visible)).sort(((e,s)=>e.position-s.position)),h=a.filter((e=>"kpi"===e.category&&e.visible)).sort(((e,s)=>e.position-s.position)),x=a.filter((e=>"dashboard"===e.category&&e.visible)).sort(((e,s)=>e.position-s.position));return{cards:a,visibleCards:m,kpiCards:h,dashboardCards:x,isLoading:i,error:n,updateCards:u,saveSettings:()=>!!a&&(l.mutate(a),!0),saveCardsDirectly:e=>(l.mutate(e),!0),resetToDefaults:()=>(c.mutate(),!0),addCard:e=>{const s={...e,id:`card-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,position:a.length},t=[...a,s];u(t),l.mutate(t)},removeCard:e=>{d.mutate(e)},toggleCardVisibility:e=>{const s=a.find((s=>s.id===e));s&&o.mutate({cardId:e,updates:{visible:!s.visible}})},updateCard:(e,s)=>{o.mutate({cardId:e,updates:s})},reorderCards:(e,s)=>{const t=Array.from(a),[i]=t.splice(e,1);t.splice(s,0,i);const n=t.map(((e,s)=>({...e,position:s})));u(n),l.mutate(n)},refetch:r,isSaving:l.isPending,isResetting:c.isPending}}const lv=[{value:"clients",label:"Clients",icon:"Building"},{value:"contracts",label:"Contracts",icon:"FileText"},{value:"services",label:"Services",icon:"Shield"},{value:"license_pools",label:"License Pools",icon:"Server"},{value:"hardware_assets",label:"Hardware Assets",icon:"Database"},{value:"service_scopes",label:"Service Scopes",icon:"Shield"},{value:"proposals",label:"Proposals",icon:"FileText"},{value:"financial_transactions",label:"Financial Transactions",icon:"DollarSign"},{value:"team_assignments",label:"Team Assignments",icon:"Users"},{value:"service_authorization_forms",label:"Service Authorization Forms",icon:"Shield"},{value:"certificates_of_compliance",label:"Certificates of Compliance",icon:"Shield"},{value:"documents",label:"Documents",icon:"FileText"},{value:"users",label:"Users",icon:"Users"},{value:"audit_logs",label:"Audit Logs",icon:"Shield"}],cv=[{value:"bar",label:"Bar Chart",icon:Vr},{value:"line",label:"Line Chart",icon:Al},{value:"pie",label:"Pie Chart",icon:Pl},{value:"doughnut",label:"Doughnut Chart",icon:Pl},{value:"area",label:"Area Chart",icon:yl},{value:"radar",label:"Radar Chart",icon:yl},{value:"scatter",label:"Scatter Plot",icon:yl}],ov=[{value:"count",label:"Count"},{value:"sum",label:"Sum"},{value:"average",label:"Average"},{value:"max",label:"Maximum"},{value:"min",label:"Minimum"}],dv=[{value:"number",label:"Number"},{value:"currency",label:"Currency"},{value:"percentage",label:"Percentage"}],uv=[{value:"vs",label:"Side by Side"},{value:"ratio",label:"Ratio"},{value:"diff",label:"Difference"},{value:"trend",label:"Trend Over Time"}],mv=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}];function hv({cards:e,onCardsChange:s,onClose:t}){const{toast:a}=sd(),[i,n]=$n.useState(!1),[r,l]=$n.useState(null),[c,o]=$n.useState(null),[d,u]=$n.useState({type:"metric",dataSource:"clients",size:"small",visible:!0,config:{color:"blue",format:"number",aggregation:"count"}}),m=e=>({clients:["id","name","industry","status","created_at","updated_at"],contracts:["id","title","status","start_date","end_date","value","client_id","created_at"],services:["id","name","type","price","status","category","created_at"],license_pools:["id","name","total_licenses","used_licenses","available_licenses","pool_type"],proposals:["id","title","status","value","submitted_date","client_id"],financial_transactions:["id","amount","type","date","status","client_id"],users:["id","username","email","role","status","created_at"],audit_logs:["id","action","entity_type","user_id","created_at"]}[e]||[]);return Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h3",{className:"text-lg font-semibold",children:"Advanced Dashboard Card Creator"}),Si.jsx("p",{className:"text-sm text-gray-600",children:"Create advanced dashboard cards with external data integration, comparisons, and dynamic filters"})]}),Si.jsx("div",{className:"flex gap-2",children:Si.jsxs(Ex,{onClick:()=>n(!0),children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Card"]})})]}),Si.jsxs("div",{className:"space-y-3",children:[Si.jsxs("h4",{className:"font-medium",children:["Current Cards (",e.length,")"]}),0===e.length?Si.jsx(Ax,{className:"border-dashed border-2 border-gray-300",children:Si.jsx(Lx,{className:"flex items-center justify-center py-8",children:Si.jsxs("div",{className:"text-center",children:[Si.jsx(Vr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Si.jsx("p",{className:"text-gray-600 mb-4",children:"No dashboard cards configured"}),Si.jsxs(Ex,{onClick:()=>n(!0),children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Your First Card"]})]})})}):Si.jsx("div",{className:"space-y-2",children:e.map((t=>{var i,n;return Si.jsx(Ax,{className:"p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsxs("div",{className:"p-2 rounded "+("blue"===t.config.color?"bg-blue-100 text-blue-600":"green"===t.config.color?"bg-green-100 text-green-600":"red"===t.config.color?"bg-red-100 text-red-600":"bg-gray-100 text-gray-600"),children:["Building"===t.config.icon&&Si.jsx(Qr,{className:"h-4 w-4"}),"FileText"===t.config.icon&&Si.jsx(Kr,{className:"h-4 w-4"}),"DollarSign"===t.config.icon&&Si.jsx(Ur,{className:"h-4 w-4"}),"Users"===t.config.icon&&Si.jsx($r,{className:"h-4 w-4"}),"Server"===t.config.icon&&Si.jsx(zr,{className:"h-4 w-4"}),"Database"===t.config.icon&&Si.jsx(kl,{className:"h-4 w-4"}),"Shield"===t.config.icon&&Si.jsx(Gr,{className:"h-4 w-4"}),!t.config.icon&&Si.jsx(Vr,{className:"h-4 w-4"})]}),Si.jsxs("div",{children:[Si.jsx("h5",{className:"font-medium",children:t.title}),Si.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[Si.jsx(Sx,{variant:"outline",className:"text-xs",children:t.type}),Si.jsx("span",{children:"•"}),Si.jsx("span",{children:(null==(i=lv.find((e=>e.value===t.dataSource)))?void 0:i.label)||t.dataSource}),t.config.compareWith&&Si.jsxs(Si.Fragment,{children:[Si.jsx("span",{children:"vs"}),Si.jsx("span",{children:(null==(n=lv.find((e=>e.value===t.config.compareWith)))?void 0:n.label)||t.config.compareWith})]})]})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>(t=>{const i={...t,id:`card-${Date.now()}`,title:`${t.title} (Copy)`,position:e.length,isRemovable:!0};s([...e,i]),a({title:"Success",description:"Card duplicated successfully"})})(t),children:Si.jsx(El,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>l(t),children:Si.jsx(Mr,{className:"h-4 w-4"})}),t.isRemovable&&Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>(t=>{const i=e.filter((e=>e.id!==t));s(i),a({title:"Success",description:"Card removed successfully"})})(t.id),children:Si.jsx(al,{className:"h-4 w-4"})})]})]})},t.id)}))})]}),Si.jsx(Sp,{open:i,onOpenChange:n,children:Si.jsxs(Ep,{className:"max-w-4xl max-h-[85vh] overflow-y-auto",children:[Si.jsxs(Ap,{children:[Si.jsx(_p,{children:"Add Advanced Dashboard Card"}),Si.jsx(Fp,{children:"Create a new dashboard card with advanced features like comparisons, dynamic filters, and external data integration"})]}),Si.jsx(xv,{card:d,onCardChange:u,onSave:()=>{var t,i,r,l;const c={id:`card-${Date.now()}`,title:d.title||"New Card",type:d.type||"metric",category:"dashboard",dataSource:d.dataSource||"clients",size:d.size||"small",visible:!0,position:e.length,config:{...d.config,icon:(null==(t=d.config)?void 0:t.icon)||"BarChart3",color:(null==(i=d.config)?void 0:i.color)||"blue",format:(null==(r=d.config)?void 0:r.format)||"number",aggregation:(null==(l=d.config)?void 0:l.aggregation)||"count"},isBuiltIn:!1,isRemovable:!0};s([...e,c]),u({type:"metric",dataSource:"clients",size:"small",visible:!0,config:{color:"blue",format:"number",aggregation:"count"}}),n(!1),a({title:"Success",description:"Dashboard card added successfully"})},onCancel:()=>n(!1),getFieldsForDataSource:m})]})}),Si.jsx(Sp,{open:!!r,onOpenChange:e=>{e||(l(null),o(null))},children:Si.jsxs(Ep,{className:"max-w-4xl max-h-[85vh] overflow-y-auto",children:[Si.jsxs(Ap,{children:[Si.jsx(_p,{children:"Edit Dashboard Card"}),Si.jsx(Fp,{children:"Modify the card configuration and advanced features"})]}),r&&Si.jsx(xv,{card:{...r,...c},onCardChange:e=>{const s={...c,...e,config:{...r.config,...null==c?void 0:c.config,...e.config}};o(s)},onSave:()=>{(t=>{const i=e.map((e=>e.id===t.id?t:e));s(i),a({title:"Success",description:"Card updated successfully"})})({...r,...c,config:{...r.config,...null==c?void 0:c.config}}),l(null),o(null)},onCancel:()=>{l(null),o(null)},getFieldsForDataSource:m,isEditing:!0})]})})]})}function xv({card:e,onCardChange:s,onSave:t,onCancel:a,getFieldsForDataSource:i,isEditing:n=!1}){var r,l,c,o,d,u,m,h,x,p,f,g,j,v,y;const b=t=>{s({...e,...t})},N=s=>{b({config:{...e.config,...s}})},w=e=>["value","price","amount","revenue","total_licenses","used_licenses","available_licenses"].includes(e);return Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs(Mp,{defaultValue:"basic",className:"w-full",children:[Si.jsxs(Vp,{className:"grid w-full grid-cols-3",children:[Si.jsx(Up,{value:"basic",children:"Basic Settings"}),Si.jsx(Up,{value:"data",children:"Data & Comparison"}),Si.jsx(Up,{value:"visualization",children:"Visualization"})]}),Si.jsx($p,{value:"basic",className:"space-y-4",children:Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"card-title",children:"Card Title"}),Si.jsx(kx,{id:"card-title",value:e.title||"",onChange:e=>b({title:e.target.value}),placeholder:"e.g., Contract Revenue vs License Pool Usage"})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"card-type",children:"Card Type"}),Si.jsxs(zp,{value:e.type||"metric",onValueChange:e=>b({type:e}),children:[Si.jsx(Kp,{id:"card-type",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"metric",children:"Metric"}),Si.jsx(Hp,{value:"chart",children:"Chart"}),Si.jsx(Hp,{value:"comparison",children:"Comparison"}),Si.jsx(Hp,{value:"pool-comparison",children:"Pool Comparison"})]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"card-size",children:"Card Size"}),Si.jsxs(zp,{value:e.size||"small",onValueChange:e=>b({size:e}),children:[Si.jsx(Kp,{id:"card-size",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"small",children:"Small"}),Si.jsx(Hp,{value:"medium",children:"Medium"}),Si.jsx(Hp,{value:"large",children:"Large"}),Si.jsx(Hp,{value:"xlarge",children:"Extra Large"})]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"card-color",children:"Color Theme"}),Si.jsxs(zp,{value:(null==(r=e.config)?void 0:r.color)||"blue",onValueChange:e=>N({color:e}),children:[Si.jsx(Kp,{id:"card-color",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"blue",children:"Blue"}),Si.jsx(Hp,{value:"green",children:"Green"}),Si.jsx(Hp,{value:"red",children:"Red"}),Si.jsx(Hp,{value:"purple",children:"Purple"}),Si.jsx(Hp,{value:"orange",children:"Orange"}),Si.jsx(Hp,{value:"gray",children:"Gray"})]})]})]})]})}),Si.jsxs($p,{value:"data",className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"data-source",children:"Primary Data Source"}),Si.jsxs(zp,{value:e.dataSource||"clients",onValueChange:e=>b({dataSource:e}),children:[Si.jsx(Kp,{id:"data-source",children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:lv.map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"aggregation",children:"Aggregation"}),Si.jsxs(zp,{value:"string"==typeof(null==(l=e.config)?void 0:l.aggregation)?e.config.aggregation:"count",onValueChange:e=>N({aggregation:e}),children:[Si.jsx(Kp,{id:"aggregation",children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:ov.map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"format",children:"Value Format"}),Si.jsxs(zp,{value:(null==(c=e.config)?void 0:c.format)||"number",onValueChange:e=>N({format:e}),children:[Si.jsx(Kp,{id:"format",children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:dv.map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"group-by",children:"Group By Field"}),Si.jsxs(zp,{value:(null==(o=e.config)?void 0:o.groupBy)||"any",onValueChange:e=>N({groupBy:"any"===e?void 0:e}),children:[Si.jsx(Kp,{id:"group-by",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"any",children:"None"}),i(e.dataSource||"clients").map((e=>Si.jsx(Hp,{value:e,children:e},e)))]})]})]})]}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("h5",{className:"font-medium text-sm text-gray-700",children:"External Data Comparison"}),Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"compare-with",children:"Compare With Data Source"}),Si.jsxs(zp,{value:(null==(d=e.config)?void 0:d.compareWith)||"any",onValueChange:e=>N({compareWith:"any"===e?void 0:e}),children:[Si.jsx(Kp,{id:"compare-with",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"any",children:"None"}),lv.map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))]})]})]}),(null==(u=e.config)?void 0:u.compareWith)&&Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"comparison-type",children:"Comparison Type"}),Si.jsxs(zp,{value:(null==(m=e.config)?void 0:m.comparisonType)||"vs",onValueChange:e=>N({comparisonType:e}),children:[Si.jsx(Kp,{id:"comparison-type",children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:uv.map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})]})]})]})]}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("h5",{className:"font-medium text-sm text-gray-700",children:"Dynamic Filters"}),Si.jsxs(Ex,{type:"button",variant:"outline",size:"sm",onClick:()=>{var s;const t=(null==(s=e.config)?void 0:s.dynamicFilters)||[];N({dynamicFilters:[...t,{field:"",operator:"=",value:""}]})},children:[Si.jsx(nl,{className:"h-4 w-4 mr-1"}),"Add Filter"]})]}),(null==(h=e.config)?void 0:h.dynamicFilters)&&e.config.dynamicFilters.length>0&&Si.jsx("div",{className:"space-y-3",children:e.config.dynamicFilters.map(((s,t)=>{return Si.jsxs("div",{className:"grid grid-cols-4 gap-2 items-end",children:[Si.jsxs("div",{children:[Si.jsx(Op,{className:"text-xs",children:"Field"}),Si.jsxs(zp,{value:s.field||"any",onValueChange:a=>{var i;const n=[...(null==(i=e.config)?void 0:i.dynamicFilters)||[]];n[t]={...s,field:"any"===a?"":a},N({dynamicFilters:n})},children:[Si.jsx(Kp,{className:"h-8",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"any",children:"Select field"}),i(e.dataSource||"clients").map((e=>Si.jsx(Hp,{value:e,children:e},e)))]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{className:"text-xs",children:"Operator"}),Si.jsxs(zp,{value:s.operator||"=",onValueChange:a=>{var i;const n=[...(null==(i=e.config)?void 0:i.dynamicFilters)||[]];n[t]={...s,operator:a},N({dynamicFilters:n})},children:[Si.jsx(Kp,{className:"h-8",children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:[{value:"=",label:"Equals"},{value:"!=",label:"Not equals"},{value:">",label:"Greater than"},{value:"<",label:"Less than"},{value:">=",label:"Greater or equal"},{value:"<=",label:"Less or equal"},{value:"contains",label:"Contains"},{value:"starts_with",label:"Starts with"},{value:"ends_with",label:"Ends with"}].map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{className:"text-xs",children:"Value"}),(a=s.field,a.includes("date")||a.includes("created_at")||a.includes("updated_at")?Si.jsxs(zp,{value:s.value||"any",onValueChange:a=>{var i;const n=[...(null==(i=e.config)?void 0:i.dynamicFilters)||[]];n[t]={...s,value:"any"===a?"":a},N({dynamicFilters:n})},children:[Si.jsx(Kp,{className:"h-8",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"any",children:"Select period"}),[{value:"1D",label:"Last 1 Day"},{value:"3D",label:"Last 3 Days"},{value:"7D",label:"Last 7 Days"},{value:"10D",label:"Last 10 Days"},{value:"30D",label:"Last 30 Days"},{value:"1M",label:"Last 1 Month"},{value:"3M",label:"Last 3 Months"},{value:"6M",label:"Last 6 Months"},{value:"12M",label:"Last 12 Months"}].map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))]})]}):w(s.field)?Si.jsx(kx,{type:"number",placeholder:"Enter number",value:s.value,onChange:a=>{var i;const n=[...(null==(i=e.config)?void 0:i.dynamicFilters)||[]];n[t]={...s,value:a.target.value},N({dynamicFilters:n})},className:"h-8"}):Si.jsx(kx,{placeholder:"Enter value",value:s.value,onChange:a=>{var i;const n=[...(null==(i=e.config)?void 0:i.dynamicFilters)||[]];n[t]={...s,value:a.target.value},N({dynamicFilters:n})},className:"h-8"}))]}),Si.jsx(Ex,{type:"button",variant:"outline",size:"sm",onClick:()=>{var s,a;const i=(null==(a=null==(s=e.config)?void 0:s.dynamicFilters)?void 0:a.filter(((e,s)=>s!==t)))||[];N({dynamicFilters:i})},className:"h-8 w-8 p-0",children:Si.jsx(Tr,{className:"h-4 w-4"})})]},t);var a}))})]})]}),Si.jsxs($p,{value:"visualization",className:"space-y-4",children:[("chart"===e.type||"comparison"===e.type)&&Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"chart-type",children:"Chart Type"}),Si.jsxs(zp,{value:(null==(x=e.config)?void 0:x.chartType)||"bar",onValueChange:e=>N({chartType:e}),children:[Si.jsx(Kp,{id:"chart-type",children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:cv.map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})]})]}),Si.jsxs("div",{className:"space-y-3",children:[Si.jsx("h5",{className:"font-medium text-sm text-gray-700",children:"Chart Options"}),Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("input",{type:"checkbox",id:"show-legend",checked:!1!==(null==(p=e.config)?void 0:p.showLegend),onChange:e=>N({showLegend:e.target.checked})}),Si.jsx(Op,{htmlFor:"show-legend",className:"text-sm",children:"Show Legend"})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("input",{type:"checkbox",id:"show-data-labels",checked:!0===(null==(f=e.config)?void 0:f.showDataLabels),onChange:e=>N({showDataLabels:e.target.checked})}),Si.jsx(Op,{htmlFor:"show-data-labels",className:"text-sm",children:"Show Data Labels"})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("input",{type:"checkbox",id:"enable-drill-down",checked:!0===(null==(g=e.config)?void 0:g.enableDrillDown),onChange:e=>N({enableDrillDown:e.target.checked})}),Si.jsx(Op,{htmlFor:"enable-drill-down",className:"text-sm",children:"Enable Drill Down"})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("input",{type:"checkbox",id:"show-trend",checked:!0===(null==(j=e.config)?void 0:j.trend),onChange:e=>N({trend:e.target.checked})}),Si.jsx(Op,{htmlFor:"show-trend",className:"text-sm",children:"Show Trend"})]})]})]})]}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("h5",{className:"font-medium text-sm text-gray-700",children:"Advanced Options"}),Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"refresh-interval",children:"Refresh Interval (seconds)"}),Si.jsx(kx,{id:"refresh-interval",type:"number",min:"30",value:(null==(v=e.config)?void 0:v.refreshInterval)||300,onChange:e=>N({refreshInterval:parseInt(e.target.value)||300}),placeholder:"300"})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"time-range",children:"Time Range"}),Si.jsxs(zp,{value:(null==(y=e.config)?void 0:y.timeRange)||"monthly",onValueChange:e=>N({timeRange:e}),children:[Si.jsx(Kp,{id:"time-range",children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:mv.map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})]})]})]})]})]})]}),Si.jsx(Cp,{}),Si.jsxs("div",{className:"flex justify-end space-x-2",children:[Si.jsx(Ex,{variant:"outline",onClick:a,children:"Cancel"}),Si.jsx(Ex,{onClick:t,disabled:!e.title,children:n?"Update Card":"Add Card"})]})]})}const pv=({widget:e,data:s,loading:t,onRefresh:a})=>{var i;const{toast:n}=sd(),r=(()=>{var s;const t=e.name.toLowerCase();return null==(s=e.description)||s.toLowerCase(),t.includes("security")||t.includes("incident")||t.includes("critical")||t.includes("high priority")?{icon:Si.jsx(Gr,{className:"h-8 w-8"}),category:"Security",color:"text-red-600",bgColor:"bg-gradient-to-r from-red-50 to-red-100",borderColor:"border-red-200"}:t.includes("issues")||t.includes("open")||t.includes("unresolved")||t.includes("problems")?{icon:Si.jsx(ol,{className:"h-8 w-8"}),category:"Issues",color:"text-orange-600",bgColor:"bg-gradient-to-r from-orange-50 to-orange-100",borderColor:"border-orange-200"}:t.includes("performance")||t.includes("activity")||t.includes("recent")||t.includes("updated")?{icon:Si.jsx(Nl,{className:"h-8 w-8"}),category:"Activity",color:"text-blue-600",bgColor:"bg-gradient-to-r from-blue-50 to-blue-100",borderColor:"border-blue-200"}:t.includes("report")||t.includes("analytics")||t.includes("distribution")||t.includes("trend")?{icon:Si.jsx(Vr,{className:"h-8 w-8"}),category:"Analytics",color:"text-purple-600",bgColor:"bg-gradient-to-r from-purple-50 to-purple-100",borderColor:"border-purple-200"}:t.includes("time")||t.includes("duration")||t.includes("month")||t.includes("daily")?{icon:Si.jsx(Wr,{className:"h-8 w-8"}),category:"Timeline",color:"text-green-600",bgColor:"bg-gradient-to-r from-green-50 to-green-100",borderColor:"border-green-200"}:t.includes("client")||t.includes("user")||t.includes("assignee")?{icon:Si.jsx($r,{className:"h-8 w-8"}),category:"Clients",color:"text-indigo-600",bgColor:"bg-gradient-to-r from-indigo-50 to-indigo-100",borderColor:"border-indigo-200"}:{icon:Si.jsx(Kr,{className:"h-8 w-8"}),category:"General",color:"text-gray-600",bgColor:"bg-gradient-to-r from-gray-50 to-gray-100",borderColor:"border-gray-200"}})(),l=e=>e.replace(/jira/gi,"").replace(/issues/gi,"Items").replace(/DEP|MD/gi,"Project").replace(/security incidents/gi,"Security Alerts").replace(/open/gi,"Active").replace(/created/gi,"New").replace(/updated/gi,"Modified").replace(/unassigned/gi,"Pending Assignment").trim(),c=t?{icon:Si.jsx(ul,{className:"h-4 w-4 animate-spin"}),text:"Updating",color:"text-blue-500"}:(null==s?void 0:s.success)?{icon:Si.jsx(_l,{className:"h-4 w-4"}),text:"Live",color:"text-green-500"}:{icon:Si.jsx(vl,{className:"h-4 w-4"}),text:"Offline",color:"text-red-500"},o=(null==s?void 0:s.success)&&void 0!==(null==(i=s.data)?void 0:i.totalResults)?0===(d=s.data.totalResults)?"0":d>=1e6?(d/1e6).toFixed(1)+"M":d>=1e3?(d/1e3).toFixed(1)+"K":d.toString():"--";var d;return Si.jsx(Ax,{className:`${r.bgColor} ${r.borderColor} hover:shadow-md transition-shadow cursor-pointer`,onClick:()=>{var t;(null==s?void 0:s.success)&&void 0!==(null==(t=s.data)?void 0:t.totalResults)&&n({title:l(e.name),description:`Current value: ${o}`})},children:Si.jsx(Lx,{className:"p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:`text-sm font-medium ${r.color}`,children:l(e.name)}),Si.jsx("p",{className:`text-2xl font-bold ${"text-gray-600"===r.color?"text-gray-900":r.color}`,children:t?Si.jsx("span",{className:"animate-pulse",children:"--"}):o}),Si.jsxs("div",{className:`flex items-center text-xs mt-1 ${c.color}`,children:[c.icon,Si.jsx("span",{className:"ml-1",children:c.text})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[r.icon,Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),a()},disabled:t,className:"h-6 w-6 p-0 opacity-50 hover:opacity-100",children:Si.jsx(ul,{className:"h-3 w-3 "+(t?"animate-spin":"")})})]})]})})})},fv=({className:e="",maxColumns:s=4,showOnlyActive:t=!0,showOnlyGlobal:a=!1})=>{const[i,n]=$n.useState({}),[r,l]=$n.useState({}),[c,o]=$n.useState(new Date),{toast:d}=sd(),{data:u,isLoading:m,refetch:h}=fh({queryKey:["business-metrics"],queryFn:async()=>{const e=await fetch("/api/widgets/manage",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch business metrics");return await e.json()},staleTime:6e4,refetchInterval:3e5}),x=Bn.useMemo((()=>{if(!u)return[];let e=u;return t&&(e=e.filter((e=>e.isActive))),a&&(e=e.filter((e=>e.isGlobal))),e.sort(((e,s)=>{const t=e=>{const s=e.toLowerCase();return s.includes("security")||s.includes("critical")?1:s.includes("high priority")||s.includes("incident")?2:s.includes("open")||s.includes("unresolved")?3:s.includes("activity")||s.includes("recent")?4:5};return t(e.name)-t(s.name)}))}),[u,t,a]),p=async e=>{try{l((s=>({...s,[e.id]:!0})));const s=await fetch("/api/plugins/jira/instances/jira-main/query",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({query:e.query,method:e.method,parameters:e.parameters})}),t=await s.json();n((s=>({...s,[e.id]:t})))}catch(s){n((t=>({...t,[e.id]:{success:!1,message:"Data temporarily unavailable",error:s}})))}finally{l((s=>({...s,[e.id]:!1})))}};$n.useEffect((()=>{x&&x.length>0&&(x.forEach((e=>{p(e)})),o(new Date))}),[x]);const f=()=>({1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 md:grid-cols-2 lg:grid-cols-4",5:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5",6:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6"}[Math.min(s,x.length)]||"grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4");return m?Si.jsxs("div",{className:`space-y-6 ${e}`,children:[Si.jsx("div",{className:"flex items-center justify-between",children:Si.jsxs("div",{children:[Si.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Business Dashboard"}),Si.jsx("p",{className:"text-gray-600",children:"Loading business metrics..."})]})}),Si.jsx("div",{className:`grid gap-6 ${f()}`,children:[...Array(6)].map(((e,s)=>Si.jsx(Ax,{className:"h-48 animate-pulse",children:Si.jsx(Lx,{className:"p-6",children:Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),Si.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"}),Si.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]})})},s)))})]}):Si.jsxs("div",{className:`space-y-6 ${e}`,children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Business Dashboard"}),Si.jsx("p",{className:"text-gray-600",children:"Real-time business metrics and performance indicators"})]}),Si.jsxs("div",{className:"flex items-center space-x-4",children:[Si.jsxs("div",{className:"text-sm text-gray-500",children:[Si.jsx(jl,{className:"h-4 w-4 inline mr-1"}),"Last updated: ",c.toLocaleTimeString()]}),Si.jsxs(Ex,{onClick:()=>{x.forEach((e=>{p(e)})),o(new Date),d({title:"Business Metrics Refreshed",description:"All business metrics have been updated with the latest data."})},variant:"outline",size:"sm",disabled:Object.values(r).some(Boolean),children:[Si.jsx(ul,{className:"h-4 w-4 mr-2 "+(Object.values(r).some(Boolean)?"animate-spin":"")}),"Refresh All"]})]})]}),0===x.length?Si.jsx(Ax,{className:"p-12 text-center",children:Si.jsxs("div",{className:"space-y-4",children:[Si.jsx(Vr,{className:"h-12 w-12 text-gray-400 mx-auto"}),Si.jsxs("div",{children:[Si.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No Business Metrics Available"}),Si.jsx("p",{className:"text-gray-600 mt-2",children:"Business metrics are currently being configured. Please check back shortly."})]})]})}):Si.jsx("div",{className:`grid gap-6 ${f()}`,children:x.map((e=>Si.jsx(pv,{widget:e,data:i[e.id]||null,loading:r[e.id]||!1,onRefresh:()=>(e=>{p(e)})(e)},e.id)))})]})},gv=["#8884d8","#82ca9d","#ffc658","#ff7300","#a4de6c","#d084d0","#8dd1e1","#ffb347"];function jv({className:e}){Oo();const[s,t]=$n.useState("ytd"),[a,i]=$n.useState(!1),[n,r]=$n.useState({}),[l,c]=$n.useState(!1),[o,d]=$n.useState(null),[u,m]=$n.useState(!1);sd();const h=(()=>{const e=new Date,s=e.getFullYear(),t=Math.floor(e.getMonth()/3)+1;return[{value:"all_time",label:"All Time",description:"Since the beginning"},{value:"ytd",label:"Year to Date",description:`Jan 1, ${s} - Present`},{value:"current_year",label:"Current Year",description:`${s}`},{value:"last_year",label:"Last Year",description:""+(s-1)},{value:"current_quarter",label:"Current Quarter",description:`Q${t} ${s}`},{value:"last_quarter",label:"Last Quarter",description:`Q${1===t?4:t-1} ${1===t?s-1:s}`},{value:"last_3_months",label:"Last 3 Months",description:"Last 90 days"},{value:"last_6_months",label:"Last 6 Months",description:"Last 180 days"},{value:"last_12_months",label:"Last 12 Months",description:"Last 365 days"},{value:"current_month",label:"Current Month",description:e.toLocaleString("default",{month:"long",year:"numeric"})},{value:"last_month",label:"Last Month",description:new Date(e.getFullYear(),e.getMonth()-1).toLocaleString("default",{month:"long",year:"numeric"})},{value:"30d",label:"Last 30 Days",description:"Last 30 days"},{value:"7d",label:"Last 7 Days",description:"Last week"}]})(),{data:x,isLoading:p,refetch:f}=fh({queryKey:["/api/dashboard/stats",s,n,"fixed-null-handling-2025-06-15"],queryFn:async()=>{var e,t;const a=new URLSearchParams;a.append("timeRange",s),Object.entries(n).forEach((([e,s])=>{null!=s&&""!==s&&(Array.isArray(s)?s.forEach((s=>a.append(`${e}[]`,s.toString()))):a.append(e,s.toString()))}));const i=await vh("GET",`/api/dashboard/stats?${a.toString()}`),r=await i.json();return{totalClients:r.overview.totalClients,activeContracts:"string"==typeof r.overview.activeContracts?parseInt(r.overview.activeContracts):r.overview.activeContracts,totalRevenue:"string"==typeof r.overview.totalRevenue?parseFloat(r.overview.totalRevenue):r.overview.totalRevenue,pendingTasks:0,activeClients:r.overview.totalClients,inactiveClients:0,expiringContracts:0,completedTasks:0,totalRecurringRevenue:0,newContractRevenue:0,clientsByIndustry:(null==(t=null==(e=r.recentActivity)?void 0:e.clients)?void 0:t.map(((e,s)=>({name:e.industry||"Unknown",value:1,color:gv[s%gv.length]}))))||[],revenueByMonth:[],contractStatusDistribution:[],serviceUtilization:[],teamPerformance:[],clientSatisfaction:[],periodInfo:{startDate:r.period.start,endDate:r.period.end,description:s}}}}),{data:g,isLoading:j,error:v,refetch:y}=fh({queryKey:["/api/license-pools"],queryFn:async()=>(await vh("GET","/api/license-pools")).json(),staleTime:3e5,refetchOnWindowFocus:!1,retry:3}),{data:b=[]}=fh({queryKey:["/api/clients"],queryFn:async()=>(await vh("GET","/api/clients")).json()}),{data:N=[]}=fh({queryKey:["/api/contracts"],queryFn:async()=>(await vh("GET","/api/contracts")).json()}),{data:w=[]}=fh({queryKey:["/api/services"],queryFn:async()=>(await vh("GET","/api/services")).json()}),C=[{key:"clientId",label:"Client",type:"select",options:(b||[]).map((e=>({value:e.id.toString(),label:Ou(e)}))),icon:Qr},{key:"contractStatus",label:"Contract Status",type:"multiselect",options:[{value:"active",label:"Active"},{value:"pending",label:"Pending"},{value:"expired",label:"Expired"},{value:"cancelled",label:"Cancelled"}],icon:Kr},{key:"serviceCategory",label:"Service Category",type:"multiselect",options:Array.from(new Set((w||[]).map((e=>e.category)))).map((e=>({value:e,label:e}))),icon:Or},{key:"revenueRange",label:"Revenue Range",type:"select",options:[{value:"0-10000",label:"$0 - $10K"},{value:"10000-50000",label:"$10K - $50K"},{value:"50000-100000",label:"$50K - $100K"},{value:"100000+",label:"$100K+"}],icon:Ur},{key:"dateRange",label:"Custom Date Range",type:"dateRange",icon:jl}],S=()=>{const e=h.find((e=>e.value===s));return(null==e?void 0:e.description)||"Selected period"},{cards:T,updateCards:k,saveCardsDirectly:D,visibleCards:E}=rv();return p?Si.jsx("div",{className:"flex items-center justify-center h-96",children:Si.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Si.jsxs("div",{className:e,children:[Si.jsxs("div",{className:"mb-6 space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard Overview"}),Si.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[S(),(null==x?void 0:x.periodInfo)&&Si.jsx("span",{className:"ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:x.periodInfo.description})]})]}),Si.jsxs("div",{className:"flex items-center space-x-4",children:[Si.jsxs(zp,{value:s,onValueChange:t,children:[Si.jsx(Kp,{className:"w-48",children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:h.map((e=>Si.jsx(Hp,{value:e.value,children:Si.jsxs("div",{children:[Si.jsx("div",{className:"font-medium",children:e.label}),Si.jsx("div",{className:"text-xs text-muted-foreground",children:e.description})]})},e.value)))})]}),Si.jsxs(Ex,{onClick:()=>f(),variant:"outline",size:"sm",children:[Si.jsx(Nl,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),Si.jsx(Kj,{filters:C,values:n,onChange:r,onClear:()=>r({}),compact:!0,className:"mb-4"})]}),Si.jsxs("div",{className:"mb-8",children:[Si.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Business Metrics Dashboard"}),Si.jsxs(Sx,{variant:"outline",className:"ml-2",children:[E.filter((e=>"widget"===e.type)).length," imported widget",1!==E.filter((e=>"widget"===e.type)).length?"s":""]})]}),Si.jsx("div",{className:"flex items-center space-x-2",children:Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>m(!u),className:"flex items-center space-x-2",children:[Si.jsx(Mr,{className:"h-4 w-4"}),Si.jsx("span",{children:"Manage Widgets"})]})})]}),E.filter((e=>"widget"===e.type)).length>0&&Si.jsxs("div",{className:"mb-6",children:[Si.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Imported Widgets"}),Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:E.filter((e=>"widget"===e.type)).map((e=>Si.jsx(iv,{card:e,onClick:()=>{}},e.id)))})]}),Si.jsx(fv,{className:"w-full",maxColumns:4,showOnlyActive:!0,showOnlyGlobal:!1})]}),u&&Si.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:Si.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[Si.jsxs("div",{className:"p-6 border-b border-gray-200 flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Enhanced Dashboard Customizer"}),Si.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create advanced dashboard cards with external data integration and comparisons"})]}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>m(!1),className:"text-gray-400 hover:text-gray-600",children:Si.jsx(Tr,{className:"h-5 w-5"})})]}),Si.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:Si.jsx(hv,{cards:T,onCardsChange:async e=>{const s=e.map((e=>({id:e.id,title:e.title,type:"comparison"===e.type||"pool-comparison"===e.type?"custom":e.type,category:"comparison"===e.category?"custom":e.category,dataSource:e.dataSource,size:e.size,visible:e.visible,position:e.position,config:{...e.config,icon:e.config.icon||"Building",color:e.config.color||"blue",format:e.config.format||"number",aggregation:e.config.aggregation||"count"},isBuiltIn:e.isBuiltIn,isRemovable:e.isRemovable})));k(s),D(s)},onClose:()=>m(!1)})})]})}),l&&o&&Si.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:Si.jsxs(Ax,{className:"w-full max-w-4xl max-h-[80vh] overflow-auto",children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs(_x,{children:["Detailed View - ",S()]}),Si.jsx(Ex,{variant:"ghost",onClick:()=>c(!1),children:"✕"})]})}),Si.jsx(Lx,{children:Si.jsx("pre",{className:"bg-gray-50 p-4 rounded text-sm overflow-auto",children:JSON.stringify(o,null,2)})})]})})]})}function vv(){return Si.jsx(vf,{title:"Executive Dashboard",subtitle:"Real-time insights and analytics",children:Si.jsx("div",{className:"p-6",children:Si.jsx(jv,{})})})}var yv=function(e,s){for(var t={};e.length;){var a=e[0],i=a.code,n=a.message,r=a.path.join(".");if(!t[r])if("unionErrors"in a){var l=a.unionErrors[0].errors[0];t[r]={message:l.message,type:l.code}}else t[r]={message:n,type:i};if("unionErrors"in a&&a.unionErrors.forEach((function(s){return s.errors.forEach((function(s){return e.push(s)}))})),s){var c=t[r].types,o=c&&c[a.code];t[r]=Oc(r,s,t,i,o?[].concat(o,a.message):a.message)}e.shift()}return t},bv=function(e,s,t){return void 0===t&&(t={}),function(a,i,n){try{return Promise.resolve(function(i,r){try{var l=Promise.resolve(e["sync"===t.mode?"parse":"parseAsync"](a,s)).then((function(e){return n.shouldUseNativeValidation&&Rc({},n),{errors:{},values:t.raw?a:e}}))}catch(c){return r(c)}return l&&l.then?l.then(void 0,r):l}(0,(function(e){if(s=e,Array.isArray(null==s?void 0:s.errors))return{values:{},errors:qc(yv(e.errors,!n.shouldUseNativeValidation&&"all"===n.criteriaMode),n)};var s;throw e})))}catch(r){return Promise.reject(r)}}};const Nv=Symbol.for("drizzle:entityKind");function wv(e,s){if(!e||"object"!=typeof e)return!1;if(e instanceof s)return!0;if(!Object.prototype.hasOwnProperty.call(s,Nv))throw new Error(`Class "${s.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=Object.getPrototypeOf(e).constructor;if(t)for(;t;){if(Nv in t&&t[Nv]===s[Nv])return!0;t=Object.getPrototypeOf(t)}return!1}be=Nv;class Cv{constructor(e,s){pi(this,"name"),pi(this,"keyAsName"),pi(this,"primary"),pi(this,"notNull"),pi(this,"default"),pi(this,"defaultFn"),pi(this,"onUpdateFn"),pi(this,"hasDefault"),pi(this,"isUnique"),pi(this,"uniqueName"),pi(this,"uniqueType"),pi(this,"dataType"),pi(this,"columnType"),pi(this,"enumValues"),pi(this,"generated"),pi(this,"generatedIdentity"),pi(this,"config"),this.table=e,this.config=s,this.name=s.name,this.keyAsName=s.keyAsName,this.notNull=s.notNull,this.default=s.default,this.defaultFn=s.defaultFn,this.onUpdateFn=s.onUpdateFn,this.hasDefault=s.hasDefault,this.primary=s.primaryKey,this.isUnique=s.isUnique,this.uniqueName=s.uniqueName,this.uniqueType=s.uniqueType,this.dataType=s.dataType,this.columnType=s.columnType,this.generated=s.generated,this.generatedIdentity=s.generatedIdentity}mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}pi(Cv,be,"Column"),Ne=Nv;class Sv{constructor(e,s,t){pi(this,"config"),pi(this,"$default",this.$defaultFn),pi(this,"$onUpdate",this.$onUpdateFn),this.config={name:e,keyAsName:""===e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:s,columnType:t,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){""===this.config.name&&(this.config.name=e)}}pi(Sv,Ne,"ColumnBuilder");const Tv=Symbol.for("drizzle:Name");we=Nv;class kv{constructor(e,s){pi(this,"reference"),pi(this,"_onUpdate","no action"),pi(this,"_onDelete","no action"),this.reference=()=>{const{name:s,columns:t,foreignColumns:a}=e();return{name:s,columns:t,foreignTable:a[0].table,foreignColumns:a}},s&&(this._onUpdate=s.onUpdate,this._onDelete=s.onDelete)}onUpdate(e){return this._onUpdate=void 0===e?"no action":e,this}onDelete(e){return this._onDelete=void 0===e?"no action":e,this}build(e){return new Dv(e,this)}}pi(kv,we,"PgForeignKeyBuilder"),Ce=Nv;class Dv{constructor(e,s){pi(this,"reference"),pi(this,"onUpdate"),pi(this,"onDelete"),this.table=e,this.reference=s.reference,this.onUpdate=s._onUpdate,this.onDelete=s._onDelete}getName(){const{name:e,columns:s,foreignColumns:t}=this.reference(),a=s.map((e=>e.name)),i=t.map((e=>e.name)),n=[this.table[Tv],...a,t[0].table[Tv],...i];return e??`${n.join("_")}_fk`}}function Ev(e){return new _v(e)}function Av(e,s){return`${e[Tv]}_${s.join("_")}_unique`}pi(Dv,Ce,"PgForeignKey"),Se=Nv;class Pv{constructor(e,s){pi(this,"columns"),pi(this,"nullsNotDistinctConfig",!1),this.name=s,this.columns=e}nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Fv(e,this.columns,this.nullsNotDistinctConfig,this.name)}}pi(Pv,Se,"PgUniqueConstraintBuilder"),Te=Nv;class _v{constructor(e){pi(this,"name"),this.name=e}on(...e){return new Pv(e,this.name)}}pi(_v,Te,"PgUniqueOnConstraintBuilder"),ke=Nv;class Fv{constructor(e,s,t,a){pi(this,"columns"),pi(this,"name"),pi(this,"nullsNotDistinct",!1),this.table=e,this.columns=s,this.name=a??Av(this.table,this.columns.map((e=>e.name))),this.nullsNotDistinct=t}getName(){return this.name}}function Lv(e,s,t){for(let a=s;a<e.length;a++){const i=e[a];if("\\"!==i){if('"'===i)return[e.slice(s,a).replace(/\\/g,""),a+1];if(!t&&(","===i||"}"===i))return[e.slice(s,a).replace(/\\/g,""),a]}else a++}return[e.slice(s).replace(/\\/g,""),e.length]}function Iv(e,s=0){const t=[];let a=s,i=!1;for(;a<e.length;){const n=e[a];if(","===n){(i||a===s)&&t.push(""),i=!0,a++;continue}if(i=!1,"\\"===n){a+=2;continue}if('"'===n){const[s,i]=Lv(e,a+1,!0);t.push(s),a=i;continue}if("}"===n)return[t,a+1];if("{"===n){const[s,i]=Iv(e,a+1);t.push(s),a=i;continue}const[r,l]=Lv(e,a,!1);t.push(r),a=l}return[t,a]}function Rv(e){const[s]=Iv(e,1);return s}function qv(e){return`{${e.map((e=>Array.isArray(e)?qv(e):"string"==typeof e?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`)).join(",")}}`}pi(Fv,ke,"PgUniqueConstraint");class Ov extends(Ee=Sv,De=Nv,Ee){constructor(){super(...arguments),pi(this,"foreignKeyConfigs",[])}array(e){return new $v(this.config.name,this,e)}references(e,s={}){return this.foreignKeyConfigs.push({ref:e,actions:s}),this}unique(e,s){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=null==s?void 0:s.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,s){return this.foreignKeyConfigs.map((({ref:t,actions:a})=>function(e,...s){return e(...s)}(((t,a)=>{const i=new kv((()=>{const s=t();return{columns:[e],foreignColumns:[s]}}));return a.onUpdate&&i.onUpdate(a.onUpdate),a.onDelete&&i.onDelete(a.onDelete),i.build(s)}),t,a)))}buildExtraConfigColumn(e){return new Vv(e,this.config)}}pi(Ov,De,"PgColumnBuilder");class Mv extends(Pe=Cv,Ae=Nv,Pe){constructor(e,s){s.uniqueName||(s.uniqueName=Av(e,[s.name])),super(e,s),this.table=e}}pi(Mv,Ae,"PgColumn");class Vv extends(Fe=Mv,_e=Nv,Fe){constructor(){super(...arguments),pi(this,"indexConfig",{order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass}),pi(this,"defaultConfig",{order:"asc",nulls:"last",opClass:void 0})}getSQLType(){return this.getSQLType()}asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}}pi(Vv,_e,"ExtraConfigColumn"),Le=Nv;class Uv{constructor(e,s,t,a){pi(this,"name"),pi(this,"keyAsName"),pi(this,"type"),pi(this,"indexConfig"),this.name=e,this.keyAsName=s,this.type=t,this.indexConfig=a}}pi(Uv,Le,"IndexedColumn");class $v extends(Re=Ov,Ie=Nv,Re){constructor(e,s,t){super(e,"array","PgArray"),this.config.baseBuilder=s,this.config.size=t}build(e){const s=this.config.baseBuilder.build(e);return new Bv(e,this.config,s)}}pi($v,Ie,"PgArrayBuilder");const zv=class e extends(Oe=Mv,qe=Nv,Oe){constructor(e,s,t,a){super(e,s),pi(this,"size"),this.baseColumn=t,this.range=a,this.size=s.size}getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(e){return"string"==typeof e&&(e=Rv(e)),e.map((e=>this.baseColumn.mapFromDriverValue(e)))}mapToDriverValue(s,t=!1){const a=s.map((s=>null===s?null:wv(this.baseColumn,e)?this.baseColumn.mapToDriverValue(s,!0):this.baseColumn.mapToDriverValue(s)));return t?a:qv(a)}};pi(zv,qe,"PgArray");let Bv=zv;const Kv=Symbol.for("drizzle:isPgEnum");Me=Nv;class Qv{constructor(e,s,t,a=!1){this._={brand:"Subquery",sql:e,selectedFields:s,alias:t,isWith:a}}}pi(Qv,Me,"Subquery");const Gv={startActiveSpan:(e,s)=>s()},Wv=Symbol.for("drizzle:ViewBaseConfig"),Hv=Symbol.for("drizzle:Schema"),Yv=Symbol.for("drizzle:Columns"),Jv=Symbol.for("drizzle:ExtraConfigColumns"),Xv=Symbol.for("drizzle:OriginalName"),Zv=Symbol.for("drizzle:BaseName"),ey=Symbol.for("drizzle:IsAlias"),sy=Symbol.for("drizzle:ExtraConfigBuilder"),ty=Symbol.for("drizzle:IsDrizzleTable");He=Nv,We=Tv,Ge=Xv,Qe=Hv,Ke=Yv,Be=Jv,ze=Zv,$e=ey,Ue=ty,Ve=sy;class ay{constructor(e,s,t){pi(this,We),pi(this,Ge),pi(this,Qe),pi(this,Ke),pi(this,Be),pi(this,ze),pi(this,$e,!1),pi(this,Ue,!0),pi(this,Ve),this[Tv]=this[Xv]=e,this[Hv]=s,this[Zv]=t}}function iy(e){return"object"==typeof e&&null!==e&&ty in e}pi(ay,He,"Table"),pi(ay,"Symbol",{Name:Tv,Schema:Hv,OriginalName:Xv,Columns:Yv,ExtraConfigColumns:Jv,BaseName:Zv,IsAlias:ey,ExtraConfigBuilder:sy}),Ye=Nv;class ny{constructor(e){pi(this,"value"),this.value=Array.isArray(e)?e:[e]}getSQL(){return new ly([this])}}pi(ny,Ye,"StringChunk"),Je=Nv;const ry=class e{constructor(e){pi(this,"decoder",oy),pi(this,"shouldInlineParams",!1),this.queryChunks=e}append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return Gv.startActiveSpan("drizzle.buildSQL",(s=>{const t=this.buildQueryFromSourceParams(this.queryChunks,e);return null==s||s.setAttributes({"drizzle.query.text":t.sql,"drizzle.query.params":JSON.stringify(t.params)}),t}))}buildQueryFromSourceParams(s,t){const a=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:i,escapeName:n,escapeParam:r,prepareTyping:l,inlineParams:c,paramStartIndex:o}=a;return function(e){var s;const t={sql:"",params:[]};for(const a of e)t.sql+=a.sql,t.params.push(...a.params),(null==(s=a.typings)?void 0:s.length)&&(t.typings||(t.typings=[]),t.typings.push(...a.typings));return t}(s.map((s=>{var d,u,m;if(wv(s,ny))return{sql:s.value.join(""),params:[]};if(wv(s,cy))return{sql:n(s.value),params:[]};if(void 0===s)return{sql:"",params:[]};if(Array.isArray(s)){const e=[new ny("(")];for(const[t,a]of s.entries())e.push(a),t<s.length-1&&e.push(new ny(", "));return e.push(new ny(")")),this.buildQueryFromSourceParams(e,a)}if(wv(s,e))return this.buildQueryFromSourceParams(s.queryChunks,{...a,inlineParams:c||s.shouldInlineParams});if(wv(s,ay)){const e=s[ay.Symbol.Schema],t=s[ay.Symbol.Name];return{sql:void 0===e||s[ey]?n(t):n(e)+"."+n(t),params:[]}}if(wv(s,Cv)){const e=i.getColumnCasing(s);if("indexes"===t.invokeSource)return{sql:n(e),params:[]};const a=s.table[ay.Symbol.Schema];return{sql:s.table[ey]||void 0===a?n(s.table[ay.Symbol.Name])+"."+n(e):n(a)+"."+n(s.table[ay.Symbol.Name])+"."+n(e),params:[]}}if(wv(s,fy)){const e=s[Wv].schema,t=s[Wv].name;return{sql:void 0===e||s[Wv].isAlias?n(t):n(e)+"."+n(t),params:[]}}if(wv(s,uy)){if(wv(s.value,xy))return{sql:r(o.value++,s),params:[s],typings:["none"]};const t=null===s.value?null:s.encoder.mapToDriverValue(s.value);if(wv(t,e))return this.buildQueryFromSourceParams([t],a);if(c)return{sql:this.mapInlineParam(t,a),params:[]};let i=["none"];return l&&(i=[l(s.encoder)]),{sql:r(o.value++,t),params:[t],typings:i}}return wv(s,xy)?{sql:r(o.value++,s),params:[s],typings:["none"]}:wv(s,e.Aliased)&&void 0!==s.fieldAlias?{sql:n(s.fieldAlias),params:[]}:wv(s,Qv)?s._.isWith?{sql:n(s._.alias),params:[]}:this.buildQueryFromSourceParams([new ny("("),s._.sql,new ny(") "),new cy(s._.alias)],a):(u=s)&&"function"==typeof u&&Kv in u&&!0===u[Kv]?s.schema?{sql:n(s.schema)+"."+n(s.enumName),params:[]}:{sql:n(s.enumName),params:[]}:null!=(m=s)&&"function"==typeof m.getSQL?(null==(d=s.shouldOmitSQLParens)?void 0:d.call(s))?this.buildQueryFromSourceParams([s.getSQL()],a):this.buildQueryFromSourceParams([new ny("("),s.getSQL(),new ny(")")],a):c?{sql:this.mapInlineParam(s,a),params:[]}:{sql:r(o.value++,s),params:[s],typings:["none"]}})))}mapInlineParam(e,{escapeString:s}){if(null===e)return"null";if("number"==typeof e||"boolean"==typeof e)return e.toString();if("string"==typeof e)return s(e);if("object"==typeof e){const t=e.toString();return s("[object Object]"===t?JSON.stringify(e):t)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(s){return void 0===s?this:new e.Aliased(this,s)}mapWith(e){return this.decoder="function"==typeof e?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}};pi(ry,Je,"SQL");let ly=ry;Xe=Nv;class cy{constructor(e){pi(this,"brand"),this.value=e}getSQL(){return new ly([this])}}pi(cy,Xe,"Name");const oy={mapFromDriverValue:e=>e},dy={mapToDriverValue:e=>e};Ze=Nv;class uy{constructor(e,s=dy){pi(this,"brand"),this.value=e,this.encoder=s}getSQL(){return new ly([this])}}function my(e,...s){const t=[];(s.length>0||e.length>0&&""!==e[0])&&t.push(new ny(e[0]));for(const[a,i]of s.entries())t.push(i,new ny(e[a+1]));return new ly(t)}var hy;pi(uy,Ze,"Param"),(hy=my||(my={})).empty=function(){return new ly([])},hy.fromList=function(e){return new ly(e)},hy.raw=function(e){return new ly([new ny(e)])},hy.join=function(e,s){const t=[];for(const[a,i]of e.entries())a>0&&void 0!==s&&t.push(s),t.push(i);return new ly(t)},hy.identifier=function(e){return new cy(e)},hy.placeholder=function(e){return new xy(e)},hy.param=function(e,s){return new uy(e,s)},(e=>{var s;s=Nv;const t=class e{constructor(e,s){pi(this,"isSelectionField",!1),this.sql=e,this.fieldAlias=s}getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}};pi(t,s,"SQL.Aliased");let a=t;e.Aliased=a})(ly||(ly={})),es=Nv;class xy{constructor(e){this.name=e}getSQL(){return new ly([this])}}pi(xy,es,"Placeholder");const py=Symbol.for("drizzle:IsDrizzleView");as=Nv,ts=Wv,ss=py;class fy{constructor({name:e,schema:s,selectedFields:t,query:a}){pi(this,ts),pi(this,ss,!0),this[Wv]={name:e,originalName:e,schema:s,selectedFields:t,query:a,isExisting:!a,isAlias:!1}}getSQL(){return new ly([this])}}pi(fy,as,"View"),Cv.prototype.getSQL=function(){return new ly([this])},ay.prototype.getSQL=function(){return new ly([this])},Qv.prototype.getSQL=function(){return new ly([this])},is=Nv;class gy{constructor(e,s){pi(this,"brand"),this.name=e,this.value=s}build(e){return new jy(e,this)}}pi(gy,is,"PgCheckBuilder"),ns=Nv;class jy{constructor(e,s){pi(this,"name"),pi(this,"value"),this.table=e,this.name=s.name,this.value=s.value}}function vy(e,s){return{name:"string"==typeof e&&e.length>0?e:"",config:"object"==typeof e?e:s}}pi(jy,ns,"PgCheck");class yy extends(ls=Ov,rs=Nv,ls){generatedAlwaysAsIdentity(e){if(e){const{name:s,...t}=e;this.config.generatedIdentity={type:"always",sequenceName:s,sequenceOptions:t}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){const{name:s,...t}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:s,sequenceOptions:t}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}pi(yy,rs,"PgIntColumnBaseBuilder");class by extends(os=yy,cs=Nv,os){constructor(e){super(e,"number","PgBigInt53")}build(e){return new Ny(e,this.config)}}pi(by,cs,"PgBigInt53Builder");class Ny extends(us=Mv,ds=Nv,us){getSQLType(){return"bigint"}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}}pi(Ny,ds,"PgBigInt53");class wy extends(hs=yy,ms=Nv,hs){constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new Cy(e,this.config)}}pi(wy,ms,"PgBigInt64Builder");class Cy extends(ps=Mv,xs=Nv,ps){getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}}function Sy(e,s){const{name:t,config:a}=vy(e,s);return"number"===a.mode?new by(t):new wy(t)}pi(Cy,xs,"PgBigInt64");class Ty extends(gs=Ov,fs=Nv,gs){constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new ky(e,this.config)}}pi(Ty,fs,"PgBigSerial53Builder");class ky extends(vs=Mv,js=Nv,vs){getSQLType(){return"bigserial"}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}}pi(ky,js,"PgBigSerial53");class Dy extends(bs=Ov,ys=Nv,bs){constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new Ey(e,this.config)}}pi(Dy,ys,"PgBigSerial64Builder");class Ey extends(ws=Mv,Ns=Nv,ws){getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}}function Ay(e,s){const{name:t,config:a}=vy(e,s);return"number"===a.mode?new Ty(t):new Dy(t)}pi(Ey,Ns,"PgBigSerial64");class Py extends(Ss=Ov,Cs=Nv,Ss){constructor(e){super(e,"boolean","PgBoolean")}build(e){return new _y(e,this.config)}}pi(Py,Cs,"PgBooleanBuilder");class _y extends(ks=Mv,Ts=Nv,ks){getSQLType(){return"boolean"}}function Fy(e){return new Py(e??"")}pi(_y,Ts,"PgBoolean");class Ly extends(Es=Ov,Ds=Nv,Es){constructor(e,s){super(e,"string","PgChar"),this.config.length=s.length,this.config.enumValues=s.enum}build(e){return new Iy(e,this.config)}}pi(Ly,Ds,"PgCharBuilder");class Iy extends(Ps=Mv,As=Nv,Ps){constructor(){super(...arguments),pi(this,"length",this.config.length),pi(this,"enumValues",this.config.enumValues)}getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}function Ry(e,s={}){const{name:t,config:a}=vy(e,s);return new Ly(t,a)}pi(Iy,As,"PgChar");class qy extends(Fs=Ov,_s=Nv,Fs){constructor(e){super(e,"string","PgCidr")}build(e){return new Oy(e,this.config)}}pi(qy,_s,"PgCidrBuilder");class Oy extends(Is=Mv,Ls=Nv,Is){getSQLType(){return"cidr"}}function My(e){return new qy(e??"")}pi(Oy,Ls,"PgCidr");class Vy extends(qs=Ov,Rs=Nv,qs){constructor(e,s,t){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=s,this.config.customTypeParams=t}build(e){return new Uy(e,this.config)}}pi(Vy,Rs,"PgCustomColumnBuilder");class Uy extends(Ms=Mv,Os=Nv,Ms){constructor(e,s){super(e,s),pi(this,"sqlName"),pi(this,"mapTo"),pi(this,"mapFrom"),this.sqlName=s.customTypeParams.dataType(s.fieldConfig),this.mapTo=s.customTypeParams.toDriver,this.mapFrom=s.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return"function"==typeof this.mapFrom?this.mapFrom(e):e}mapToDriverValue(e){return"function"==typeof this.mapTo?this.mapTo(e):e}}function $y(e){return(s,t)=>{const{name:a,config:i}=vy(s,t);return new Vy(a,i,e)}}pi(Uy,Os,"PgCustomColumn");class zy extends(Us=Ov,Vs=Nv,Us){defaultNow(){return this.default(my`now()`)}}pi(zy,Vs,"PgDateColumnBaseBuilder");class By extends(zs=zy,$s=Nv,zs){constructor(e){super(e,"date","PgDate")}build(e){return new Ky(e,this.config)}}pi(By,$s,"PgDateBuilder");class Ky extends(Ks=Mv,Bs=Nv,Ks){getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}}pi(Ky,Bs,"PgDate");class Qy extends(Gs=zy,Qs=Nv,Gs){constructor(e){super(e,"string","PgDateString")}build(e){return new Gy(e,this.config)}}pi(Qy,Qs,"PgDateStringBuilder");class Gy extends(Hs=Mv,Ws=Nv,Hs){getSQLType(){return"date"}}function Wy(e,s){const{name:t,config:a}=vy(e,s);return"date"===(null==a?void 0:a.mode)?new By(t):new Qy(t)}pi(Gy,Ws,"PgDateString");class Hy extends(Js=Ov,Ys=Nv,Js){constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new Yy(e,this.config)}}pi(Hy,Ys,"PgDoublePrecisionBuilder");class Yy extends(Zs=Mv,Xs=Nv,Zs){getSQLType(){return"double precision"}mapFromDriverValue(e){return"string"==typeof e?Number.parseFloat(e):e}}function Jy(e){return new Hy(e??"")}pi(Yy,Xs,"PgDoublePrecision");class Xy extends(st=Ov,et=Nv,st){constructor(e){super(e,"string","PgInet")}build(e){return new Zy(e,this.config)}}pi(Xy,et,"PgInetBuilder");class Zy extends(at=Mv,tt=Nv,at){getSQLType(){return"inet"}}function eb(e){return new Xy(e??"")}pi(Zy,tt,"PgInet");class sb extends(nt=yy,it=Nv,nt){constructor(e){super(e,"number","PgInteger")}build(e){return new tb(e,this.config)}}pi(sb,it,"PgIntegerBuilder");class tb extends(lt=Mv,rt=Nv,lt){getSQLType(){return"integer"}mapFromDriverValue(e){return"string"==typeof e?Number.parseInt(e):e}}function ab(e){return new sb(e??"")}pi(tb,rt,"PgInteger");class ib extends(ot=Ov,ct=Nv,ot){constructor(e,s){super(e,"string","PgInterval"),this.config.intervalConfig=s}build(e){return new nb(e,this.config)}}pi(ib,ct,"PgIntervalBuilder");class nb extends(ut=Mv,dt=Nv,ut){constructor(){super(...arguments),pi(this,"fields",this.config.intervalConfig.fields),pi(this,"precision",this.config.intervalConfig.precision)}getSQLType(){return`interval${this.fields?` ${this.fields}`:""}${this.precision?`(${this.precision})`:""}`}}function rb(e,s={}){const{name:t,config:a}=vy(e,s);return new ib(t,a)}pi(nb,dt,"PgInterval");class lb extends(ht=Ov,mt=Nv,ht){constructor(e){super(e,"json","PgJson")}build(e){return new cb(e,this.config)}}pi(lb,mt,"PgJsonBuilder");class cb extends(pt=Mv,xt=Nv,pt){constructor(e,s){super(e,s)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e}}function ob(e){return new lb(e??"")}pi(cb,xt,"PgJson");class db extends(gt=Ov,ft=Nv,gt){constructor(e){super(e,"json","PgJsonb")}build(e){return new ub(e,this.config)}}pi(db,ft,"PgJsonbBuilder");class ub extends(vt=Mv,jt=Nv,vt){constructor(e,s){super(e,s)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{return e}return e}}function mb(e){return new db(e??"")}pi(ub,jt,"PgJsonb");class hb extends(bt=Ov,yt=Nv,bt){constructor(e){super(e,"array","PgLine")}build(e){return new xb(e,this.config)}}pi(hb,yt,"PgLineBuilder");class xb extends(wt=Mv,Nt=Nv,wt){getSQLType(){return"line"}mapFromDriverValue(e){const[s,t,a]=e.slice(1,-1).split(",");return[Number.parseFloat(s),Number.parseFloat(t),Number.parseFloat(a)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}}pi(xb,Nt,"PgLine");class pb extends(St=Ov,Ct=Nv,St){constructor(e){super(e,"json","PgLineABC")}build(e){return new fb(e,this.config)}}pi(pb,Ct,"PgLineABCBuilder");class fb extends(kt=Mv,Tt=Nv,kt){getSQLType(){return"line"}mapFromDriverValue(e){const[s,t,a]=e.slice(1,-1).split(",");return{a:Number.parseFloat(s),b:Number.parseFloat(t),c:Number.parseFloat(a)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}}function gb(e,s){const{name:t,config:a}=vy(e,s);return(null==a?void 0:a.mode)&&"tuple"!==a.mode?new pb(t):new hb(t)}pi(fb,Tt,"PgLineABC");class jb extends(Et=Ov,Dt=Nv,Et){constructor(e){super(e,"string","PgMacaddr")}build(e){return new vb(e,this.config)}}pi(jb,Dt,"PgMacaddrBuilder");class vb extends(Pt=Mv,At=Nv,Pt){getSQLType(){return"macaddr"}}function yb(e){return new jb(e??"")}pi(vb,At,"PgMacaddr");class bb extends(Ft=Ov,_t=Nv,Ft){constructor(e){super(e,"string","PgMacaddr8")}build(e){return new Nb(e,this.config)}}pi(bb,_t,"PgMacaddr8Builder");class Nb extends(It=Mv,Lt=Nv,It){getSQLType(){return"macaddr8"}}function wb(e){return new bb(e??"")}pi(Nb,Lt,"PgMacaddr8");class Cb extends(qt=Ov,Rt=Nv,qt){constructor(e,s,t){super(e,"string","PgNumeric"),this.config.precision=s,this.config.scale=t}build(e){return new Sb(e,this.config)}}pi(Cb,Rt,"PgNumericBuilder");class Sb extends(Mt=Mv,Ot=Nv,Mt){constructor(e,s){super(e,s),pi(this,"precision"),pi(this,"scale"),this.precision=s.precision,this.scale=s.scale}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function Tb(e,s){const{name:t,config:a}=vy(e,s);return new Cb(t,null==a?void 0:a.precision,null==a?void 0:a.scale)}pi(Sb,Ot,"PgNumeric");const kb=Tb;class Db extends(Ut=Ov,Vt=Nv,Ut){constructor(e){super(e,"array","PgPointTuple")}build(e){return new Eb(e,this.config)}}pi(Db,Vt,"PgPointTupleBuilder");class Eb extends(zt=Mv,$t=Nv,zt){getSQLType(){return"point"}mapFromDriverValue(e){if("string"==typeof e){const[s,t]=e.slice(1,-1).split(",");return[Number.parseFloat(s),Number.parseFloat(t)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}}pi(Eb,$t,"PgPointTuple");class Ab extends(Kt=Ov,Bt=Nv,Kt){constructor(e){super(e,"json","PgPointObject")}build(e){return new Pb(e,this.config)}}pi(Ab,Bt,"PgPointObjectBuilder");class Pb extends(Gt=Mv,Qt=Nv,Gt){getSQLType(){return"point"}mapFromDriverValue(e){if("string"==typeof e){const[s,t]=e.slice(1,-1).split(",");return{x:Number.parseFloat(s),y:Number.parseFloat(t)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}}function _b(e,s){const{name:t,config:a}=vy(e,s);return(null==a?void 0:a.mode)&&"tuple"!==a.mode?new Ab(t):new Db(t)}function Fb(e,s){const t=new ArrayBuffer(8),a=new DataView(t);for(let i=0;i<8;i++)a.setUint8(i,e[s+i]);return a.getFloat64(0,!0)}function Lb(e){const s=function(e){const s=[];for(let t=0;t<e.length;t+=2)s.push(Number.parseInt(e.slice(t,t+2),16));return new Uint8Array(s)}(e);let t=0;const a=s[t];t+=1;const i=new DataView(s.buffer),n=i.getUint32(t,1===a);if(t+=4,536870912&n&&(i.getUint32(t,1===a),t+=4),1==(65535&n)){const e=Fb(s,t);t+=8;const a=Fb(s,t);return t+=8,[e,a]}throw new Error("Unsupported geometry type")}pi(Pb,Qt,"PgPointObject");class Ib extends(Ht=Ov,Wt=Nv,Ht){constructor(e){super(e,"array","PgGeometry")}build(e){return new Rb(e,this.config)}}pi(Ib,Wt,"PgGeometryBuilder");class Rb extends(Jt=Mv,Yt=Nv,Jt){getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return Lb(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}}pi(Rb,Yt,"PgGeometry");class qb extends(Zt=Ov,Xt=Nv,Zt){constructor(e){super(e,"json","PgGeometryObject")}build(e){return new Ob(e,this.config)}}pi(qb,Xt,"PgGeometryObjectBuilder");class Ob extends(sa=Mv,ea=Nv,sa){getSQLType(){return"geometry(point)"}mapFromDriverValue(e){const s=Lb(e);return{x:s[0],y:s[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}}function Mb(e,s){const{name:t,config:a}=vy(e,s);return(null==a?void 0:a.mode)&&"tuple"!==a.mode?new qb(t):new Ib(t)}pi(Ob,ea,"PgGeometryObject");class Vb extends(aa=Ov,ta=Nv,aa){constructor(e,s){super(e,"number","PgReal"),this.config.length=s}build(e){return new Ub(e,this.config)}}pi(Vb,ta,"PgRealBuilder");class Ub extends(na=Mv,ia=Nv,na){constructor(e,s){super(e,s),pi(this,"mapFromDriverValue",(e=>"string"==typeof e?Number.parseFloat(e):e))}getSQLType(){return"real"}}function $b(e){return new Vb(e??"")}pi(Ub,ia,"PgReal");class zb extends(la=Ov,ra=Nv,la){constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Bb(e,this.config)}}pi(zb,ra,"PgSerialBuilder");class Bb extends(oa=Mv,ca=Nv,oa){getSQLType(){return"serial"}}function Kb(e){return new zb(e??"")}pi(Bb,ca,"PgSerial");class Qb extends(ua=yy,da=Nv,ua){constructor(e){super(e,"number","PgSmallInt")}build(e){return new Gb(e,this.config)}}pi(Qb,da,"PgSmallIntBuilder");class Gb extends(ha=Mv,ma=Nv,ha){constructor(){super(...arguments),pi(this,"mapFromDriverValue",(e=>"string"==typeof e?Number(e):e))}getSQLType(){return"smallint"}}function Wb(e){return new Qb(e??"")}pi(Gb,ma,"PgSmallInt");class Hb extends(pa=Ov,xa=Nv,pa){constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new Yb(e,this.config)}}pi(Hb,xa,"PgSmallSerialBuilder");class Yb extends(ga=Mv,fa=Nv,ga){getSQLType(){return"smallserial"}}function Jb(e){return new Hb(e??"")}pi(Yb,fa,"PgSmallSerial");class Xb extends(va=Ov,ja=Nv,va){constructor(e,s){super(e,"string","PgText"),this.config.enumValues=s.enum}build(e){return new Zb(e,this.config)}}pi(Xb,ja,"PgTextBuilder");class Zb extends(ba=Mv,ya=Nv,ba){constructor(){super(...arguments),pi(this,"enumValues",this.config.enumValues)}getSQLType(){return"text"}}function eN(e,s={}){const{name:t,config:a}=vy(e,s);return new Xb(t,a)}pi(Zb,ya,"PgText");class sN extends(wa=zy,Na=Nv,wa){constructor(e,s,t){super(e,"string","PgTime"),this.withTimezone=s,this.precision=t,this.config.withTimezone=s,this.config.precision=t}build(e){return new tN(e,this.config)}}pi(sN,Na,"PgTimeBuilder");class tN extends(Sa=Mv,Ca=Nv,Sa){constructor(e,s){super(e,s),pi(this,"withTimezone"),pi(this,"precision"),this.withTimezone=s.withTimezone,this.precision=s.precision}getSQLType(){return`time${void 0===this.precision?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function aN(e,s={}){const{name:t,config:a}=vy(e,s);return new sN(t,a.withTimezone??!1,a.precision)}pi(tN,Ca,"PgTime");class iN extends(ka=zy,Ta=Nv,ka){constructor(e,s,t){super(e,"date","PgTimestamp"),this.config.withTimezone=s,this.config.precision=t}build(e){return new nN(e,this.config)}}pi(iN,Ta,"PgTimestampBuilder");class nN extends(Ea=Mv,Da=Nv,Ea){constructor(e,s){super(e,s),pi(this,"withTimezone"),pi(this,"precision"),pi(this,"mapFromDriverValue",(e=>new Date(this.withTimezone?e:e+"+0000"))),pi(this,"mapToDriverValue",(e=>e.toISOString())),this.withTimezone=s.withTimezone,this.precision=s.precision}getSQLType(){return`timestamp${void 0===this.precision?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}}pi(nN,Da,"PgTimestamp");class rN extends(Pa=zy,Aa=Nv,Pa){constructor(e,s,t){super(e,"string","PgTimestampString"),this.config.withTimezone=s,this.config.precision=t}build(e){return new lN(e,this.config)}}pi(rN,Aa,"PgTimestampStringBuilder");class lN extends(Fa=Mv,_a=Nv,Fa){constructor(e,s){super(e,s),pi(this,"withTimezone"),pi(this,"precision"),this.withTimezone=s.withTimezone,this.precision=s.precision}getSQLType(){return`timestamp${void 0===this.precision?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function cN(e,s={}){const{name:t,config:a}=vy(e,s);return"string"===(null==a?void 0:a.mode)?new rN(t,a.withTimezone??!1,a.precision):new iN(t,(null==a?void 0:a.withTimezone)??!1,null==a?void 0:a.precision)}pi(lN,_a,"PgTimestampString");class oN extends(Ia=Ov,La=Nv,Ia){constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(my`gen_random_uuid()`)}build(e){return new dN(e,this.config)}}pi(oN,La,"PgUUIDBuilder");class dN extends(qa=Mv,Ra=Nv,qa){getSQLType(){return"uuid"}}function uN(e){return new oN(e??"")}pi(dN,Ra,"PgUUID");class mN extends(Ma=Ov,Oa=Nv,Ma){constructor(e,s){super(e,"string","PgVarchar"),this.config.length=s.length,this.config.enumValues=s.enum}build(e){return new hN(e,this.config)}}pi(mN,Oa,"PgVarcharBuilder");class hN extends(Ua=Mv,Va=Nv,Ua){constructor(){super(...arguments),pi(this,"length",this.config.length),pi(this,"enumValues",this.config.enumValues)}getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function xN(e,s={}){const{name:t,config:a}=vy(e,s);return new mN(t,a)}pi(hN,Va,"PgVarchar");class pN extends(za=Ov,$a=Nv,za){constructor(e,s){super(e,"string","PgBinaryVector"),this.config.dimensions=s.dimensions}build(e){return new fN(e,this.config)}}pi(pN,$a,"PgBinaryVectorBuilder");class fN extends(Ka=Mv,Ba=Nv,Ka){constructor(){super(...arguments),pi(this,"dimensions",this.config.dimensions)}getSQLType(){return`bit(${this.dimensions})`}}function gN(e,s){const{name:t,config:a}=vy(e,s);return new pN(t,a)}pi(fN,Ba,"PgBinaryVector");class jN extends(Ga=Ov,Qa=Nv,Ga){constructor(e,s){super(e,"array","PgHalfVector"),this.config.dimensions=s.dimensions}build(e){return new vN(e,this.config)}}pi(jN,Qa,"PgHalfVectorBuilder");class vN extends(Ha=Mv,Wa=Nv,Ha){constructor(){super(...arguments),pi(this,"dimensions",this.config.dimensions)}getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map((e=>Number.parseFloat(e)))}}function yN(e,s){const{name:t,config:a}=vy(e,s);return new jN(t,a)}pi(vN,Wa,"PgHalfVector");class bN extends(Ja=Ov,Ya=Nv,Ja){constructor(e,s){super(e,"string","PgSparseVector"),this.config.dimensions=s.dimensions}build(e){return new NN(e,this.config)}}pi(bN,Ya,"PgSparseVectorBuilder");class NN extends(Za=Mv,Xa=Nv,Za){constructor(){super(...arguments),pi(this,"dimensions",this.config.dimensions)}getSQLType(){return`sparsevec(${this.dimensions})`}}function wN(e,s){const{name:t,config:a}=vy(e,s);return new bN(t,a)}pi(NN,Xa,"PgSparseVector");class CN extends(si=Ov,ei=Nv,si){constructor(e,s){super(e,"array","PgVector"),this.config.dimensions=s.dimensions}build(e){return new SN(e,this.config)}}pi(CN,ei,"PgVectorBuilder");class SN extends(ai=Mv,ti=Nv,ai){constructor(){super(...arguments),pi(this,"dimensions",this.config.dimensions)}getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map((e=>Number.parseFloat(e)))}}function TN(e,s){const{name:t,config:a}=vy(e,s);return new CN(t,a)}pi(SN,ti,"PgVector");const kN=Symbol.for("drizzle:PgInlineForeignKeys"),DN=Symbol.for("drizzle:EnableRLS");class EN extends(ci=ay,li=Nv,ri=kN,ni=DN,ii=ay.Symbol.ExtraConfigBuilder,ci){constructor(){super(...arguments),pi(this,ri,[]),pi(this,ni,!1),pi(this,ii)}}function AN(e,s,t,a,i=e){const n=new EN(e,a,i),r="function"==typeof s?s({bigint:Sy,bigserial:Ay,boolean:Fy,char:Ry,cidr:My,customType:$y,date:Wy,doublePrecision:Jy,inet:eb,integer:ab,interval:rb,json:ob,jsonb:mb,line:gb,macaddr:yb,macaddr8:wb,numeric:Tb,point:_b,geometry:Mb,real:$b,serial:Kb,smallint:Wb,smallserial:Jb,text:eN,time:aN,timestamp:cN,uuid:uN,varchar:xN,bit:gN,halfvec:yN,sparsevec:wN,vector:TN}):s,l=Object.fromEntries(Object.entries(r).map((([e,s])=>{const t=s;t.setName(e);const a=t.build(n);return n[kN].push(...t.buildForeignKeys(a,n)),[e,a]}))),c=Object.fromEntries(Object.entries(r).map((([e,s])=>{const t=s;t.setName(e);return[e,t.buildExtraConfigColumn(n)]}))),o=Object.assign(n,l);return o[ay.Symbol.Columns]=l,o[ay.Symbol.ExtraConfigColumns]=c,t&&(o[EN.Symbol.ExtraConfigBuilder]=t),Object.assign(o,{enableRLS:()=>(o[EN.Symbol.EnableRLS]=!0,o)})}pi(EN,li,"PgTable"),pi(EN,"Symbol",Object.assign({},ay.Symbol,{InlineForeignKeys:kN,EnableRLS:DN}));const PN=(e,s,t)=>AN(e,s,t,void 0);oi=Nv;class _N{constructor(e,s){this.unique=e,this.name=s}on(...e){return new FN(e.map((e=>{if(wv(e,ly))return e;const s=new Uv(e.name,!!e.keyAsName,e.columnType,e.indexConfig);return e.indexConfig=JSON.parse(JSON.stringify(e.defaultConfig)),s})),this.unique,!1,this.name)}onOnly(...e){return new FN(e.map((e=>{if(wv(e,ly))return e;const s=new Uv(e.name,!!e.keyAsName,e.columnType,e.indexConfig);return e.indexConfig=e.defaultConfig,s})),this.unique,!0,this.name)}using(e,...s){return new FN(s.map((e=>{if(wv(e,ly))return e;const s=new Uv(e.name,!!e.keyAsName,e.columnType,e.indexConfig);return e.indexConfig=JSON.parse(JSON.stringify(e.defaultConfig)),s})),this.unique,!0,this.name,e)}}pi(_N,oi,"PgIndexBuilderOn"),di=Nv;class FN{constructor(e,s,t,a,i="btree"){pi(this,"config"),this.config={name:a,columns:e,unique:s,only:t,method:i}}concurrently(){return this.config.concurrently=!0,this}with(e){return this.config.with=e,this}where(e){return this.config.where=e,this}build(e){return new LN(this.config,e)}}pi(FN,di,"PgIndexBuilder"),ui=Nv;class LN{constructor(e,s){pi(this,"config"),this.config={...e,table:s}}}function IN(e){return new _N(!1,e)}pi(LN,ui,"PgIndex");const RN=-128,qN=127,ON=255,MN=-32768,VN=32767,UN=65535,$N=-8388608,zN=8388607,BN=16777215,KN=-2147483648,QN=2147483647,GN=4294967295,WN=-0x800000000000,HN=0x7fffffffffff,YN=0xffffffffffff,JN=-9223372036854775808n,XN=9223372036854775807n,ZN=18446744073709551615n;function ew(e,s){return s.includes(e.columnType)}const sw=Mc([Vc(),Uc(),$c(),zc()]),tw=Mc([sw,Bc(Qc()),Kc(Qc())]),aw=Gc((e=>e instanceof Buffer));function iw(e,s){const t=(null==s?void 0:s.zodInstance)??Hc,a=(null==s?void 0:s.coerce)??{};let i;return function(e){return"enumValues"in e&&Array.isArray(e.enumValues)&&e.enumValues.length>0}(e)&&(i=e.enumValues.length?t.enum(e.enumValues):t.string()),i||(ew(e,["PgGeometry","PgPointTuple"])?i=t.tuple([t.number(),t.number()]):ew(e,["PgGeometryObject","PgPointObject"])?i=t.object({x:t.number(),y:t.number()}):ew(e,["PgHalfVector","PgVector"])?(i=t.array(t.number()),i=e.dimensions?i.length(e.dimensions):i):ew(e,["PgLine"])?i=t.tuple([t.number(),t.number(),t.number()]):ew(e,["PgLineABC"])?i=t.object({a:t.number(),b:t.number(),c:t.number()}):ew(e,["PgArray"])?(i=t.array(iw(e.baseColumn,t)),i=e.size?i.length(e.size):i):"array"===e.dataType?i=t.array(t.any()):"number"===e.dataType?i=function(e,s,t){let a,i,n=e.getSQLType().includes("unsigned"),r=!1;ew(e,["MySqlTinyInt","SingleStoreTinyInt"])?(a=n?0:RN,i=n?ON:qN,r=!0):ew(e,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"])?(a=n?0:MN,i=n?UN:VN,r=!0):ew(e,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreMediumInt","SingleStoreFloat"])?(a=n?0:$N,i=n?BN:zN,r=ew(e,["MySqlMediumInt","SingleStoreMediumInt"])):ew(e,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"])?(a=n?0:KN,i=n?GN:QN,r=!0):ew(e,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"])?(a=n?0:WN,i=n?YN:HN):ew(e,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"])?(n=n||ew(e,["MySqlSerial","SingleStoreSerial"]),a=n?0:Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,r=!0):ew(e,["MySqlYear","SingleStoreYear"])?(a=1901,i=2155,r=!0):(a=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER);let l=!0===t||(null==t?void 0:t.number)?s.coerce.number():s.number();return l=l.min(a).max(i),r?l.int():l}(e,t,a):"bigint"===e.dataType?i=function(e,s,t){const a=e.getSQLType().includes("unsigned"),i=a?0n:JN,n=a?ZN:XN,r=!0===t||(null==t?void 0:t.bigint)?s.coerce.bigint():s.bigint();return r.min(i).max(n)}(e,t,a):"boolean"===e.dataType?i=!0===a||a.boolean?t.coerce.boolean():t.boolean():"date"===e.dataType?i=!0===a||a.date?t.coerce.date():t.date():"string"===e.dataType?i=function(e,s,t){if(ew(e,["PgUUID"]))return s.string().uuid();let a,i,n=!1;ew(e,["PgVarchar","SQLiteText"])?a=e.length:ew(e,["MySqlVarChar","SingleStoreVarChar"])?a=e.length??UN:ew(e,["MySqlText","SingleStoreText"])&&(a="longtext"===e.textType?GN:"mediumtext"===e.textType?BN:"text"===e.textType?UN:ON);ew(e,["PgChar","MySqlChar","SingleStoreChar"])&&(a=e.length,n=!0);ew(e,["PgBinaryVector"])&&(i=/^[01]+$/,a=e.dimensions);let r=!0===t||(null==t?void 0:t.string)?s.coerce.string():s.string();return r=i?r.regex(i):r,a&&n?r.length(a):a?r.max(a):r}(e,t,a):"json"===e.dataType?i=tw:"custom"===e.dataType?i=t.any():"buffer"===e.dataType&&(i=aw)),i||(i=t.any()),i}function nw(e){return iy(e)?e[ay.Symbol.Columns]:e[Wv].selectedFields}function rw(e,s,t,a){const i={};for(const[r,l]of Object.entries(e)){if(!wv(l,Cv)&&!wv(l,ly)&&!wv(l,ly.Aliased)&&"object"==typeof l){const e=iy(l)||"object"==typeof(n=l)&&null!==n&&py in n?nw(l):l;i[r]=rw(e,s[r]??{},t,a);continue}const e=s[r];if(void 0!==e&&"function"!=typeof e){i[r]=e;continue}const c=wv(l,Cv)?l:void 0,o=c?iw(c,a):Qc(),d="function"==typeof e?e(o):o;t.never(c)||(i[r]=d,c&&(t.nullable(c)&&(i[r]=i[r].nullable()),t.optional(c)&&(i[r]=i[r].optional())))}var n;return Wc(i)}const lw={never:e=>{var s,t;return"always"===(null==(s=null==e?void 0:e.generated)?void 0:s.type)||"always"===(null==(t=null==e?void 0:e.generatedIdentity)?void 0:t.type)},optional:e=>!e.notNull||e.notNull&&e.hasDefault,nullable:e=>!e.notNull},cw=(e,s)=>rw(nw(e),s??{},lw),ow=PN("users",{id:Kb("id").primaryKey(),username:eN("username").notNull().unique(),password:eN("password"),email:eN("email").notNull().unique(),firstName:eN("first_name").notNull(),lastName:eN("last_name").notNull(),role:eN("role").notNull().default("user"),authProvider:eN("auth_provider").notNull().default("local"),ldapId:eN("ldap_id").unique(),isActive:Fy("is_active").notNull().default(!0),createdAt:cN("created_at").notNull().defaultNow()}),dw=PN("user_settings",{id:Kb("id").primaryKey(),userId:ab("user_id").notNull().references((()=>ow.id)),emailNotifications:Fy("email_notifications").notNull().default(!0),pushNotifications:Fy("push_notifications").notNull().default(!1),contractReminders:Fy("contract_reminders").notNull().default(!0),financialAlerts:Fy("financial_alerts").notNull().default(!0),sessionTimeout:Fy("session_timeout").notNull().default(!0),darkMode:Fy("dark_mode").notNull().default(!1),theme:eN("theme").notNull().default("light"),timezone:eN("timezone").notNull().default("America/New_York"),language:eN("language").notNull().default("en"),currency:eN("currency").notNull().default("USD"),autoSaveForms:Fy("auto_save_forms").notNull().default(!0),dataExport:Fy("data_export").notNull().default(!0),apiAccess:Fy("api_access").notNull().default(!1),dataRetentionPeriod:eN("data_retention_period").notNull().default("5years"),updatedAt:cN("updated_at").notNull().defaultNow()}),uw=PN("company_settings",{id:Kb("id").primaryKey(),companyName:eN("company_name").notNull().default("MSSP Client Manager"),currency:eN("currency").notNull().default("USD"),timezone:eN("timezone").notNull().default("America/New_York"),fiscalYearStart:eN("fiscal_year_start").notNull().default("01-01"),dateFormat:eN("date_format").notNull().default("MM/DD/YYYY"),timeFormat:eN("time_format").notNull().default("12h"),logoUrl:eN("logo_url"),primaryColor:eN("primary_color").notNull().default("#3b82f6"),secondaryColor:eN("secondary_color").notNull().default("#64748b"),address:eN("address"),phone:eN("phone"),email:eN("email"),website:eN("website"),taxId:eN("tax_id"),registrationNumber:eN("registration_number"),emailNotificationsEnabled:Fy("email_notifications_enabled").notNull().default(!0),smsNotificationsEnabled:Fy("sms_notifications_enabled").notNull().default(!1),sessionTimeoutMinutes:ab("session_timeout_minutes").notNull().default(480),passwordExpiryDays:ab("password_expiry_days").notNull().default(90),maxLoginAttempts:ab("max_login_attempts").notNull().default(5),auditLogRetentionDays:ab("audit_log_retention_days").notNull().default(2555),backupRetentionDays:ab("backup_retention_days").notNull().default(365),apiRateLimit:ab("api_rate_limit").notNull().default(1e3),webhookRetryAttempts:ab("webhook_retry_attempts").notNull().default(3),advancedSearchEnabled:Fy("advanced_search_enabled").notNull().default(!0),auditLoggingEnabled:Fy("audit_logging_enabled").notNull().default(!0),dataExportEnabled:Fy("data_export_enabled").notNull().default(!0),ldapEnabled:Fy("ldap_enabled").notNull().default(!1),ldapUrl:eN("ldap_url"),ldapBindDn:eN("ldap_bind_dn"),ldapBindPassword:eN("ldap_bind_password"),ldapSearchBase:eN("ldap_search_base"),ldapSearchFilter:eN("ldap_search_filter").default("(uid={{username}})"),ldapUsernameAttribute:eN("ldap_username_attribute").default("uid"),ldapEmailAttribute:eN("ldap_email_attribute").default("mail"),ldapFirstNameAttribute:eN("ldap_first_name_attribute").default("givenName"),ldapLastNameAttribute:eN("ldap_last_name_attribute").default("sn"),ldapDefaultRole:eN("ldap_default_role").default("user"),ldapGroupSearchBase:eN("ldap_group_search_base"),ldapGroupSearchFilter:eN("ldap_group_search_filter"),ldapAdminGroup:eN("ldap_admin_group"),ldapManagerGroup:eN("ldap_manager_group"),ldapEngineerGroup:eN("ldap_engineer_group"),ldapConnectionTimeout:ab("ldap_connection_timeout").default(5e3),ldapSearchTimeout:ab("ldap_search_timeout").default(1e4),ldapCertificateVerification:Fy("ldap_certificate_verification").notNull().default(!0),updatedAt:cN("updated_at").notNull().defaultNow(),updatedBy:ab("updated_by").references((()=>ow.id))}),mw=PN("clients",{id:Kb("id").primaryKey(),name:eN("name").notNull(),shortName:eN("shortName"),domain:eN("domain"),industry:eN("industry"),companySize:eN("companySize"),status:eN("status").notNull().default("prospect"),source:eN("source"),address:eN("address"),website:eN("website"),notes:eN("notes"),deletedAt:cN("deletedAt"),createdAt:cN("createdAt").notNull().defaultNow(),updatedAt:cN("updatedAt").notNull().defaultNow()},(e=>{return[IN("idx_clients_active").on(e.deletedAt).where(my`${e.deletedAt} IS NULL`),IN("idx_clients_deleted_at").on(e.deletedAt),(s="clients_status_check",t=my`status = ANY (ARRAY['prospect'::text, 'active'::text, 'inactive'::text, 'suspended'::text, 'archived'::text])`,new gy(s,t))];var s,t})),hw=PN("client_contacts",{id:Kb("id").primaryKey(),clientId:ab("clientId").notNull().references((()=>mw.id)),name:eN("name").notNull(),email:eN("email").notNull(),phone:eN("phone"),title:eN("title"),isPrimary:Fy("isPrimary").notNull().default(!1),isActive:Fy("isActive").notNull().default(!0),createdAt:cN("createdAt").notNull().defaultNow()}),xw=PN("services",{id:Kb("id").primaryKey(),name:eN("name").notNull(),category:eN("category").notNull(),description:eN("description"),deliveryModel:eN("delivery_model").notNull(),basePrice:kb("base_price",{precision:10,scale:2}),pricingUnit:eN("pricing_unit"),scopeDefinitionTemplate:mb("scope_definition_template"),isActive:Fy("is_active").notNull().default(!0),createdAt:cN("created_at").notNull().defaultNow()}),pw=PN("service_scope_fields",{id:Kb("id").primaryKey(),serviceId:ab("service_id").references((()=>xw.id)),name:eN("name").notNull(),label:eN("label").notNull(),fieldType:eN("field_type").notNull(),isRequired:Fy("is_required").notNull().default(!1),displayOrder:ab("display_order").notNull().default(0),placeholderText:eN("placeholder_text"),helpText:eN("help_text"),defaultValue:eN("default_value"),selectOptions:mb("select_options"),validationRules:mb("validation_rules"),isActive:Fy("is_active").notNull().default(!0),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()}),fw=PN("contracts",{id:Kb("id").primaryKey(),clientId:ab("clientId").notNull().references((()=>mw.id)),name:eN("name").notNull(),startDate:cN("startDate").notNull(),endDate:cN("endDate").notNull(),autoRenewal:Fy("autoRenewal").notNull().default(!1),renewalTerms:eN("renewalTerms"),totalValue:kb("totalValue",{precision:12,scale:2}),status:eN("status").notNull().default("draft"),documentUrl:eN("documentUrl"),notes:eN("notes"),createdAt:cN("createdAt").notNull().defaultNow(),updatedAt:cN("updatedAt").notNull().defaultNow()}),gw=PN("service_scopes",{id:Kb("id").primaryKey(),contractId:ab("contract_id").notNull().references((()=>fw.id)),serviceId:ab("service_id").references((()=>xw.id)),scopeDefinition:mb("scope_definition"),safDocumentUrl:eN("saf_document_url"),safStartDate:cN("saf_start_date"),safEndDate:cN("saf_end_date"),safStatus:eN("saf_status").default("pending"),startDate:cN("start_date"),endDate:cN("end_date"),status:eN("status").default("active"),monthlyValue:kb("monthly_value",{precision:10,scale:2}),description:eN("description"),notes:eN("notes"),eps:ab("eps"),endpoints:ab("endpoints"),dataVolumeGb:kb("data_volume_gb",{precision:10,scale:2}),logSources:ab("log_sources"),firewallDevices:ab("firewall_devices"),pamUsers:ab("pam_users"),responseTimeMinutes:ab("response_time_minutes"),coverageHours:eN("coverage_hours"),serviceTier:eN("service_tier"),safId:ab("saf_id").references((()=>ww.id)),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()}),jw=PN("scope_variable_definitions",{id:Kb("id").primaryKey(),variableName:xN("variable_name",{length:100}).notNull().unique(),variableType:xN("variable_type",{length:20}).notNull(),displayName:xN("display_name",{length:200}).notNull(),description:eN("description"),isFilterable:Fy("is_filterable").default(!0),isIndexed:Fy("is_indexed").default(!1),filterComponent:xN("filter_component",{length:50}),unit:xN("unit",{length:20}),createdAt:cN("created_at").defaultNow()});PN("scope_variable_values",{id:Kb("id").primaryKey(),serviceScopeId:ab("service_scope_id").notNull().references((()=>gw.id),{onDelete:"cascade"}),variableName:xN("variable_name",{length:100}).notNull().references((()=>jw.variableName)),valueText:eN("value_text"),valueInteger:ab("value_integer"),valueDecimal:kb("value_decimal",{precision:15,scale:4}),valueBoolean:Fy("value_boolean"),createdAt:cN("created_at").defaultNow(),updatedAt:cN("updated_at").defaultNow()},(e=>({uniqueScope:Ev().on(e.serviceScopeId,e.variableName)})));const vw=PN("proposals",{id:Kb("id").primaryKey(),contractId:ab("contract_id").notNull().references((()=>fw.id)),type:eN("type").notNull(),version:eN("version").notNull().default("1.0"),status:eN("status").notNull().default("draft"),documentUrl:eN("document_url"),proposedValue:kb("proposed_value",{precision:12,scale:2}),notes:eN("notes"),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()}),yw=PN("license_pools",{id:Kb("id").primaryKey(),name:eN("name").notNull(),vendor:eN("vendor").notNull(),productName:eN("product_name").notNull(),licenseType:eN("license_type"),totalLicenses:ab("total_licenses").notNull(),availableLicenses:ab("available_licenses").notNull(),orderedLicenses:ab("ordered_licenses").notNull().default(0),costPerLicense:kb("cost_per_license",{precision:8,scale:2}),renewalDate:cN("renewal_date"),purchaseRequestNumber:eN("purchase_request_number"),purchaseOrderNumber:eN("purchase_order_number"),notes:eN("notes"),isActive:Fy("is_active").notNull().default(!0),createdAt:cN("created_at").notNull().defaultNow()}),bw=PN("client_licenses",{id:Kb("id").primaryKey(),clientId:ab("client_id").notNull().references((()=>mw.id)),licensePoolId:ab("license_pool_id").notNull().references((()=>yw.id)),serviceScopeId:ab("service_scope_id").references((()=>gw.id)),assignedLicenses:ab("assigned_licenses").notNull(),assignedDate:cN("assigned_date").notNull().defaultNow(),notes:eN("notes")}),Nw=PN("individual_licenses",{id:Kb("id").primaryKey(),clientId:ab("client_id").notNull().references((()=>mw.id)),serviceScopeId:ab("service_scope_id").references((()=>gw.id)),name:eN("name").notNull(),vendor:eN("vendor").notNull(),productName:eN("product_name").notNull(),licenseKey:eN("license_key"),licenseType:eN("license_type"),quantity:ab("quantity").notNull().default(1),costPerLicense:kb("cost_per_license",{precision:8,scale:2}),purchaseDate:cN("purchase_date"),expiryDate:cN("expiry_date"),renewalDate:cN("renewal_date"),purchaseRequestNumber:eN("purchase_request_number"),purchaseOrderNumber:eN("purchase_order_number"),documentUrl:eN("document_url"),status:eN("status").notNull().default("active"),notes:eN("notes"),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()}),ww=PN("service_authorization_forms",{id:Kb("id").primaryKey(),clientId:ab("client_id").references((()=>mw.id)).notNull(),contractId:ab("contract_id").references((()=>fw.id)).notNull(),serviceScopeId:ab("service_scope_id").references((()=>gw.id)),safNumber:eN("saf_number").notNull(),title:eN("title").notNull(),description:eN("description"),status:eN("status").default("pending"),requestedDate:cN("requested_date").notNull(),approvedDate:cN("approved_date"),expiryDate:cN("expiry_date"),approvedBy:ab("approved_by").references((()=>ow.id)),notes:eN("notes"),createdAt:cN("created_at").defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()}),Cw=PN("certificates_of_compliance",{id:Kb("id").primaryKey(),clientId:ab("client_id").references((()=>mw.id)).notNull(),contractId:ab("contract_id").references((()=>fw.id)),serviceScopeId:ab("service_scope_id").references((()=>gw.id)),safId:ab("saf_id").references((()=>ww.id)),cocNumber:eN("coc_number").notNull(),title:eN("title").notNull(),description:eN("description"),complianceType:eN("compliance_type").notNull(),issueDate:cN("issue_date").notNull(),expiryDate:cN("expiry_date"),status:eN("status").default("active"),documentUrl:eN("document_url"),issuedBy:ab("issued_by").references((()=>ow.id)),auditDate:cN("audit_date"),nextAuditDate:cN("next_audit_date"),notes:eN("notes"),createdAt:cN("created_at").defaultNow(),updatedAt:cN("updated_at").defaultNow()}),Sw=PN("hardware_assets",{id:Kb("id").primaryKey(),name:eN("name").notNull(),category:eN("category").notNull(),manufacturer:eN("manufacturer"),model:eN("model"),serialNumber:eN("serial_number").unique(),purchaseDate:cN("purchase_date"),purchaseCost:kb("purchase_cost",{precision:10,scale:2}),warrantyExpiry:cN("warranty_expiry"),status:eN("status").notNull().default("available"),location:eN("location"),purchaseRequestNumber:eN("purchase_request_number"),purchaseOrderNumber:eN("purchase_order_number"),notes:eN("notes"),createdAt:cN("created_at").notNull().defaultNow()}),Tw=PN("client_hardware_assignments",{id:Kb("id").primaryKey(),clientId:ab("client_id").notNull().references((()=>mw.id)),hardwareAssetId:ab("hardware_asset_id").notNull().references((()=>Sw.id)),serviceScopeId:ab("service_scope_id").references((()=>gw.id)),assignedDate:cN("assigned_date").notNull().defaultNow(),returnedDate:cN("returned_date"),installationLocation:eN("installation_location"),status:eN("status").notNull().default("active"),notes:eN("notes")}),kw=PN("financial_transactions",{id:Kb("id").primaryKey(),type:eN("type").notNull(),amount:kb("amount",{precision:12,scale:2}).notNull(),description:eN("description").notNull(),status:eN("status").notNull().default("pending"),clientId:ab("client_id").references((()=>mw.id)),contractId:ab("contract_id").references((()=>fw.id)),serviceScopeId:ab("service_scope_id").references((()=>gw.id)),licensePoolId:ab("license_pool_id").references((()=>yw.id)),hardwareAssetId:ab("hardware_asset_id").references((()=>Sw.id)),transactionDate:cN("transaction_date").notNull(),category:eN("category"),reference:eN("reference"),notes:eN("notes"),createdAt:cN("created_at").notNull().defaultNow()}),Dw=PN("client_team_assignments",{id:Kb("id").primaryKey(),clientId:ab("client_id").notNull().references((()=>mw.id)),userId:ab("user_id").notNull().references((()=>ow.id)),role:eN("role").notNull(),assignedDate:cN("assigned_date").notNull().defaultNow(),isActive:Fy("is_active").notNull().default(!0),notes:eN("notes")}),Ew=PN("custom_fields",{id:Kb("id").primaryKey(),entityType:eN("entity_type").notNull(),fieldName:eN("field_name").notNull(),fieldType:eN("field_type").notNull(),fieldOptions:mb("field_options"),isRequired:Fy("is_required").notNull().default(!1),isActive:Fy("is_active").notNull().default(!0),createdAt:cN("created_at").notNull().defaultNow()}),Aw=PN("custom_field_values",{id:Kb("id").primaryKey(),customFieldId:ab("custom_field_id").notNull().references((()=>Ew.id)),entityId:ab("entity_id").notNull(),value:eN("value"),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()});cw(ow).omit({id:!0,createdAt:!0});const Pw=cw(mw).omit({id:!0,createdAt:!0,updatedAt:!0});cw(hw).omit({id:!0,createdAt:!0});const _w=cw(xw).omit({id:!0,createdAt:!0});cw(fw,{startDate:Vc().transform((e=>new Date(e))),endDate:Vc().transform((e=>new Date(e)))}).omit({id:!0,createdAt:!0,updatedAt:!0}),cw(gw,{safStartDate:Vc().optional().transform((e=>e?new Date(e):void 0)),safEndDate:Vc().optional().transform((e=>e?new Date(e):void 0)),startDate:Vc().optional().transform((e=>e?new Date(e):void 0)),endDate:Vc().optional().transform((e=>e?new Date(e):void 0))}).omit({id:!0,createdAt:!0,updatedAt:!0}),cw(vw).omit({id:!0,createdAt:!0,updatedAt:!0});const Fw=cw(yw,{renewalDate:Vc().optional().transform((e=>e?new Date(e):void 0))}).omit({id:!0,createdAt:!0,availableLicenses:!0});cw(bw).omit({id:!0,assignedDate:!0}),cw(Nw,{purchaseDate:Vc().optional().transform((e=>e?new Date(e):void 0)),expiryDate:Vc().optional().transform((e=>e?new Date(e):void 0)),renewalDate:Vc().optional().transform((e=>e?new Date(e):void 0))}).omit({id:!0,createdAt:!0,updatedAt:!0}),cw(ww).omit({id:!0,createdAt:!0,updatedAt:!0}),cw(Cw,{issueDate:Vc().transform((e=>new Date(e))),expiryDate:Vc().optional().transform((e=>e?new Date(e):void 0)),auditDate:Vc().optional().transform((e=>e?new Date(e):void 0)),nextAuditDate:Vc().optional().transform((e=>e?new Date(e):void 0))}).omit({id:!0,createdAt:!0,updatedAt:!0}),cw(Sw,{purchaseDate:Vc().optional().transform((e=>e?new Date(e):void 0)),warrantyExpiry:Vc().optional().transform((e=>e?new Date(e):void 0))}).omit({id:!0,createdAt:!0}),cw(Tw).omit({id:!0,assignedDate:!0}),cw(kw,{transactionDate:Vc().transform((e=>new Date(e)))}).omit({id:!0,createdAt:!0}),cw(Dw).omit({id:!0,assignedDate:!0}),cw(Ew).omit({id:!0,createdAt:!0}),cw(Aw).omit({id:!0,createdAt:!0,updatedAt:!0});const Lw=PN("documents",{id:Kb("id").primaryKey(),name:eN("name").notNull(),description:eN("description"),documentType:eN("document_type").notNull(),fileName:eN("file_name").notNull(),filePath:eN("file_path").notNull(),fileSize:ab("file_size").notNull(),mimeType:eN("mime_type").notNull(),version:ab("version").notNull().default(1),isActive:Fy("is_active").notNull().default(!0),clientId:ab("client_id").references((()=>mw.id)),contractId:ab("contract_id").references((()=>fw.id)),tags:eN("tags").array(),expirationDate:cN("expiration_date"),complianceType:eN("compliance_type"),uploadedBy:ab("uploaded_by").notNull().references((()=>ow.id)),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()}),Iw=PN("document_versions",{id:Kb("id").primaryKey(),documentId:ab("document_id").notNull().references((()=>Lw.id)),version:ab("version").notNull(),fileName:eN("file_name").notNull(),filePath:eN("file_path").notNull(),fileSize:ab("file_size").notNull(),changeNotes:eN("change_notes"),uploadedBy:ab("uploaded_by").notNull().references((()=>ow.id)),createdAt:cN("created_at").notNull().defaultNow()}),Rw=PN("document_access",{id:Kb("id").primaryKey(),documentId:ab("document_id").notNull().references((()=>Lw.id)),userId:ab("user_id").notNull().references((()=>ow.id)),accessType:eN("access_type").notNull(),grantedBy:ab("granted_by").notNull().references((()=>ow.id)),grantedAt:cN("granted_at").notNull().defaultNow(),expiresAt:cN("expires_at")});cw(Lw).omit({id:!0,createdAt:!0,updatedAt:!0}),cw(Iw).omit({id:!0,createdAt:!0}),cw(Rw).omit({id:!0,grantedAt:!0}),cw(dw).omit({id:!0,updatedAt:!0}),cw(uw).omit({id:!0,updatedAt:!0}),cw(uw).omit({id:!0,updatedAt:!0,updatedBy:!0}).partial(),PN("user_dashboard_settings",{id:Kb("id").primaryKey(),userId:ab("user_id").notNull().references((()=>ow.id),{onDelete:"cascade"}),cardId:eN("card_id").notNull(),title:eN("title").notNull(),type:eN("type").notNull(),category:eN("category").notNull().default("dashboard"),dataSource:eN("data_source").notNull(),size:eN("size").notNull().default("small"),visible:Fy("visible").notNull().default(!0),position:ab("position").notNull().default(0),config:mb("config").notNull().default("{}"),isBuiltIn:Fy("is_built_in").notNull().default(!1),isRemovable:Fy("is_removable").notNull().default(!0),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()},(e=>({userCardUnique:Ev().on(e.userId,e.cardId)}))),PN("client_external_mappings",{id:Kb("id").primaryKey(),clientId:ab("client_id").notNull().references((()=>mw.id),{onDelete:"cascade"}),systemName:eN("system_name").notNull(),externalIdentifier:eN("external_identifier").notNull(),metadata:mb("metadata"),isActive:Fy("is_active").notNull().default(!0),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()}),PN("saved_searches",{id:Kb("id").primaryKey(),userId:ab("user_id").notNull().references((()=>ow.id)),name:eN("name").notNull(),description:eN("description"),searchConfig:eN("search_config").notNull(),entityTypes:eN("entity_types").array().notNull(),isPublic:Fy("is_public").notNull().default(!1),isQuickFilter:Fy("is_quick_filter").notNull().default(!1),useCount:ab("use_count").notNull().default(0),lastUsed:cN("last_used"),tags:eN("tags").array(),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()}),PN("search_history",{id:Kb("id").primaryKey(),userId:ab("user_id").notNull().references((()=>ow.id)),searchQuery:eN("search_query").notNull(),searchConfig:eN("search_config"),entityTypes:eN("entity_types").array().notNull(),resultsCount:ab("results_count").notNull().default(0),executionTime:ab("execution_time"),createdAt:cN("created_at").notNull().defaultNow()}),PN("global_search_index",{id:Kb("id").primaryKey(),entityType:eN("entity_type").notNull(),entityId:ab("entity_id").notNull(),searchContent:eN("search_content").notNull(),keywords:eN("keywords").array(),lastIndexed:cN("last_indexed").notNull().defaultNow()});const qw=PN("audit_logs",{id:Kb("id").primaryKey(),userId:ab("user_id").references((()=>ow.id)),sessionId:eN("session_id"),action:eN("action").notNull(),entityType:eN("entity_type").notNull(),entityId:ab("entity_id"),entityName:eN("entity_name"),description:eN("description").notNull(),ipAddress:eN("ip_address"),userAgent:eN("user_agent"),severity:eN("severity").notNull().default("info"),category:eN("category").notNull(),metadata:mb("metadata"),timestamp:cN("timestamp").notNull().defaultNow()}),Ow=PN("change_history",{id:Kb("id").primaryKey(),entityType:eN("entity_type").notNull(),entityId:ab("entity_id").notNull(),entityName:eN("entity_name"),userId:ab("user_id").notNull().references((()=>ow.id)),action:eN("action").notNull(),fieldName:eN("field_name"),oldValue:eN("old_value"),newValue:eN("new_value"),changeReason:eN("change_reason"),automaticChange:Fy("automatic_change").notNull().default(!1),batchId:eN("batch_id"),rollbackData:mb("rollback_data"),ipAddress:eN("ip_address"),userAgent:eN("user_agent"),timestamp:cN("timestamp").notNull().defaultNow()}),Mw=PN("security_events",{id:Kb("id").primaryKey(),userId:ab("user_id").references((()=>ow.id)),eventType:eN("event_type").notNull(),source:eN("source").notNull(),ipAddress:eN("ip_address").notNull(),userAgent:eN("user_agent"),location:eN("location"),deviceFingerprint:eN("device_fingerprint"),success:Fy("success").notNull(),failureReason:eN("failure_reason"),riskScore:ab("risk_score"),blocked:Fy("blocked").notNull().default(!1),entityType:eN("entity_type"),entityId:ab("entity_id"),metadata:mb("metadata"),timestamp:cN("timestamp").notNull().defaultNow()}),Vw=PN("data_access_logs",{id:Kb("id").primaryKey(),userId:ab("user_id").notNull().references((()=>ow.id)),entityType:eN("entity_type").notNull(),entityId:ab("entity_id"),entityName:eN("entity_name"),accessType:eN("access_type").notNull(),accessMethod:eN("access_method").notNull(),dataScope:eN("data_scope"),filters:mb("filters"),resultCount:ab("result_count"),sensitiveData:Fy("sensitive_data").notNull().default(!1),purpose:eN("purpose"),ipAddress:eN("ip_address"),userAgent:eN("user_agent"),sessionDuration:ab("session_duration"),timestamp:cN("timestamp").notNull().defaultNow()}),Uw=PN("system_events",{id:Kb("id").primaryKey(),eventType:eN("event_type").notNull(),source:eN("source").notNull(),severity:eN("severity").notNull(),category:eN("category").notNull(),description:eN("description").notNull(),details:mb("details"),affectedEntities:mb("affected_entities"),resolution:eN("resolution"),resolvedAt:cN("resolved_at"),timestamp:cN("timestamp").notNull().defaultNow()});cw(qw).omit({id:!0,timestamp:!0}),cw(Ow).omit({id:!0,timestamp:!0}),cw(Mw).omit({id:!0,timestamp:!0}),cw(Vw).omit({id:!0,timestamp:!0}),cw(Uw).omit({id:!0,timestamp:!0}),PN("client_satisfaction_surveys",{id:Kb("id").primaryKey(),clientId:ab("client_id").references((()=>mw.id)).notNull(),contractId:ab("contract_id").references((()=>fw.id)),serviceScopeId:ab("service_scope_id").references((()=>gw.id)),surveyDate:cN("survey_date").notNull(),surveyType:eN("survey_type").notNull(),overallSatisfaction:ab("overall_satisfaction").notNull(),serviceQuality:ab("service_quality"),responseTime:ab("response_time"),communication:ab("communication"),technicalExpertise:ab("technical_expertise"),valueForMoney:ab("value_for_money"),likelihood_to_recommend:ab("likelihood_to_recommend"),feedback:eN("feedback"),improvements:eN("improvements"),compliments:eN("compliments"),concerns:eN("concerns"),status:eN("status").default("completed"),conductedBy:ab("conducted_by").references((()=>ow.id)),createdAt:cN("created_at").defaultNow(),updatedAt:cN("updated_at").defaultNow()}),PN("client_feedback",{id:Kb("id").primaryKey(),clientId:ab("client_id").references((()=>mw.id)).notNull(),contractId:ab("contract_id").references((()=>fw.id)),serviceScopeId:ab("service_scope_id").references((()=>gw.id)),feedbackDate:cN("feedback_date").defaultNow(),feedbackType:eN("feedback_type").notNull(),category:eN("category"),priority:eN("priority").default("medium"),title:eN("title").notNull(),description:eN("description").notNull(),contactMethod:eN("contact_method"),satisfactionRating:ab("satisfaction_rating"),status:eN("status").default("open"),assignedTo:ab("assigned_to").references((()=>ow.id)),resolvedBy:ab("resolved_by").references((()=>ow.id)),resolvedAt:cN("resolved_at"),resolutionNotes:eN("resolution_notes"),followUpRequired:Fy("follow_up_required").default(!1),followUpDate:cN("follow_up_date"),internalNotes:eN("internal_notes"),createdAt:cN("created_at").defaultNow(),updatedAt:cN("updated_at").defaultNow()});cw(PN("page_permissions",{id:Kb("id").primaryKey(),pageName:eN("page_name").notNull().unique(),pageUrl:eN("page_url").notNull(),displayName:eN("display_name").notNull(),description:eN("description"),category:eN("category").notNull().default("main"),icon:eN("icon"),adminAccess:Fy("admin_access").notNull().default(!0),managerAccess:Fy("manager_access").notNull().default(!1),engineerAccess:Fy("engineer_access").notNull().default(!1),userAccess:Fy("user_access").notNull().default(!1),requiresSpecialPermission:Fy("requires_special_permission").notNull().default(!1),isActive:Fy("is_active").notNull().default(!0),sortOrder:ab("sort_order").notNull().default(0),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()})),cw(pw,{selectOptions:Kc(Vc()).optional(),validationRules:Wc({min:Uc().optional(),max:Uc().optional()}).optional()}).omit({id:!0,createdAt:!0,updatedAt:!0}),PN("schema_versions",{id:Kb("id").primaryKey(),scriptVersion:eN("script_version"),appVersion:eN("app_version"),schemaVersion:eN("schema_version"),version:eN("version").notNull(),appliedAt:cN("applied_at").defaultNow(),createdAt:cN("created_at").notNull().defaultNow(),environment:eN("environment"),notes:eN("notes"),migrationFile:eN("migration_file"),description:eN("description")});cw(PN("field_visibility_config",{id:Kb("id").primaryKey(),tableName:eN("table_name").notNull(),fieldName:eN("field_name").notNull(),isVisible:Fy("is_visible").notNull().default(!0),context:eN("context").notNull().default("form"),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()},(e=>[Ev("field_visibility_unique").on(e.tableName,e.fieldName,e.context),IN("idx_field_visibility_table_context").on(e.tableName,e.context)])));cw(PN("saved_queries",{id:Kb("id").primaryKey(),userId:ab("user_id").notNull().references((()=>ow.id)),pluginName:eN("plugin_name").notNull(),instanceId:eN("instance_id").notNull(),name:eN("name").notNull(),description:eN("description"),query:eN("query").notNull(),method:eN("method").notNull().default("GET"),tags:mb("tags"),isPublic:Fy("is_public").notNull().default(!1),executionCount:ab("execution_count").notNull().default(0),lastExecutedAt:cN("last_executed_at"),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()},(e=>[IN("idx_saved_queries_user_plugin").on(e.userId,e.pluginName),IN("idx_saved_queries_public").on(e.isPublic).where(my`${e.isPublic} = true`)]))).omit({id:!0,executionCount:!0,lastExecutedAt:!0,createdAt:!0,updatedAt:!0});cw(PN("custom_widgets",{id:Kb("id").primaryKey(),userId:ab("user_id").notNull().references((()=>ow.id)),name:eN("name").notNull(),description:eN("description"),pluginName:eN("plugin_name").notNull(),instanceId:eN("instance_id").notNull(),queryType:eN("query_type").notNull().default("default"),queryId:eN("query_id"),customQuery:eN("custom_query"),queryMethod:eN("query_method").notNull().default("GET"),queryParameters:mb("query_parameters").notNull().default("{}"),displayType:eN("display_type").notNull().default("table"),chartType:eN("chart_type"),refreshInterval:ab("refresh_interval").notNull().default(30),placement:eN("placement").notNull().default("client-details"),styling:mb("styling").notNull().default('{"width":"full","height":"medium","showBorder":true,"showHeader":true}'),groupBy:mb("group_by"),isActive:Fy("is_active").notNull().default(!0),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()},(e=>[IN("idx_custom_widgets_user").on(e.userId),IN("idx_custom_widgets_placement").on(e.placement)]))).omit({id:!0,createdAt:!0,updatedAt:!0});cw(PN("user_preferences",{id:Kb("id").primaryKey(),userId:ab("user_id").notNull().references((()=>ow.id)),preferenceType:eN("preference_type").notNull(),preferenceKey:eN("preference_key").notNull(),preferenceValue:mb("preference_value").notNull(),createdAt:cN("created_at").notNull().defaultNow(),updatedAt:cN("updated_at").notNull().defaultNow()},(e=>[Ev("user_preference_unique").on(e.userId,e.preferenceType,e.preferenceKey),IN("idx_user_preferences_lookup").on(e.userId,e.preferenceType,e.preferenceKey)]))).omit({id:!0,createdAt:!0,updatedAt:!0});const $w=Jc,zw=$n.createContext({}),Bw=({...e})=>Si.jsx(zw.Provider,{value:{name:e.name},children:Si.jsx(Xc,{...e})}),Kw=()=>{const e=$n.useContext(zw),s=$n.useContext(Qw),{getFieldState:t,formState:a}=Yc(),i=t(e.name,a);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:n}=s;return{id:n,name:e.name,formItemId:`${n}-form-item`,formDescriptionId:`${n}-form-item-description`,formMessageId:`${n}-form-item-message`,...i}},Qw=$n.createContext({}),Gw=$n.forwardRef((({className:e,...s},t)=>{const a=$n.useId();return Si.jsx(Qw.Provider,{value:{id:a},children:Si.jsx("div",{ref:t,className:Lu("space-y-2",e),...s})})}));Gw.displayName="FormItem";const Ww=$n.forwardRef((({className:e,...s},t)=>{const{error:a,formItemId:i}=Kw();return Si.jsx(Op,{ref:t,className:Lu(a&&"text-destructive",e),htmlFor:i,...s})}));Ww.displayName="FormLabel";const Hw=$n.forwardRef((({...e},s)=>{const{error:t,formItemId:a,formDescriptionId:i,formMessageId:n}=Kw();return Si.jsx(Qi,{ref:s,id:a,"aria-describedby":t?`${i} ${n}`:`${i}`,"aria-invalid":!!t,...e})}));Hw.displayName="FormControl";const Yw=$n.forwardRef((({className:e,...s},t)=>{const{formDescriptionId:a}=Kw();return Si.jsx("p",{ref:t,id:a,className:Lu("text-sm text-muted-foreground",e),...s})}));Yw.displayName="FormDescription";const Jw=$n.forwardRef((({className:e,children:s,...t},a)=>{const{error:i,formMessageId:n}=Kw(),r=i?String((null==i?void 0:i.message)??""):s;return r?Si.jsx("p",{ref:a,id:n,className:Lu("text-sm font-medium text-destructive",e),...t,children:r}):null}));function Xw(e,s="form"){const[t,a]=$n.useState({}),[i,n]=$n.useState(!0),[r,l]=$n.useState(null);$n.useEffect((()=>{(async()=>{try{n(!0);const t=await fetch(`/api/field-visibility/${e}?context=${s}`);if(!t.ok)throw new Error("Failed to load field visibility configuration");const i=await t.json();a(i),l(null)}catch(t){l(t instanceof Error?t.message:"Unknown error")}finally{n(!1)}})()}),[e,s]);return{isFieldVisible:e=>!1!==t[e],setFieldVisibility:async(t,i)=>{try{if(!(await fetch("/api/field-visibility",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:e,fieldName:t,isVisible:i,context:s})})).ok)throw new Error("Failed to update field visibility");a((e=>({...e,[t]:i}))),l(null)}catch(n){throw l(n instanceof Error?n.message:"Unknown error"),n}},resetFieldVisibility:async t=>{try{if(!(await fetch(`/api/field-visibility/${e}/${t}?context=${s}`,{method:"DELETE"})).ok)throw new Error("Failed to reset field visibility");a((e=>{const s={...e};return delete s[t],s})),l(null)}catch(i){throw l(i instanceof Error?i.message:"Unknown error"),i}},fieldVisibilityConfig:t,loading:i,error:r}}function Zw({client:e,onSubmit:s,onCancel:t,isLoading:a}){const{isFieldVisible:i}=Xw("clients","form"),n=Zc({resolver:bv(Pw),defaultValues:{name:(null==e?void 0:e.name)||"",shortName:(null==e?void 0:e.shortName)||"",domain:(null==e?void 0:e.domain)||"",industry:(null==e?void 0:e.industry)||"",companySize:(null==e?void 0:e.companySize)||"",status:(null==e?void 0:e.status)||"prospect",source:(null==e?void 0:e.source)||"",address:(null==e?void 0:e.address)||"",website:(null==e?void 0:e.website)||"",notes:(null==e?void 0:e.notes)||""}});return Si.jsx($w,{...n,children:Si.jsxs("form",{onSubmit:n.handleSubmit((e=>{s(e)})),className:"flex flex-col h-full",children:[Si.jsx(Lp,{children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i("name")&&Si.jsx(Bw,{control:n.control,name:"name",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Client Name *"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"Enter client name",...e})}),Si.jsx(Jw,{})]})}),i("shortName")&&Si.jsx(Bw,{control:n.control,name:"shortName",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Short Name"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"Enter short name (e.g., ACME)",...e,value:e.value||""})}),Si.jsx(Jw,{})]})}),i("domain")&&Si.jsx(Bw,{control:n.control,name:"domain",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Domain"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"Enter domain (e.g., company.com)",...e,value:e.value||""})}),Si.jsx(Jw,{})]})}),i("industry")&&Si.jsx(Bw,{control:n.control,name:"industry",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Industry"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select industry"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"healthcare",children:"Healthcare"}),Si.jsx(Hp,{value:"finance",children:"Finance"}),Si.jsx(Hp,{value:"manufacturing",children:"Manufacturing"}),Si.jsx(Hp,{value:"technology",children:"Technology"}),Si.jsx(Hp,{value:"retail",children:"Retail"}),Si.jsx(Hp,{value:"education",children:"Education"}),Si.jsx(Hp,{value:"government",children:"Government"})]})]}),Si.jsx(Jw,{})]})}),i("companySize")&&Si.jsx(Bw,{control:n.control,name:"companySize",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Company Size"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select company size"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"small",children:"Small (1-50 employees)"}),Si.jsx(Hp,{value:"medium",children:"Medium (51-200 employees)"}),Si.jsx(Hp,{value:"large",children:"Large (201-1000 employees)"}),Si.jsx(Hp,{value:"enterprise",children:"Enterprise (1000+ employees)"})]})]}),Si.jsx(Jw,{})]})}),i("status")&&Si.jsx(Bw,{control:n.control,name:"status",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Status"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select status"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"prospect",children:"Prospect"}),Si.jsx(Hp,{value:"active",children:"Active"}),Si.jsx(Hp,{value:"inactive",children:"Inactive"}),Si.jsx(Hp,{value:"archived",children:"Archived"})]})]}),Si.jsx(Jw,{})]})}),i("source")&&Si.jsx(Bw,{control:n.control,name:"source",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Source"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select source"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"nca",children:"NCA"}),Si.jsx(Hp,{value:"direct",children:"Direct"}),Si.jsx(Hp,{value:"both",children:"Both"})]})]}),Si.jsx(Jw,{})]})}),i("website")&&Si.jsx(Bw,{control:n.control,name:"website",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Website"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"Enter website URL",...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]}),i("address")&&Si.jsx(Bw,{control:n.control,name:"address",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Address"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Enter company address",className:"resize-none",rows:2,...e,value:e.value||""})}),Si.jsx(Jw,{})]})}),i("notes")&&Si.jsx(Bw,{control:n.control,name:"notes",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Notes"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Additional notes about this client",className:"resize-none",rows:3,...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]})}),Si.jsxs(Pp,{children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:t,children:"Cancel"}),Si.jsx(Ex,{type:"submit",disabled:a,children:a?"Saving...":e?"Update Client":"Create Client"})]})]})})}Jw.displayName="FormMessage";const eC=Mn,sC=Vn;$n.forwardRef((({className:e,inset:s,children:t,...a},i)=>Si.jsxs(En,{ref:i,className:Lu("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",e),...a,children:[t,Si.jsx(fl,{className:"ml-auto"})]}))).displayName=En.displayName;$n.forwardRef((({className:e,...s},t)=>Si.jsx(An,{ref:t,className:Lu("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",e),...s}))).displayName=An.displayName;const tC=$n.forwardRef((({className:e,sideOffset:s=4,...t},a)=>Si.jsx(Pn,{children:Si.jsx(_n,{ref:a,sideOffset:s,className:Lu("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",e),...t})})));tC.displayName=_n.displayName;$n.forwardRef((({className:e,inset:s,...t},a)=>Si.jsx(Fn,{ref:a,className:Lu("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",s&&"pl-8",e),...t}))).displayName=Fn.displayName;$n.forwardRef((({className:e,children:s,checked:t,...a},i)=>Si.jsxs(Ln,{ref:i,className:Lu("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:t,...a,children:[Si.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:Si.jsx(In,{children:Si.jsx(Jr,{className:"h-4 w-4"})})}),s]}))).displayName=Ln.displayName;$n.forwardRef((({className:e,children:s,...t},a)=>Si.jsxs(Rn,{ref:a,className:Lu("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...t,children:[Si.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:Si.jsx(In,{children:Si.jsx(Fl,{className:"h-2 w-2 fill-current"})})}),s]}))).displayName=Rn.displayName;const aC=$n.forwardRef((({className:e,inset:s,...t},a)=>Si.jsx(qn,{ref:a,className:Lu("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",e),...t})));aC.displayName=qn.displayName;const iC=$n.forwardRef((({className:e,...s},t)=>Si.jsx(On,{ref:t,className:Lu("-mx-1 my-1 h-px bg-muted",e),...s})));function nC({columns:e,visibleColumns:s,onVisibilityChange:t,onReset:a}){const i=Object.values(s).filter(Boolean).length;return Si.jsxs(eC,{children:[Si.jsx(sC,{asChild:!0,children:Si.jsxs(Ex,{variant:"outline",size:"sm",children:[Si.jsx(Ll,{className:"h-4 w-4 mr-2"}),"Columns (",i,")"]})}),Si.jsxs(tC,{align:"end",className:"w-56",children:[Si.jsx(aC,{children:"Show/Hide Columns"}),Si.jsx(iC,{}),Si.jsx("div",{className:"px-2 py-1 space-y-2 max-h-64 overflow-y-auto",children:e.map((e=>{const a=s[e.key]??e.defaultVisible,i=e.mandatory;return Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx($f,{id:`column-${e.key}`,checked:a,onCheckedChange:s=>((e,s)=>{t(e,s)})(e.key,s),disabled:i}),Si.jsxs(Op,{htmlFor:`a${e.key}`,className:"text-sm flex-1 "+(i?"text-muted-foreground":""),children:[e.label,i&&Si.jsx("span",{className:"ml-1 text-xs",children:"(required)"})]})]},e.key)}))}),a&&Si.jsxs(Si.Fragment,{children:[Si.jsx(iC,{}),Si.jsx("div",{className:"px-2 py-1",children:Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{a&&a()},className:"w-full text-xs",children:"Reset to Default"})})]})]})]})}function rC({storageKey:e,columns:s}){const t=$n.useCallback((()=>s.reduce(((e,s)=>(e[s.key]=s.defaultVisible,e)),{})),[s]),[a,i]=$n.useState((()=>{try{const s=localStorage.getItem(e);if(s){const e=JSON.parse(s);return{...t(),...e}}}catch(s){}return t()}));$n.useEffect((()=>{try{localStorage.setItem(e,JSON.stringify(a))}catch(s){}}),[e,a]);const n=$n.useCallback(((e,s)=>{i((t=>({...t,[e]:s})))}),[]),r=$n.useCallback((()=>{const e=t();i(e)}),[t]),l=$n.useCallback((e=>{const t=s.find((s=>s.key===e));return a[e]??(null==t?void 0:t.defaultVisible)??!1}),[a,s]);return{visibleColumns:a,handleVisibilityChange:n,resetToDefaults:r,isColumnVisible:l}}function lC(){const[e,s]=$n.useState(""),[t,a]=$n.useState("all"),[i,n]=$n.useState("all"),[r,l]=$n.useState(new Set),[c,o]=$n.useState(!1),[d,u]=$n.useState(null),[m,h]=$n.useState({});Oo();const{toast:x}=sd(),[p,f]=$n.useState(!1),[g,j]=$n.useState(null),[v,y]=$n.useState(!1),[b,N]=$n.useState(null),w=dh(),C=[{key:"checkbox",label:"Select",defaultVisible:!0,mandatory:!0},{key:"name",label:"Name",defaultVisible:!0,mandatory:!0},{key:"shortName",label:"Short Name",defaultVisible:!0,mandatory:!0},{key:"domain",label:"Domain",defaultVisible:!0,mandatory:!0},{key:"industry",label:"Industry",defaultVisible:!0},{key:"companySize",label:"Company Size",defaultVisible:!1},{key:"contractsCount",label:"Contracts",defaultVisible:!1},{key:"servicesCount",label:"Services",defaultVisible:!1},{key:"licensesCount",label:"Licenses",defaultVisible:!1},{key:"status",label:"Status",defaultVisible:!0},{key:"source",label:"Source",defaultVisible:!0},{key:"address",label:"Address",defaultVisible:!1},{key:"website",label:"Website",defaultVisible:!1},{key:"createdAt",label:"Created",defaultVisible:!0},{key:"updatedAt",label:"Updated",defaultVisible:!0,mandatory:!0},{key:"actions",label:"Actions",defaultVisible:!0,mandatory:!0}],{visibleColumns:S,handleVisibilityChange:T,resetToDefaults:k,isColumnVisible:D}=rC({storageKey:"clients-table-columns",columns:C}),{data:E=[],isLoading:A}=fh({queryKey:["/api/clients"],queryFn:async()=>{const e=await vh("GET","/api/clients");return await e.json()}}),{data:P=[],isLoading:_,error:F}=fh({queryKey:["/api/clients/archived"],queryFn:async()=>{const e=await vh("GET","/api/clients/archived");if(!e.ok)throw new Error(`Failed to fetch archived clients: ${e.statusText}`);return await e.json()},enabled:p,retry:2}),L=(p?P:E).filter((s=>{var a,i,n,r;return!!(s.name.toLowerCase().includes(e.toLowerCase())||(null==(a=s.shortName)?void 0:a.toLowerCase().includes(e.toLowerCase()))||(null==(i=s.domain)?void 0:i.toLowerCase().includes(e.toLowerCase()))||(null==(n=s.industry)?void 0:n.toLowerCase().includes(e.toLowerCase()))||(null==(r=s.address)?void 0:r.toLowerCase().includes(e.toLowerCase())))&&(p?"archived"===s.status||s.deletedAt:"archived"!==s.status&&(!t||"all"===t||s.status===t))})).filter((e=>!i||"all"===i||e.source===i)),I=gh({mutationFn:async e=>{const s=await vh("POST","/api/clients",e);return await s.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["/api/clients"]}),o(!1),x({title:"Success",description:"Client created successfully"})},onError:()=>{x({title:"Error",description:"Failed to create client",variant:"destructive"})}}),R=gh({mutationFn:async({id:e,client:s})=>{const t=await vh("PUT",`/api/clients/${e}`,s);return await t.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["/api/clients"]}),w.invalidateQueries({queryKey:["/api/clients/archived"]}),w.refetchQueries({queryKey:["/api/clients"]}),p&&w.refetchQueries({queryKey:["/api/clients/archived"]}),o(!1),u(null),x({title:"Success",description:"Client updated successfully"})},onError:()=>{x({title:"Error",description:"Failed to update client",variant:"destructive"})}}),q=gh({mutationFn:async e=>{const s=await vh("DELETE",`/api/clients/${e}`);return await s.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["/api/clients"]}),w.invalidateQueries({queryKey:["/api/clients/archived"]}),y(!1),N(null),j(null),x({title:"Success",description:"Client archived successfully"})},onError:e=>{var s,t;const a=(null==(t=null==(s=e.response)?void 0:s.data)?void 0:t.message)||"Failed to archive client";x({title:"Error",description:a,variant:"destructive"})}}),O=gh({mutationFn:async e=>{const s=await vh("POST",`/api/clients/${e}/restore`);return await s.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["/api/clients"]}),w.invalidateQueries({queryKey:["/api/clients/archived"]}),x({title:"Success",description:"Client restored successfully"})},onError:()=>{x({title:"Error",description:"Failed to restore client",variant:"destructive"})}}),M=async e=>{N(e);const s=await(async e=>{try{const s=await vh("GET",`/api/clients/${e}/deletion-impact`);return await s.json()}catch(s){return null}})(e.id);j(s),y(!0)},V=e=>Si.jsx(Sx,{variant:{prospect:"outline",active:"default",inactive:"secondary",suspended:"destructive",archived:"secondary"}[e]||"outline",children:e});return A?Si.jsx("div",{className:"flex items-center justify-center h-64",children:Si.jsx(ul,{className:"h-8 w-8 animate-spin"})}):Si.jsx(vf,{title:"Client Management",subtitle:"Manage your client relationships and profiles",children:Si.jsxs("main",{className:"flex-1 overflow-auto p-6 pt-16 md:pt-6",children:[Si.jsxs(Mp,{value:p?"archived":"active",onValueChange:e=>f("archived"===e),children:[Si.jsxs(Vp,{children:[Si.jsxs(Up,{value:"active",children:["Active Clients (",E.length,")"]}),Si.jsxs(Up,{value:"archived",children:["Archived Clients (",P.length,")"]})]}),Si.jsxs($p,{value:"active",className:"space-y-4",children:[Si.jsx(Ax,{children:Si.jsx(Lx,{className:"pt-6",children:Si.jsx(Kj,{filters:[{key:"status",label:"Status",type:"select",options:[{label:"All",value:"all"},{label:"Prospect",value:"prospect"},{label:"Active",value:"active"},{label:"Inactive",value:"inactive"},{label:"Pending",value:"pending"}]},{key:"source",label:"Source",type:"select",options:[{label:"All",value:"all"},{label:"NCA",value:"nca"},{label:"Direct",value:"direct"},{label:"Both",value:"both"}]}],values:m,onChange:e=>{h(e),a(e.status||"all"),n(e.source||"all")},onClear:()=>{h({}),s(""),a("all"),n("all")},compact:!0})})}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex justify-between items-center",children:[Si.jsxs("div",{children:[Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(Qr,{className:"h-5 w-5"}),"Active Clients",Si.jsxs(Sp,{open:c,onOpenChange:o,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{className:"ml-4",children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Client"]})}),Si.jsxs(Ep,{className:"max-w-2xl max-h-[85vh] overflow-hidden",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:d?"Edit Client":"Add New Client"})}),Si.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:Si.jsx(Zw,{client:d,onSubmit:e=>{d?R.mutate({id:d.id,client:e}):I.mutate(e)},onCancel:()=>{o(!1),u(null)},isLoading:I.isPending||R.isPending})})]})]})]}),Si.jsxs(Fx,{children:[L.length," of ",E.length," clients"]})]}),Si.jsxs("div",{className:"flex gap-2",children:[Si.jsxs("div",{className:"relative",children:[Si.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),Si.jsx(kx,{placeholder:"Search clients...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]}),Si.jsx(nC,{columns:C,visibleColumns:S,onVisibilityChange:T,onReset:k}),Si.jsx(Ex,{variant:"outline",size:"icon",onClick:()=>{w.invalidateQueries({queryKey:["/api/clients"]}),w.invalidateQueries({queryKey:["/api/clients/archived"]})},title:"Refresh client data",children:Si.jsx(ul,{className:"h-4 w-4"})}),r.size>0&&Si.jsxs(Si.Fragment,{children:[Si.jsxs(Ex,{variant:"outline",onClick:async()=>{if(0!==r.size)try{await Promise.all(Array.from(r).map((e=>vh("DELETE",`/api/clients/${e}`)))),w.invalidateQueries({queryKey:["/api/clients"]}),w.invalidateQueries({queryKey:["/api/clients/archived"]}),l(new Set),x({title:"Success",description:`Archived ${r.size} clients`})}catch(e){x({title:"Error",description:"Failed to archive selected clients",variant:"destructive"})}},children:[Si.jsx(Il,{className:"h-4 w-4 mr-2"}),"Archive Selected (",r.size,")"]}),Si.jsxs(Ex,{variant:"outline",onClick:()=>{const e=L.filter((e=>r.has(e.id))),s=e.length>0?e:L,t=[["Name","Industry","Status","Source","Created"].join(","),...s.map((e=>[e.name,e.industry||"",e.status,e.source||"",e.createdAt?new Date(e.createdAt).toLocaleDateString():""].join(",")))].join("\n"),a=new Blob([t],{type:"text/csv"}),i=window.URL.createObjectURL(a),n=document.createElement("a");n.href=i,n.download=`clients-${p?"archived":"active"}.csv`,n.click(),window.URL.revokeObjectURL(i)},children:[Si.jsx(Rl,{className:"h-4 w-4 mr-2"}),"Export"]})]})]})]})}),Si.jsx(Lx,{children:Si.jsxs(Wj,{children:[Si.jsx(Hj,{children:Si.jsxs(Jj,{children:[D("checkbox")&&Si.jsx(Xj,{className:"w-12",children:Si.jsx($f,{checked:r.size===L.length&&L.length>0,onCheckedChange:e=>{l(e?new Set(L.map((e=>e.id))):new Set)}})}),D("name")&&Si.jsx(Xj,{children:"Name"}),D("shortName")&&Si.jsx(Xj,{children:"Short Name"}),D("domain")&&Si.jsx(Xj,{children:"Domain"}),D("industry")&&Si.jsx(Xj,{children:"Industry"}),D("companySize")&&Si.jsx(Xj,{children:"Company Size"}),D("contractsCount")&&Si.jsx(Xj,{children:"Contracts"}),D("servicesCount")&&Si.jsx(Xj,{children:"Services"}),D("licensesCount")&&Si.jsx(Xj,{children:"Licenses"}),D("status")&&Si.jsx(Xj,{children:"Status"}),D("source")&&Si.jsx(Xj,{children:"Source"}),D("address")&&Si.jsx(Xj,{children:"Address"}),D("website")&&Si.jsx(Xj,{children:"Website"}),D("createdAt")&&Si.jsx(Xj,{children:"Created"}),D("updatedAt")&&Si.jsx(Xj,{children:"Updated"}),D("actions")&&Si.jsx(Xj,{className:"text-right",children:"Actions"})]})}),Si.jsx(Yj,{children:L.map((e=>Si.jsxs(Jj,{children:[D("checkbox")&&Si.jsx(Zj,{children:Si.jsx($f,{checked:r.has(e.id),onCheckedChange:s=>((e,s)=>{const t=new Set(r);s?t.add(e):t.delete(e),l(t)})(e.id,s)})}),D("name")&&Si.jsx(Zj,{className:"font-medium",children:e.name}),D("shortName")&&Si.jsx(Zj,{children:Si.jsxs("a",{href:`/clients/${e.id}`,className:"flex items-center gap-2 hover:text-blue-600 cursor-pointer",children:[e.shortName&&Si.jsx(Cl,{className:"h-4 w-4 text-muted-foreground"}),e.shortName||"—"]})}),D("domain")&&Si.jsx(Zj,{children:Si.jsxs("a",{href:`/clients/${e.id}`,className:"flex items-center gap-2 hover:text-blue-600 cursor-pointer",children:[e.domain&&Si.jsx(ql,{className:"h-4 w-4 text-muted-foreground"}),e.domain||"—"]})}),D("industry")&&Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center gap-2",children:[e.industry&&Si.jsx(pl,{className:"h-4 w-4 text-muted-foreground"}),e.industry||"—"]})}),D("companySize")&&Si.jsx(Zj,{children:e.companySize||"—"}),D("contractsCount")&&Si.jsx(Zj,{children:e.contractsCount||"—"}),D("servicesCount")&&Si.jsx(Zj,{children:e.servicesCount||"—"}),D("licensesCount")&&Si.jsx(Zj,{children:e.licensesCount||"—"}),D("status")&&Si.jsx(Zj,{children:V(e.status)}),D("source")&&Si.jsx(Zj,{children:e.source||"—"}),D("address")&&Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center gap-2",children:[e.address&&Si.jsx(Ol,{className:"h-4 w-4 text-muted-foreground"}),Si.jsx("span",{className:"truncate max-w-[200px]",title:e.address,children:e.address||"—"})]})}),D("website")&&Si.jsx(Zj,{children:e.website?Si.jsxs("a",{href:e.website.startsWith("http")?e.website:`https://${e.website}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 hover:text-blue-800",children:[Si.jsx(ql,{className:"h-4 w-4"}),Si.jsx("span",{className:"truncate max-w-[150px]",children:e.website.replace(/^https?:\/\//,"")})]}):"—"}),D("createdAt")&&Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx(jl,{className:"h-4 w-4 text-muted-foreground"}),e.createdAt?new Date(e.createdAt).toLocaleDateString():"—"]})}),D("updatedAt")&&Si.jsx(Zj,{children:Si.jsxs("a",{href:`/clients/${e.id}`,className:"flex items-center gap-2 hover:text-blue-600 cursor-pointer",children:[Si.jsx(jl,{className:"h-4 w-4 text-muted-foreground"}),e.updatedAt?new Date(e.updatedAt).toLocaleDateString():"—"]})}),D("actions")&&Si.jsx(Zj,{className:"text-right",children:Si.jsxs("div",{className:"flex justify-end gap-2",children:[Si.jsx(Ex,{variant:"ghost",size:"sm",asChild:!0,children:Si.jsx("a",{href:`/clients/${e.id}`,children:Si.jsx(Sl,{className:"h-4 w-4"})})}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(e=>{u(e),o(!0)})(e),children:Si.jsx(tl,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>M(e),children:Si.jsx(Il,{className:"h-4 w-4"})})]})})]},e.id)))})]})})]})]}),Si.jsx($p,{value:"archived",className:"space-y-4",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex justify-between items-center",children:[Si.jsxs("div",{children:[Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(Il,{className:"h-5 w-5"}),"Archived Clients"]}),Si.jsx(Fx,{children:"Clients that have been archived for historical reference"})]}),Si.jsxs("div",{className:"flex gap-2",children:[Si.jsxs("div",{className:"relative",children:[Si.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),Si.jsx(kx,{placeholder:"Search archived clients...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]}),Si.jsx(nC,{columns:C.filter((e=>"checkbox"!==e.key)),visibleColumns:S,onVisibilityChange:T,onReset:k})]})]})}),Si.jsx(Lx,{children:Si.jsxs(Wj,{children:[Si.jsx(Hj,{children:Si.jsxs(Jj,{children:[D("name")&&Si.jsx(Xj,{children:"Name"}),D("shortName")&&Si.jsx(Xj,{children:"Short Name"}),D("domain")&&Si.jsx(Xj,{children:"Domain"}),D("industry")&&Si.jsx(Xj,{children:"Industry"}),D("companySize")&&Si.jsx(Xj,{children:"Company Size"}),D("status")&&Si.jsx(Xj,{children:"Status"}),D("source")&&Si.jsx(Xj,{children:"Source"}),D("address")&&Si.jsx(Xj,{children:"Address"}),D("website")&&Si.jsx(Xj,{children:"Website"}),D("createdAt")&&Si.jsx(Xj,{children:"Created"}),D("updatedAt")&&Si.jsx(Xj,{children:"Updated"}),Si.jsx(Xj,{children:"Archived Date"}),Si.jsx(Xj,{className:"text-right",children:"Actions"})]})}),Si.jsx(Yj,{children:_?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:Object.values(S).filter(Boolean).length+2,className:"text-center py-8",children:"Loading archived clients..."})}):F?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:Object.values(S).filter(Boolean).length+2,className:"text-center py-8",children:Si.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[Si.jsx(Il,{className:"h-8 w-8 text-red-400"}),Si.jsx("p",{className:"text-red-600",children:"Failed to load archived clients"}),Si.jsx("p",{className:"text-sm text-gray-500",children:F instanceof Error?F.message:"Unknown error occurred"})]})})}):0===L.length?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:Object.values(S).filter(Boolean).length+2,className:"text-center py-8",children:Si.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[Si.jsx(Il,{className:"h-8 w-8 text-gray-400"}),Si.jsx("p",{className:"text-gray-500",children:"No archived clients found"}),Si.jsx("p",{className:"text-sm text-gray-400",children:e?"Try adjusting your search":"No clients have been archived yet"})]})})}):L.map((e=>Si.jsxs(Jj,{children:[D("name")&&Si.jsx(Zj,{className:"font-medium",children:e.name}),D("shortName")&&Si.jsx(Zj,{children:Si.jsxs("a",{href:`/clients/${e.id}`,className:"flex items-center gap-2 hover:text-blue-600 cursor-pointer",children:[e.shortName&&Si.jsx(Cl,{className:"h-4 w-4 text-muted-foreground"}),e.shortName||"—"]})}),D("domain")&&Si.jsx(Zj,{children:Si.jsxs("a",{href:`/clients/${e.id}`,className:"flex items-center gap-2 hover:text-blue-600 cursor-pointer",children:[e.domain&&Si.jsx(ql,{className:"h-4 w-4 text-muted-foreground"}),e.domain||"—"]})}),D("industry")&&Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center gap-2",children:[e.industry&&Si.jsx(pl,{className:"h-4 w-4 text-muted-foreground"}),e.industry||"—"]})}),D("companySize")&&Si.jsx(Zj,{children:e.companySize||"—"}),D("status")&&Si.jsx(Zj,{children:V(e.status)}),D("source")&&Si.jsx(Zj,{children:e.source||"—"}),D("address")&&Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center gap-2",children:[e.address&&Si.jsx(Ol,{className:"h-4 w-4 text-muted-foreground"}),Si.jsx("span",{className:"truncate max-w-[200px]",title:e.address,children:e.address||"—"})]})}),D("website")&&Si.jsx(Zj,{children:e.website?Si.jsxs("a",{href:e.website.startsWith("http")?e.website:`https://${e.website}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-blue-600 hover:text-blue-800",children:[Si.jsx(ql,{className:"h-4 w-4"}),Si.jsx("span",{className:"truncate max-w-[150px]",children:e.website.replace(/^https?:\/\//,"")})]}):"—"}),D("createdAt")&&Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx(jl,{className:"h-4 w-4 text-muted-foreground"}),e.createdAt?new Date(e.createdAt).toLocaleDateString():"—"]})}),D("updatedAt")&&Si.jsx(Zj,{children:Si.jsxs("a",{href:`/clients/${e.id}`,className:"flex items-center gap-2 hover:text-blue-600 cursor-pointer",children:[Si.jsx(jl,{className:"h-4 w-4 text-muted-foreground"}),e.updatedAt?new Date(e.updatedAt).toLocaleDateString():"—"]})}),Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx(jl,{className:"h-4 w-4 text-muted-foreground"}),e.deletedAt?new Date(e.deletedAt).toLocaleDateString():"—"]})}),Si.jsx(Zj,{className:"text-right",children:Si.jsxs(Ex,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void O.mutate(s);var s},children:[Si.jsx(Ml,{className:"h-4 w-4 mr-2"}),"Restore"]})})]},e.id)))})]})})]})})]}),Si.jsx(Sp,{open:v,onOpenChange:y,children:Si.jsxs(Ep,{className:"max-w-md",children:[Si.jsxs(Ap,{children:[Si.jsxs(_p,{className:"flex items-center gap-2",children:[Si.jsx(vl,{className:"h-5 w-5 text-orange-500"}),"Archive Client"]}),Si.jsxs(Fp,{children:['Are you sure you want to archive "',null==b?void 0:b.name,'"?']})]}),g&&Si.jsxs("div",{className:"space-y-4",children:[!g.canDelete&&Si.jsxs(Nx,{children:[Si.jsx(vl,{className:"h-4 w-4"}),Si.jsx(wx,{children:Si.jsxs("div",{className:"space-y-2",children:[Si.jsx("p",{className:"font-medium",children:"Cannot archive this client:"}),Si.jsx("ul",{className:"list-disc list-inside space-y-1",children:g.blockers.map(((e,s)=>Si.jsx("li",{className:"text-sm",children:e},s)))})]})})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx("p",{className:"font-medium text-sm",children:"Dependencies that will be preserved:"}),Si.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-muted-foreground",children:[Si.jsxs("div",{children:["Contracts: ",g.dependencies.contracts]}),Si.jsxs("div",{children:["Documents: ",g.dependencies.documents]}),Si.jsxs("div",{children:["Licenses: ",g.dependencies.licenses]}),Si.jsxs("div",{children:["Hardware: ",g.dependencies.hardwareAssignments]}),Si.jsxs("div",{children:["Team: ",g.dependencies.teamAssignments]}),Si.jsxs("div",{children:["Transactions: ",g.dependencies.financialTransactions]})]})]})]}),Si.jsxs("div",{className:"flex justify-end gap-2",children:[Si.jsx(Ex,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),Si.jsx(Ex,{variant:"destructive",onClick:()=>{b&&q.mutate(b.id)},disabled:!(null==g?void 0:g.canDelete)||q.isPending,children:q.isPending?"Archiving...":"Archive Client"})]})]})})]})})}iC.displayName=On.displayName;const cC=Wc({clientId:Uc().min(1,"Please select a client"),licensePoolId:Uc({required_error:"Please select a license pool"}),serviceScopeId:Uc().optional(),assignedLicenses:Uc().min(1,"Must assign at least 1 license"),notes:Vc().optional()});function oC({clientId:e,licensePoolId:s,onSubmit:t,onCancel:a,isLoading:i=!1}){const n=0===e,r=Zc({resolver:bv(cC),defaultValues:{clientId:e||void 0,licensePoolId:s||void 0,assignedLicenses:1,notes:""}}),l=r.watch("clientId"),c=r.watch("licensePoolId"),{data:o=[]}=fh({queryKey:["/api/clients"],queryFn:async()=>{const e=await fetch("/api/clients",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch clients");return e.json()},enabled:n}),{data:d=[]}=fh({queryKey:["/api/license-pools"],enabled:!s}),{data:u}=fh({queryKey:["/api/license-pools",s],queryFn:async()=>{const e=await fetch(`/api/license-pools/${s}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch license pool");return e.json()},enabled:!!s}),{data:m=[]}=fh({queryKey:["/api/clients",l,"service-scopes"],queryFn:async()=>{const e=await fetch(`/api/clients/${l}/service-scopes`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch service scopes");return e.json()},enabled:!!l&&l>0}),h=u||d.find((e=>e.id===c));return Si.jsx($w,{...r,children:Si.jsxs("form",{onSubmit:r.handleSubmit((e=>{t(e)})),className:"flex flex-col h-full",children:[Si.jsx(Lp,{children:Si.jsxs("div",{className:"space-y-6",children:[n&&Si.jsx(Bw,{control:r.control,name:"clientId",render:({field:e})=>{var s;return Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Client"}),Si.jsxs(zp,{onValueChange:s=>e.onChange(parseInt(s)),value:(null==(s=e.value)?void 0:s.toString())||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a client"})})}),Si.jsx(Wp,{children:o.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:Ou(e)},e.id)))})]}),Si.jsx(Jw,{})]})}}),!s&&Si.jsx(Bw,{control:r.control,name:"licensePoolId",render:({field:e})=>{var s;return Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"License Pool"}),Si.jsxs(zp,{onValueChange:s=>e.onChange(parseInt(s)),value:(null==(s=e.value)?void 0:s.toString())||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a license pool"})})}),Si.jsx(Wp,{children:(d||[]).filter((e=>e.availableLicenses>0)).map((e=>Si.jsx(Hp,{value:e.id.toString(),children:Si.jsxs("div",{className:"flex justify-between items-center w-full",children:[Si.jsxs("span",{children:[e.name," (",e.vendor,")"]}),Si.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:[e.availableLicenses," available"]})]})},e.id)))})]}),Si.jsx(Jw,{}),h&&Si.jsxs("p",{className:"text-sm text-gray-600",children:["Product: ",h.productName," | Available: ",h.availableLicenses," licenses"]})]})}}),s&&u&&Si.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[Si.jsx("h4",{className:"font-medium text-gray-900",children:u.name}),Si.jsxs("p",{className:"text-sm text-gray-600",children:[u.vendor," ",u.productName]}),Si.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Available: ",u.availableLicenses," licenses"]})]}),Si.jsx(Bw,{control:r.control,name:"serviceScopeId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Service Scope (Optional)"}),Si.jsxs(zp,{onValueChange:s=>e.onChange("none"===s?void 0:parseInt(s)),value:e.value?e.value.toString():"none",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a service scope"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"none",children:"No Service Scope"}),m.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:e.name},e.id)))]})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:r.control,name:"assignedLicenses",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Number of Licenses to Assign"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"number",placeholder:"1",min:1,max:(null==h?void 0:h.availableLicenses)||999,...e,onChange:s=>e.onChange(parseInt(s.target.value)||1)})}),Si.jsx(Jw,{}),h&&Si.jsxs("p",{className:"text-sm text-gray-500",children:["Maximum available: ",h.availableLicenses," licenses"]})]})}),Si.jsx(Bw,{control:r.control,name:"notes",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Notes (Optional)"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Any additional notes about this license assignment...",className:"resize-none",rows:3,...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]})}),Si.jsxs(Pp,{children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),Si.jsx(Ex,{type:"submit",disabled:i||!h||n&&!l,children:i?"Assigning...":"Assign Licenses"})]})]})})}const dC={create:nl,update:tl,delete:al,view:Sl,login:xl,logout:xl,export:Rl,import:Lr,grant_permission:Ul,revoke_permission:Ul,default:Kr},uC={info:"bg-blue-100 text-blue-800",low:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",critical:"bg-red-100 text-red-800"},mC={authentication:"bg-purple-100 text-purple-800",data_access:"bg-blue-100 text-blue-800",data_modification:"bg-orange-100 text-orange-800",security:"bg-red-100 text-red-800",compliance:"bg-green-100 text-green-800",system:"bg-gray-100 text-gray-800"};function hC({entity_type:e,entity_id:s,entity_name:t,className:a}){const[i,n]=$n.useState("changes"),[r,l]=$n.useState(null),[c,o]=$n.useState(!1),[d,u]=$n.useState("all"),[m,h]=$n.useState("all"),[x,p]=$n.useState("all"),[f,g]=$n.useState(""),[j,v]=$n.useState(new Set),y=dh(),b=()=>{const t=new URLSearchParams;return e&&t.append("entityType",e),s&&t.append("entityId",s.toString()),"all"!==d&&t.append("timeFilter",d),"all"!==m&&t.append("actionFilter",m),"all"!==x&&t.append("userFilter",x),f&&t.append("search",f),t.toString()},{data:N=[],isLoading:w}=fh({queryKey:["/api/audit/change-history",b()],queryFn:async()=>(await vh("GET",`/api/audit/change-history?${b()}`)).json()}),{data:C=[],isLoading:S}=fh({queryKey:["/api/audit/logs",b()],queryFn:async()=>(await vh("GET",`/api/audit/logs?${b()}`)).json()}),{data:T=[],isLoading:k}=fh({queryKey:["/api/audit/security-events",b()],queryFn:async()=>(await vh("GET",`/api/audit/security-events?${b()}`)).json()}),{data:D=[],isLoading:E}=fh({queryKey:["/api/audit/data-access",b()],queryFn:async()=>(await vh("GET",`/api/audit/data-access?${b()}`)).json()}),A=gh({mutationFn:async e=>(await vh("POST",`/api/audit/rollback/${e}`)).json(),onSuccess:()=>{y.invalidateQueries({queryKey:["/api/audit/change-history"]}),y.invalidateQueries({queryKey:["/api/clients"]})}}),P=Bn.useMemo((()=>{if(!N||!Array.isArray(N))return[];const e={};return N.forEach((s=>{const t=s.batch_id||`single_${s.id}`;e[t]||(e[t]=[]),e[t].push(s)})),e&&"object"==typeof e?Object.entries(e).map((([e,s])=>({batchId:e,changes:s.sort(((e,s)=>new Date(e.timestamp).getTime()-new Date(s.timestamp).getTime())),timestamp:s[0].timestamp,isBatch:s.length>1}))).sort(((e,s)=>new Date(s.timestamp).getTime()-new Date(e.timestamp).getTime())):[]}),[N]),_=e=>{if(!e)return"N/A";try{const s=JSON.parse(e);return"object"==typeof s?JSON.stringify(s,null,2):String(s)}catch{return e}},F=(e,s=!1)=>{const t=dC[e.action]||dC.default;return Si.jsx("div",{className:Lu("p-4 border rounded-lg hover:shadow-sm transition-shadow",s&&"ml-6 border-l-4 border-l-blue-200"),children:Si.jsxs("div",{className:"flex items-start justify-between",children:[Si.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[Si.jsx("div",{className:Lu("p-2 rounded-lg",{"bg-green-100":"create"===e.action,"bg-blue-100":"update"===e.action,"bg-red-100":"delete"===e.action,"bg-gray-100":!["create","update","delete"].includes(e.action)}),children:Si.jsx(t,{className:Lu("h-4 w-4",{"text-green-600":"create"===e.action,"text-blue-600":"update"===e.action,"text-red-600":"delete"===e.action,"text-gray-600":!["create","update","delete"].includes(e.action)})})}),Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[Si.jsx("span",{className:"font-medium text-sm",children:e.user_name}),Si.jsx(Sx,{variant:"outline",className:"text-xs",children:e.user_role}),e.automatic_change&&Si.jsxs(Sx,{variant:"secondary",className:"text-xs",children:[Si.jsx(kl,{className:"h-3 w-3 mr-1"}),"System"]})]}),Si.jsxs("p",{className:"text-sm text-gray-900 mb-1",children:["create"===e.action&&`Created ${e.entity_type}: ${e.entity_name}`,"update"===e.action&&e.field_name&&`Updated ${e.field_name} in ${e.entity_type}: ${e.entity_name}`,"update"===e.action&&!e.field_name&&`Updated ${e.entity_type}: ${e.entity_name}`,"delete"===e.action&&`Deleted ${e.entity_type}: ${e.entity_name}`]}),e.field_name&&"update"===e.action&&Si.jsxs("div",{className:"space-y-1 text-xs",children:[e.old_value&&Si.jsxs("div",{children:[Si.jsx("span",{className:"text-red-600 font-medium",children:"Old:"}),Si.jsx("span",{className:"text-gray-600 ml-1 font-mono",children:_(e.old_value)})]}),e.new_value&&Si.jsxs("div",{children:[Si.jsx("span",{className:"text-green-600 font-medium",children:"New:"}),Si.jsx("span",{className:"text-gray-600 ml-1 font-mono",children:_(e.new_value)})]})]}),e.change_reason&&Si.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-xs",children:[Si.jsx("span",{className:"font-medium",children:"Reason:"})," ",e.change_reason]}),Si.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[Si.jsxs("span",{className:"flex items-center",children:[Si.jsx(Wr,{className:"h-3 w-3 mr-1"}),Hn(new Date(e.timestamp),"MMM dd, yyyy HH:mm:ss")]}),Si.jsxs("span",{children:[Sr(new Date(e.timestamp))," ago"]}),e.ip_address&&Si.jsxs("span",{className:"flex items-center",children:[Si.jsx(ql,{className:"h-3 w-3 mr-1"}),e.ip_address]})]})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{l(e),o(!0)},children:Si.jsx(Sl,{className:"h-4 w-4"})}),e.rollback_data&&Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>A.mutate(e.id),disabled:A.isPending,className:"text-orange-600 hover:text-orange-700",children:Si.jsx($l,{className:"h-4 w-4"})})]})]})},e.id)};return Si.jsxs("div",{className:Lu("w-full space-y-6",a),children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[Si.jsx(Vl,{className:"h-5 w-5 mr-2"}),"Activity History",t&&Si.jsxs("span",{className:"text-gray-500 ml-2",children:["- ",t]})]}),Si.jsx("p",{className:"text-sm text-gray-600",children:"Complete audit trail of all activities and changes"})]}),Si.jsx("div",{className:"flex items-center space-x-2",children:Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>y.invalidateQueries({queryKey:["/api/audit"]}),children:[Si.jsx(ul,{className:"h-4 w-4 mr-2"}),"Refresh"]})})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"text-base flex items-center",children:[Si.jsx(rl,{className:"h-4 w-4 mr-2"}),"Filters"]})}),Si.jsx(Lx,{children:Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"search",children:"Search"}),Si.jsx(kx,{id:"search",placeholder:"Search activities...",value:f,onChange:e=>g(e.target.value),className:"mt-1"})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"time-filter",children:"Time Period"}),Si.jsxs(zp,{value:d,onValueChange:u,children:[Si.jsx(Kp,{className:"mt-1",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Time"}),Si.jsx(Hp,{value:"today",children:"Today"}),Si.jsx(Hp,{value:"week",children:"This Week"}),Si.jsx(Hp,{value:"month",children:"This Month"}),Si.jsx(Hp,{value:"quarter",children:"This Quarter"})]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"action-filter",children:"Action"}),Si.jsxs(zp,{value:m,onValueChange:h,children:[Si.jsx(Kp,{className:"mt-1",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Actions"}),Si.jsx(Hp,{value:"create",children:"Create"}),Si.jsx(Hp,{value:"update",children:"Update"}),Si.jsx(Hp,{value:"delete",children:"Delete"}),Si.jsx(Hp,{value:"view",children:"View"}),Si.jsx(Hp,{value:"export",children:"Export"})]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"user-filter",children:"User"}),Si.jsxs(zp,{value:x,onValueChange:p,children:[Si.jsx(Kp,{className:"mt-1",children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:Si.jsx(Hp,{value:"all",children:"All Users"})})]})]})]})})]}),Si.jsxs(Mp,{value:i,onValueChange:n,children:[Si.jsxs(Vp,{className:"grid w-full grid-cols-4",children:[Si.jsxs(Up,{value:"changes",children:["Change History (",N.length,")"]}),Si.jsxs(Up,{value:"audit",children:["Audit Logs (",C.length,")"]}),Si.jsxs(Up,{value:"security",children:["Security Events (",T.length,")"]}),Si.jsxs(Up,{value:"access",children:["Data Access (",D.length,")"]})]}),Si.jsx($p,{value:"changes",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Vl,{className:"h-4 w-4 mr-2"}),"Change History",Si.jsx(Sx,{variant:"secondary",className:"ml-2",children:"Git-like tracking"})]})}),Si.jsx(Lx,{children:Si.jsx(jp,{className:"h-96",children:w?Si.jsx("div",{className:"flex items-center justify-center py-8",children:Si.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):P.length>0?Si.jsx("div",{className:"space-y-4",children:P.map((e=>Si.jsx("div",{children:e.isBatch?Si.jsxs("div",{className:"border rounded-lg",children:[Si.jsx("div",{className:"p-4 bg-gray-50 cursor-pointer flex items-center justify-between",onClick:()=>(e=>{const s=new Set(j);s.has(e)?s.delete(e):s.add(e),v(s)})(e.batchId),children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[j.has(e.batchId)?Si.jsx(Hr,{className:"h-4 w-4"}):Si.jsx(fl,{className:"h-4 w-4"}),Si.jsxs("span",{className:"font-medium",children:["Batch Operation (",e.changes.length," changes)"]}),Si.jsx(Sx,{variant:"outline",className:"text-xs",children:Hn(new Date(e.timestamp),"MMM dd, yyyy HH:mm")})]})}),j.has(e.batchId)&&Si.jsx("div",{className:"border-t space-y-2 p-2",children:e.changes.map((e=>F(e,!0)))})]}):F(e.changes[0])},e.batchId)))}):Si.jsxs("div",{className:"text-center py-8 text-gray-500",children:[Si.jsx(Vl,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),Si.jsx("p",{children:"No change history found"})]})})})]})}),Si.jsx($p,{value:"audit",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Gr,{className:"h-4 w-4 mr-2"}),"Audit Logs"]})}),Si.jsx(Lx,{children:Si.jsx(jp,{className:"h-96",children:S?Si.jsx("div",{className:"flex items-center justify-center py-8",children:Si.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):C.length>0?Si.jsx("div",{className:"space-y-4",children:C.map((e=>{const s=dC[e.action]||dC.default;return Si.jsx("div",{className:"p-4 border rounded-lg hover:shadow-sm transition-shadow",children:Si.jsxs("div",{className:"flex items-start justify-between",children:[Si.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[Si.jsx("div",{className:Lu("p-2 rounded-lg",mC[e.category]||"bg-gray-100"),children:Si.jsx(s,{className:"h-4 w-4"})}),Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.user_name&&Si.jsxs(Si.Fragment,{children:[Si.jsx("span",{className:"font-medium text-sm",children:e.user_name}),Si.jsx(Sx,{variant:"outline",className:"text-xs",children:e.user_role})]}),Si.jsx(Sx,{variant:"secondary",className:Lu("text-xs",uC[e.severity]),children:e.severity}),Si.jsx(Sx,{variant:"outline",className:"text-xs",children:e.category})]}),Si.jsx("p",{className:"text-sm text-gray-900 mb-1",children:e.description}),Si.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[Si.jsxs("span",{className:"flex items-center",children:[Si.jsx(Wr,{className:"h-3 w-3 mr-1"}),Hn(new Date(e.timestamp),"MMM dd, yyyy HH:mm:ss")]}),Si.jsxs("span",{children:[Sr(new Date(e.timestamp))," ago"]}),e.ip_address&&Si.jsxs("span",{className:"flex items-center",children:[Si.jsx(ql,{className:"h-3 w-3 mr-1"}),e.ip_address]})]})]})]}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{l(e),o(!0)},children:Si.jsx(Sl,{className:"h-4 w-4"})})]})},e.id)}))}):Si.jsxs("div",{className:"text-center py-8 text-gray-500",children:[Si.jsx(Gr,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),Si.jsx("p",{children:"No audit logs found"})]})})})]})}),Si.jsx($p,{value:"security",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(ol,{className:"h-4 w-4 mr-2"}),"Security Events"]})}),Si.jsx(Lx,{children:Si.jsx(jp,{className:"h-96",children:k?Si.jsx("div",{className:"flex items-center justify-center py-8",children:Si.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):T.length>0?Si.jsx("div",{className:"space-y-4",children:T.map((e=>Si.jsx("div",{className:"p-4 border rounded-lg hover:shadow-sm transition-shadow",children:Si.jsxs("div",{className:"flex items-start justify-between",children:[Si.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[Si.jsx("div",{className:Lu("p-2 rounded-lg",{"bg-green-100":e.success&&!e.blocked,"bg-red-100":!e.success||e.blocked,"bg-yellow-100":e.risk_score&&e.risk_score>50}),children:e.success&&!e.blocked?Si.jsx(Dl,{className:"h-4 w-4 text-green-600"}):Si.jsx(zl,{className:"h-4 w-4 text-red-600"})}),Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.user_name&&Si.jsx("span",{className:"font-medium text-sm",children:e.user_name}),Si.jsx(Sx,{variant:e.success?"default":"destructive",className:"text-xs",children:(e.event_type||"Unknown Event").replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase()))}),e.blocked&&Si.jsx(Sx,{variant:"destructive",className:"text-xs",children:"Blocked"}),e.risk_score&&e.risk_score>0&&Si.jsxs(Sx,{variant:"secondary",className:"text-xs",children:["Risk: ",e.risk_score,"%"]})]}),Si.jsxs("p",{className:"text-sm text-gray-900 mb-1",children:[(e.event_type||"Unknown Event").replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase())),e.failure_reason&&` - ${e.failure_reason}`]}),Si.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[Si.jsxs("span",{className:"flex items-center",children:[Si.jsx(Wr,{className:"h-3 w-3 mr-1"}),Hn(new Date(e.timestamp),"MMM dd, yyyy HH:mm:ss")]}),Si.jsxs("span",{className:"flex items-center",children:[Si.jsx(ql,{className:"h-3 w-3 mr-1"}),e.ip_address]}),Si.jsxs("span",{className:"flex items-center",children:[Si.jsx(Bl,{className:"h-3 w-3 mr-1"}),e.source]}),e.location&&Si.jsx("span",{children:e.location})]})]})]}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{l(e),o(!0)},children:Si.jsx(Sl,{className:"h-4 w-4"})})]})},e.id)))}):Si.jsxs("div",{className:"text-center py-8 text-gray-500",children:[Si.jsx(ol,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),Si.jsx("p",{children:"No security events found"})]})})})]})}),Si.jsx($p,{value:"access",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Sl,{className:"h-4 w-4 mr-2"}),"Data Access Logs"]})}),Si.jsx(Lx,{children:Si.jsx(jp,{className:"h-96",children:E?Si.jsx("div",{className:"flex items-center justify-center py-8",children:Si.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):D.length>0?Si.jsx("div",{className:"space-y-4",children:D.map((e=>Si.jsx("div",{className:"p-4 border rounded-lg hover:shadow-sm transition-shadow",children:Si.jsxs("div",{className:"flex items-start justify-between",children:[Si.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[Si.jsx("div",{className:Lu("p-2 rounded-lg",{"bg-blue-100":"view"===e.access_type,"bg-orange-100":"export"===e.access_type,"bg-purple-100":"search"===e.access_type}),children:Si.jsx(Sl,{className:"h-4 w-4"})}),Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[Si.jsx("span",{className:"font-medium text-sm",children:e.user_name}),Si.jsx(Sx,{variant:"outline",className:"text-xs",children:e.user_role}),Si.jsx(Sx,{variant:"secondary",className:"text-xs",children:e.access_type}),e.sensitive_data&&Si.jsxs(Sx,{variant:"destructive",className:"text-xs",children:[Si.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Sensitive"]})]}),Si.jsxs("p",{className:"text-sm text-gray-900 mb-1",children:["Accessed ",e.result_count," ",e.entity_type," record",1!==e.result_count?"s":"",e.entity_name&&` (${e.entity_name})`]}),e.purpose&&Si.jsxs("p",{className:"text-xs text-gray-600 mb-1",children:["Purpose: ",e.purpose]}),Si.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-xs text-gray-500",children:[Si.jsxs("span",{className:"flex items-center",children:[Si.jsx(Wr,{className:"h-3 w-3 mr-1"}),Hn(new Date(e.timestamp),"MMM dd, yyyy HH:mm:ss")]}),Si.jsx("span",{children:e.access_method}),Si.jsxs("span",{children:["Scope: ",e.data_scope]}),e.session_duration&&Si.jsxs("span",{children:["Duration: ",Math.round(e.session_duration/1e3),"s"]})]})]})]}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{l(e),o(!0)},children:Si.jsx(Sl,{className:"h-4 w-4"})})]})},e.id)))}):Si.jsxs("div",{className:"text-center py-8 text-gray-500",children:[Si.jsx(Sl,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),Si.jsx("p",{children:"No data access logs found"})]})})})]})})]}),Si.jsx(Sp,{open:c,onOpenChange:o,children:Si.jsxs(Ep,{className:"max-w-2xl max-h-[85vh] overflow-hidden",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Activity Details"})}),r&&Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[Si.jsxs("div",{children:[Si.jsx("span",{className:"font-medium",children:"Type:"}),Si.jsx("span",{className:"ml-2",children:r.action||r.event_type||r.access_type})]}),Si.jsxs("div",{children:[Si.jsx("span",{className:"font-medium",children:"User:"}),Si.jsx("span",{className:"ml-2",children:r.user_name||"System"})]}),Si.jsxs("div",{children:[Si.jsx("span",{className:"font-medium",children:"Timestamp:"}),Si.jsx("span",{className:"ml-2",children:Hn(new Date(r.timestamp),"MMM dd, yyyy HH:mm:ss")})]}),Si.jsxs("div",{children:[Si.jsx("span",{className:"font-medium",children:"IP Address:"}),Si.jsx("span",{className:"ml-2",children:r.ip_address})]})]}),r.metadata&&Si.jsxs("div",{children:[Si.jsx("span",{className:"font-medium",children:"Metadata:"}),Si.jsx("pre",{className:"mt-2 p-3 bg-gray-100 rounded text-xs overflow-auto",children:JSON.stringify(r.metadata,null,2)})]}),r.rollback_data&&Si.jsxs("div",{children:[Si.jsx("span",{className:"font-medium",children:"Rollback Data:"}),Si.jsx("pre",{className:"mt-2 p-3 bg-gray-100 rounded text-xs overflow-auto",children:JSON.stringify(r.rollback_data,null,2)})]})]})]})})]})}var xC="Collapsible",[pC,fC]=Ni(xC),[gC,jC]=pC(xC),vC=$n.forwardRef(((e,s)=>{const{__scopeCollapsible:t,open:a,defaultOpen:i,disabled:n,onOpenChange:r,...l}=e,[c,o]=Di({prop:a,defaultProp:i??!1,onChange:r,caller:xC});return Si.jsx(gC,{scope:t,disabled:n,contentId:$i(),open:c,onOpenToggle:$n.useCallback((()=>o((e=>!e))),[o]),children:Si.jsx(ki.div,{"data-state":SC(c),"data-disabled":n?"":void 0,...l,ref:s})})}));vC.displayName=xC;var yC="CollapsibleTrigger",bC=$n.forwardRef(((e,s)=>{const{__scopeCollapsible:t,...a}=e,i=jC(yC,t);return Si.jsx(ki.button,{type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":SC(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled,...a,ref:s,onClick:Ai(e.onClick,i.onOpenToggle)})}));bC.displayName=yC;var NC="CollapsibleContent",wC=$n.forwardRef(((e,s)=>{const{forceMount:t,...a}=e,i=jC(NC,e.__scopeCollapsible);return Si.jsx(Ei,{present:t||i.open,children:({present:e})=>Si.jsx(CC,{...a,ref:s,present:e})})}));wC.displayName=NC;var CC=$n.forwardRef(((e,s)=>{const{__scopeCollapsible:t,present:a,children:i,...n}=e,r=jC(NC,t),[l,c]=$n.useState(a),o=$n.useRef(null),d=Ci(s,o),u=$n.useRef(0),m=u.current,h=$n.useRef(0),x=h.current,p=r.open||l,f=$n.useRef(p),g=$n.useRef(void 0);return $n.useEffect((()=>{const e=requestAnimationFrame((()=>f.current=!1));return()=>cancelAnimationFrame(e)}),[]),Ii((()=>{const e=o.current;if(e){g.current=g.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";const s=e.getBoundingClientRect();u.current=s.height,h.current=s.width,f.current||(e.style.transitionDuration=g.current.transitionDuration,e.style.animationName=g.current.animationName),c(a)}}),[r.open,a]),Si.jsx(ki.div,{"data-state":SC(r.open),"data-disabled":r.disabled?"":void 0,id:r.contentId,hidden:!p,...n,ref:d,style:{"--radix-collapsible-content-height":m?`${m}px`:void 0,"--radix-collapsible-content-width":x?`${x}px`:void 0,...e.style},children:p&&i})}));function SC(e){return e?"open":"closed"}const TC=vC,kC=bC,DC=wC,EC={CLIENT:"client",CONTRACT:"contract",SERVICE_SCOPE:"service_scope",ASSET:"hardware_asset",SAF:"service_authorization_form",COC:"certificate_of_compliance",PROPOSAL:"proposal",DOCUMENT:"document",FINANCIAL_TRANSACTION:"financial_transaction",LICENSE_POOL:"license_pool",SERVICE:"service",USER:"user",AUDIT_LOG:"audit_log"},AC={OWNS:"owns",BELONGS_TO:"belongs_to",CONTAINS:"contains",PART_OF:"part_of",DEPENDS_ON:"depends_on",BLOCKS:"blocks",RELATES_TO:"relates_to",REFERENCES:"references",CREATED_BY:"created_by",ASSIGNED_TO:"assigned_to",APPROVED_BY:"approved_by",ISSUED_FOR:"issued_for",ATTACHED_TO:"attached_to",SUPERSEDES:"supersedes",SUPERSEDED_BY:"superseded_by",PAID_FOR:"paid_for",INVOICED_TO:"invoiced_to",COSTS:"costs",PROVIDES:"provides",USES:"uses",AUTHORIZES:"authorizes",COMPLIES_WITH:"complies_with"},PC={[EC.CLIENT]:{type:EC.CLIENT,displayName:"Client",pluralName:"Clients",icon:"Building",urlPath:"/clients",primaryField:"name",secondaryField:"industry",statusField:"status",searchableFields:["name","industry","address","description"],sortableFields:["name","industry","createdAt","status"]},[EC.CONTRACT]:{type:EC.CONTRACT,displayName:"Contract",pluralName:"Contracts",icon:"FileText",urlPath:"/contracts",primaryField:"name",secondaryField:"totalValue",statusField:"status",searchableFields:["name","notes"],sortableFields:["name","startDate","endDate","totalValue","status"]},[EC.SERVICE_SCOPE]:{type:EC.SERVICE_SCOPE,displayName:"Service Scope",pluralName:"Service Scopes",icon:"Settings",urlPath:"/service-scopes",primaryField:"name",secondaryField:"description",statusField:"status",searchableFields:["name","description"],sortableFields:["name","createdAt","status"]},[EC.ASSET]:{type:EC.ASSET,displayName:"Hardware Asset",pluralName:"Hardware Assets",icon:"Monitor",urlPath:"/assets",primaryField:"name",secondaryField:"model",statusField:"status",searchableFields:["name","model","serialNumber","manufacturer"],sortableFields:["name","model","purchaseDate","status"]},[EC.SAF]:{type:EC.SAF,displayName:"Service Authorization Form",pluralName:"Service Authorization Forms",icon:"Shield",urlPath:"/safs",primaryField:"safNumber",secondaryField:"description",statusField:"status",searchableFields:["safNumber","description","scope"],sortableFields:["safNumber","createdAt","status"]},[EC.COC]:{type:EC.COC,displayName:"Certificate of Compliance",pluralName:"Certificates of Compliance",icon:"Award",urlPath:"/cocs",primaryField:"certificateNumber",secondaryField:"description",statusField:"status",searchableFields:["certificateNumber","description","complianceType"],sortableFields:["certificateNumber","issuedDate","status"]},[EC.PROPOSAL]:{type:EC.PROPOSAL,displayName:"Proposal",pluralName:"Proposals",icon:"FileCheck",urlPath:"/proposals",primaryField:"type",secondaryField:"proposedValue",statusField:"status",searchableFields:["type","notes"],sortableFields:["type","proposedValue","createdAt","status"]},[EC.DOCUMENT]:{type:EC.DOCUMENT,displayName:"Document",pluralName:"Documents",icon:"File",urlPath:"/documents",primaryField:"name",secondaryField:"documentType",statusField:"isActive",searchableFields:["name","description","documentType"],sortableFields:["name","documentType","createdAt"]},[EC.FINANCIAL_TRANSACTION]:{type:EC.FINANCIAL_TRANSACTION,displayName:"Financial Transaction",pluralName:"Financial Transactions",icon:"DollarSign",urlPath:"/transactions",primaryField:"description",secondaryField:"amount",statusField:"status",searchableFields:["description","reference","category"],sortableFields:["description","amount","transactionDate","status"]},[EC.LICENSE_POOL]:{type:EC.LICENSE_POOL,displayName:"License Pool",pluralName:"License Pools",icon:"Key",urlPath:"/license-pools",primaryField:"name",secondaryField:"totalLicenses",statusField:"status",searchableFields:["name","description","vendor"],sortableFields:["name","totalLicenses","createdAt","status"]},[EC.SERVICE]:{type:EC.SERVICE,displayName:"Service",pluralName:"Services",icon:"Cog",urlPath:"/services",primaryField:"name",secondaryField:"category",statusField:"isActive",searchableFields:["name","description","category"],sortableFields:["name","category","createdAt"]},[EC.USER]:{type:EC.USER,displayName:"User",pluralName:"Users",icon:"User",urlPath:"/users",primaryField:"name",secondaryField:"email",statusField:"isActive",searchableFields:["name","email","role"],sortableFields:["name","email","role","createdAt"]},[EC.AUDIT_LOG]:{type:EC.AUDIT_LOG,displayName:"Audit Log",pluralName:"Audit Logs",icon:"History",urlPath:"/audit-logs",primaryField:"action",secondaryField:"entityType",searchableFields:["action","entityType","details"],sortableFields:["action","entityType","timestamp"]}},_C=Wc({id:Uc(),type:eo(Object.values(EC)),name:Vc(),url:Vc(),status:Vc().optional(),icon:Vc().optional(),metadata:Bc(Qc()).optional()}),FC=Wc({id:Vc(),sourceEntity:_C,targetEntity:_C,relationshipType:eo(Object.values(AC)),isReverse:$c().default(!1),strength:Uc().min(1).max(10).default(5),metadata:Bc(Qc()).optional(),createdAt:Vc(),updatedAt:Vc()});function LC(e){return PC[e]}function IC(e,s){return`${LC(e).urlPath}/${s}`}Wc({type:eo(Object.values(AC)),displayName:Vc(),relationships:Kc(FC),count:Uc(),icon:Vc().optional()});const RC={Building:"Building",FileText:"FileText",Settings:"Settings",Monitor:"Monitor",Shield:"Shield",Award:"Award",FileCheck:"FileCheck",File:"File",DollarSign:"DollarSign",Key:"Key",Cog:"Cog",User:"User",History:"History",Link:"Link"},qC={active:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",inactive:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300",draft:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",pending:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-300",expired:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",completed:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",approved:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",rejected:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"},OC=({entity:e})=>{var s;const t=LC(e.type);return t?Si.jsxs("div",{className:"p-3 max-w-sm",children:[Si.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Si.jsx(MC,{type:e.type,className:"h-4 w-4"}),Si.jsx("span",{className:"font-medium",children:t.displayName}),e.status&&Si.jsx(Sx,{variant:"outline",className:Lu("text-xs",qC[e.status.toLowerCase()]||qC.inactive),children:e.status})]}),Si.jsxs("div",{className:"text-sm text-muted-foreground",children:[Si.jsx("div",{className:"font-medium",children:e.name}),(null==(s=e.metadata)?void 0:s.secondaryText)&&Si.jsx("div",{className:"text-xs mt-1",children:e.metadata.secondaryText})]}),Si.jsxs("div",{className:"text-xs text-muted-foreground mt-2 opacity-75",children:["Click to view ",t.displayName.toLowerCase()," details"]})]}):Si.jsxs("div",{className:"p-3 max-w-sm",children:[Si.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Si.jsx(MC,{type:e.type,className:"h-4 w-4"}),Si.jsx("span",{className:"font-medium",children:"Unknown Entity"})]}),Si.jsx("div",{className:"text-sm text-muted-foreground",children:Si.jsx("div",{className:"font-medium",children:e.name})})]})},MC=({type:e,className:s="h-4 w-4"})=>{const t=LC(e);if(!t){const e=Kl;return Si.jsx(e,{className:s})}const a=RC[t.icon]||"Link",i=Ql[a];if(!i){const e=Kl;return Si.jsx(e,{className:s})}return Si.jsx(i,{className:s})},VC=({entity:e,variant:s="default",showIcon:t=!0,showStatus:a=!0,showSecondaryText:i=!0,showTooltip:n=!0,className:r,onClick:l})=>{const c=LC(e.type),o=Si.jsx(zo,{href:e.url,className:Lu("block text-inherit hover:text-inherit no-underline transition-colors","card"===s&&"hover:no-underline","inline"===s&&"inline",r),onClick:e=>{l&&(e.preventDefault(),l())},children:(()=>{var n,r;switch(s){case"compact":return Si.jsxs("div",{className:"flex items-center gap-1",children:[t&&Si.jsx(MC,{type:e.type,className:"h-3 w-3"}),Si.jsx("span",{className:"text-xs font-medium truncate",children:e.name}),e.status&&a&&Si.jsx(Sx,{variant:"outline",className:Lu("text-[10px] px-1 py-0 h-4",qC[e.status.toLowerCase()]||qC.inactive),children:e.status})]});case"card":return Si.jsx("div",{className:"p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:Si.jsxs("div",{className:"flex items-start gap-3",children:[t&&Si.jsx(MC,{type:e.type,className:"h-5 w-5 mt-0.5"}),Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[Si.jsx("span",{className:"font-medium truncate",children:e.name}),e.status&&a&&Si.jsx(Sx,{variant:"outline",className:Lu("text-xs",qC[e.status.toLowerCase()]||qC.inactive),children:e.status})]}),(null==(n=e.metadata)?void 0:n.secondaryText)&&i&&Si.jsx("div",{className:"text-sm text-muted-foreground truncate",children:e.metadata.secondaryText}),Si.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:(null==c?void 0:c.displayName)||"Unknown Entity"})]})]})});case"inline":return Si.jsxs("span",{className:"inline-flex items-center gap-1 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200",children:[t&&Si.jsx(MC,{type:e.type,className:"h-3 w-3"}),Si.jsx("span",{className:"underline decoration-dotted underline-offset-2",children:e.name})]});default:return Si.jsxs("div",{className:"flex items-center gap-2 py-1",children:[t&&Si.jsx(MC,{type:e.type,className:"h-4 w-4"}),Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx("span",{className:"font-medium truncate",children:e.name}),e.status&&a&&Si.jsx(Sx,{variant:"outline",className:Lu("text-xs",qC[e.status.toLowerCase()]||qC.inactive),children:e.status})]}),(null==(r=e.metadata)?void 0:r.secondaryText)&&i&&Si.jsx("div",{className:"text-sm text-muted-foreground truncate",children:e.metadata.secondaryText})]})]})}})()});return n&&"card"!==s?Si.jsx(hx,{children:Si.jsxs(xx,{children:[Si.jsx(px,{asChild:!0,children:o}),Si.jsx(fx,{side:"top",className:"p-0",children:Si.jsx(OC,{entity:e})})]})}):o},UC=({entities:e,variant:s="default",emptyMessage:t="No related entities found",className:a,maxItems:i,showViewAll:n=!1,onViewAll:r})=>{const l=i?e.slice(0,i):e,c=i&&e.length>i;return 0===e.length?Si.jsx("div",{className:Lu("text-sm text-muted-foreground py-4 text-center",a),children:t}):Si.jsxs("div",{className:Lu("space-y-1",a),children:[l.map(((e,t)=>Si.jsx(VC,{entity:e,variant:s},`${e.type}-${e.id}`))),c&&Si.jsx("div",{className:"pt-2",children:Si.jsxs("button",{onClick:r,className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 font-medium",children:["View all ",e.length," items..."]})}),n&&e.length>0&&Si.jsx("div",{className:"pt-2",children:Si.jsxs("button",{onClick:r,className:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200 font-medium",children:["View all (",e.length,")"]})})]})},$C=({group:e,isOpen:s,onOpenChange:t})=>e?Si.jsx(Sp,{open:s,onOpenChange:t,children:Si.jsxs(Ep,{className:"sm:max-w-2xl",children:[Si.jsx(Ap,{children:Si.jsxs(_p,{className:"flex items-center gap-2",children:[Si.jsx("span",{children:e.displayName}),Si.jsx(Sx,{variant:"secondary",children:e.count})]})}),Si.jsx(Lp,{children:Si.jsx(jp,{className:"h-96",children:Si.jsx("div",{className:"space-y-2 pr-4",children:e.relationships.map((e=>(e.isReverse?e.sourceEntity:e.targetEntity,Si.jsx(VC,{entity:e.targetEntity,showIcon:!0},e.id))))})})})]})}):null,zC=({entityType:e,entityId:s})=>{const{data:t,isLoading:a}=fh({queryKey:["relationship-stats",e,s],queryFn:async()=>{const t=await fetch(`/api/entities/${e}/${s}/relationships/stats`,{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch relationship stats");return t.json()}});return a?Si.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[Si.jsx(kr,{className:"h-3 w-3 animate-spin"}),Si.jsx("span",{children:"Loading stats..."})]}):t&&0!==t.totalRelationships?Si.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[Si.jsxs("div",{className:"flex items-center gap-1",children:[Si.jsx(Kl,{className:"h-3 w-3"}),Si.jsx("span",{className:"font-medium",children:t.totalRelationships}),Si.jsx("span",{className:"text-muted-foreground",children:1===t.totalRelationships?"relationship":"relationships"})]}),Si.jsx("div",{className:"flex gap-2",children:t.relationshipTypes&&Object.entries(t.relationshipTypes).map((([e,s])=>Si.jsxs(Sx,{variant:"secondary",className:"text-xs",children:[s," ",e.replace(/_/g," ").toLowerCase()]},e)))})]}):Si.jsx("div",{className:"text-sm text-muted-foreground",children:"No relationships found"})},BC=({group:e,isExpanded:s,onToggle:t,maxItems:a=5,showViewAll:i=!0,onViewAll:n})=>{const[r,l]=$n.useState(""),c=e.relationships.filter((e=>!r||e.targetEntity.name.toLowerCase().includes(r.toLowerCase())||e.sourceEntity.name.toLowerCase().includes(r.toLowerCase()))),o=a?c.slice(0,a):c,d=c.length>a,u=(e=>{switch(e){case"Building":return Qr;case"FileText":return Kr;case"Settings":return Mr;case"Monitor":return Bl;case"Shield":return Gr;case"Award":return Yl;case"FileCheck":return Hl;case"File":return Wl;case"DollarSign":return Ur;case"Key":return Ul;case"User":return xl;case"History":return Vl;default:return Kl}})(e.icon);return Si.jsx("div",{className:"space-y-2",children:Si.jsxs(TC,{open:s,onOpenChange:t,children:[Si.jsx(kC,{asChild:!0,children:Si.jsxs(Ex,{variant:"ghost",className:"w-full justify-between p-2 h-auto font-normal hover:bg-muted/50",children:[Si.jsxs("div",{className:"flex items-center gap-2",children:[s?Si.jsx(Hr,{className:"h-4 w-4"}):Si.jsx(fl,{className:"h-4 w-4"}),Si.jsx(u,{className:"h-4 w-4"}),Si.jsx("span",{className:"font-medium",children:e.displayName}),Si.jsx(Sx,{variant:"secondary",className:"ml-1",children:e.count})]}),Si.jsx(Gl,{className:"h-4 w-4 opacity-50"})]})}),Si.jsxs(DC,{className:"space-y-2",children:[e.count>5&&Si.jsx("div",{className:"px-2",children:Si.jsxs("div",{className:"relative",children:[Si.jsx(Xr,{className:"absolute left-2 top-2.5 h-3 w-3 text-muted-foreground"}),Si.jsx(kx,{placeholder:"Search relationships...",value:r,onChange:e=>l(e.target.value),className:"pl-7 h-8 text-xs"})]})}),Si.jsxs("div",{className:"px-2 space-y-1",children:[o.map((e=>{const s=e.isReverse?e.sourceEntity:e.targetEntity;return Si.jsx(VC,{entity:s,variant:"compact",className:"block p-1 rounded hover:bg-muted/50 transition-colors"},e.id)})),d&&i&&Si.jsx("div",{className:"pt-1",children:Si.jsxs(Ex,{variant:"ghost",size:"sm",onClick:n,className:"h-6 text-xs text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200",children:["View all ",c.length," items..."]})}),r&&0===c.length&&Si.jsx("div",{className:"text-xs text-muted-foreground py-2 text-center",children:"No relationships match your search"})]})]})]})})},KC=({entityType:e,entityId:s,className:t,variant:a="full",showSearch:i=!0,showStats:n=!0,maxItemsPerGroup:r=5,collapsible:l=!0,initiallyExpanded:c=[]})=>{const[o,d]=$n.useState(new Set(c)),[u,m]=$n.useState(""),[h,x]=$n.useState(null),{data:p,isLoading:f,error:g,refetch:j}=fh({queryKey:["entity-relationships",e,s],queryFn:async()=>{const t=await fetch(`/api/entities/${e}/${s}/relationships`,{credentials:"include"});if(!t.ok)throw new Error("Failed to fetch relationships");return t.json()},refetchOnWindowFocus:!1});$n.useEffect((()=>{p&&p.length>0&&0===o.size&&d(new Set([p[0].type]))}),[p,o.size]);const v=(null==p?void 0:p.filter((e=>!u||e.displayName.toLowerCase().includes(u.toLowerCase())||e.relationships.some((e=>e.targetEntity.name.toLowerCase().includes(u.toLowerCase())||e.sourceEntity.name.toLowerCase().includes(u.toLowerCase()))))))||[],y=()=>f?Si.jsxs("div",{className:"space-y-3",children:[Si.jsx(Qj,{className:"h-8 w-full"}),Si.jsx(Qj,{className:"h-24 w-full"}),Si.jsx(Qj,{className:"h-16 w-full"})]}):g?Si.jsxs("div",{className:"text-center py-6",children:[Si.jsx("div",{className:"text-sm text-destructive mb-2",children:"Failed to load relationships"}),Si.jsx(Ex,{size:"sm",onClick:()=>j(),children:"Retry"})]}):v.length?Si.jsxs("div",{className:"space-y-2",children:[v.map(((e,s)=>Si.jsx(BC,{group:e,isExpanded:!l||o.has(e.type),onToggle:()=>(e=>{if(!l)return;const s=new Set(o);s.has(e)?s.delete(e):s.add(e),d(s)})(e.type),maxItems:r,showViewAll:!0,onViewAll:()=>x(e)},e.type))),Si.jsx($C,{group:h,isOpen:!!h,onOpenChange:e=>{e||x(null)}})]}):Si.jsxs("div",{className:"text-center py-6",children:[Si.jsx(Kl,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),Si.jsx("div",{className:"text-sm text-muted-foreground",children:u?"No relationships match your search":"No relationships found"})]}),b=()=>{const s=LC(e);return"compact"===a?"Linked":`${s.displayName} Relationships`};return"compact"===a?Si.jsxs(Ax,{className:Lu("w-full",t),children:[Si.jsx(Px,{className:"pb-3",children:Si.jsxs(_x,{className:"text-sm font-medium flex items-center gap-2",children:[Si.jsx(Kl,{className:"h-4 w-4"}),b()]})}),Si.jsx(Lx,{className:"pt-0",children:Si.jsx(jp,{className:"h-64",children:y()})})]}):Si.jsxs(Ax,{className:Lu("w-full",t),children:[Si.jsxs(Px,{className:"pb-3",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs(_x,{className:"text-lg font-semibold flex items-center gap-2",children:[Si.jsx(Kl,{className:"h-5 w-5"}),b()]}),v.length>0&&Si.jsxs(Sx,{variant:"secondary",children:[v.reduce(((e,s)=>e+s.count),0)," total"]})]}),n&&Si.jsxs(Si.Fragment,{children:[Si.jsx(Cp,{className:"my-3"}),Si.jsx(zC,{entityType:e,entityId:s})]}),i&&v.length>0&&Si.jsxs(Si.Fragment,{children:[Si.jsx(Cp,{className:"my-3"}),Si.jsxs("div",{className:"relative",children:[Si.jsx(Xr,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),Si.jsx(kx,{placeholder:"Search all relationships...",value:u,onChange:e=>m(e.target.value),className:"pl-9"})]})]})]}),Si.jsx(Lx,{className:"pt-0",children:"sidebar"===a?Si.jsx(jp,{className:"h-96",children:y()}):y()})]})},QC=e=>{switch((null==e?void 0:e.toLowerCase())||""){case"active":case"approved":case"completed":case"paid":case"delivered":return"text-green-600";case"pending":case"in progress":case"processing":return"text-yellow-600";case"inactive":case"rejected":case"cancelled":case"overdue":return"text-red-600";case"draft":case"review":return"text-blue-600";default:return"text-gray-600"}},GC=e=>{switch((null==e?void 0:e.toLowerCase())||""){case"active":case"approved":case"completed":case"paid":return Dl;case"pending":case"in progress":case"processing":return Wr;case"inactive":case"rejected":case"cancelled":return zl;case"overdue":return ol;case"draft":return Kr;default:return jl}},WC=e=>({active:"default",approved:"default",completed:"default",paid:"default",pending:"secondary","in progress":"secondary",processing:"secondary",inactive:"destructive",rejected:"destructive",cancelled:"destructive",overdue:"destructive",draft:"outline"}[(null==e?void 0:e.toLowerCase())||""]||"outline"),HC=e=>{switch((null==e?void 0:e.toLowerCase())||""){case"active":case"approved":case"completed":case"paid":return"default";case"pending":case"in progress":case"processing":return"secondary";case"inactive":case"rejected":case"cancelled":case"overdue":return"destructive";default:return"outline"}},YC=({clientShortName:e,className:s=""})=>{const[t,a]=$n.useState(null),[i,n]=$n.useState(!0),[r,l]=$n.useState(null);return $n.useEffect((()=>{e&&(async()=>{var s,t;try{n(!0),l(null);const i=await fetch(`/api/mock-jira/tickets/count?clientShortName=${encodeURIComponent(e)}`,{credentials:"include"});if(!i.ok)throw new Error(`Request failed: ${i.status}`);const r=await i.json();a(r.count??(null==(t=null==(s=r.data)?void 0:s[0])?void 0:t.value)??0)}catch(i){l(i.message||"Unknown error")}finally{n(!1)}})()}),[e]),Si.jsxs(Ax,{className:s,children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Jira Tickets"})}),Si.jsx(Lx,{children:i?Si.jsx("div",{className:"flex items-center justify-center py-8",children:Si.jsx(kr,{className:"h-5 w-5 animate-spin"})}):r?Si.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[Si.jsx(vl,{className:"h-4 w-4"}),r]}):Si.jsx("div",{className:"text-4xl font-bold text-primary text-center py-4",children:t})})]})},JC=({clientId:e,clientShortName:s,clientName:t,clientDomain:a,onManageWidgets:i})=>{const[n,r]=$n.useState([]),[l,c]=$n.useState(!0),[o,d]=$n.useState(null);$n.useEffect((()=>{u()}),[]);const u=async()=>{try{c(!0),d(null);const e=await fetch("/api/global-widgets",{credentials:"include"});if(!e.ok)throw new Error(`Failed to load global widgets: ${e.statusText}`);const s=(await e.json()).filter((e=>e.isActive));r(s)}catch(e){d(e instanceof Error?e.message:"Failed to load global widgets")}finally{c(!1)}};return l?Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("div",{className:"flex items-center justify-between mb-6",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(ql,{className:"h-5 w-5 mr-2 text-blue-600"}),Si.jsx("h2",{className:"text-lg font-semibold",children:"Global Widgets"}),Si.jsx(Sx,{variant:"outline",className:"ml-2",children:"Loading..."})]})}),Si.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4",children:[1,2,3].map((e=>Si.jsx(Ax,{className:"h-64",children:Si.jsxs(Lx,{className:"flex items-center justify-center h-full",children:[Si.jsx(ul,{className:"h-6 w-6 animate-spin mr-2"}),Si.jsx("span",{children:"Loading widgets..."})]})},e)))})]}):o?Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("div",{className:"flex items-center justify-between mb-6",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(ql,{className:"h-5 w-5 mr-2 text-blue-600"}),Si.jsx("h2",{className:"text-lg font-semibold",children:"Global Widgets"}),Si.jsx(Sx,{variant:"destructive",className:"ml-2",children:"Error"})]})}),Si.jsxs(Nx,{className:"border-red-200 bg-red-50",children:[Si.jsx(vl,{className:"h-4 w-4 text-red-600"}),Si.jsxs(wx,{className:"text-red-800",children:[Si.jsx("strong",{children:"Error:"})," ",o,Si.jsx(Ex,{variant:"outline",size:"sm",className:"ml-2",onClick:u,children:"Retry"})]})]})]}):0===n.length?Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(ql,{className:"h-5 w-5 mr-2 text-blue-600"}),Si.jsx("h2",{className:"text-lg font-semibold",children:"Global Widgets"}),Si.jsx(Sx,{variant:"secondary",className:"ml-2",children:"0 widgets"})]}),i&&Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:i,children:[Si.jsx(Mr,{className:"h-4 w-4 mr-2"}),"Manage Global Widgets"]})]}),Si.jsx(Ax,{className:"border-dashed border-gray-300",children:Si.jsxs(Lx,{className:"text-center py-12",children:[Si.jsx(ql,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),Si.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No global widgets available"}),Si.jsx("p",{className:"text-gray-600 mb-4",children:"No global widgets have been created yet, or none are enabled for client detail pages."}),i&&Si.jsxs(Ex,{variant:"outline",onClick:i,children:[Si.jsx(Mr,{className:"h-4 w-4 mr-2"}),"Create Global Widgets"]})]})}),Si.jsxs(Nx,{className:"border-blue-200 bg-blue-50",children:[Si.jsx(vl,{className:"h-4 w-4 text-blue-600"}),Si.jsxs(wx,{className:"text-blue-800",children:[Si.jsx("strong",{children:"Global Widgets:"})," These widgets are automatically deployed to all client detail pages. They can query any available plugin (Jira, Fortigate, Splunk, etc.) and will automatically receive client context variables like clientShortName, clientName, and clientDomain."]})]})]}):Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(ql,{className:"h-5 w-5 mr-2 text-blue-600"}),Si.jsx("h2",{className:"text-lg font-semibold",children:"Global Widgets"}),Si.jsxs(Sx,{variant:"secondary",className:"ml-2",children:[n.length," active"]})]}),Si.jsx("div",{className:"flex items-center gap-2",children:i&&Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:i,children:[Si.jsx(Mr,{className:"h-4 w-4 mr-2"}),"Manage Global Widgets"]})})]}),Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:n.map((e=>{return Si.jsx("div",{className:"relative group",children:Si.jsxs(Ax,{className:"h-auto min-h-[120px] hover:shadow-md transition-shadow duration-200",children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2 px-3 pt-3",children:[Si.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[Si.jsx(Sx,{variant:"outline",className:"text-xs",children:e.pluginName}),Si.jsx(Sx,{variant:"secondary",className:"text-xs",children:e.widgetType})]}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=document.querySelector(`[data-widget-id="${e}"]`);if(s){const t=new CustomEvent("refreshWidget",{detail:{widgetId:e}});s.dispatchEvent(t)}})(e.id),className:"h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity duration-200",title:"Refresh widget",children:Si.jsx(ul,{className:"h-3 w-3"})})]}),Si.jsxs(Lx,{className:"px-3 pb-3 pt-0",children:[Si.jsx(_x,{className:"text-sm font-medium truncate mb-2",children:e.name}),Si.jsx("div",{"data-widget-id":e.id,className:"min-h-[60px]",children:Si.jsx(Gj,{widget:{id:e.id,name:e.name,description:e.description,pluginName:e.pluginName,instanceId:(i=e.pluginName,n=e.systemId,"jira"===i?1===n?"jira-main":`jira-system-${n}`:`${i}-main`),queryType:"custom",customQuery:e.query,queryMethod:e.method,queryParameters:e.parameters,displayType:e.widgetType,chartType:e.chartType,refreshInterval:e.refreshInterval,placement:"client-details",styling:{width:"full",height:"small",showBorder:!1,showHeader:!1},enabled:e.isActive},clientShortName:s,clientName:t,clientDomain:a,className:"compact-widget"})})]})]})},e.id);var i,n}))}),Si.jsxs(Nx,{className:"border-blue-200 bg-blue-50 mt-6",children:[Si.jsx(vl,{className:"h-4 w-4 text-blue-600"}),Si.jsxs(wx,{className:"text-blue-800",children:[Si.jsx("strong",{children:"Global Widgets:"})," These widgets are automatically deployed to all client pages and will dynamically adapt to show client-specific data using context variables."]})]})]})},XC=({onSave:e,onCancel:s,editingWidget:t,placement:a="client-details",clientContext:i})=>{var n,r,l,c;const[o,d]=$n.useState([]),[u,m]=$n.useState(!1),[h,x]=$n.useState(null),[p,f]=$n.useState("basic"),[g,j]=$n.useState([]),[v,y]=$n.useState({name:"",description:"",pluginName:"",instanceId:"",queryType:"default",queryMethod:"GET",queryParameters:{},displayType:"table",refreshInterval:30,placement:a,styling:{width:"full",height:"medium",showBorder:!0,showHeader:!0},filters:[]});$n.useEffect((()=>{b(),t&&y(t)}),[t]);const b=async()=>{try{m(!0);const e=await fetch("/api/plugins"),s=await e.json();s.success&&d(s.plugins)}catch(e){}finally{m(!1)}},N=o.find((e=>e.systemName===v.pluginName));null==N||N.config.instances.find((e=>e.id===v.instanceId));const w=e=>{const s=new Set;if(Array.isArray(e)){const t=Math.min(e.length,10);for(let a=0;a<t;a++)e[a]&&"object"==typeof e[a]&&Object.keys(e[a]).forEach((e=>{e&&""!==e.trim()&&s.add(e)}))}else if(e&&"object"==typeof e)if(e.sampleData&&Array.isArray(e.sampleData)){const t=Math.min(e.sampleData.length,10);for(let a=0;a<t;a++)e.sampleData[a]&&"object"==typeof e.sampleData[a]&&Object.keys(e.sampleData[a]).forEach((e=>{e&&""!==e.trim()&&s.add(e)}))}else if(e.results&&Array.isArray(e.results)){const t=Math.min(e.results.length,10);for(let a=0;a<t;a++)e.results[a]&&"object"==typeof e.results[a]&&Object.keys(e.results[a]).forEach((e=>{e&&""!==e.trim()&&s.add(e)}))}else if(e.items&&Array.isArray(e.items)){const t=Math.min(e.items.length,10);for(let a=0;a<t;a++)e.items[a]&&"object"==typeof e.items[a]&&Object.keys(e.items[a]).forEach((e=>{e&&""!==e.trim()&&s.add(e)}))}else if(e.records&&Array.isArray(e.records)){const t=Math.min(e.records.length,10);for(let a=0;a<t;a++)e.records[a]&&"object"==typeof e.records[a]&&Object.keys(e.records[a]).forEach((e=>{e&&""!==e.trim()&&s.add(e)}))}else Object.keys(e).forEach((e=>{e&&""!==e.trim()&&!["metadata","timestamp","saved","totalResults","displayedSample"].includes(e)&&s.add(e)}));return Array.from(s).filter((e=>e&&""!==e.trim()&&!["metadata","timestamp","saved","success","error","message"].includes(e))).sort()},C=(e,s)=>{var t;y({...v,filters:(null==(t=v.filters)?void 0:t.map((t=>t.id===e?{...t,...s}:t)))||[]})},S=e=>{const s={string:[{value:"equals",label:"Equals"},{value:"not_equals",label:"Not Equals"},{value:"contains",label:"Contains"},{value:"not_contains",label:"Does Not Contain"},{value:"starts_with",label:"Starts With"},{value:"ends_with",label:"Ends With"},{value:"in",label:"In List"},{value:"not_in",label:"Not In List"},{value:"is_null",label:"Is Empty"},{value:"is_not_null",label:"Is Not Empty"},{value:"regex_match",label:"Matches Pattern"}],number:[{value:"equals",label:"Equals"},{value:"not_equals",label:"Not Equals"},{value:"greater_than",label:"Greater Than"},{value:"greater_equal",label:"Greater Or Equal"},{value:"less_than",label:"Less Than"},{value:"less_equal",label:"Less Or Equal"},{value:"between",label:"Between"},{value:"in",label:"In List"},{value:"not_in",label:"Not In List"},{value:"is_null",label:"Is Empty"},{value:"is_not_null",label:"Is Not Empty"}],date:[{value:"date_equals",label:"Date Equals"},{value:"date_before",label:"Before Date"},{value:"date_after",label:"After Date"},{value:"date_range",label:"Date Range"},{value:"is_null",label:"Is Empty"},{value:"is_not_null",label:"Is Not Empty"}],boolean:[{value:"equals",label:"Is True/False"},{value:"is_null",label:"Is Empty"},{value:"is_not_null",label:"Is Not Empty"}],array:[{value:"contains",label:"Contains Element"},{value:"not_contains",label:"Does Not Contain"},{value:"in",label:"Array In List"},{value:"not_in",label:"Array Not In List"},{value:"is_null",label:"Is Empty"},{value:"is_not_null",label:"Is Not Empty"}]};return s[e]||s.string},T=e=>({jira:{language:"JQL (Jira Query Language)",examples:['project = "${clientShortName}" AND status != Done','assignee = currentUser() AND project = "${clientShortName}"','created >= -7d AND project = "${clientShortName}" ORDER BY created DESC']},splunk:{language:"SPL (Search Processing Language)",examples:['index=main client="${clientShortName}" | stats count by sourcetype','index=security client="${clientShortName}" earliest=-24h | head 100','search index=main "${clientName}" | timechart count by host']},qradar:{language:"AQL (Ariel Query Language)",examples:["SELECT * FROM events WHERE \"Client Name\" = '${clientName}' LAST 24 HOURS","SELECT sourceip, count(*) FROM events WHERE \"Client\" = '${clientShortName}' GROUP BY sourceip","SELECT * FROM offenses WHERE \"Client Domain\" ILIKE '%${clientDomain}%'"]},elasticsearch:{language:"Elasticsearch Query DSL",examples:['{"query": {"match": {"client.short_name": "${clientShortName}"}}}','{"query": {"bool": {"must": [{"term": {"client": "${clientShortName}"}}, {"range": {"@timestamp": {"gte": "now-1d"}}}]}}}','{"query": {"wildcard": {"client.domain": "*${clientDomain}*"}}}']},grafana:{language:"PromQL/SQL (depends on data source)",examples:['up{client="${clientShortName}"}','rate(http_requests_total{client="${clientShortName}"}[5m])',"SELECT * FROM metrics WHERE client = '${clientShortName}' AND time > now() - 1h"]},fortigate:{language:"FortiGate API Paths",examples:["/api/v2/monitor/system/status","/api/v2/monitor/firewall/policy?client=${clientShortName}",'/api/v2/monitor/log/traffic?filter=client=="${clientShortName}"']}}[e]||{language:"System-specific query language",examples:["Use ${clientShortName} for client identifier","Use ${clientName} for full client name","Use ${clientDomain} for client domain (if available)"]});return Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs(Mp,{value:p,onValueChange:f,children:[Si.jsxs(Vp,{className:"grid w-full grid-cols-5",children:[Si.jsx(Up,{value:"basic",children:"Basic Info"}),Si.jsx(Up,{value:"query",children:"Query Config"}),Si.jsx(Up,{value:"display",children:"Display Options"}),Si.jsx(Up,{value:"aggregation",children:"Aggregation"}),Si.jsx(Up,{value:"preview",children:"Preview & Test"})]}),Si.jsx($p,{value:"basic",className:"space-y-4",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Widget Information"})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"widget-name",children:"Widget Name *"}),Si.jsx(kx,{id:"widget-name",value:v.name,onChange:e=>y({...v,name:e.target.value}),placeholder:"e.g., Client Security Alerts"})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"refresh-interval",children:"Refresh Interval (seconds)"}),Si.jsx(kx,{id:"refresh-interval",type:"number",value:v.refreshInterval,onChange:e=>y({...v,refreshInterval:parseInt(e.target.value)||30}),min:"10",max:"3600"})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"widget-description",children:"Description"}),Si.jsx(Yp,{id:"widget-description",value:v.description,onChange:e=>y({...v,description:e.target.value}),placeholder:"Describe what this widget displays...",rows:3})]}),Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"plugin-select",children:"Plugin *"}),Si.jsxs(zp,{value:v.pluginName,onValueChange:e=>y({...v,pluginName:e,instanceId:""}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a plugin"})}),Si.jsx(Wp,{children:o.map((e=>Si.jsxs(Hp,{value:e.systemName,children:[e.displayName||e.systemName," (",e.instanceCount," instances)"]},e.systemName)))})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"instance-select",children:"Instance *"}),Si.jsxs(zp,{value:v.instanceId,onValueChange:e=>y({...v,instanceId:e}),disabled:!N,children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select an instance"})}),Si.jsx(Wp,{children:null==N?void 0:N.config.instances.map((e=>Si.jsxs(Hp,{value:e.id,children:[e.name," ",!e.isActive&&"(Inactive)"]},e.id)))})]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"placement",children:"Widget Placement"}),Si.jsxs(zp,{value:v.placement,onValueChange:e=>y({...v,placement:e}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"client-details",children:"Client Details Pages"}),Si.jsx(Hp,{value:"global-dashboard",children:"Global Dashboard"}),Si.jsx(Hp,{value:"custom",children:"Custom Placement"})]})]})]})]})]})}),Si.jsxs($p,{value:"query",className:"space-y-4",children:[i&&Si.jsxs(Nx,{className:"border-blue-200 bg-blue-50",children:[Si.jsx(vl,{className:"h-4 w-4 text-blue-600"}),Si.jsxs(wx,{className:"text-blue-800",children:[Si.jsx("strong",{children:"Client Context Available:"})," Your queries can use these variables:",Si.jsxs("div",{className:"mt-2 space-y-1 text-sm font-mono",children:[Si.jsxs("div",{children:['• clientShortName = "',i.clientShortName,'"']}),Si.jsxs("div",{children:['• clientName = "',i.clientName,'"']}),i.clientDomain&&Si.jsxs("div",{children:['• clientDomain = "',i.clientDomain,'"']})]}),N&&Si.jsxs("div",{className:"mt-3 p-3 bg-white rounded border",children:[Si.jsxs("div",{className:"text-sm font-medium text-blue-900 mb-2",children:[T(N.systemName).language," Examples:"]}),Si.jsx("div",{className:"space-y-1 text-xs font-mono text-gray-700",children:T(N.systemName).examples.map(((e,s)=>Si.jsx("div",{className:"bg-gray-50 p-2 rounded border",children:e},s)))})]}),Si.jsxs("div",{className:"mt-2 text-xs",children:["These variables are automatically injected into your queries. Use the $","{variable}"," syntax to reference them."]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Query Configuration"})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{children:"Query Type"}),Si.jsxs("div",{className:"flex space-x-4 mt-2",children:[Si.jsxs("label",{className:"flex items-center space-x-2",children:[Si.jsx("input",{type:"radio",checked:"default"===v.queryType,onChange:()=>y({...v,queryType:"default",customQuery:""})}),Si.jsx("span",{children:"Use Default Query"})]}),Si.jsxs("label",{className:"flex items-center space-x-2",children:[Si.jsx("input",{type:"radio",checked:"custom"===v.queryType,onChange:()=>y({...v,queryType:"custom",queryId:""})}),Si.jsx("span",{children:"Write Custom Query"})]})]})]}),"default"===v.queryType&&N&&Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"default-query",children:"Default Query"}),Si.jsxs(zp,{value:v.queryId||"",onValueChange:e=>y({...v,queryId:e}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a default query"})}),Si.jsx(Wp,{children:N.defaultQueries.map((e=>Si.jsxs(Hp,{value:e.id,children:[e.description," (",e.method,")"]},e.id)))})]})]}),"custom"===v.queryType&&Si.jsx("div",{className:"space-y-4",children:Si.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[Si.jsxs("div",{className:"col-span-3",children:[Si.jsx(Op,{htmlFor:"custom-query",children:"Custom Query"}),Si.jsx(Yp,{id:"custom-query",value:v.customQuery||"",onChange:e=>y({...v,customQuery:e.target.value}),placeholder:N?`Enter your ${T(N.systemName).language} query here...`:"Enter your query here...",rows:4,className:"font-mono"})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"query-method",children:"Method"}),Si.jsxs(zp,{value:v.queryMethod,onValueChange:e=>y({...v,queryMethod:e}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"GET",children:"GET"}),Si.jsx(Hp,{value:"POST",children:"POST"}),Si.jsx(Hp,{value:"PUT",children:"PUT"}),Si.jsx(Hp,{value:"DELETE",children:"DELETE"})]})]})]})]})}),Si.jsxs("div",{children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx(Op,{children:"Query Parameters"}),Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>{const e=prompt("Enter parameter name (e.g., 'reporterDomain'):");e&&e.trim()&&y({...v,queryParameters:{...v.queryParameters,[e.trim()]:{source:"static",value:""}}})},children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Parameter"]})]}),Si.jsxs("div",{className:"space-y-3 mt-2",children:[Object.entries(v.queryParameters).map((([e,s])=>{const t="object"==typeof s&&null!==s?s:{value:s,source:"static"};return Si.jsxs("div",{className:"border rounded-lg p-3 space-y-2",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx(Op,{className:"text-sm font-medium",children:e}),Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>(e=>{const s={...v.queryParameters};delete s[e],y({...v,queryParameters:s})})(e),children:Si.jsx(al,{className:"h-4 w-4"})})]}),Si.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Si.jsxs("div",{children:[Si.jsx(Op,{className:"text-xs text-gray-600",children:"Parameter Source"}),Si.jsxs(zp,{value:t.source||"static",onValueChange:s=>y({...v,queryParameters:{...v.queryParameters,[e]:{...t,source:s,..."static"===s&&{dbColumn:void 0,dbTable:void 0}}}}),children:[Si.jsx(Kp,{className:"h-8",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"static",children:"Static Value"}),Si.jsx(Hp,{value:"database",children:"Database Column"}),Si.jsx(Hp,{value:"context",children:"Page Context"})]})]})]}),Si.jsxs("div",{children:["static"===t.source&&Si.jsxs(Si.Fragment,{children:[Si.jsx(Op,{className:"text-xs text-gray-600",children:"Static Value"}),Si.jsx(kx,{value:t.value||"",onChange:s=>y({...v,queryParameters:{...v.queryParameters,[e]:{...t,value:s.target.value}}}),className:"h-8",placeholder:"Enter static value"})]}),"database"===t.source&&Si.jsxs(Si.Fragment,{children:[Si.jsx(Op,{className:"text-xs text-gray-600",children:"Database Table"}),Si.jsxs(zp,{value:t.dbTable||"",onValueChange:s=>y({...v,queryParameters:{...v.queryParameters,[e]:{...t,dbTable:s,dbColumn:""}}}),children:[Si.jsx(Kp,{className:"h-8",children:Si.jsx(Bp,{placeholder:"Select table"})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"clients",children:"clients"}),Si.jsx(Hp,{value:"contracts",children:"contracts"}),Si.jsx(Hp,{value:"services",children:"services"}),Si.jsx(Hp,{value:"users",children:"users"}),Si.jsx(Hp,{value:"proposals",children:"proposals"}),Si.jsx(Hp,{value:"service_scopes",children:"service_scopes"})]})]})]}),"context"===t.source&&Si.jsxs(Si.Fragment,{children:[Si.jsx(Op,{className:"text-xs text-gray-600",children:"Context Variable"}),Si.jsxs(zp,{value:t.contextVar||"",onValueChange:s=>y({...v,queryParameters:{...v.queryParameters,[e]:{...t,contextVar:s}}}),children:[Si.jsx(Kp,{className:"h-8",children:Si.jsx(Bp,{placeholder:"Select context"})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"clientId",children:"Client ID"}),Si.jsx(Hp,{value:"clientShortName",children:"Client Short Name"}),Si.jsx(Hp,{value:"clientName",children:"Client Name"}),Si.jsx(Hp,{value:"clientDomain",children:"Client Domain"}),Si.jsx(Hp,{value:"contractId",children:"Contract ID"}),Si.jsx(Hp,{value:"userId",children:"Current User ID"})]})]})]})]})]}),"database"===t.source&&t.dbTable&&Si.jsxs("div",{children:[Si.jsx(Op,{className:"text-xs text-gray-600",children:"Database Column"}),Si.jsxs(zp,{value:t.dbColumn||"",onValueChange:s=>y({...v,queryParameters:{...v.queryParameters,[e]:{...t,dbColumn:s}}}),children:[Si.jsx(Kp,{className:"h-8",children:Si.jsx(Bp,{placeholder:"Select column"})}),Si.jsx(Wp,{children:(a=t.dbTable,{clients:["id","name","shortName","domain","industry","companySize","status","source","address","website"],contracts:["id","clientId","name","startDate","endDate","autoRenewal","totalValue","status"],services:["id","name","category","description","deliveryModel","basePrice","pricingUnit","isActive"],users:["id","username","email","firstName","lastName","role","authProvider","isActive"],proposals:["id","contractId","name","description","status","totalValue","validUntil"],service_scopes:["id","contractId","serviceId","scopeDefinition","safDocumentUrl","safStartDate","safEndDate"]}[a]||[]).map((e=>Si.jsx(Hp,{value:e,children:e},e)))})]})]}),"database"===t.source&&Si.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"💡 Value will be fetched from database column based on current page context (e.g., client ID from URL)"}),"context"===t.source&&Si.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"💡 Value will be taken from current page context automatically"})]},e);var a})),0===Object.keys(v.queryParameters).length&&Si.jsx("p",{className:"text-sm text-gray-500",children:"No parameters configured"})]})]})]})]})]}),Si.jsx($p,{value:"display",className:"space-y-4",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Display Configuration"})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"display-type",children:"Display Type"}),Si.jsxs(zp,{value:v.displayType,onValueChange:e=>y({...v,displayType:e}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"table",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Jl,{className:"h-4 w-4 mr-2"}),"Table"]})}),Si.jsx(Hp,{value:"list",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Xl,{className:"h-4 w-4 mr-2"}),"List"]})}),Si.jsx(Hp,{value:"query",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Sl,{className:"h-4 w-4 mr-2"}),"Raw Query Results"]})}),Si.jsx(Hp,{value:"chart",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Vr,{className:"h-4 w-4 mr-2"}),"Chart"]})}),Si.jsx(Hp,{value:"number",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx("span",{className:"h-4 w-4 mr-2 text-center font-bold text-blue-600",children:"#"}),"Number Display (Count/Sum)"]})}),Si.jsx(Hp,{value:"percentage",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx("span",{className:"h-4 w-4 mr-2 text-center font-bold text-green-600",children:"%"}),"Percentage (Average)"]})}),Si.jsx(Hp,{value:"progress",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Nl,{className:"h-4 w-4 mr-2"}),"Progress Bar"]})}),Si.jsx(Hp,{value:"gauge",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Zl,{className:"h-4 w-4 mr-2"}),"Gauge/Meter"]})}),Si.jsx(Hp,{value:"trend",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(yl,{className:"h-4 w-4 mr-2"}),"Trend Indicator"]})}),Si.jsx(Hp,{value:"statistic",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Vr,{className:"h-4 w-4 mr-2"}),"Statistic Card (Min/Max/Avg)"]})}),Si.jsx(Hp,{value:"summary",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Sl,{className:"h-4 w-4 mr-2"}),"Summary Card"]})}),Si.jsx(Hp,{value:"metric",children:Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Zl,{className:"h-4 w-4 mr-2"}),"Legacy Metric/KPI"]})})]})]}),Si.jsx("p",{className:"text-xs text-gray-500 mt-1",children:((e,s)=>{const t=s?` with ${s}`:"";switch(e){case"number":return`Large number display${t}. Perfect for counts and totals.`;case"percentage":return`Percentage display${t}. Shows values as percentages with % symbol.`;case"progress":return`Progress bar${t}. Shows completion or ratio as a filled bar.`;case"gauge":return`Circular gauge${t}. Shows value within a range.`;case"trend":return`Trend indicator${t}. Shows up/down direction with arrows.`;case"statistic":return`Statistical summary${t}. Perfect for min/max/average displays.`;case"summary":return`Summary card${t}. Combines multiple metrics in one card.`;case"table":return"Tabular data display. Best for detailed raw data viewing.";case"chart":return"Graphical chart display. Visualizes data patterns and trends.";case"list":return"Simple list format. Good for key-value pairs and simple data.";case"query":return"Raw query results. Shows unprocessed data from the system.";default:return"Choose the best display format for your data type."}})(v.displayType,null==(n=v.aggregation)?void 0:n.function)})]}),"chart"===v.displayType&&Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"chart-type",children:"Chart Type"}),Si.jsxs(zp,{value:v.chartType||"bar",onValueChange:e=>y({...v,chartType:e}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"bar",children:"Bar Chart"}),Si.jsx(Hp,{value:"line",children:"Line Chart"}),Si.jsx(Hp,{value:"pie",children:"Pie Chart"}),Si.jsx(Hp,{value:"area",children:"Area Chart"})]})]})]})]}),Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"widget-width",children:"Width"}),Si.jsxs(zp,{value:v.styling.width,onValueChange:e=>y({...v,styling:{...v.styling,width:e}}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"full",children:"Full Width"}),Si.jsx(Hp,{value:"half",children:"Half Width"}),Si.jsx(Hp,{value:"third",children:"One Third"}),Si.jsx(Hp,{value:"quarter",children:"Quarter Width"})]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"widget-height",children:"Height"}),Si.jsxs(zp,{value:v.styling.height,onValueChange:e=>y({...v,styling:{...v.styling,height:e}}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"small",children:"Small (200px)"}),Si.jsx(Hp,{value:"medium",children:"Medium (300px)"}),Si.jsx(Hp,{value:"large",children:"Large (400px)"})]})]})]})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{children:"Display Options"}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsxs("label",{className:"flex items-center space-x-2",children:[Si.jsx("input",{type:"checkbox",checked:v.styling.showBorder,onChange:e=>y({...v,styling:{...v.styling,showBorder:e.target.checked}})}),Si.jsx("span",{children:"Show Border"})]}),Si.jsxs("label",{className:"flex items-center space-x-2",children:[Si.jsx("input",{type:"checkbox",checked:v.styling.showHeader,onChange:e=>y({...v,styling:{...v.styling,showHeader:e.target.checked}})}),Si.jsx("span",{children:"Show Header"})]})]})]})]})]})}),Si.jsx($p,{value:"aggregation",className:"space-y-4",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Data Aggregation & Processing"})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"aggregation-function",children:"Aggregation Function"}),Si.jsxs(zp,{value:(null==(r=v.aggregation)?void 0:r.function)||"none",onValueChange:e=>{var s;y("none"===e?{...v,aggregation:void 0}:{...v,aggregation:{function:e,field:(null==(s=v.aggregation)?void 0:s.field)||""}})},children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select aggregation function"})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"none",children:"No Aggregation"}),Si.jsx(Hp,{value:"count",children:"Count"}),Si.jsx(Hp,{value:"sum",children:"Sum"}),Si.jsx(Hp,{value:"avg",children:"Average"}),Si.jsx(Hp,{value:"min",children:"Minimum"}),Si.jsx(Hp,{value:"max",children:"Maximum"})]})]}),Si.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Apply mathematical functions to aggregate the data (useful for metrics and charts)"})]}),v.aggregation&&"count"!==v.aggregation.function&&Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"aggregation-field",children:"Aggregation Field"}),Si.jsx(kx,{id:"aggregation-field",value:v.aggregation.field||"",onChange:e=>y({...v,aggregation:{...v.aggregation,field:e.target.value}}),placeholder:"Field name to aggregate (e.g., 'priority', 'status')"}),Si.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Specify the field name to perform ",v.aggregation.function," operation on"]})]}),Si.jsx(Cp,{}),Si.jsxs("div",{children:[Si.jsx(Op,{children:"Data Filters"}),Si.jsxs("div",{className:"space-y-2 mt-2",children:[null==(l=v.filters)?void 0:l.map(((e,s)=>Si.jsxs("div",{className:"flex space-x-2 items-center",children:[Si.jsx(kx,{placeholder:"Field name",value:e.field,onChange:s=>C(e.id,{field:s.target.value}),className:"flex-1"}),Si.jsxs(zp,{value:e.dataType,onValueChange:s=>C(e.id,{dataType:s}),children:[Si.jsx(Kp,{className:"w-24",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"string",children:"Text"}),Si.jsx(Hp,{value:"number",children:"Number"}),Si.jsx(Hp,{value:"date",children:"Date"}),Si.jsx(Hp,{value:"boolean",children:"Boolean"}),Si.jsx(Hp,{value:"array",children:"Array"})]})]}),Si.jsxs(zp,{value:e.operator,onValueChange:s=>C(e.id,{operator:s}),children:[Si.jsx(Kp,{className:"w-32",children:Si.jsx(Bp,{})}),Si.jsx(Wp,{children:S(e.dataType).map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})]}),Si.jsx(kx,{placeholder:"Value",value:e.value,onChange:s=>C(e.id,{value:s.target.value}),className:"flex-1"}),"between"===e.operator&&Si.jsx(kx,{placeholder:"To value",value:e.value2||"",onChange:s=>C(e.id,{value2:s.target.value}),className:"flex-1"}),Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>{return s=e.id,void y({...v,filters:(null==(t=v.filters)?void 0:t.filter((e=>e.id!==s)))||[]});var s,t},children:Si.jsx(al,{className:"h-4 w-4"})})]},e.id||s))),Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>{const e=prompt("Enter field name to filter (e.g., 'status', 'priority', 'amount'):");if(e&&e.trim()){const s={id:Date.now().toString(),field:e.trim(),operator:"equals",value:"",dataType:"string",enabled:!0};y({...v,filters:[...v.filters||[],s]})}},children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Filter"]})]}),Si.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add filters to process and refine the data before display"})]}),Si.jsx(Cp,{}),Si.jsxs("div",{children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx(Op,{children:"Chart Grouping & Data Processing"}),g.length>0&&Si.jsxs(Sx,{variant:"secondary",className:"bg-green-100 text-green-800",children:[Si.jsx(Dl,{className:"h-3 w-3 mr-1"}),g.length," fields detected"]})]}),Si.jsxs("div",{className:"space-y-4 mt-2 p-4 border rounded-lg bg-gray-50",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("input",{type:"checkbox",id:"enable-groupby",checked:!!v.groupBy,onChange:e=>{e.target.checked?y({...v,groupBy:{field:g.length>0?g[0]:"",valueField:"",aggregationFunction:"count",limit:10,sortBy:"desc"}}):y({...v,groupBy:void 0})},className:"rounded"}),Si.jsx(Op,{htmlFor:"enable-groupby",className:"text-sm font-medium",children:"Enable Group By (recommended for charts)"})]}),0===g.length&&Si.jsx("div",{className:"bg-blue-50 p-3 rounded border-l-4 border-blue-400",children:Si.jsxs("div",{className:"flex items-start justify-between",children:[Si.jsxs("p",{className:"text-sm text-blue-800",children:[Si.jsx(Nl,{className:"h-4 w-4 inline mr-1"}),Si.jsx("strong",{children:"Tip:"}),' Test your query first in the "Test & Preview" tab to automatically populate field dropdowns with available data fields.']}),Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>f("preview"),className:"ml-2 text-xs",children:"Go to Test"})]})}),g.length>0&&Si.jsxs("div",{className:"flex items-center justify-between bg-green-50 p-2 rounded",children:[Si.jsxs("span",{className:"text-sm text-green-800",children:[Si.jsx(Dl,{className:"h-4 w-4 inline mr-1"}),"Fields detected from query test"]}),Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>f("preview"),className:"text-xs",children:[Si.jsx(ul,{className:"h-3 w-3 mr-1"}),"Re-test Query"]})]}),v.groupBy&&Si.jsxs("div",{className:"space-y-3",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"groupby-field",children:"Group By Field (X-axis)"}),g.length>0?Si.jsxs(zp,{value:v.groupBy.field,onValueChange:e=>y({...v,groupBy:{...v.groupBy,field:e}}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select field to group by..."})}),Si.jsx(Wp,{children:g.filter((e=>e&&""!==e.trim())).map((e=>Si.jsx(Hp,{value:e,children:e},e)))})]}):Si.jsx(kx,{id:"groupby-field",value:v.groupBy.field,onChange:e=>y({...v,groupBy:{...v.groupBy,field:e.target.value}}),placeholder:"Field to group by (e.g., 'status', 'priority', 'project')"}),Si.jsx("p",{className:"text-xs text-gray-500 mt-1",children:g.length>0?`Choose from ${g.length} available fields (detected from test query)`:"This field will be used as the X-axis for charts. Test your query first to see available fields."})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"groupby-value-field",children:"Value Field (Y-axis) - Optional"}),g.length>0?Si.jsxs(zp,{value:v.groupBy.valueField||"__none__",onValueChange:e=>y({...v,groupBy:{...v.groupBy,valueField:"__none__"===e?"":e}}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select value field (optional)..."})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"__none__",children:"No specific field (use count)"}),g.filter((e=>e&&""!==e.trim())).map((e=>Si.jsx(Hp,{value:e,children:e},e)))]})]}):Si.jsx(kx,{id:"groupby-value-field",value:v.groupBy.valueField||"",onChange:e=>y({...v,groupBy:{...v.groupBy,valueField:e.target.value}}),placeholder:"Field for values (e.g., 'amount', 'count', 'duration')"}),Si.jsx("p",{className:"text-xs text-gray-500 mt-1",children:g.length>0?"Leave empty to count items per group, or select a numeric field for values":"Leave empty to count items per group, or specify field for numeric values. Test your query first to see available fields."})]}),Si.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"groupby-aggregation",children:"Aggregation Function"}),Si.jsxs(zp,{value:v.groupBy.aggregationFunction||"count",onValueChange:e=>y({...v,groupBy:{...v.groupBy,aggregationFunction:e}}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"count",children:"Count"}),Si.jsx(Hp,{value:"sum",children:"Sum"}),Si.jsx(Hp,{value:"avg",children:"Average"}),Si.jsx(Hp,{value:"min",children:"Minimum"}),Si.jsx(Hp,{value:"max",children:"Maximum"})]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"groupby-sort",children:"Sort Order"}),Si.jsxs(zp,{value:v.groupBy.sortBy||"desc",onValueChange:e=>y({...v,groupBy:{...v.groupBy,sortBy:e}}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"desc",children:"Highest First"}),Si.jsx(Hp,{value:"asc",children:"Lowest First"})]})]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"groupby-limit",children:"Max Groups to Show"}),Si.jsx(kx,{id:"groupby-limit",type:"number",min:"5",max:"50",value:v.groupBy.limit||10,onChange:e=>y({...v,groupBy:{...v.groupBy,limit:parseInt(e.target.value)||10}})}),Si.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Limit the number of groups to display (5-50)"})]}),g.length>0&&Si.jsxs("div",{className:"bg-green-50 p-3 rounded border-l-4 border-green-400",children:[Si.jsx("p",{className:"text-sm text-green-800 mb-2",children:Si.jsx("strong",{children:"Available Fields:"})}),Si.jsx("div",{className:"flex flex-wrap gap-1",children:g.map((e=>Si.jsx(Sx,{variant:"outline",className:"text-xs",children:e},e)))})]}),Si.jsx("div",{className:"bg-blue-50 p-3 rounded border-l-4 border-blue-400",children:Si.jsxs("p",{className:"text-sm text-blue-800",children:[Si.jsx("strong",{children:"Example:"}),' Group by "status" with count function will show how many issues exist for each status (Open: 45, In Progress: 23, Done: 67)']})})]})]}),Si.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Configure how data should be grouped and aggregated for charts and analysis"})]}),Si.jsx(Cp,{}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"refresh-interval",children:"Refresh Interval (seconds)"}),Si.jsx(kx,{id:"refresh-interval",type:"number",min:"10",max:"3600",value:v.refreshInterval,onChange:e=>y({...v,refreshInterval:parseInt(e.target.value)||30})}),Si.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How often the widget data should be refreshed (minimum 10 seconds)"})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"widget-placement",children:"Dashboard Placement"}),Si.jsxs(zp,{value:v.placement,onValueChange:e=>y({...v,placement:e}),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"client-details",children:"Client Detail Pages"}),Si.jsx(Hp,{value:"global-dashboard",children:"Global Dashboard"}),Si.jsx(Hp,{value:"custom",children:"Custom Placement"})]})]}),Si.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Where this widget will appear in the dashboard"})]})]})]})}),Si.jsx($p,{value:"preview",className:"space-y-4",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Test & Preview"})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"flex space-x-2",children:[Si.jsxs(Ex,{onClick:async()=>{if(v.pluginName&&v.instanceId)try{m(!0),x(null),j([]);let e="",s=null;const t={...v.queryParameters,...i&&{clientShortName:i.clientShortName,clientName:i.clientName,...i.clientDomain&&{clientDomain:i.clientDomain}}};if("default"===v.queryType&&v.queryId)e=`/api/plugins/${v.pluginName}/instances/${v.instanceId}/default-query/${v.queryId}`,Object.keys(t).length>0&&(s={parameters:t});else{if("custom"!==v.queryType||!v.customQuery)throw new Error("Please configure a query first");e=`/api/plugins/${v.pluginName}/instances/${v.instanceId}/query`,s={query:v.customQuery,method:v.queryMethod,parameters:t}}const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:s?JSON.stringify(s):null}),n=await a.json();if(x(n),n.success&&n.data){const e=w(n.data);j(e)}}catch(e){x({success:!1,error:e instanceof Error?e.message:"Test failed"})}finally{m(!1)}else alert("Please select a plugin and instance first")},disabled:u,children:[u?Si.jsx(kr,{className:"h-4 w-4 animate-spin mr-2"}):Si.jsx(el,{className:"h-4 w-4 mr-2"}),"Test Query"]}),Si.jsx(Ex,{variant:"outline",onClick:()=>x(null),children:"Clear Results"})]}),h&&Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"p-4 rounded-lg "+(h.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"),children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[h.success?Si.jsx(Dl,{className:"h-5 w-5 text-green-600"}):Si.jsx(vl,{className:"h-5 w-5 text-red-600"}),Si.jsx("span",{className:"font-medium "+(h.success?"text-green-800":"text-red-800"),children:h.success?"Query executed successfully":"Query failed"})]}),h.error&&Si.jsx("p",{className:"text-red-700 mt-2",children:h.error})]}),h.success&&h.data&&Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{children:"Query Results Summary"}),Si.jsx("div",{className:"bg-blue-50 border border-blue-200 p-3 rounded-lg mt-2",children:Si.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[Si.jsxs("span",{children:[Si.jsx("strong",{children:"Total Results:"})," ",h.data.totalResults||h.data.total||"Unknown"]}),h.data.displayedSample&&Si.jsxs("span",{children:[Si.jsx("strong",{children:"Sample Shown:"})," ",h.data.displayedSample," records"]}),(null==(c=h.metadata)?void 0:c.responseTime)&&Si.jsxs("span",{children:[Si.jsx("strong",{children:"Response Time:"})," ",h.metadata.responseTime]}),Si.jsxs("span",{children:[Si.jsx("strong",{children:"Display Type:"})," ",v.displayType]})]})})]}),g.length>0&&Si.jsxs("div",{children:[Si.jsxs(Op,{children:["Detected Data Fields (",g.length,")"]}),Si.jsxs("div",{className:"bg-green-50 border border-green-200 p-3 rounded-lg mt-2",children:[Si.jsx("div",{className:"flex flex-wrap gap-1",children:g.map((e=>Si.jsx(Sx,{variant:"outline",className:"text-xs bg-white",children:e},e)))}),Si.jsx("p",{className:"text-xs text-green-700 mt-2",children:'These fields are now available in the Group By dropdowns in the "Advanced" tab.'})]})]}),Si.jsxs("div",{children:[Si.jsxs(Op,{children:["Widget Preview (",v.displayType,")"]}),Si.jsx("div",{className:"border rounded-lg mt-2 p-4 bg-white min-h-64",children:Si.jsx(Gj,{widget:{...v,id:"preview",name:`Preview: ${v.name||"Test Widget"}`},clientShortName:null==i?void 0:i.clientShortName,className:"shadow-none border-0",previewData:h.data.sampleData||h.data.issues||h.data})})]}),Si.jsxs("details",{className:"border rounded-lg",children:[Si.jsx("summary",{className:"px-3 py-2 bg-gray-50 cursor-pointer text-sm font-medium",children:"Raw Response Data"}),Si.jsx("div",{className:"p-3",children:Si.jsx("pre",{className:"bg-gray-100 p-3 rounded text-xs overflow-auto max-h-64",children:JSON.stringify(h.data,null,2)})})]})]})]})]})]})})]}),Si.jsxs("div",{className:"flex justify-end space-x-2",children:[Si.jsx(Ex,{variant:"outline",onClick:s,children:"Cancel"}),Si.jsxs(Ex,{onClick:()=>{v.name&&v.pluginName&&v.instanceId?"default"!==v.queryType||v.queryId?"custom"!==v.queryType||v.customQuery?e(v):alert("Please enter a custom query"):alert("Please select a default query"):alert("Please fill in all required fields")},children:[Si.jsx(Zr,{className:"h-4 w-4 mr-2"}),"Save Widget"]})]})]})},ZC=({onClose:e})=>{var s,t,a,i,n,r,l,c;const[o,d]=$n.useState([]),[u,m]=$n.useState([]),[h,x]=$n.useState(!0),[p,f]=$n.useState(null),[g,j]=$n.useState(""),[v,y]=$n.useState("all"),[b,N]=$n.useState("all"),[w,C]=$n.useState(!1),[S,T]=$n.useState(),[k,D]=$n.useState(),[E,A]=$n.useState([]),[P,_]=$n.useState({});$n.useEffect((()=>{F()}),[]),$n.useEffect((()=>{L()}),[o,g,v,b]);const F=async()=>{try{x(!0),f(null);const e=await fetch("/api/widgets/manage",{credentials:"include"});if(!e.ok)throw new Error(`Failed to load widgets: ${e.statusText}`);const s=await e.json();d(s)}catch(e){f(e instanceof Error?e.message:"Failed to load widgets")}finally{x(!1)}},L=()=>{let e=o;g&&(e=e.filter((e=>e.name.toLowerCase().includes(g.toLowerCase())||e.description.toLowerCase().includes(g.toLowerCase())||e.pluginName.toLowerCase().includes(g.toLowerCase())))),"all"!==v&&(e=e.filter((e=>"global"===v?e.isGlobal:!e.isGlobal))),"all"!==b&&(e=e.filter((e=>e.widgetType===b))),m(e)},I=()=>{T(void 0),C(!0)},R=e=>e.isGlobal&&e.isActive?Si.jsx(ec,{className:"h-4 w-4 text-green-600"}):e.isGlobal&&!e.isActive?Si.jsx(sc,{className:"h-4 w-4 text-orange-600"}):!e.isGlobal&&e.isActive?Si.jsx(Sl,{className:"h-4 w-4 text-blue-600"}):Si.jsx(tc,{className:"h-4 w-4 text-gray-400"}),q=e=>e.isGlobal&&e.isActive?"Global & Active":e.isGlobal&&!e.isActive?"Global & Inactive":!e.isGlobal&&e.isActive?"Local & Active":"Local & Inactive",O=async e=>{if(!P[e]){const s=await(async e=>{try{const s=await fetch(`/api/plugins/${e}/instances`),t=await s.json();if(t.instances&&t.instances.length>0){const e=t.instances.find((e=>e.id.includes("main")||e.name.toLowerCase().includes("main")));if(e)return e.id;const s=t.instances.find((e=>e.isActive));return s?s.id:t.instances[0].id}return`${e}-main`}catch(s){return`${e}-main`}})(e);return _((t=>({...t,[e]:s}))),s}return P[e]};return h?Si.jsx("div",{className:"p-6",children:Si.jsxs("div",{className:"flex items-center justify-center py-8",children:[Si.jsx(ul,{className:"h-6 w-6 animate-spin mr-2"}),Si.jsx("span",{children:"Loading widgets..."})]})}):p?Si.jsx("div",{className:"p-6",children:Si.jsxs(Nx,{className:"border-red-200 bg-red-50",children:[Si.jsx(vl,{className:"h-4 w-4 text-red-600"}),Si.jsxs(wx,{className:"text-red-800",children:[Si.jsx("strong",{children:"Error:"})," ",p,Si.jsx(Ex,{variant:"outline",size:"sm",className:"ml-2",onClick:F,children:"Retry"})]})]})}):Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h2",{className:"text-2xl font-bold",children:"Global Widget Manager"}),Si.jsx("p",{className:"text-muted-foreground",children:"Create and manage widgets that can be deployed globally to all client pages"})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsxs(Ex,{onClick:I,children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Create Widget"]}),e&&Si.jsx(Ex,{variant:"outline",onClick:e,children:"Close"})]})]}),Si.jsx(Ax,{children:Si.jsx(Lx,{className:"p-4",children:Si.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[Si.jsx("div",{className:"flex-1 min-w-[200px]",children:Si.jsxs("div",{className:"relative",children:[Si.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),Si.jsx(kx,{placeholder:"Search widgets...",value:g,onChange:e=>j(e.target.value),className:"pl-10"})]})}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(rl,{className:"h-4 w-4 text-muted-foreground"}),Si.jsxs(zp,{value:v,onValueChange:e=>y(e),children:[Si.jsx(Kp,{className:"w-32",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Widgets"}),Si.jsx(Hp,{value:"global",children:"Global Only"}),Si.jsx(Hp,{value:"local",children:"Local Only"})]})]}),Si.jsxs(zp,{value:b,onValueChange:e=>N(e),children:[Si.jsx(Kp,{className:"w-32",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Types"}),Si.jsx(Hp,{value:"table",children:"Table"}),Si.jsx(Hp,{value:"chart",children:"Chart"}),Si.jsx(Hp,{value:"metric",children:"Metric"}),Si.jsx(Hp,{value:"list",children:"List"}),Si.jsx(Hp,{value:"gauge",children:"Gauge"})]})]})]}),Si.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground",children:[Si.jsxs("span",{children:[u.length," widgets"]}),Si.jsxs("div",{className:"flex items-center space-x-1",children:[Si.jsx(ql,{className:"h-3 w-3"}),Si.jsxs("span",{children:[o.filter((e=>e.isGlobal)).length," global"]})]})]})]})})}),u.length>0?Si.jsx("div",{className:"grid gap-4",children:u.map((e=>Si.jsx(Ax,{className:"hover:shadow-md transition-shadow",children:Si.jsx(Lx,{className:"p-4",children:Si.jsxs("div",{className:"flex items-start justify-between",children:[Si.jsxs("div",{className:"flex-1",children:[Si.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[R(e),Si.jsx("h3",{className:"font-semibold",children:e.name}),Si.jsx(Sx,{variant:"outline",children:e.pluginName}),Si.jsx(Sx,{variant:"secondary",children:e.widgetType}),e.isGlobal&&Si.jsxs(Sx,{className:"bg-green-100 text-green-800",children:[Si.jsx(ql,{className:"h-3 w-3 mr-1"}),"Global"]})]}),Si.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:e.description||"No description provided"}),Si.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[Si.jsxs("span",{children:["Status: ",q(e)]}),Si.jsxs("span",{children:["Refresh: ",e.refreshInterval,"s"]}),Si.jsxs("span",{children:["Created: ",new Date(e.createdAt).toLocaleDateString()]})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsxs("div",{className:"flex items-center space-x-1",children:[Si.jsx(Op,{htmlFor:`global-${e.id}`,className:"text-xs",children:"Global"}),Si.jsx(df,{id:`global-${e.id}`,checked:e.isGlobal,onCheckedChange:()=>(async e=>{try{const s=await fetch(`/api/widgets/manage/${e}/toggle-global`,{method:"PATCH",credentials:"include"});if(!s.ok)throw new Error(`Failed to toggle global status: ${s.statusText}`);await F()}catch(s){alert(`Failed to toggle global status: ${s instanceof Error?s.message:"Unknown error"}`)}})(e.id)})]}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(async e=>{await O(e.pluginName),D(e)})(e),children:Si.jsx(Sl,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(async e=>{await O(e.pluginName),T(e),C(!0)})(e),children:Si.jsx(tl,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s={...e,id:`${e.id}-copy-${Date.now()}`,name:`${e.name} (Copy)`,isGlobal:!1,createdBy:0,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};T(s),C(!0)})(e),children:Si.jsx(El,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this widget?"))try{const s=await fetch(`/api/widgets/manage/${e}`,{method:"DELETE",credentials:"include"});if(!s.ok)throw new Error(`Failed to delete widget: ${s.statusText}`);await F()}catch(s){alert(`Failed to delete widget: ${s instanceof Error?s.message:"Unknown error"}`)}})(e.id),className:"text-red-600 hover:text-red-700",children:Si.jsx(al,{className:"h-4 w-4"})})]})]})})},e.id)))}):Si.jsx(Ax,{children:Si.jsxs(Lx,{className:"p-8 text-center",children:[Si.jsx(Vr,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),Si.jsx("h3",{className:"text-lg font-semibold mb-2",children:0===o.length?"No widgets found":"No widgets match your filters"}),Si.jsx("p",{className:"text-muted-foreground mb-4",children:0===o.length?"Create your first global widget to get started.":"Try adjusting your search or filter criteria."}),0===o.length&&Si.jsxs(Ex,{onClick:I,children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Create Widget"]})]})}),Si.jsx(Sp,{open:w,onOpenChange:C,children:Si.jsxs(Ep,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:S?"Edit Widget":"Create New Widget"})}),w&&Si.jsx(XC,{onSave:async e=>{const s=S?`/api/widgets/manage/${S.id}`:"/api/widgets/manage",t=S?"PUT":"POST";try{const a={name:e.name,description:e.description,pluginName:e.pluginName,widgetType:e.displayType,chartType:e.chartType,query:e.customQuery||"",method:e.queryMethod||"GET",parameters:e.queryParameters||{},displayConfig:e.styling||{},refreshInterval:e.refreshInterval||30,isGlobal:"global-dashboard"===e.placement},i=await fetch(s,{method:t,headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(a)});if(!i.ok){const e=await i.json();throw new Error(e.message||`Failed to save widget: ${i.statusText}`)}await F(),T(void 0),C(!1)}catch(a){alert(`Failed to save widget: ${a instanceof Error?a.message:"Unknown error"}`)}},onCancel:()=>{C(!1),T(void 0)},editingWidget:S?{id:S.id,name:S.name,description:S.description,pluginName:S.pluginName,instanceId:P[S.pluginName]||`${S.pluginName}-main`,queryType:"custom",customQuery:S.query,queryMethod:S.method,queryParameters:S.parameters,displayType:S.widgetType,refreshInterval:S.refreshInterval,placement:"global-dashboard",styling:{width:(null==(s=S.displayConfig)?void 0:s.width)||"full",height:(null==(t=S.displayConfig)?void 0:t.height)||"medium",showBorder:!1!==(null==(a=S.displayConfig)?void 0:a.showBorder),showHeader:!1!==(null==(i=S.displayConfig)?void 0:i.showHeader)},chartType:S.chartType}:void 0})]})}),Si.jsx(Sp,{open:!!k,onOpenChange:()=>D(void 0),children:Si.jsxs(Ep,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[Si.jsx(Ap,{children:Si.jsxs(_p,{children:["Widget Preview: ",null==k?void 0:k.name]})}),k&&Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{variant:"outline",children:k.pluginName}),Si.jsx(Sx,{variant:"secondary",children:k.widgetType}),k.isGlobal&&Si.jsxs(Sx,{className:"bg-green-100 text-green-800",children:[Si.jsx(ql,{className:"h-3 w-3 mr-1"}),"Global"]})]}),Si.jsx(Gj,{widget:{id:k.id,name:k.name,description:k.description,pluginName:k.pluginName,instanceId:P[k.pluginName]||`${k.pluginName}-main`,queryType:"custom",customQuery:k.query,queryMethod:k.method,queryParameters:k.parameters,displayType:k.widgetType,refreshInterval:k.refreshInterval,placement:"global-dashboard",styling:{width:(null==(n=k.displayConfig)?void 0:n.width)||"full",height:(null==(r=k.displayConfig)?void 0:r.height)||"medium",showBorder:!1!==(null==(l=k.displayConfig)?void 0:l.showBorder),showHeader:!1!==(null==(c=k.displayConfig)?void 0:c.showHeader)},chartType:k.chartType,enabled:k.isActive},clientShortName:"DEMO"},`${k.id}-demo`)]})]})})]})};function eS(){const{id:e}=Ro(),[,s]=Oo(),[t,a]=$n.useState(!1),[i,n]=$n.useState(!1),[r,l]=$n.useState(!1),{toast:c}=sd(),o=e?parseInt(e,10):null,{data:d,isLoading:u,error:m}=fh({queryKey:["/api/clients",o],queryFn:async()=>{if(!o)throw new Error("No client ID provided");const e=await fetch(`/api/clients/${o}`,{credentials:"include"});if(!e.ok){const s=await e.text();throw new Error(`Failed to fetch client: ${e.status} ${s}`)}return await e.json()},enabled:!!o}),{data:h=[]}=fh({queryKey:["/api/contracts","client",e],queryFn:async()=>{if(!e)return[];const s=await fetch(`/api/contracts?clientId=${e}`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch client contracts");return s.json()},enabled:!!e&&!!d}),{data:x=[]}=fh({queryKey:["/api/proposals","client",e],queryFn:async()=>{if(!e)return[];const s=await fetch(`/api/proposals?clientId=${e}`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch client proposals");return s.json()},enabled:!!e&&!!d}),{data:p=[]}=fh({queryKey:["/api/clients",e,"financial-transactions"],queryFn:async()=>{if(!e)return[];const s=await fetch(`/api/clients/${e}/financial-transactions`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch client financial transactions");return s.json()},enabled:!!e&&!!d}),{data:f=[]}=fh({queryKey:["/api/clients",e,"team-assignments"],queryFn:async()=>{if(!e)return[];const s=await fetch(`/api/clients/${e}/team-assignments`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch client team assignments");return s.json()},enabled:!!e&&!!d}),{data:g=[]}=fh({queryKey:["/api/users"],enabled:!!d}),{data:j=[]}=fh({queryKey:["/api/documents","client",e],queryFn:async()=>{if(!e)return[];const s=await fetch(`/api/documents?clientId=${e}`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch client documents");return s.json()},enabled:!!e&&!!d}),{data:v=[],isLoading:y}=fh({queryKey:["/api/service-scopes","client",e,null==h?void 0:h.length],queryFn:async()=>{if(!e)return[];try{const e=[];if(h&&h.length>0)for(const s of h){const t=await fetch(`/api/contracts/${s.id}/service-scopes`,{credentials:"include"});if(t.ok){const s=await t.json();e.push(...s)}}return e}catch(s){return[]}},enabled:!!e&&!!d&&void 0!==h&&Array.isArray(h)}),{data:b=[],isLoading:N}=fh({queryKey:["/api/services"],queryFn:async()=>{const e=await fetch("/api/services",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch services");return e.json()},enabled:!!d}),{data:w=[]}=fh({queryKey:["/api/clients",e,"licenses"],queryFn:async()=>{if(!e)return[];const s=await fetch(`/api/clients/${e}/licenses`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch client licenses");return s.json()},enabled:!!e&&!!d}),{data:C=[]}=fh({queryKey:["/api/license-pools"],enabled:!!d}),{data:S=[]}=fh({queryKey:["/api/client-hardware-assignments",e],queryFn:async()=>{if(!e)return[];const s=await fetch(`/api/clients/${e}/hardware`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch client hardware assignments");return s.json()},enabled:!!e&&!!d}),{data:T=[]}=fh({queryKey:["/api/hardware-assets"],enabled:!!d}),{data:k=[]}=fh({queryKey:["/api/individual-licenses","client",e],queryFn:async()=>{if(!e)return[];const s=await fetch(`/api/clients/${e}/individual-licenses`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch client individual licenses");return s.json()},enabled:!!e&&!!d}),{data:D=[]}=fh({queryKey:["/api/service-authorization-forms","client",e],queryFn:async()=>{if(!e)return[];const s=await fetch(`/api/clients/${e}/service-authorization-forms`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch client SAFs");return s.json()},enabled:!!e&&!!d}),{data:E=[]}=fh({queryKey:["/api/certificates-of-compliance","client",e],queryFn:async()=>{if(!e)return[];const s=await fetch(`/api/clients/${e}/certificates-of-compliance`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch client COCs");return s.json()},enabled:!!e&&!!d}),A=gh({mutationFn:async e=>(await vh("PUT",`/api/clients/${o}`,e)).json(),onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/clients",o]}),a(!1),c({title:"Success",description:"Client updated successfully"})},onError:e=>{c({title:"Error",description:"Failed to update client. Please try again.",variant:"destructive"})}}),P=gh({mutationFn:async e=>(await vh("POST",`/api/clients/${o}/licenses`,e)).json(),onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/clients",o,"licenses"]}),Nh.invalidateQueries({queryKey:["/api/license-pools"]}),n(!1),c({title:"Success",description:"License assigned successfully"})},onError:e=>{c({title:"Error",description:"Failed to assign license. Please try again.",variant:"destructive"})}}),_=async e=>{try{window.open(`/api/documents/${e.id}/download`,"_blank")}catch(s){c({title:"Error",description:"Failed to download document",variant:"destructive"})}},F=e=>{switch(e){case"contract":return"bg-blue-100 text-blue-800";case"compliance":return"bg-green-100 text-green-800";case"technical":return"bg-purple-100 text-purple-800";case"financial":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},L=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},I=e=>{const s=Number(e),t=b.find((e=>Number(e.id)===s));return(null==t?void 0:t.name)??`Service #${e}`},R=e=>{const s=C.find((s=>s.id===e));return(null==s?void 0:s.name)||"Unknown License Pool"},q=e=>{const s=T.find((s=>s.id===e));return(null==s?void 0:s.name)||"Unknown Asset"},O=e=>{const s=h.find((s=>s.id===e));return(null==s?void 0:s.name)||"Unknown Contract"},M=j.reduce(((e,s)=>{const t=s.documentType||"general";return e[t]||(e[t]=[]),e[t].push(s),e}),{}),V={total:j.length,contract:j.filter((e=>"contract"===e.documentType)).length,proposal:j.filter((e=>"proposal"===e.documentType)).length,technical:j.filter((e=>"technical"===e.documentType)).length,financial:j.filter((e=>"financial"===e.documentType)).length,service:j.filter((e=>"service"===e.documentType)).length,license:j.filter((e=>"license"===e.documentType)).length,compliance:j.filter((e=>"compliance"===e.documentType)).length,general:j.filter((e=>!e.documentType||"general"===e.documentType)).length},U=["contract","proposal","financial","technical","service","license","compliance","general"].filter((e=>{var s;return(null==(s=M[e])?void 0:s.length)>0})),$=(()=>{const e={};return v&&Array.isArray(v)?(v.forEach((s=>{const t=s.scopeDefinition;t&&"object"==typeof t&&Object.entries(t).forEach((([s,t])=>{"description"!==s&&"deliverables"!==s&&null!=t&&""!==t&&(e[s]||(e[s]=[]),Array.isArray(t)?e[s].push(...t):e[s].push(t))}))})),Object.entries(e).map((([e,s])=>{let t=e;t="va"===e.toLowerCase()||"vulnerability"===e.toLowerCase()?"Va":"edr"===e.toLowerCase()||"endpoint"===e.toLowerCase()?"Edr":"siem"===e.toLowerCase()||"security"===e.toLowerCase()?"Siem":e.replace(/([A-Z])/g," $1").replace(/^./,(e=>e.toUpperCase()));const a=[...new Set(s)];return{key:e,label:t,values:a,displayValue:1===a.length?a[0]:a.join(", ")}}))):[]})();return u?Si.jsx("div",{className:"flex items-center justify-center min-h-screen",children:Si.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):d?Si.jsxs(vf,{title:d.name,subtitle:"Client Profile & Management",children:[Si.jsx("main",{className:"flex-1 overflow-auto p-6 pt-16 md:pt-6",children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs(Ex,{variant:"outline",onClick:()=>s("/clients"),children:[Si.jsx(dl,{className:"h-4 w-4 mr-2"}),"Back to Clients"]}),Si.jsx("div",{className:"flex space-x-2",children:Si.jsxs(Sp,{open:t,onOpenChange:a,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{children:[Si.jsx(tl,{className:"h-4 w-4 mr-2"}),"Edit Client"]})}),Si.jsxs(Ep,{className:"max-w-2xl max-h-[85vh] overflow-hidden",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Edit Client Information"})}),Si.jsx(Zw,{client:d,onSubmit:e=>{A.mutate(e)},onCancel:()=>a(!1),isLoading:A.isPending})]})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[Si.jsxs(Ax,{className:"md:col-span-2",children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Qr,{className:"h-5 w-5 mr-2"}),"Client Information"]}),Si.jsxs("div",{className:"flex space-x-2",children:[Si.jsx(Sx,{className:QC(d.status||""),children:d.status||"Unknown"}),Si.jsx(Sx,{className:(e=>{switch(null==e?void 0:e.toLowerCase()){case"direct":return"bg-blue-100 text-blue-800";case"nca":return"bg-purple-100 text-purple-800";case"both":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}})(d.source||""),children:d.source||"Unknown"})]})]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Industry"}),Si.jsx("p",{className:"text-gray-900",children:d.industry||"Not specified"})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Company Size"}),Si.jsx("p",{className:"text-gray-900",children:d.companySize||"Not specified"})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Short Name"}),Si.jsx("p",{className:"text-gray-900",children:d.shortName||"Not specified"})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Domain"}),Si.jsx("p",{className:"text-gray-900",children:d.domain||"Not specified"})]})]}),d.website&&Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(ql,{className:"h-4 w-4 mr-2 text-gray-500"}),Si.jsx("a",{href:d.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:d.website})]}),d.address&&Si.jsxs("div",{className:"flex items-start",children:[Si.jsx(Ol,{className:"h-4 w-4 mr-2 text-gray-500 mt-1"}),Si.jsx("p",{className:"text-gray-900",children:d.address})]}),d.notes&&Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Notes"}),Si.jsx("p",{className:"text-gray-900 mt-1",children:d.notes})]}),Si.jsx("div",{className:"pt-2 border-t",children:Si.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[Si.jsx(jl,{className:"h-4 w-4 mr-1"}),"Created: ",Ru(d.createdAt),d.updatedAt&&d.updatedAt!==d.createdAt&&Si.jsxs("span",{className:"ml-4",children:["Last updated: ",Ru(d.updatedAt)]})]})})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Quick Stats"})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Kr,{className:"h-4 w-4 mr-2 text-blue-600"}),Si.jsx("span",{className:"text-sm",children:"Contracts"})]}),Si.jsx("span",{className:"font-medium",children:h.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Kr,{className:"h-4 w-4 mr-2 text-violet-600"}),Si.jsx("span",{className:"text-sm",children:"Proposals"})]}),Si.jsx("span",{className:"font-medium",children:x.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Mr,{className:"h-4 w-4 mr-2 text-purple-600"}),Si.jsx("span",{className:"text-sm",children:"Services"})]}),Si.jsx("span",{className:"font-medium",children:v.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Ul,{className:"h-4 w-4 mr-2 text-yellow-600"}),Si.jsx("span",{className:"text-sm",children:"Licenses"})]}),Si.jsx("span",{className:"font-medium",children:w.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(_r,{className:"h-4 w-4 mr-2 text-orange-600"}),Si.jsx("span",{className:"text-sm",children:"Hardware Assets"})]}),Si.jsx("span",{className:"font-medium",children:S.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Kr,{className:"h-4 w-4 mr-2 text-green-600"}),Si.jsx("span",{className:"text-sm",children:"Documents"})]}),Si.jsx("span",{className:"font-medium",children:j.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Gr,{className:"h-4 w-4 mr-2 text-purple-600"}),Si.jsx("span",{className:"text-sm",children:"SAFs"})]}),Si.jsx("span",{className:"font-medium",children:D.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Gr,{className:"h-4 w-4 mr-2 text-yellow-600"}),Si.jsx("span",{className:"text-sm",children:"COCs"})]}),Si.jsx("span",{className:"font-medium",children:E.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Ur,{className:"h-4 w-4 mr-2 text-green-600"}),Si.jsx("span",{className:"text-sm",children:"Transactions"})]}),Si.jsx("span",{className:"font-medium",children:p.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx($r,{className:"h-4 w-4 mr-2 text-orange-600"}),Si.jsx("span",{className:"text-sm",children:"Team Members"})]}),Si.jsx("span",{className:"font-medium",children:f.length})]}),$.length>0&&Si.jsx(Si.Fragment,{children:Si.jsxs("div",{className:"border-t pt-4 mt-4",children:[Si.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[Si.jsx(Mr,{className:"h-4 w-4 mr-2 text-blue-600"}),"Scope Details"]}),Si.jsx("div",{className:"space-y-2",children:$.map((e=>Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("div",{className:"flex items-center",children:Si.jsxs("span",{className:"text-sm text-gray-600",children:[e.label,":"]})}),Si.jsx("span",{className:"font-medium text-sm text-blue-700",children:e.displayValue})]},e.key)))})]})}),Si.jsx(YC,{clientShortName:d.shortName||""})]})]})]}),Si.jsx("div",{className:"mt-6",children:Si.jsx(JC,{clientId:o,clientShortName:(null==d?void 0:d.shortName)||"",clientName:(null==d?void 0:d.name)||"",clientDomain:null==d?void 0:d.domain,onManageWidgets:()=>l(!0)})}),Si.jsx("div",{className:"mt-6",children:Si.jsxs(Ax,{children:[Si.jsxs(Px,{children:[Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Kl,{className:"h-4 w-4 mr-2"}),"Entity Relationships"]}),Si.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Navigate through connected entities and their relationships"})]}),Si.jsx(Lx,{children:Si.jsx(KC,{entityType:EC.CLIENT,entityId:o,variant:"full",showSearch:!0,showStats:!0,maxItemsPerGroup:10})})]})}),Si.jsxs(Mp,{defaultValue:"contracts",className:"space-y-6",children:[Si.jsxs(Vp,{children:[Si.jsx(Up,{value:"contracts",children:"Contracts"}),Si.jsxs(Up,{value:"proposals",children:["Proposals (",x.length,")"]}),Si.jsxs(Up,{value:"services",children:["Services (",v.length,")"]}),Si.jsxs(Up,{value:"licenses",children:["Licenses (",w.length,")"]}),Si.jsxs(Up,{value:"individual-licenses",children:["Individual Licenses (",k.length,")"]}),Si.jsxs(Up,{value:"assets",children:["Assets (",S.length,")"]}),Si.jsxs(Up,{value:"saf",children:["SAFs (",D.length,")"]}),Si.jsxs(Up,{value:"coc",children:["COCs (",E.length,")"]}),Si.jsxs(Up,{value:"documents",children:["Documents (",j.length,")"]}),Si.jsxs(Up,{value:"transactions",children:["Transactions (",p.length,")"]}),Si.jsx(Up,{value:"team",children:"Team Assignments"}),Si.jsx(Up,{value:"history",children:"History"})]}),Si.jsx($p,{value:"contracts",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Client Contracts"})}),Si.jsx(Lx,{children:h.length>0?Si.jsx("div",{className:"space-y-4",children:h.map((e=>Si.jsx("div",{className:"border rounded-lg p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx(VC,{entity:{id:e.id,type:EC.CONTRACT,name:e.name,url:`/contracts/${e.id}`,status:e.status,icon:"FileText",metadata:{secondaryText:e.totalValue?qu(e.totalValue):void 0,...e}},variant:"card",showTooltip:!0}),Si.jsxs("p",{className:"text-sm text-gray-600 mt-2",children:[Ru(e.startDate)," - ",Ru(e.endDate)]}),e.documentUrl&&Si.jsx("div",{className:"mt-2",children:Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>window.open(e.documentUrl,"_blank"),className:"text-xs",children:[Si.jsx(Rl,{className:"h-3 w-3 mr-1"}),"Download Contract"]})})]}),Si.jsxs("div",{className:"text-right",children:[Si.jsx("p",{className:"font-medium",children:qu(e.totalValue)}),Si.jsx(Sx,{className:"active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:e.status})]})]})},e.id)))}):Si.jsx("p",{className:"text-gray-500 text-center py-8",children:"No contracts found for this client."})})]})}),Si.jsx($p,{value:"proposals",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Client Proposals"})}),Si.jsx(Lx,{children:x.length>0?Si.jsx("div",{className:"space-y-4",children:x.map((e=>Si.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:Si.jsxs("div",{className:"flex items-start justify-between",children:[Si.jsxs("div",{className:"flex-1",children:[Si.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[Si.jsx("div",{className:"w-8 h-8 bg-violet-100 rounded-lg flex items-center justify-center",children:Si.jsx(Kr,{className:"h-4 w-4 text-violet-600"})}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium text-gray-900",children:e.type||"Proposal"}),Si.jsxs("p",{className:"text-sm text-gray-600",children:["Version ",e.version||"1.0"]})]}),Si.jsx(Sx,{className:"approved"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"rejected"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800",children:e.status||"draft"})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[e.contractId&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Contract"}),Si.jsx("p",{className:"text-sm font-medium",children:O(e.contractId)})]}),e.proposedValue&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Proposed Value"}),Si.jsx("p",{className:"text-sm font-medium text-green-600",children:qu(parseFloat(e.proposedValue))})]}),Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Created"}),Si.jsx("p",{className:"text-sm font-medium",children:Ru(e.createdAt)})]}),e.updatedAt&&e.updatedAt!==e.createdAt&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Last Updated"}),Si.jsx("p",{className:"text-sm font-medium",children:Ru(e.updatedAt)})]})]}),e.notes&&Si.jsxs("div",{className:"mt-3",children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Notes"}),Si.jsx("p",{className:"text-sm text-gray-700 mt-1",children:e.notes})]})]}),Si.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[e.documentUrl&&Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>window.open(e.documentUrl,"_blank"),children:[Si.jsx(Rl,{className:"h-3 w-3 mr-1"}),"Download"]}),Si.jsxs(Ex,{variant:"outline",size:"sm",children:[Si.jsx(Sl,{className:"h-3 w-3 mr-1"}),"View Details"]})]})]})},e.id)))}):Si.jsxs("div",{className:"text-center py-12",children:[Si.jsx(Kr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Si.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Proposals Found"}),Si.jsx("p",{className:"text-gray-500 mb-4",children:"No proposals have been created for this client yet."})]})})]})}),Si.jsx($p,{value:"services",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Client Services"})}),Si.jsx(Lx,{children:N?Si.jsx("div",{className:"flex items-center justify-center py-12",children:Si.jsx("div",{className:"animate-spin w-6 h-6 border-4 border-primary border-t-transparent rounded-full"})}):v&&Array.isArray(v)&&v.length>0?Si.jsx("div",{className:"space-y-4",children:v.map((e=>{const s=e.scopeDefinition,t="string"==typeof s?s:(null==s?void 0:s.description)||e.notes||"No description available",a=(()=>{if(!s||"string"==typeof s)return[];const e=[];for(const[t,a]of Object.entries(s))if("description"!==t&&"deliverables"!==t&&null!=a&&""!==a){const s=t.replace(/([A-Z])/g," $1").replace(/^./,(e=>e.toUpperCase()));e.push({label:s,value:a})}return e})(),i=(null==s?void 0:s.deliverables)||[];return Si.jsxs("div",{className:"border rounded-lg p-4",children:[Si.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:I(e.serviceId)}),Si.jsxs("p",{className:"text-sm text-gray-600",children:["Contract: ",O(e.contractId)]}),e.startDate&&e.endDate&&Si.jsxs("p",{className:"text-sm text-gray-600",children:[Ru(e.startDate)," - ",Ru(e.endDate)]})]}),Si.jsxs("div",{className:"text-right",children:[e.monthlyValue&&Si.jsxs("p",{className:"font-medium text-green-600",children:[qu(e.monthlyValue),"/month"]}),Si.jsx(Sx,{className:"bg-blue-100 text-blue-800",children:e.status||"Active Service"})]})]}),t&&Si.jsxs("div",{className:"mb-3",children:[Si.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Description:"}),Si.jsx("p",{className:"text-sm text-gray-600",children:t})]}),a.length>0&&Si.jsxs("div",{className:"mb-3",children:[Si.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Scope Details:"}),Si.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:a.map(((e,s)=>Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[e.label,":"]}),Si.jsx("span",{className:"text-sm text-gray-800",children:Array.isArray(e.value)?e.value.join(", "):e.value.toString()})]},s)))})]}),Array.isArray(i)&&i.length>0&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Deliverables:"}),Si.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(((e,s)=>Si.jsx(Sx,{variant:"outline",className:"text-xs",children:(e=>{if(null==e)return"";if("string"==typeof e||"number"==typeof e)return String(e);if("object"==typeof e){if("item"in e&&e.item)return String(e.item);if("name"in e&&e.name)return String(e.name);if("title"in e&&e.title)return String(e.title);if("value"in e&&e.value)return String(e.value);try{return JSON.stringify(e)}catch(s){return"[object]"}}return String(e)})(e)},s)))})]})]},e.id)}))}):Si.jsxs("div",{className:"text-center py-12",children:[Si.jsx(Mr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Si.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Services Found"}),Si.jsx("p",{className:"text-gray-500 mb-4",children:"No services have been configured for this client yet."})]})})]})}),Si.jsx($p,{value:"licenses",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx(_x,{children:"Client Licenses"}),Si.jsxs(Sp,{open:i,onOpenChange:n,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{size:"sm",children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Assign License"]})}),Si.jsxs(Ep,{className:"max-w-2xl",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Assign License Pool to Client"})}),Si.jsx(oC,{clientId:o,onSubmit:e=>P.mutate(e),onCancel:()=>n(!1),isLoading:P.isPending})]})]})]})}),Si.jsx(Lx,{children:w.length>0?Si.jsx("div",{className:"space-y-4",children:w.map((e=>Si.jsx("div",{className:"border rounded-lg p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:R(e.licensePoolId)}),Si.jsxs("p",{className:"text-sm text-gray-600",children:["Assigned: ",Ru(e.assignedDate)]}),e.notes&&Si.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e.notes})]}),Si.jsxs("div",{className:"text-right",children:[Si.jsx("p",{className:"font-medium text-lg",children:e.assignedLicenses}),Si.jsx("p",{className:"text-sm text-gray-500",children:"licenses assigned"})]})]})},e.id)))}):Si.jsxs("div",{className:"text-center py-12",children:[Si.jsx(Ul,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Si.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Licenses Found"}),Si.jsx("p",{className:"text-gray-500 mb-4",children:"No licenses have been assigned to this client yet."})]})})]})}),Si.jsx($p,{value:"individual-licenses",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Client Individual Licenses"})}),Si.jsx(Lx,{children:k.length>0?Si.jsx("div",{className:"space-y-4",children:k.map((e=>Si.jsx("div",{className:"border rounded-lg p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:e.name}),Si.jsxs("p",{className:"text-sm text-gray-600",children:["Vendor: ",e.vendor]}),Si.jsxs("p",{className:"text-sm text-gray-600",children:["Product: ",e.productName]}),Si.jsxs("p",{className:"text-sm text-gray-600",children:["License Type: ",e.licenseType]}),e.expiryDate&&Si.jsxs("p",{className:"text-sm text-gray-600",children:["Expires: ",Ru(e.expiryDate)]}),e.notes&&Si.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e.notes})]}),Si.jsxs("div",{className:"text-right",children:[Si.jsx("p",{className:"font-medium text-lg",children:e.quantity}),Si.jsx("p",{className:"text-sm text-gray-500",children:"quantity"}),Si.jsx(Sx,{variant:"active"===e.status?"default":"secondary",children:e.status})]})]})},e.id)))}):Si.jsxs("div",{className:"text-center py-12",children:[Si.jsx(Ul,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Si.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Individual Licenses Found"}),Si.jsx("p",{className:"text-gray-500 mb-4",children:"No individual licenses have been assigned to this client yet."})]})})]})}),Si.jsx($p,{value:"assets",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Client Hardware Assets"})}),Si.jsx(Lx,{children:S.length>0?Si.jsx("div",{className:"space-y-4",children:S.map((e=>Si.jsx("div",{className:"border rounded-lg p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:q(e.hardwareAssetId)}),Si.jsxs("p",{className:"text-sm text-gray-600",children:["Assigned: ",Ru(e.assignedDate)]}),e.installationLocation&&Si.jsxs("p",{className:"text-sm text-gray-500",children:["Location: ",e.installationLocation]}),e.notes&&Si.jsx("p",{className:"text-sm text-gray-500 mt-1",children:e.notes})]}),Si.jsxs("div",{className:"text-right",children:[Si.jsx(Sx,{className:"active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:e.status}),e.returnedDate&&Si.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Returned: ",Ru(e.returnedDate)]})]})]})},e.id)))}):Si.jsxs("div",{className:"text-center py-12",children:[Si.jsx(zr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Si.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Hardware Assets Found"}),Si.jsx("p",{className:"text-gray-500 mb-4",children:"No hardware assets have been assigned to this client yet."})]})})]})}),Si.jsx($p,{value:"saf",children:Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between",children:[Si.jsx(_x,{children:"Service Authorization Forms (SAF)"}),Si.jsxs(Ex,{onClick:()=>s(`/create-saf?clientId=${o}`),size:"sm",children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Create SAF"]})]}),Si.jsx(Lx,{children:D.length>0?Si.jsx("div",{className:"space-y-4",children:D.map((e=>Si.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:Si.jsxs("div",{className:"flex items-start justify-between",children:[Si.jsxs("div",{className:"flex-1",children:[Si.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[Si.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:Si.jsx(Kr,{className:"h-4 w-4 text-blue-600"})}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium text-gray-900",children:e.title}),Si.jsxs("p",{className:"text-sm text-gray-600",children:["SAF #",e.safNumber]})]})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Service Period"}),Si.jsxs("p",{className:"text-sm font-medium",children:[Ru(e.startDate)," - ",Ru(e.endDate)]})]}),e.value&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Value"}),Si.jsxs("p",{className:"text-sm font-medium text-green-600",children:["$",parseFloat(e.value).toLocaleString()]})]}),e.contractId&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Contract"}),Si.jsx("p",{className:"text-sm font-medium",children:O(e.contractId)})]}),e.approvedDate&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Approved Date"}),Si.jsx("p",{className:"text-sm font-medium",children:Ru(e.approvedDate)})]})]}),e.description&&Si.jsxs("div",{className:"mt-3",children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Description"}),Si.jsx("p",{className:"text-sm text-gray-700 mt-1",children:e.description})]}),e.notes&&Si.jsxs("div",{className:"mt-3",children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Notes"}),Si.jsx("p",{className:"text-sm text-gray-700 mt-1",children:e.notes})]})]}),Si.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[Si.jsx(Sx,{variant:"active"===e.status||"approved"===e.status||"completed"===e.status?"default":"pending"===e.status?"secondary":"cancelled"===e.status?"destructive":"secondary",className:"active"===e.status?"bg-green-100 text-green-800 hover:bg-green-200":"approved"===e.status?"bg-blue-100 text-blue-800 hover:bg-blue-200":"completed"===e.status?"bg-gray-100 text-gray-800 hover:bg-gray-200":"pending"===e.status?"bg-yellow-100 text-yellow-800 hover:bg-yellow-200":"cancelled"===e.status?"bg-red-100 text-red-800 hover:bg-red-200":"",children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),e.documentUrl&&Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>window.open(e.documentUrl,"_blank"),className:"text-xs",children:[Si.jsx(Rl,{className:"h-3 w-3 mr-1"}),"Document"]})]})]})},e.id)))}):Si.jsxs("div",{className:"text-center py-12",children:[Si.jsx(Kr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Si.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No SAFs Found"}),Si.jsx("p",{className:"text-gray-500 mb-4",children:"No Service Authorization Forms have been created for this client yet."}),Si.jsxs(Ex,{variant:"outline",onClick:()=>s(`/create-saf?clientId=${o}`),children:[Si.jsx(Kr,{className:"h-4 w-4 mr-2"}),"Create SAF"]})]})})]})}),Si.jsx($p,{value:"coc",children:Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between",children:[Si.jsx(_x,{children:"Certificates of Compliance (COC)"}),Si.jsxs(Ex,{onClick:()=>s(`/create-coc?clientId=${o}`),size:"sm",children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Create COC"]})]}),Si.jsx(Lx,{children:E.length>0?Si.jsx("div",{className:"space-y-4",children:E.map((e=>{const s=e.expiryDate&&new Date(e.expiryDate)<new Date,t=e.expiryDate&&new Date(e.expiryDate)>new Date&&new Date(e.expiryDate)<=new Date(Date.now()+2592e6);return Si.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:Si.jsxs("div",{className:"flex items-start justify-between",children:[Si.jsxs("div",{className:"flex-1",children:[Si.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[Si.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:Si.jsx(Gr,{className:"h-4 w-4 text-green-600"})}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium text-gray-900",children:e.title}),Si.jsxs("p",{className:"text-sm text-gray-600",children:["COC #",e.cocNumber]})]})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-3",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Compliance Type"}),Si.jsx("p",{className:"text-sm font-medium",children:e.complianceType})]}),Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Issue Date"}),Si.jsx("p",{className:"text-sm font-medium",children:Ru(e.issueDate)})]}),e.expiryDate&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Expiry Date"}),Si.jsxs("p",{className:"text-sm font-medium "+(s?"text-red-600":t?"text-yellow-600":"text-gray-900"),children:[Ru(e.expiryDate),s&&" (Expired)",t&&" (Expiring Soon)"]})]}),e.contractId&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Contract"}),Si.jsx("p",{className:"text-sm font-medium",children:O(e.contractId)})]}),e.auditDate&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Last Audit"}),Si.jsx("p",{className:"text-sm font-medium",children:Ru(e.auditDate)})]}),e.nextAuditDate&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Next Audit"}),Si.jsx("p",{className:"text-sm font-medium",children:Ru(e.nextAuditDate)})]})]}),e.description&&Si.jsxs("div",{className:"mt-3",children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Description"}),Si.jsx("p",{className:"text-sm text-gray-700 mt-1",children:e.description})]}),e.notes&&Si.jsxs("div",{className:"mt-3",children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"Notes"}),Si.jsx("p",{className:"text-sm text-gray-700 mt-1",children:e.notes})]})]}),Si.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[Si.jsx(Sx,{variant:"active"===e.status||"issued"===e.status?"default":"expired"===e.status||"revoked"===e.status?"destructive":"secondary",className:"active"===e.status?"bg-green-100 text-green-800 hover:bg-green-200":"issued"===e.status?"bg-blue-100 text-blue-800 hover:bg-blue-200":"expired"===e.status||"revoked"===e.status?"bg-red-100 text-red-800 hover:bg-red-200":"",children:e.status.charAt(0).toUpperCase()+e.status.slice(1)}),(s||t)&&Si.jsx(Sx,{variant:"destructive",className:"text-xs",children:s?"Expired":"Expiring Soon"}),e.documentUrl&&Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>window.open(e.documentUrl,"_blank"),className:"text-xs",children:[Si.jsx(Rl,{className:"h-3 w-3 mr-1"}),"Certificate"]})]})]})},e.id)}))}):Si.jsxs("div",{className:"text-center py-12",children:[Si.jsx(Gr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Si.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No COCs Found"}),Si.jsx("p",{className:"text-gray-500 mb-4",children:"No Certificates of Compliance have been created for this client yet."}),Si.jsxs(Ex,{variant:"outline",onClick:()=>s(`/create-coc?clientId=${o}`),children:[Si.jsx(Gr,{className:"h-4 w-4 mr-2"}),"Create COC"]})]})})]})}),Si.jsx($p,{value:"documents",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx(_x,{children:"Client Documents & Files"}),Si.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"All documents related to this client including contracts, proposals, services, licenses, and general files"})]}),Si.jsxs(Ex,{variant:"outline",onClick:()=>window.open("/documents","_blank"),children:[Si.jsx(Lr,{className:"h-4 w-4 mr-2"}),"Upload Documents"]})]})}),Si.jsx(Lx,{children:j.length>0?Si.jsxs("div",{className:"space-y-6",children:[Si.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(V).map((([e,s])=>Si.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[Si.jsx("div",{className:"text-lg font-semibold",children:s}),Si.jsx("div",{className:"text-sm text-gray-600 capitalize",children:e})]},e)))}),Si.jsx(Cp,{}),Si.jsx("div",{className:"space-y-4",children:U.map((e=>{var s,t;const a=(e=>{const s={contract:{name:"Contracts",description:"Contract documents and agreements",icon:Kr,color:"text-blue-600"},proposal:{name:"Proposals",description:"Business and service proposals",icon:Kr,color:"text-purple-600"},financial:{name:"Financial",description:"Financial proposals and cost analyses",icon:Ur,color:"text-green-600"},technical:{name:"Technical",description:"Technical specifications and documentation",icon:Mr,color:"text-indigo-600"},service:{name:"Services",description:"Service documentation and scope definitions",icon:zr,color:"text-cyan-600"},license:{name:"Licenses",description:"License agreements and certificates",icon:Ul,color:"text-yellow-600"},compliance:{name:"Compliance",description:"Compliance certificates and audit documents",icon:Gr,color:"text-red-600"},general:{name:"General",description:"General client documents and files",icon:Kr,color:"text-gray-600"}};return s[e]||s.general})(e),i=a.icon;return Si.jsxs("div",{className:"space-y-3",children:[Si.jsxs("div",{className:"border-b pb-2",children:[Si.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[Si.jsx(i,{className:`h-5 w-5 mr-2 ${a.color}`}),a.name," (",null==(s=M[e])?void 0:s.length,")"]}),Si.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.description})]}),Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:null==(t=M[e])?void 0:t.map((e=>{return Si.jsxs(Ax,{className:"hover:shadow-md transition-shadow",children:[Si.jsx(Px,{className:"pb-3",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsx("h4",{className:"font-medium text-sm truncate",children:e.name}),Si.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.fileName})]}),Si.jsx(Sx,{className:F(e.documentType),variant:"secondary",children:e.documentType})]})}),Si.jsxs(Lx,{className:"pt-0 space-y-3",children:[e.description&&Si.jsx("p",{className:"text-xs text-gray-600 line-clamp-2",children:e.description}),Si.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[Si.jsx(Wr,{className:"mr-1 h-3 w-3"}),"Version ",e.version," • ",L(e.fileSize)]}),Si.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[Si.jsx(jl,{className:"mr-1 h-3 w-3"}),Ru(e.createdAt)]}),e.tags&&e.tags.length>0&&Si.jsxs("div",{className:"flex items-center gap-1",children:[Si.jsx(ac,{className:"h-3 w-3 text-gray-400"}),Si.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.tags.slice(0,2).map(((e,s)=>Si.jsx(Sx,{variant:"outline",className:"text-xs px-1 py-0",children:e},s))),e.tags.length>2&&Si.jsxs(Sx,{variant:"outline",className:"text-xs px-1 py-0",children:["+",e.tags.length-2]})]})]}),Si.jsx(Cp,{className:"my-2"}),Si.jsxs("div",{className:"flex justify-between gap-2",children:[Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>_(e),className:"flex-1 text-xs",children:[Si.jsx(Rl,{className:"mr-1 h-3 w-3"}),"Download"]}),(s=e.mimeType,["application/pdf","image/jpeg","image/png","image/gif","text/plain"].includes(s)&&Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>(async e=>{try{window.open(`/api/documents/${e.id}/preview`,"_blank")}catch(s){c({title:"Error",description:"Failed to preview document",variant:"destructive"})}})(e),className:"flex-1 text-xs",children:[Si.jsx(Sl,{className:"mr-1 h-3 w-3"}),"Preview"]}))]})]})]},e.id);var s}))})]},e)}))}),j.length>3&&Si.jsxs("div",{className:"mt-6",children:[Si.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Recent Uploads"}),Si.jsx("div",{className:"space-y-2",children:j.sort(((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime())).slice(0,5).map((e=>Si.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx(Kr,{className:"h-4 w-4 text-gray-400"}),Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium",children:e.name}),Si.jsxs("p",{className:"text-xs text-gray-500",children:[Ru(e.createdAt)," • ",L(e.fileSize)]})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{className:F(e.documentType),variant:"secondary",children:e.documentType}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>_(e),children:Si.jsx(Rl,{className:"h-4 w-4"})})]})]},e.id)))})]})]}):Si.jsxs("div",{className:"text-center py-12",children:[Si.jsx(Kr,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Si.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Documents Found"}),Si.jsx("p",{className:"text-gray-500 mb-4",children:"No documents have been uploaded for this client yet."}),Si.jsxs(Ex,{onClick:()=>window.open("/documents","_blank"),children:[Si.jsx(Lr,{className:"h-4 w-4 mr-2"}),"Upload Documents"]})]})})]})}),Si.jsx($p,{value:"transactions",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Financial Transactions"})}),Si.jsx(Lx,{children:p.length>0?Si.jsx("div",{className:"space-y-4",children:p.map((e=>Si.jsx("div",{className:"border rounded-lg p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:e.description}),Si.jsx("p",{className:"text-sm text-gray-600",children:Ru(e.transactionDate)})]}),Si.jsxs("div",{className:"text-right",children:[Si.jsxs("p",{className:"font-medium "+(["revenue","payment","credit"].includes(e.type)?"text-green-600":"text-red-600"),children:[["revenue","payment","credit"].includes(e.type)?"+":"-",qu(e.amount)]}),Si.jsx(Sx,{variant:"completed"===e.status?"default":"secondary",children:e.type})]})]})},e.id)))}):Si.jsx("p",{className:"text-gray-500 text-center py-8",children:"No financial transactions found for this client."})})]})}),Si.jsx($p,{value:"team",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Team Assignments"})}),Si.jsx(Lx,{children:f.length>0?Si.jsx("div",{className:"space-y-4",children:f.map((e=>{const s=g.find((s=>s.id===e.userId));return Si.jsx("div",{className:"border rounded-lg p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:s?`${s.firstName} ${s.lastName}`:"Unknown User"}),Si.jsx("p",{className:"text-sm text-gray-600",children:e.role})]}),Si.jsx("div",{className:"text-right",children:Si.jsxs("p",{className:"text-sm text-gray-600",children:["Since: ",Ru(e.assignedDate)]})})]})},e.id)}))}):Si.jsx("p",{className:"text-gray-500 text-center py-8",children:"No team assignments found for this client."})})]})}),Si.jsx($p,{value:"history",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Vl,{className:"h-4 w-4 mr-2"}),"Activity History"]})}),Si.jsx(Lx,{children:Si.jsx(hC,{entity_type:"client",entity_id:o,entity_name:null==d?void 0:d.name})})]})})]})]})}),Si.jsx(Sp,{open:r,onOpenChange:l,children:Si.jsxs(Ep,{className:"max-w-7xl max-h-[90vh] overflow-y-auto",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Global Widget Management"})}),Si.jsx(ZC,{onClose:()=>l(!1)})]})})]}):Si.jsx("div",{className:"flex items-center justify-center min-h-screen",children:Si.jsxs("div",{className:"text-center",children:[Si.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Client Not Found"}),Si.jsx("p",{className:"text-gray-600 mt-2",children:"The requested client could not be found."}),m&&Si.jsxs("p",{className:"text-red-600 mt-2 text-sm",children:["Error: ",m.message]}),Si.jsxs(Ex,{onClick:()=>s("/clients"),className:"mt-4",children:[Si.jsx(dl,{className:"h-4 w-4 mr-2"}),"Back to Clients"]})]})})}const sS=Wc({clientId:Uc().min(1,"Client is required"),name:Vc().min(1,"Contract name is required"),startDate:Vc().min(1,"Start date is required"),endDate:Vc().min(1,"End date is required"),status:Vc().default("draft"),notes:Vc().nullable().optional(),autoRenewal:$c().default(!1),renewalTerms:Vc().nullable().optional(),totalValue:Vc().nullable().optional(),documentUrl:Vc().nullable().optional()});function tS({contract:e,clients:s,onSubmit:t,onCancel:a,isLoading:i=!1}){const[n,r]=$n.useState(!1),[l,c]=$n.useState(null),[o,d]=$n.useState([]),[u,m]=$n.useState({}),[h,x]=$n.useState(""),{toast:p}=sd(),{data:f=[]}=fh({queryKey:["/api/services"]}),{data:g=[]}=fh({queryKey:["/api/contracts",null==e?void 0:e.id,"service-scopes"],queryFn:async()=>{if(!(null==e?void 0:e.id))return[];const s=await fetch(`/api/contracts/${e.id}/service-scopes`,{credentials:"include"});return s.ok?s.json():[]},enabled:!!(null==e?void 0:e.id)});$n.useEffect((()=>{if(e&&g.length>0){const e=g.map((e=>{const s=f.find((s=>s.id===e.serviceId));return{serviceId:e.serviceId,serviceName:(null==s?void 0:s.name)||"Unknown Service",scopeData:e.scopeDefinition||{}}}));d(e),e.forEach((e=>{v(e.serviceId)}))}}),[e,g,f]);const j=Zc({resolver:bv(sS),defaultValues:{clientId:(null==e?void 0:e.clientId)||0,name:(null==e?void 0:e.name)||"",startDate:(null==e?void 0:e.startDate)?new Date(e.startDate).toISOString().split("T")[0]:"",endDate:(null==e?void 0:e.endDate)?new Date(e.endDate).toISOString().split("T")[0]:"",autoRenewal:(null==e?void 0:e.autoRenewal)??!1,renewalTerms:(null==e?void 0:e.renewalTerms)||"",totalValue:(null==e?void 0:e.totalValue)?e.totalValue.toString():"",status:(null==e?void 0:e.status)||"draft",documentUrl:(null==e?void 0:e.documentUrl)||"",notes:(null==e?void 0:e.notes)||""}}),v=async e=>{try{const s=await fetch(`/api/services/${e}/scope-template`,{credentials:"include"});if(s.ok){const t=await s.json();m((s=>({...s,[e]:t.template})))}}catch(s){}},y=e=>{const s=parseInt(e),t=f.find((e=>e.id===s));if(!t||o.some((e=>e.serviceId===s)))return;const a={serviceId:s,serviceName:t.name,scopeData:{}};d((e=>[...e,a])),v(s),x(""),p({title:"Service Added",description:`${t.name} has been added to the contract.`})},b=(e,s,t)=>{d((a=>a.map((a=>a.serviceId===e?{...a,scopeData:{...a.scopeData,[s]:t}}:a))))},N=(e,s)=>{var t,a,i,n,r,l,c,d,u,m;const h=(null==(t=o.find((s=>s.serviceId===e)))?void 0:t.scopeData[s.name])||"";switch(s.fieldType){case"TEXT_SINGLE_LINE":default:return Si.jsx(kx,{value:h,onChange:t=>b(e,s.name,t.target.value),placeholder:s.placeholderText||`Enter ${s.label.toLowerCase()}`,required:s.isRequired});case"TEXT_MULTI_LINE":return Si.jsx(Yp,{value:h,onChange:t=>b(e,s.name,t.target.value),placeholder:s.placeholderText||`Enter ${s.label.toLowerCase()}`,required:s.isRequired,rows:3});case"NUMBER_INTEGER":return Si.jsx(kx,{type:"number",value:h,onChange:t=>b(e,s.name,parseInt(t.target.value)||""),placeholder:s.placeholderText||`Enter ${s.label.toLowerCase()}`,required:s.isRequired,min:null==(a=s.validation)?void 0:a.min,max:null==(i=s.validation)?void 0:i.max});case"NUMBER_DECIMAL":return Si.jsx(kx,{type:"number",step:"0.01",value:h,onChange:t=>b(e,s.name,parseFloat(t.target.value)||""),placeholder:s.placeholderText||`Enter ${s.label.toLowerCase()}`,required:s.isRequired,min:null==(n=s.validation)?void 0:n.min,max:null==(r=s.validation)?void 0:r.max});case"BOOLEAN":return Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx($f,{checked:!!h,onCheckedChange:t=>b(e,s.name,t)}),Si.jsx("span",{className:"text-sm",children:(null==(l=s.validation)?void 0:l.trueLabel)||"Yes"})]});case"DATE":return Si.jsx(kx,{type:"date",value:h,onChange:t=>b(e,s.name,t.target.value),required:s.isRequired});case"SELECT_SINGLE_DROPDOWN":return Si.jsxs(zp,{value:h,onValueChange:t=>b(e,s.name,t),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:`Select ${s.label.toLowerCase()}`})}),Si.jsx(Wp,{children:null==(d=null==(c=s.validation)?void 0:c.options)?void 0:d.map((e=>Si.jsx(Hp,{value:e.value,children:e.label},e.value)))})]});case"SELECT_MULTI_CHECKBOX":const t=Array.isArray(h)?h:[];return Si.jsx("div",{className:"space-y-2",children:null==(m=null==(u=s.validation)?void 0:u.options)?void 0:m.map((a=>Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx($f,{checked:t.includes(a.value),onCheckedChange:i=>{const n=i?[...t,a.value]:t.filter((e=>e!==a.value));b(e,s.name,n)}}),Si.jsx("span",{className:"text-sm",children:a.label})]},a.value)))})}},w=f.filter((e=>e.isActive&&!o.some((s=>s.serviceId===e.id))));return Si.jsx("div",{className:"h-full flex flex-col",children:Si.jsx($w,{...j,children:Si.jsxs("form",{onSubmit:j.handleSubmit((e=>{const s={clientId:Number(e.clientId),name:e.name,startDate:new Date(e.startDate),endDate:new Date(e.endDate),totalValue:e.totalValue?parseFloat(e.totalValue):null,status:e.status,autoRenewal:e.autoRenewal,renewalTerms:e.renewalTerms||null,documentUrl:(null==l?void 0:l.url)||e.documentUrl||null,notes:e.notes||null};t({...s,services:o})})),className:"flex flex-col h-full",children:[Si.jsxs("div",{className:"flex-1 space-y-4 pb-4",children:[Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("h3",{className:"text-sm font-medium text-gray-900 border-b pb-2",children:"Basic Information"}),Si.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:j.control,name:"clientId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Client"}),Si.jsxs(zp,{onValueChange:s=>e.onChange(parseInt(s)),value:e.value>0?e.value.toString():"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select client"})})}),Si.jsx(Wp,{className:"z-[100]",children:0===(s||[]).length?Si.jsx(Hp,{value:"no-clients",disabled:!0,children:"No clients available"}):(s||[]).map((e=>Si.jsx(Hp,{value:e.id.toString(),children:Ou(e)},e.id)))})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:j.control,name:"name",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Contract Name"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., SOC Services Agreement 2024",...e})}),Si.jsx(Jw,{})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[Si.jsx(Bw,{control:j.control,name:"startDate",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Start Date"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"date",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:j.control,name:"endDate",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"End Date"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"date",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:j.control,name:"totalValue",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Total Value ($)"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"number",step:"0.01",min:"0",max:"999999999",placeholder:"0.00",...e,value:e.value||"",onChange:s=>{const t=s.target.value;(/^\d*\.?\d*$/.test(t)||""===t)&&e.onChange(t)}})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:j.control,name:"status",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Status"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select status"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"draft",children:"Draft"}),Si.jsx(Hp,{value:"active",children:"Active"}),Si.jsx(Hp,{value:"expired",children:"Expired"}),Si.jsx(Hp,{value:"terminated",children:"Terminated"})]})]}),Si.jsx(Jw,{})]})})]})]}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("h3",{className:"text-sm font-medium text-gray-900 border-b pb-2",children:"Services & Scope Configuration"}),w.length>0&&Si.jsxs("div",{className:"flex items-center gap-4",children:[Si.jsxs(zp,{value:h,onValueChange:x,children:[Si.jsx(Kp,{className:"w-64",children:Si.jsx(Bp,{placeholder:"Select a service to add..."})}),Si.jsx(Wp,{children:w.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:Si.jsxs("div",{className:"flex flex-col",children:[Si.jsx("span",{className:"font-medium",children:e.name}),Si.jsx("span",{className:"text-xs text-gray-500",children:e.category})]})},e.id)))})]}),Si.jsxs(Ex,{type:"button",variant:"outline",size:"sm",onClick:()=>{h?y(h):p({title:"No Service Selected",description:"Please select a service from the dropdown first.",variant:"destructive"})},disabled:!h,children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Service"]})]}),w.length>0&&Si.jsxs("div",{className:"flex flex-wrap gap-2",children:[Si.jsx("p",{className:"text-xs text-gray-500 w-full",children:"Quick add:"}),w.slice(0,6).map((e=>Si.jsxs(Ex,{type:"button",variant:"ghost",size:"sm",className:"text-xs h-8 px-3 border border-gray-200 hover:border-blue-300 hover:bg-blue-50",onClick:()=>y(e.id.toString()),children:[Si.jsx(nl,{className:"h-3 w-3 mr-1"}),e.name]},e.id)))]}),0===w.length&&o.length>0&&Si.jsx("div",{className:"text-center py-4 bg-green-50 border border-green-200 rounded-lg",children:Si.jsx("p",{className:"text-sm text-green-700",children:"All available services have been added to this contract."})}),0===o.length?Si.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-gray-200 rounded-lg",children:[Si.jsx(Mr,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),Si.jsx("p",{className:"text-sm text-gray-500",children:"No services selected"}),Si.jsx("p",{className:"text-xs text-gray-400",children:"Add services to configure their scope parameters"})]}):Si.jsx("div",{className:"space-y-4",children:o.map((e=>{const s=u[e.serviceId],t=(null==s?void 0:s.fields)||[];return Si.jsxs(Ax,{className:"border-l-4 border-l-blue-500",children:[Si.jsx(Px,{className:"pb-3",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx(_x,{className:"text-base",children:e.serviceName}),Si.jsx(Fx,{children:"Configure scope parameters for this service"})]}),Si.jsx(Ex,{type:"button",variant:"ghost",size:"sm",onClick:()=>{return s=e.serviceId,d((e=>e.filter((e=>e.serviceId!==s)))),void m((e=>{const t={...e};return delete t[s],t}));var s},className:"text-red-600 hover:text-red-800",children:Si.jsx(al,{className:"h-4 w-4"})})]})}),Si.jsx(Lx,{children:0===t.length?Si.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg",children:[Si.jsx("p",{className:"text-sm text-gray-500",children:"No scope template defined for this service"}),Si.jsx("p",{className:"text-xs text-gray-400",children:"Contact administrator to set up scope fields"})]}):Si.jsx("div",{className:"grid gap-4",children:t.sort(((e,s)=>e.displayOrder-s.displayOrder)).map((s=>Si.jsxs("div",{className:"space-y-2",children:[Si.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium",children:[s.label,s.isRequired&&Si.jsx("span",{className:"text-red-500",children:"*"})]}),s.helpText&&Si.jsx("p",{className:"text-xs text-gray-500",children:s.helpText}),N(e.serviceId,s)]},s.name)))})})]},e.serviceId)}))})]}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("h3",{className:"text-sm font-medium text-gray-900 border-b pb-2",children:"Renewal Settings"}),Si.jsx(Bw,{control:j.control,name:"autoRenewal",render:({field:e})=>Si.jsxs(Gw,{className:"flex flex-row items-start space-x-3 space-y-0",children:[Si.jsx(Hw,{children:Si.jsx($f,{checked:e.value,onCheckedChange:e.onChange})}),Si.jsx("div",{className:"space-y-1 leading-none",children:Si.jsx(Ww,{children:"Auto Renewal"})})]})}),Si.jsx(Bw,{control:j.control,name:"renewalTerms",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Renewal Terms"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Describe renewal terms and conditions...",className:"resize-none",rows:2,...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("h3",{className:"text-sm font-medium text-gray-900 border-b pb-2",children:"Contract Document"}),!l&&!j.watch("documentUrl")&&Si.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4",children:Si.jsxs("div",{className:"text-center",children:[Si.jsx(Lr,{className:"mx-auto h-8 w-8 text-gray-400"}),Si.jsxs("div",{className:"mt-2",children:[Si.jsxs("label",{htmlFor:"contract-file",className:"cursor-pointer",children:[Si.jsx("span",{className:"block text-sm font-medium text-gray-900",children:"Upload contract document"}),Si.jsx("span",{className:"block text-xs text-gray-500",children:"PDF, Word, or text files up to 10MB"})]}),Si.jsx("input",{id:"contract-file",type:"file",className:"sr-only",accept:".pdf,.doc,.docx,.txt",onChange:e=>{var t;const a=null==(t=e.target.files)?void 0:t[0];if(a){if(a.size>10485760)return void p({title:"Error",description:"File size must be less than 10MB",variant:"destructive"});if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","text/plain"].includes(a.type))return void p({title:"Error",description:"Only PDF, Word, and text files are allowed",variant:"destructive"});(async e=>{var t;r(!0);try{const a=new FormData;a.append("file",e);const i=j.watch("clientId");i&&i>0&&a.append("clientId",i.toString()),a.append("name",`${e.name} - Contract Document`),a.append("description",`Contract document for ${(null==(t=s.find((e=>e.id===i)))?void 0:t.name)||"client"}`);const n=await fetch("/api/upload/contract-document",{method:"POST",body:a,credentials:"include"});if(!n.ok){const e=await n.json();throw new Error(e.message||"Upload failed")}const r=await n.json();c({name:r.fileName,url:r.fileUrl,size:r.fileSize}),j.setValue("documentUrl",r.fileUrl),p({title:"Success",description:"Contract document uploaded successfully"})}catch(a){p({title:"Error",description:a.message||"Failed to upload document",variant:"destructive"})}finally{r(!1)}})(a)}},disabled:n})]}),Si.jsx("div",{className:"mt-2",children:Si.jsx(Ex,{type:"button",variant:"outline",size:"sm",disabled:n,onClick:()=>{var e;return null==(e=document.getElementById("contract-file"))?void 0:e.click()},children:n?"Uploading...":"Choose File"})})]})}),l&&Si.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx(Kr,{className:"h-5 w-5 text-green-600"}),Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-green-900",children:l.name}),Si.jsx("p",{className:"text-xs text-green-600",children:Iu(l.size)})]})]}),Si.jsx(Ex,{type:"button",variant:"ghost",size:"sm",onClick:()=>{c(null),j.setValue("documentUrl","")},className:"text-green-600 hover:text-green-800",children:Si.jsx(Tr,{className:"h-4 w-4"})})]}),Si.jsx("div",{className:"text-center text-xs text-gray-500",children:Si.jsx("span",{children:"or"})}),Si.jsx(Bw,{control:j.control,name:"documentUrl",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"External Document URL (Optional)"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"https://...",...e,value:e.value||"",disabled:!!l})}),Si.jsx(Jw,{})]})})]}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("h3",{className:"text-sm font-medium text-gray-900 border-b pb-2",children:"Additional Information"}),Si.jsx(Bw,{control:j.control,name:"notes",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Notes"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Additional notes about this contract...",className:"resize-none",rows:2,...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]})]}),Si.jsxs("div",{className:"flex-shrink-0 flex items-center justify-end space-x-3 pt-4 border-t border-gray-200 bg-white sticky bottom-0",children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),Si.jsx(Ex,{type:"submit",disabled:i||n,children:i?"Saving...":e?"Update Contract":"Create Contract"})]})]})})})}function aS(){const[e,s]=$n.useState(""),[t,a]=$n.useState(!1),[i,n]=$n.useState(null),{toast:r}=sd(),[l,c]=Oo(),{data:o=[]}=fh({queryKey:["/api/service-scopes"],queryFn:async()=>{const e=await vh("GET","/api/service-scopes"),s=await e.json();return Array.isArray(s)?s:s&&Array.isArray(s.data)?s.data:[]}}),{data:d=[],isLoading:u}=fh({queryKey:["/api/contracts"],queryFn:async()=>{const e=await vh("GET","/api/contracts");return await e.json()}}),m=d.map((e=>{const s=o.filter((s=>s.contractId===e.id));return{...e,serviceScopes:s,scopesCount:s.length,scopesSummary:s.map((e=>{const s=e.scopeDefinition;if("object"==typeof s&&s){const e=[];for(const[t,a]of Object.entries(s))if("description"!==t&&"deliverables"!==t&&a){const s=t.replace(/([A-Z])/g," $1").replace(/^./,(e=>e.toUpperCase()));e.push(`${s}: ${Array.isArray(a)?a.join(", "):a}`)}return e.length>0?e.join(" | "):s.description||"No details"}return s||"No scope details"})).join(" • ")}})),{data:h=[],isLoading:x}=fh({queryKey:["/api/clients"]}),p=gh({mutationFn:async e=>{const s=await vh("POST","/api/contracts",e);return await s.json()},onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/contracts"]}),Nh.invalidateQueries({queryKey:["/api/service-scopes"]}),a(!1),r({title:"Success",description:"Contract created successfully"})},onError:()=>{r({title:"Error",description:"Failed to create contract",variant:"destructive"})}}),f=gh({mutationFn:async({id:e,contractData:s})=>{const t=await vh("PUT",`/api/contracts/${e}`,s);return await t.json()},onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/contracts"]}),Nh.invalidateQueries({queryKey:["/api/service-scopes"]}),a(!1),n(null),r({title:"Success",description:"Contract updated successfully"})},onError:()=>{r({title:"Error",description:"Failed to update contract",variant:"destructive"})}}),g=gh({mutationFn:async e=>{await vh("DELETE",`/api/contracts/${e}`)},onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/contracts"]}),r({title:"Success",description:"Contract deleted successfully"})},onError:()=>{r({title:"Error",description:"Failed to delete contract",variant:"destructive"})}}),j=m.filter((s=>s.name.toLowerCase().includes(e.toLowerCase()))),v=e=>{const s=h.find((s=>s.id===e));return(null==s?void 0:s.name)||"Unknown Client"},y=[{key:"name",label:"Contract",defaultVisible:!0,mandatory:!0},{key:"client",label:"Client",defaultVisible:!0,mandatory:!0},{key:"status",label:"Status",defaultVisible:!0},{key:"value",label:"Value",defaultVisible:!1},{key:"startDate",label:"Start Date",defaultVisible:!0},{key:"endDate",label:"End Date",defaultVisible:!0},{key:"scopes",label:"Service Scopes",defaultVisible:!1},{key:"actions",label:"Actions",defaultVisible:!0,mandatory:!0}],{visibleColumns:b,handleVisibilityChange:N,resetToDefaults:w,isColumnVisible:C}=rC({storageKey:"contracts-table-columns",columns:y});return Si.jsx(vf,{title:"Contract Management",subtitle:"Manage client contracts and service agreements",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx(_x,{children:"Contracts"}),Si.jsxs(Sp,{open:t,onOpenChange:a,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Contract"]})}),Si.jsxs(Ep,{className:"max-w-4xl max-h-[95vh] flex flex-col overflow-hidden",children:[Si.jsx(Ap,{className:"flex-shrink-0 border-b pb-4",children:Si.jsx(_p,{children:i?"Edit Contract":"Add New Contract"})}),Si.jsx("div",{className:"flex-1 overflow-y-auto px-1",children:Si.jsx("div",{className:"max-h-[70vh] overflow-y-auto",children:Si.jsx(tS,{contract:i,clients:h||[],onSubmit:e=>{i?f.mutate({id:i.id,contractData:e}):p.mutate(e)},onCancel:()=>{a(!1),n(null)},isLoading:p.isPending||f.isPending||x})})})]})]})]})}),Si.jsxs(Lx,{children:[Si.jsxs("div",{className:"mb-6 flex items-center gap-2",children:[Si.jsxs("div",{className:"relative flex-1",children:[Si.jsx(Xr,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),Si.jsx(kx,{placeholder:"Search contracts...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]}),Si.jsx(nC,{columns:y,visibleColumns:b,onVisibilityChange:N,onReset:w})]}),Si.jsx("div",{className:"border rounded-lg",children:Si.jsxs(Wj,{children:[Si.jsx(Hj,{children:Si.jsxs(Jj,{children:[C("name")&&Si.jsx(Xj,{children:"Contract"}),C("client")&&Si.jsx(Xj,{children:"Client"}),C("status")&&Si.jsx(Xj,{children:"Status"}),C("value")&&Si.jsx(Xj,{children:"Value"}),C("startDate")&&Si.jsx(Xj,{children:"Start Date"}),C("endDate")&&Si.jsx(Xj,{children:"End Date"}),C("scopes")&&Si.jsx(Xj,{children:"Service Scopes"}),C("actions")&&Si.jsx(Xj,{className:"text-right",children:"Actions"})]})}),Si.jsx(Yj,{children:u?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:7,className:"text-center py-8",children:"Loading contracts..."})}):0===j.length?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:7,className:"text-center py-8",children:Si.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[Si.jsx(Kr,{className:"h-8 w-8 text-gray-400"}),Si.jsx("p",{className:"text-gray-500",children:"No contracts found"}),Si.jsx("p",{className:"text-sm text-gray-400",children:e?"Try adjusting your search":"Add your first contract to get started"})]})})}):j.map((e=>Si.jsxs(Jj,{children:[C("name")&&Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:Si.jsx(Kr,{className:"h-4 w-4 text-green-600"})}),Si.jsx("div",{children:Si.jsx("button",{onClick:()=>c(`/contracts/${e.id}`),className:"font-medium text-blue-600 hover:text-blue-800 hover:underline cursor-pointer text-left",children:e.name})})]})}),C("client")&&Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Qr,{className:"h-4 w-4 text-gray-400"}),Si.jsx("span",{className:"text-sm",children:v(e.clientId)})]})}),C("status")&&Si.jsx(Zj,{children:Si.jsx(Sx,{variant:HC(e.status),children:e.status})}),C("value")&&Si.jsx(Zj,{children:Si.jsx("span",{className:"font-medium",children:e.totalValue?`$${parseFloat(e.totalValue).toLocaleString()}`:"Not set"})}),C("startDate")&&Si.jsx(Zj,{children:Si.jsx("span",{className:"text-sm",children:new Date(e.startDate).toLocaleDateString()})}),C("endDate")&&Si.jsx(Zj,{children:Si.jsx("span",{className:"text-sm",children:new Date(e.endDate).toLocaleDateString()})}),C("scopes")&&Si.jsx(Zj,{children:Si.jsx("div",{className:"space-y-1",children:e.scopesCount>0?Si.jsxs(Si.Fragment,{children:[Si.jsx("div",{className:"flex items-center space-x-1",children:Si.jsxs(Sx,{variant:"outline",className:"text-xs",children:[e.scopesCount," scope",1!==e.scopesCount?"s":""]})}),e.scopesSummary&&Si.jsx("p",{className:"text-xs text-gray-600 truncate max-w-xs",title:e.scopesSummary,children:e.scopesSummary})]}):Si.jsx("span",{className:"text-xs text-gray-400",children:"No scopes"})})}),C("actions")&&Si.jsx(Zj,{className:"text-right",children:Si.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(e=>{n(e),a(!0)})(e),children:Si.jsx(tl,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void(confirm("Are you sure you want to delete this contract?")&&g.mutate(s));var s},children:Si.jsx(al,{className:"h-4 w-4"})})]})})]},e.id)))})]})}),Si.jsx("div",{className:"flex items-center justify-between mt-4",children:Si.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",j.length," of ",d.length," contracts"]})})]})]})})}function iS(){const{id:e}=Ro(),[,s]=Oo(),[t,a]=$n.useState(!1),{toast:i}=sd(),n=e?parseInt(e,10):null,{data:r,isLoading:l,error:c}=fh({queryKey:["/api/contracts",n],queryFn:async()=>{if(!n)throw new Error("No contract ID provided");const e=await fetch(`/api/contracts/${n}`,{credentials:"include"});if(!e.ok){const s=await e.text();throw new Error(`Failed to fetch contract: ${e.status} ${s}`)}return e.json()},enabled:!!n}),{data:o}=fh({queryKey:["/api/clients",null==r?void 0:r.clientId],queryFn:async()=>{if(!(null==r?void 0:r.clientId))throw new Error("No client ID available");const e=await fetch(`/api/clients/${r.clientId}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch client");return e.json()},enabled:!!(null==r?void 0:r.clientId)}),{data:d=[]}=fh({queryKey:["/api/clients"]}),{data:u=[]}=fh({queryKey:["/api/contracts",n,"service-scopes"],queryFn:async()=>{if(!n)return[];const e=await fetch(`/api/contracts/${n}/service-scopes`,{credentials:"include"});return e.ok?e.json():[]},enabled:!!n}),{data:m=[]}=fh({queryKey:["/api/documents","contract",n],queryFn:async()=>{if(!n)return[];const e=await fetch(`/api/documents?contractId=${n}`,{credentials:"include"});return e.ok?e.json():[]},enabled:!!n}),{data:h=[]}=fh({queryKey:["/api/service-authorization-forms","contract",n],queryFn:async()=>{if(!n)return[];const e=await fetch(`/api/service-authorization-forms?contractId=${n}`,{credentials:"include"});return e.ok?e.json():[]},enabled:!!n}),{data:x=[]}=fh({queryKey:["/api/certificates-of-compliance","contract",n],queryFn:async()=>{if(!n)return[];const e=await fetch(`/api/certificates-of-compliance?contractId=${n}`,{credentials:"include"});return e.ok?e.json():[]},enabled:!!n}),p=gh({mutationFn:async e=>{const s=await vh("PUT",`/api/contracts/${n}`,e);return await s.json()},onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/contracts",n]}),a(!1),i({title:"Success",description:"Contract updated successfully"})},onError:()=>{i({title:"Error",description:"Failed to update contract",variant:"destructive"})}});return l?Si.jsx("div",{className:"flex items-center justify-center min-h-screen",children:Si.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full"})}):c||!r?Si.jsx(vf,{title:"Contract Not Found",children:Si.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-4",children:[Si.jsx(Kr,{className:"h-16 w-16 text-gray-400"}),Si.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Contract Not Found"}),Si.jsx("p",{className:"text-gray-600 text-center max-w-md",children:"The contract you're looking for doesn't exist or you don't have permission to view it."}),Si.jsxs(Ex,{onClick:()=>s("/contracts"),children:[Si.jsx(dl,{className:"h-4 w-4 mr-2"}),"Back to Contracts"]})]})}):Si.jsxs(vf,{title:r.name,subtitle:`Contract #${r.id} - ${(null==o?void 0:o.name)||"Loading..."}`,children:[Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs(Ex,{variant:"outline",onClick:()=>s("/contracts"),children:[Si.jsx(dl,{className:"h-4 w-4 mr-2"}),"Back to Contracts"]}),Si.jsxs("div",{className:"flex space-x-2",children:[Si.jsxs(Ex,{variant:"outline",onClick:()=>a(!0),children:[Si.jsx(tl,{className:"h-4 w-4 mr-2"}),"Edit Contract"]}),r.documentUrl&&Si.jsxs(Ex,{variant:"outline",onClick:()=>window.open(r.documentUrl,"_blank"),children:[Si.jsx(Rl,{className:"h-4 w-4 mr-2"}),"Download Document"]})]})]}),Si.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[Si.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Contract Overview"})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Contract Name"}),Si.jsx("p",{className:"text-lg font-semibold",children:r.name})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Status"}),Si.jsx("div",{className:"mt-1",children:Si.jsx(Sx,{className:(e=>{switch(null==e?void 0:e.toLowerCase()){case"active":return"bg-green-100 text-green-800";case"draft":return"bg-yellow-100 text-yellow-800";case"expired":return"bg-red-100 text-red-800";case"terminated":return"bg-gray-100 text-gray-800";default:return"bg-blue-100 text-blue-800"}})(r.status),children:r.status})})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Total Value"}),Si.jsx("p",{className:"text-lg font-semibold text-green-600",children:r.totalValue?qu(r.totalValue):"Not specified"})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Contract Period"}),Si.jsxs("p",{className:"text-sm",children:[Ru(r.startDate)," - ",Ru(r.endDate)]})]}),r.autoRenewal&&Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Auto Renewal"}),Si.jsx("p",{className:"text-sm",children:"Yes"})]}),r.renewalTerms&&Si.jsxs("div",{className:"md:col-span-2",children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Renewal Terms"}),Si.jsx("p",{className:"text-sm mt-1",children:r.renewalTerms})]})]}),r.notes&&Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Notes"}),Si.jsx("p",{className:"text-sm mt-1 p-3 bg-gray-50 rounded-md",children:r.notes})]}),Si.jsx("div",{className:"pt-4 border-t",children:Si.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[Si.jsx(jl,{className:"h-4 w-4 mr-1"}),"Created: ",Ru(r.createdAt),r.updatedAt&&r.updatedAt!==r.createdAt&&Si.jsxs("span",{className:"ml-4",children:["Last updated: ",Ru(r.updatedAt)]})]})})]})]}),Si.jsxs(Mp,{defaultValue:"service-scopes",className:"space-y-6",children:[Si.jsxs(Vp,{children:[Si.jsxs(Up,{value:"service-scopes",children:["Service Scopes (",u.length,")"]}),Si.jsxs(Up,{value:"safs",children:["SAFs (",h.length,")"]}),Si.jsxs(Up,{value:"cocs",children:["COCs (",x.length,")"]}),Si.jsxs(Up,{value:"documents",children:["Documents (",m.length,")"]}),Si.jsx(Up,{value:"relationships",children:"Relationships"})]}),Si.jsx($p,{value:"service-scopes",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Service Scopes"})}),Si.jsx(Lx,{children:u.length>0?Si.jsx("div",{className:"space-y-4",children:u.map((e=>{const s=e.scopeDefinition,t="string"==typeof s?s:(null==s?void 0:s.description)||"No description available",a=(()=>{if(!s||"string"==typeof s)return[];const e=[];for(const[t,a]of Object.entries(s))if("description"!==t&&"deliverables"!==t&&a){const s=t.replace(/([A-Z])/g," $1").replace(/^./,(e=>e.toUpperCase()));e.push({label:s,value:a})}return e})(),i=(null==s?void 0:s.deliverables)||[];return Si.jsxs("div",{className:"border rounded-lg p-4",children:[Si.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:e.serviceName||`Service Scope #${e.id}`}),Si.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[Ru(e.startDate)," - ",Ru(e.endDate)]})]}),Si.jsxs("div",{className:"text-right",children:[e.monthlyValue&&Si.jsxs("p",{className:"font-medium",children:[qu(e.monthlyValue),"/month"]}),Si.jsx(Sx,{variant:"outline",children:e.status})]})]}),t&&Si.jsxs("div",{className:"mb-3",children:[Si.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Description:"}),Si.jsx("p",{className:"text-sm text-gray-600",children:t})]}),a.length>0&&Si.jsxs("div",{className:"mb-3",children:[Si.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Scope Details:"}),Si.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:a.map(((e,s)=>Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsxs("span",{className:"text-sm font-medium text-gray-600",children:[e.label,":"]}),Si.jsx("span",{className:"text-sm text-gray-800",children:Array.isArray(e.value)?e.value.join(", "):e.value.toString()})]},s)))})]}),Array.isArray(i)&&i.length>0&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Deliverables:"}),Si.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(((e,s)=>Si.jsx(Sx,{variant:"outline",className:"text-xs",children:e},s)))})]})]},e.id)}))}):Si.jsx("p",{className:"text-gray-500 text-center py-8",children:"No service scopes found for this contract."})})]})}),Si.jsx($p,{value:"safs",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Service Authorization Forms"})}),Si.jsx(Lx,{children:h.length>0?Si.jsx("div",{className:"space-y-4",children:h.map((e=>Si.jsx("div",{className:"border rounded-lg p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:e.safNumber}),Si.jsxs("p",{className:"text-sm text-gray-600",children:[Ru(e.startDate)," - ",Ru(e.endDate)]}),e.description&&Si.jsx("p",{className:"text-sm text-gray-700 mt-2",children:e.description})]}),Si.jsxs("div",{className:"text-right",children:[e.value&&Si.jsx("p",{className:"font-medium text-green-600",children:qu(e.value)}),Si.jsx(Sx,{variant:"outline",children:e.status})]})]})},e.id)))}):Si.jsx("p",{className:"text-gray-500 text-center py-8",children:"No SAFs found for this contract."})})]})}),Si.jsx($p,{value:"cocs",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Certificates of Compliance"})}),Si.jsx(Lx,{children:x.length>0?Si.jsx("div",{className:"space-y-4",children:x.map((e=>Si.jsx("div",{className:"border rounded-lg p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium",children:e.cocNumber}),Si.jsx("p",{className:"text-sm text-gray-600",children:e.title}),e.description&&Si.jsx("p",{className:"text-sm text-gray-700 mt-2",children:e.description}),Si.jsxs("div",{className:"mt-2 space-y-1",children:[Si.jsxs("p",{className:"text-sm text-gray-600",children:[Si.jsx(jl,{className:"inline h-3 w-3 mr-1"}),"Issued: ",Ru(e.issueDate)]}),e.expiryDate&&Si.jsxs("p",{className:"text-sm text-gray-600",children:[Si.jsx(Wr,{className:"inline h-3 w-3 mr-1"}),"Expires: ",Ru(e.expiryDate)]})]})]}),Si.jsxs("div",{className:"text-right",children:[Si.jsx(Sx,{variant:"outline",children:e.status}),e.documentUrl&&Si.jsxs(Ex,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>window.open(e.documentUrl,"_blank"),children:[Si.jsx(Tl,{className:"h-3 w-3 mr-1"}),"View"]})]})]})},e.id)))}):Si.jsx("p",{className:"text-gray-500 text-center py-8",children:"No COCs found for this contract."})})]})}),Si.jsx($p,{value:"documents",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Contract Documents"})}),Si.jsx(Lx,{children:m.length>0?Si.jsx("div",{className:"space-y-4",children:m.map((e=>Si.jsx("div",{className:"border rounded-lg p-4",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:Si.jsx(Kr,{className:"h-4 w-4 text-blue-600"})}),Si.jsxs("div",{children:[Si.jsx("p",{className:"font-medium",children:e.name}),e.description&&Si.jsx("p",{className:"text-sm text-gray-600",children:e.description}),Si.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Uploaded: ",Ru(e.createdAt)]})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{variant:"outline",children:e.documentType}),Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>window.open(`/uploads/${e.fileName}`,"_blank"),children:[Si.jsx(Sl,{className:"h-3 w-3 mr-1"}),"View"]})]})]})},e.id)))}):Si.jsx("p",{className:"text-gray-500 text-center py-8",children:"No documents found for this contract."})})]})}),Si.jsx($p,{value:"relationships",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Entity Relationships"})}),Si.jsx(Lx,{children:Si.jsx(KC,{entityId:n,entityType:EC.CONTRACT,entityName:r.name})})]})})]})]}),Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Client Information"})}),Si.jsx(Lx,{children:o?Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("div",{children:Si.jsx(VC,{entity:{id:o.id,type:EC.CLIENT,name:o.name,url:`/clients/${o.id}`,status:o.status,icon:"Building",metadata:o},variant:"card",showTooltip:!0})}),Si.jsx(Cp,{}),Si.jsxs("div",{className:"space-y-3",children:[Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Contact"}),Si.jsx("p",{className:"text-sm",children:o.contactName})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Email"}),Si.jsx("p",{className:"text-sm",children:o.contactEmail})]}),o.contactPhone&&Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Phone"}),Si.jsx("p",{className:"text-sm",children:o.contactPhone})]})]})]}):Si.jsxs("div",{className:"animate-pulse",children:[Si.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),Si.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]})})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Quick Stats"})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Mr,{className:"h-4 w-4 mr-2 text-blue-600"}),Si.jsx("span",{className:"text-sm",children:"Service Scopes"})]}),Si.jsx("span",{className:"font-medium",children:u.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Kr,{className:"h-4 w-4 mr-2 text-green-600"}),Si.jsx("span",{className:"text-sm",children:"SAFs"})]}),Si.jsx("span",{className:"font-medium",children:h.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Gr,{className:"h-4 w-4 mr-2 text-purple-600"}),Si.jsx("span",{className:"text-sm",children:"COCs"})]}),Si.jsx("span",{className:"font-medium",children:x.length})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"flex items-center",children:[Si.jsx(Kr,{className:"h-4 w-4 mr-2 text-orange-600"}),Si.jsx("span",{className:"text-sm",children:"Documents"})]}),Si.jsx("span",{className:"font-medium",children:m.length})]})]})]})]})]})]}),Si.jsx(Sp,{open:t,onOpenChange:a,children:Si.jsxs(Ep,{className:"max-w-4xl max-h-[95vh] flex flex-col overflow-hidden",children:[Si.jsx(Ap,{className:"flex-shrink-0 border-b pb-4",children:Si.jsx(_p,{children:"Edit Contract"})}),Si.jsx("div",{className:"flex-1 overflow-y-auto px-1",children:Si.jsx("div",{className:"max-h-[70vh] overflow-y-auto",children:Si.jsx(tS,{contract:r,clients:d,onSubmit:e=>p.mutate(e),onCancel:()=>a(!1),isLoading:p.isPending})})})]})})]})}function nS({service:e,onSubmit:s,onCancel:t,isLoading:a=!1}){const i=Zc({resolver:bv(_w),defaultValues:{name:(null==e?void 0:e.name)||"",description:(null==e?void 0:e.description)||"",category:(null==e?void 0:e.category)||"",deliveryModel:(null==e?void 0:e.deliveryModel)||"serverless",basePrice:(null==e?void 0:e.basePrice)||"",pricingUnit:(null==e?void 0:e.pricingUnit)||"",isActive:(null==e?void 0:e.isActive)??!0,scopeDefinitionTemplate:(null==e?void 0:e.scopeDefinitionTemplate)||null}});return Si.jsx($w,{...i,children:Si.jsxs("form",{onSubmit:i.handleSubmit((e=>{s(e)})),className:"space-y-4 sm:space-y-6",children:[Si.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"name",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Service Name"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., SIEM Monitoring",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"category",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Category"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select category"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"Security Operations",children:"Security Operations"}),Si.jsx(Hp,{value:"Network Security",children:"Network Security"}),Si.jsx(Hp,{value:"Compliance",children:"Compliance"}),Si.jsx(Hp,{value:"Consulting",children:"Consulting"}),Si.jsx(Hp,{value:"Support",children:"Support"})]})]}),Si.jsx(Jw,{})]})})]}),Si.jsx(Bw,{control:i.control,name:"description",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Description"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Detailed description of the service...",className:"resize-none min-h-[80px]",rows:3,...e,value:e.value||""})}),Si.jsx(Jw,{})]})}),Si.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"deliveryModel",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Delivery Model"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select delivery model"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"serverless",children:"Serverless"}),Si.jsx(Hp,{value:"on-prem",children:"On-Premises Engineer"}),Si.jsx(Hp,{value:"hybrid",children:"Hybrid"}),Si.jsx(Hp,{value:"cloud",children:"Cloud-based"})]})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"isActive",render:({field:e})=>Si.jsxs(Gw,{className:"flex flex-row items-center justify-between rounded-lg border p-3 sm:p-4",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsx(Ww,{className:"text-base",children:"Active Service"}),Si.jsx(Yw,{className:"text-sm",children:"Enable this service for client assignments"})]}),Si.jsx(Hw,{children:Si.jsx(df,{checked:e.value,onCheckedChange:e.onChange})})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"basePrice",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Base Price ($)"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"number",step:"0.01",placeholder:"0.00",...e,value:e.value||""})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"pricingUnit",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Pricing Unit"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., per month, per user",...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]}),Si.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t",children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:t,className:"w-full sm:w-auto order-2 sm:order-1",children:"Cancel"}),Si.jsx(Ex,{type:"submit",disabled:a,className:"w-full sm:w-auto order-1 sm:order-2",children:a?Si.jsxs(Si.Fragment,{children:[Si.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),e?"Updating...":"Creating..."]}):e?"Update Service":"Create Service"})]})]})})}function rS(){const[e,s]=$n.useState(""),[t,a]=$n.useState(!1),[i,n]=$n.useState(null),{toast:r}=sd();Oo();const{isAdmin:l}=Ah(),{data:c=[],isLoading:o}=fh({queryKey:["/api/services"]}),d=gh({mutationFn:async e=>{const s=await vh("POST","/api/services",e);return await s.json()},onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/services"]}),a(!1),r({title:"Success",description:"Service created successfully"})},onError:()=>{r({title:"Error",description:"Failed to create service",variant:"destructive"})}}),u=gh({mutationFn:async({id:e,service:s})=>{const t=await vh("PUT",`/api/services/${e}`,s);return await t.json()},onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/services"]}),a(!1),n(null),r({title:"Success",description:"Service updated successfully"})},onError:()=>{r({title:"Error",description:"Failed to update service",variant:"destructive"})}}),m=gh({mutationFn:async e=>{await vh("DELETE",`/api/services/${e}`)},onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/services"]}),r({title:"Success",description:"Service deleted successfully"})},onError:()=>{r({title:"Error",description:"Failed to delete service",variant:"destructive"})}}),h=c.filter((s=>s.name.toLowerCase().includes(e.toLowerCase())||s.category.toLowerCase().includes(e.toLowerCase())));return Si.jsxs(vf,{title:"Services",subtitle:"Manage your service offerings and categories",children:[Si.jsx("div",{className:"p-4 sm:p-6 space-y-6",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[Si.jsxs("div",{children:[Si.jsx(_x,{className:"text-xl sm:text-2xl",children:"Service Management"}),Si.jsx(Fx,{className:"text-sm sm:text-base",children:"Organize and manage your service portfolio"})]}),Si.jsxs(Ex,{onClick:()=>a(!0),className:"w-full sm:w-auto",children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Service"]})]})}),Si.jsxs(Lx,{className:"space-y-4 sm:space-y-6",children:[Si.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[Si.jsx("div",{className:"flex-1",children:Si.jsx(kx,{placeholder:"Search services...",value:e,onChange:e=>s(e.target.value),className:"w-full"})}),Si.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:[Si.jsxs(zp,{value:"all",onValueChange:e=>{},children:[Si.jsx(Kp,{className:"w-full sm:w-[180px]",children:Si.jsx(Bp,{placeholder:"All Categories"})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Categories"}),Si.jsx(Hp,{value:"Security Operations",children:"Security Operations"}),Si.jsx(Hp,{value:"Network Security",children:"Network Security"}),Si.jsx(Hp,{value:"Compliance",children:"Compliance"}),Si.jsx(Hp,{value:"Consulting",children:"Consulting"}),Si.jsx(Hp,{value:"Support",children:"Support"})]})]}),Si.jsxs(zp,{value:"all",onValueChange:e=>{},children:[Si.jsx(Kp,{className:"w-full sm:w-[140px]",children:Si.jsx(Bp,{placeholder:"All Status"})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Status"}),Si.jsx(Hp,{value:"active",children:"Active"}),Si.jsx(Hp,{value:"inactive",children:"Inactive"})]})]})]})]}),o?Si.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[...Array(6)].map(((e,s)=>Si.jsx(Ax,{className:"animate-pulse",children:Si.jsxs(Lx,{className:"p-4 sm:p-6",children:[Si.jsx("div",{className:"flex items-start justify-between mb-3",children:Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-lg"}),Si.jsxs("div",{children:[Si.jsx("div",{className:"h-4 bg-gray-200 rounded w-24 mb-1"}),Si.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]})]})}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),Si.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]})},s)))}):h.length>0?Si.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6",children:h.map((e=>{const s=(e=>{switch(e){case"Security Operations":case"Endpoint Security":return Gr;case"Network Security":return ic;default:return Br}})(e.category);return Si.jsx(Ax,{className:"hover:shadow-md transition-shadow duration-200 group",children:Si.jsxs(Lx,{className:"p-4 sm:p-6",children:[Si.jsxs("div",{className:"flex items-start justify-between mb-3",children:[Si.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[Si.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:Si.jsx(s,{className:"h-5 w-5 text-blue-600"})}),Si.jsxs("div",{className:"min-w-0 flex-1",children:[Si.jsx("h4",{className:"font-medium text-gray-900 truncate text-sm sm:text-base",children:e.name}),Si.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.category})]})]}),Si.jsxs("div",{className:"flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200 flex-shrink-0",children:[Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(e=>{n(e),a(!0)})(e),className:"h-8 w-8 p-0 hover:bg-blue-50 hover:text-blue-600",title:"Edit service",children:Si.jsx(tl,{className:"h-3 w-3"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void(confirm("Are you sure you want to delete this service?")&&m.mutate(s));var s},className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"Delete service",children:Si.jsx(al,{className:"h-3 w-3"})})]})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx("p",{className:"text-xs sm:text-sm text-gray-600 line-clamp-2",children:e.description||"No description available"}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx(Sx,{variant:e.isActive?"default":"secondary",className:"text-xs",children:e.isActive?"Active":"Inactive"}),Si.jsx("span",{className:"text-xs text-gray-500",children:e.deliveryModel||"Standard"})]})]})]})},e.id)}))}):Si.jsxs("div",{className:"text-center py-8 sm:py-12",children:[Si.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:Si.jsx(zr,{className:"h-8 w-8 sm:h-10 sm:w-10 text-gray-400"})}),Si.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No services found"}),Si.jsx("p",{className:"text-gray-600 mb-6 text-sm sm:text-base max-w-md mx-auto",children:e?"No services match your current filters. Try adjusting your search criteria.":"Get started by creating your first service offering."}),!e&&Si.jsxs(Ex,{onClick:()=>a(!0),className:"w-full sm:w-auto",children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Create Your First Service"]})]}),!o&&h.length>0&&Si.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mt-6 pt-4 border-t border-gray-200 gap-4",children:[Si.jsxs("p",{className:"text-sm text-gray-600 text-center sm:text-left",children:["Showing ",h.length," of ",c.length," services"]}),Si.jsxs("div",{className:"flex justify-center sm:justify-end space-x-4 text-sm text-gray-600",children:[Si.jsxs("span",{children:["Active: ",c.filter((e=>e.isActive)).length]}),Si.jsxs("span",{children:["Inactive: ",c.filter((e=>!e.isActive)).length]})]})]})]})]})}),t&&Si.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:Si.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-auto",children:[Si.jsx("div",{className:"p-4 sm:p-6 border-b",children:Si.jsx("h2",{className:"text-lg sm:text-xl font-semibold",children:i?"Edit Service":"Create New Service"})}),Si.jsx("div",{className:"p-4 sm:p-6",children:Si.jsx(nS,{service:i,onSubmit:e=>{i?u.mutate({id:i.id,service:e}):d.mutate(e)},onCancel:()=>{a(!1),n(null)},isLoading:d.isPending||u.isPending})})]})})]})}const lS=Fw.extend({availableLicenses:Uc().optional()});function cS({licensePool:e,onSubmit:s,onCancel:t,isLoading:a=!1}){const i=Zc({resolver:bv(lS),defaultValues:{name:(null==e?void 0:e.name)||"",vendor:(null==e?void 0:e.vendor)||"",productName:(null==e?void 0:e.productName)||"",licenseType:(null==e?void 0:e.licenseType)||"",totalLicenses:(null==e?void 0:e.totalLicenses)||0,availableLicenses:(null==e?void 0:e.availableLicenses)||0,orderedLicenses:(null==e?void 0:e.orderedLicenses)||0,costPerLicense:(null==e?void 0:e.costPerLicense)||"",renewalDate:(null==e?void 0:e.renewalDate)?new Date(e.renewalDate).toISOString().split("T")[0]:"",purchaseRequestNumber:(null==e?void 0:e.purchaseRequestNumber)||"",purchaseOrderNumber:(null==e?void 0:e.purchaseOrderNumber)||"",notes:(null==e?void 0:e.notes)||"",isActive:(null==e?void 0:e.isActive)??!0}}),n=i.watch("orderedLicenses");$n.useEffect((()=>{if(void 0!==n){const s=((null==e?void 0:e.totalLicenses)||0)-((null==e?void 0:e.orderedLicenses)||0)+n;i.setValue("totalLicenses",s)}}),[n,e,i]);return Si.jsx($w,{...i,children:Si.jsxs("form",{onSubmit:i.handleSubmit((e=>{const{availableLicenses:t,...a}=e;s(a)})),className:"flex flex-col h-full",children:[Si.jsx(Lp,{children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"name",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"License Pool Name"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., Microsoft 365 E5",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"vendor",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Vendor"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., Microsoft",...e})}),Si.jsx(Jw,{})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"productName",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Product Name"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., Office 365",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"licenseType",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"License Type"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select license type"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"per-user",children:"Per User"}),Si.jsx(Hp,{value:"per-device",children:"Per Device"}),Si.jsx(Hp,{value:"concurrent",children:"Concurrent"}),Si.jsx(Hp,{value:"site",children:"Site License"}),Si.jsx(Hp,{value:"enterprise",children:"Enterprise"})]})]}),Si.jsx(Jw,{})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"orderedLicenses",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Ordered Licenses"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"number",placeholder:"0",...e,onChange:s=>e.onChange(parseInt(s.target.value)||0)})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"totalLicenses",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Total Licenses"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"number",placeholder:"0",...e,value:e.value||0,readOnly:!0,disabled:!0,className:"bg-gray-50 text-gray-600",title:"Auto-calculated based on ordered licenses"})}),Si.jsx(Jw,{}),Si.jsx("p",{className:"text-xs text-gray-500",children:"Auto-calculated based on ordered licenses"})]})}),Si.jsx(Bw,{control:i.control,name:"availableLicenses",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Available Licenses"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"number",placeholder:"0",...e,value:e.value||0,readOnly:!0,disabled:!0,className:"bg-gray-50 text-gray-600",title:"Auto-calculated: Total - Assigned licenses"})}),Si.jsx(Jw,{}),Si.jsx("p",{className:"text-xs text-gray-500",children:"Auto-calculated: Total - Assigned licenses"})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"purchaseRequestNumber",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Purchase Request Number"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., PR-2024-001",...e,value:e.value||""})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"purchaseOrderNumber",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Purchase Order Number"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., PO-2024-001",...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"costPerLicense",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Cost Per License"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., 15.00",...e,value:e.value||""})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"renewalDate",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Renewal Date"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"date",...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]}),Si.jsx(Bw,{control:i.control,name:"notes",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Notes"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Additional notes about this license pool...",className:"min-h-[100px]",...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]})}),Si.jsxs(Pp,{children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:t,disabled:a,children:"Cancel"}),Si.jsx(Ex,{type:"submit",disabled:a,children:a?"Saving...":e?"Update License Pool":"Create License Pool"})]})]})})}const oS=Wc({name:Vc().min(1,"Asset name is required"),category:Vc().min(1,"Category is required"),manufacturer:Vc().optional(),model:Vc().optional(),serialNumber:Vc().optional(),purchaseDate:Vc().optional(),purchaseCost:Vc().optional(),warrantyExpiry:Vc().optional(),location:Vc().optional(),status:Vc().default("available"),purchaseRequestNumber:Vc().optional(),purchaseOrderNumber:Vc().optional(),notes:Vc().optional(),quantity:Uc().min(1,"Quantity must be at least 1").max(100,"Maximum 100 assets at once").default(1)});function dS({asset:e,onSubmit:s,onCancel:t,isLoading:a=!1}){const i=Zc({resolver:bv(oS),defaultValues:{name:(null==e?void 0:e.name)||"",category:(null==e?void 0:e.category)||"",manufacturer:(null==e?void 0:e.manufacturer)||"",model:(null==e?void 0:e.model)||"",serialNumber:(null==e?void 0:e.serialNumber)||"",purchaseDate:(null==e?void 0:e.purchaseDate)?new Date(e.purchaseDate).toISOString().split("T")[0]:"",purchaseCost:(null==e?void 0:e.purchaseCost)||"",warrantyExpiry:(null==e?void 0:e.warrantyExpiry)?new Date(e.warrantyExpiry).toISOString().split("T")[0]:"",location:(null==e?void 0:e.location)||"",status:(null==e?void 0:e.status)||"available",purchaseRequestNumber:(null==e?void 0:e.purchaseRequestNumber)||"",purchaseOrderNumber:(null==e?void 0:e.purchaseOrderNumber)||"",notes:(null==e?void 0:e.notes)||"",quantity:1}}),n=i.watch("quantity"),r=!!e,l=i.watch("serialNumber");return Si.jsx($w,{...i,children:Si.jsxs("form",{onSubmit:i.handleSubmit((e=>{s(e)})),className:"flex flex-col h-full",children:[Si.jsx(Lp,{children:Si.jsxs("div",{className:"space-y-6",children:[!r&&Si.jsx(Bw,{control:i.control,name:"quantity",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Quantity"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"number",placeholder:"1",min:1,max:100,...e,onChange:s=>e.onChange(parseInt(s.target.value)||1)})}),Si.jsx(Jw,{}),Si.jsx("p",{className:"text-sm text-gray-500",children:"Number of identical assets to create (max 100)"})]})}),!r&&n>1&&l&&Si.jsxs(Nx,{children:[Si.jsx(vl,{className:"h-4 w-4"}),Si.jsxs(wx,{children:["When creating multiple assets, serial numbers will be auto-generated with incremental suffixes (e.g., ",l,"-001, ",l,"-002, etc.)"]})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"name",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Asset Name"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., Dell OptiPlex 7090",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"serialNumber",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsxs(Ww,{children:["Serial Number ",!r&&n>1&&"(Base)"]}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., ABC123XYZ",...e,value:e.value||""})}),Si.jsx(Jw,{}),!r&&n>1&&Si.jsxs("p",{className:"text-xs text-gray-500",children:["Base serial number - will generate: ",e.value||"ABC123XYZ","-001, ",e.value||"ABC123XYZ","-002, etc."]})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"category",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Category"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select category"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"desktop",children:"Desktop"}),Si.jsx(Hp,{value:"laptop",children:"Laptop"}),Si.jsx(Hp,{value:"server",children:"Server"}),Si.jsx(Hp,{value:"network",children:"Network Equipment"}),Si.jsx(Hp,{value:"security",children:"Security Device"}),Si.jsx(Hp,{value:"mobile",children:"Mobile Device"}),Si.jsx(Hp,{value:"printer",children:"Printer"}),Si.jsx(Hp,{value:"other",children:"Other"})]})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"manufacturer",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Manufacturer"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., Dell",...e})}),Si.jsx(Jw,{})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"model",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Model"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., OptiPlex 7090",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"status",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Status"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select status"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"available",children:"Available"}),Si.jsx(Hp,{value:"assigned",children:"Assigned"}),Si.jsx(Hp,{value:"maintenance",children:"Maintenance"}),Si.jsx(Hp,{value:"retired",children:"Retired"}),Si.jsx(Hp,{value:"lost",children:"Lost"})]})]}),Si.jsx(Jw,{})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"purchaseDate",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Purchase Date"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"date",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"purchaseCost",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsxs(Ww,{children:["Purchase Cost ($) ",!r&&n>1&&"(Per Unit)"]}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"0.00",...e,value:e.value||""})}),Si.jsx(Jw,{}),!r&&n>1&&e.value&&Si.jsxs("p",{className:"text-xs text-gray-500",children:["Total cost: $",(parseFloat(e.value)*n).toFixed(2)]})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"warrantyExpiry",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Warranty Expiry"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"date",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"location",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Location"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., Office Floor 2",...e})}),Si.jsx(Jw,{})]})})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:i.control,name:"purchaseRequestNumber",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Purchase Request (PR) Number"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., PR-2024-001",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:i.control,name:"purchaseOrderNumber",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Purchase Order (PO) Number"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., PO-2024-001",...e})}),Si.jsx(Jw,{})]})})]}),Si.jsx(Bw,{control:i.control,name:"notes",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Notes"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Additional notes about this asset...",className:"resize-none",rows:3,...e,value:e.value||""})}),Si.jsx(Jw,{})]})}),!r&&n>1&&Si.jsxs(Nx,{children:[Si.jsx(vl,{className:"h-4 w-4"}),Si.jsxs(wx,{children:[Si.jsx("strong",{children:"Bulk Creation Summary:"}),Si.jsx("br",{}),"• ",n," identical assets will be created",Si.jsx("br",{}),"• Serial numbers will be auto-generated with incremental suffixes",Si.jsx("br",{}),"• All other fields will be identical across all assets"]})]})]})}),Si.jsxs(Pp,{children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:t,children:"Cancel"}),Si.jsx(Ex,{type:"submit",disabled:a,children:a?"Saving...":r?"Update Asset":"Create "+(n>1?`${n} Assets`:"Asset")})]})]})})}function uS(){const[e,s]=$n.useState(""),[t,a]=$n.useState(!1),[i,n]=$n.useState(!1),[r,l]=$n.useState(null),[c,o]=$n.useState(null),[d,u]=$n.useState(new Set),{toast:m}=sd(),{data:h=[],isLoading:x}=fh({queryKey:["/api/hardware-assets"]}),{data:p=[],isLoading:f}=fh({queryKey:["/api/license-pools"]}),{data:g={}}=fh({queryKey:["/api/license-pools/allocations/all"]}),j=gh({mutationFn:async e=>(await vh("POST","/api/license-pools",e)).json(),onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/license-pools"]}),a(!1),m({title:"Success",description:"License pool created successfully"})},onError:()=>{m({title:"Error",description:"Failed to create license pool",variant:"destructive"})}}),v=gh({mutationFn:async e=>(await vh("POST","/api/hardware-assets",e)).json(),onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/hardware-assets"]}),n(!1),m({title:"Success",description:"Hardware asset created successfully"})},onError:()=>{m({title:"Error",description:"Failed to create hardware asset",variant:"destructive"})}}),y=gh({mutationFn:async({id:e,data:s})=>(await vh("PUT",`/api/hardware-assets/${e}`,s)).json(),onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/hardware-assets"]}),l(null),n(!1),m({title:"Success",description:"Hardware asset updated successfully"})},onError:()=>{m({title:"Error",description:"Failed to update hardware asset",variant:"destructive"})}}),b=gh({mutationFn:async e=>(await vh("DELETE",`/api/hardware-assets/${e}`)).json(),onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/hardware-assets"]}),m({title:"Success",description:"Hardware asset deleted successfully"})},onError:()=>{m({title:"Error",description:"Failed to delete hardware asset",variant:"destructive"})}}),N=gh({mutationFn:async({id:e,data:s})=>(await vh("PUT",`/api/license-pools/${e}`,s)).json(),onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/license-pools"]}),o(null),a(!1),m({title:"Success",description:"License pool updated successfully"})},onError:()=>{m({title:"Error",description:"Failed to update license pool",variant:"destructive"})}}),w=gh({mutationFn:async e=>(await vh("DELETE",`/api/license-pools/${e}`)).json(),onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/license-pools"]}),m({title:"Success",description:"License pool deleted successfully"})},onError:()=>{m({title:"Error",description:"Failed to delete license pool",variant:"destructive"})}}),C=(h||[]).filter((s=>{var t,a;return(null==(t=s.name)?void 0:t.toLowerCase().includes(e.toLowerCase()))||(null==(a=s.category)?void 0:a.toLowerCase().includes(e.toLowerCase()))||s.manufacturer&&s.manufacturer.toLowerCase().includes(e.toLowerCase())})),S=(p||[]).filter((s=>{var t,a,i;return(null==(t=s.name)?void 0:t.toLowerCase().includes(e.toLowerCase()))||(null==(a=s.vendor)?void 0:a.toLowerCase().includes(e.toLowerCase()))||(null==(i=s.productName)?void 0:i.toLowerCase().includes(e.toLowerCase()))})),T=e=>g[e]||[];return Si.jsx(vf,{title:"Asset Management",subtitle:"Manage hardware inventory and software licenses",children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[Si.jsx(Ax,{children:Si.jsx(Lx,{className:"p-6",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Hardware"}),Si.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:h.length})]}),Si.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:Si.jsx(zr,{className:"h-6 w-6 text-blue-600"})})]})})}),Si.jsx(Ax,{children:Si.jsx(Lx,{className:"p-6",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Available Assets"}),Si.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:h.filter((e=>"available"===e.status)).length})]}),Si.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:Si.jsx(zr,{className:"h-6 w-6 text-green-600"})})]})})}),Si.jsx(Ax,{children:Si.jsx(Lx,{className:"p-6",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-gray-600",children:"License Pools"}),Si.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:p.length})]}),Si.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:Si.jsx(Ul,{className:"h-6 w-6 text-purple-600"})})]})})}),Si.jsx(Ax,{children:Si.jsx(Lx,{className:"p-6",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Licenses"}),Si.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:p.reduce(((e,s)=>e+s.totalLicenses),0)})]}),Si.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:Si.jsx(Ul,{className:"h-6 w-6 text-yellow-600"})})]})})})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx(_x,{children:"Asset Inventory"}),Si.jsxs("div",{className:"flex space-x-2",children:[Si.jsxs(Sp,{open:i,onOpenChange:n,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{variant:"outline",children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Hardware"]})}),Si.jsxs(Ep,{className:"max-w-2xl max-h-[85vh] overflow-hidden",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:r?"Edit Hardware Asset":"Create New Hardware Asset"})}),Si.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:Si.jsx(dS,{onSubmit:e=>{r?y.mutate({id:r.id,data:e}):v.mutate(e)},onCancel:()=>{n(!1),l(null)},isLoading:v.isPending||y.isPending,asset:r||void 0})})]})]}),Si.jsxs(Sp,{open:t,onOpenChange:a,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add License Pool"]})}),Si.jsxs(Ep,{className:"max-w-2xl max-h-[85vh] overflow-hidden",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:c?"Edit License Pool":"Create New License Pool"})}),Si.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:Si.jsx(cS,{onSubmit:e=>{c?N.mutate({id:c.id,data:e}):j.mutate(e)},onCancel:()=>{a(!1),o(null)},isLoading:j.isPending||N.isPending,licensePool:c||void 0})})]})]})]})]})}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"mb-6",children:Si.jsxs("div",{className:"relative",children:[Si.jsx(Xr,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),Si.jsx(kx,{placeholder:"Search assets...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]})}),Si.jsxs(Mp,{defaultValue:"hardware",className:"w-full",children:[Si.jsxs(Vp,{children:[Si.jsx(Up,{value:"hardware",children:"Hardware Assets"}),Si.jsx(Up,{value:"licenses",children:"License Pools"})]}),Si.jsx($p,{value:"hardware",className:"space-y-4",children:Si.jsx("div",{className:"border rounded-lg",children:Si.jsxs(Wj,{children:[Si.jsx(Hj,{children:Si.jsxs(Jj,{children:[Si.jsx(Xj,{children:"Asset"}),Si.jsx(Xj,{children:"Category"}),Si.jsx(Xj,{children:"Manufacturer"}),Si.jsx(Xj,{children:"Model"}),Si.jsx(Xj,{children:"Serial Number"}),Si.jsx(Xj,{children:"Status"}),Si.jsx(Xj,{children:"Location"}),Si.jsx(Xj,{children:"PR/PO"}),Si.jsx(Xj,{children:"Actions"})]})}),Si.jsx(Yj,{children:x?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:9,className:"text-center py-8",children:"Loading hardware assets..."})}):0===C.length?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:9,className:"text-center py-8",children:Si.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[Si.jsx(zr,{className:"h-8 w-8 text-gray-400"}),Si.jsx("p",{className:"text-gray-500",children:"No hardware assets found"}),Si.jsx("p",{className:"text-sm text-gray-400",children:e?"Try adjusting your search":"Add your first hardware asset to get started"})]})})}):C.map((e=>Si.jsxs(Jj,{children:[Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:Si.jsx(zr,{className:"h-4 w-4 text-blue-600"})}),Si.jsx("div",{children:Si.jsx("p",{className:"font-medium",children:e.name})})]})}),Si.jsx(Zj,{children:e.category}),Si.jsx(Zj,{children:e.manufacturer||"Not specified"}),Si.jsx(Zj,{children:e.model||"Not specified"}),Si.jsx(Zj,{children:Si.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:e.serialNumber||"Not available"})}),Si.jsx(Zj,{children:Si.jsx(Sx,{variant:HC(e.status),children:e.status})}),Si.jsx(Zj,{children:e.location||"Not specified"}),Si.jsx(Zj,{children:Si.jsxs("div",{className:"text-xs space-y-1",children:[e.purchaseRequestNumber&&Si.jsxs("div",{className:"text-blue-600",children:["PR: ",e.purchaseRequestNumber]}),e.purchaseOrderNumber&&Si.jsxs("div",{className:"text-green-600",children:["PO: ",e.purchaseOrderNumber]}),!e.purchaseRequestNumber&&!e.purchaseOrderNumber&&Si.jsx("span",{className:"text-gray-400",children:"Not set"})]})}),Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>(e=>{l(e),n(!0)})(e),children:Si.jsx(tl,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>{return s=e.id,void(confirm("Are you sure you want to delete this hardware asset?")&&b.mutate(s));var s},className:"text-red-600 hover:text-red-700",children:Si.jsx(al,{className:"h-4 w-4"})})]})})]},e.id)))})]})})}),Si.jsx($p,{value:"licenses",className:"space-y-4",children:Si.jsx("div",{className:"border rounded-lg",children:Si.jsxs(Wj,{children:[Si.jsx(Hj,{children:Si.jsxs(Jj,{children:[Si.jsx(Xj,{className:"w-12",children:"Expand"}),Si.jsx(Xj,{children:"License Pool"}),Si.jsx(Xj,{children:"Vendor"}),Si.jsx(Xj,{children:"Product"}),Si.jsx(Xj,{children:"Type"}),Si.jsx(Xj,{children:"Ordered"}),Si.jsx(Xj,{children:"Total Licenses"}),Si.jsx(Xj,{children:"Allocated"}),Si.jsx(Xj,{children:"Available"}),Si.jsx(Xj,{children:"PR/PO"}),Si.jsx(Xj,{children:"Actions"})]})}),Si.jsx(Yj,{children:f?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:11,className:"text-center py-8",children:"Loading license pools..."})}):0===S.length?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:11,className:"text-center py-8",children:Si.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[Si.jsx(Ul,{className:"h-8 w-8 text-gray-400"}),Si.jsx("p",{className:"text-gray-500",children:"No license pools found"}),Si.jsx("p",{className:"text-sm text-gray-400",children:e?"Try adjusting your search":"Add your first license pool to get started"})]})})}):S.map((e=>{const s=T(e.id),t=(i=e.id,T(i).reduce(((e,s)=>e+s.assignedLicenses),0));var i;const n=d.has(e.id);return Si.jsxs(Bn.Fragment,{children:[Si.jsxs(Jj,{children:[Si.jsx(Zj,{children:Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=new Set(d);s.has(e)?s.delete(e):s.add(e),u(s)})(e.id),className:"p-1",children:n?Si.jsx(Hr,{className:"h-4 w-4"}):Si.jsx(fl,{className:"h-4 w-4"})})}),Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:Si.jsx(Ul,{className:"h-4 w-4 text-purple-600"})}),Si.jsxs("div",{children:[Si.jsx("p",{className:"font-medium",children:e.name}),s.length>0&&Si.jsxs("p",{className:"text-xs text-gray-500",children:[s.length," client",1!==s.length?"s":""]})]})]})}),Si.jsx(Zj,{children:e.vendor}),Si.jsx(Zj,{children:e.productName}),Si.jsx(Zj,{children:Si.jsx(Sx,{variant:"outline",children:e.licenseType||"Standard"})}),Si.jsx(Zj,{children:Si.jsx("span",{className:"font-medium text-blue-600",children:e.orderedLicenses||0})}),Si.jsx(Zj,{children:e.totalLicenses}),Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("span",{className:t>0?"font-medium text-blue-600":"text-gray-500",children:t}),t>0&&Si.jsx($r,{className:"h-3 w-3 text-gray-400"})]})}),Si.jsx(Zj,{children:Si.jsx("span",{className:e.availableLicenses>0?"text-green-600":"text-red-600",children:e.availableLicenses})}),Si.jsx(Zj,{children:Si.jsxs("div",{className:"text-xs space-y-1",children:[e.purchaseRequestNumber&&Si.jsxs("div",{className:"text-blue-600",children:["PR: ",e.purchaseRequestNumber]}),e.purchaseOrderNumber&&Si.jsxs("div",{className:"text-green-600",children:["PO: ",e.purchaseOrderNumber]}),!e.purchaseRequestNumber&&!e.purchaseOrderNumber&&Si.jsx("span",{className:"text-gray-400",children:"Not set"})]})}),Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>(e=>{o(e),a(!0)})(e),children:Si.jsx(tl,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>{return s=e.id,void(confirm("Are you sure you want to delete this license pool?")&&w.mutate(s));var s},className:"text-red-600 hover:text-red-700",children:Si.jsx(al,{className:"h-4 w-4"})})]})})]}),n&&Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:11,className:"bg-gray-50 border-b border-gray-200",children:Si.jsx("div",{className:"py-3",children:s.length>0?Si.jsxs("div",{children:[Si.jsxs("h4",{className:"font-medium text-sm text-gray-700 mb-3 flex items-center",children:[Si.jsx($r,{className:"h-4 w-4 mr-2"}),"Client Allocations (",s.length,")"]}),Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:s.map((e=>Si.jsx("div",{className:"bg-white p-3 rounded-md border border-gray-200",children:Si.jsxs("div",{className:"flex justify-between items-start",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"font-medium text-sm text-gray-900",children:e.clientName}),Si.jsxs("p",{className:"text-xs text-gray-500",children:["Allocated: ",new Date(e.assignedDate).toLocaleDateString()]}),e.notes&&Si.jsx("p",{className:"text-xs text-gray-600 mt-1",children:e.notes})]}),Si.jsxs("div",{className:"text-right",children:[Si.jsx("p",{className:"font-semibold text-lg text-blue-600",children:e.assignedLicenses.toLocaleString()}),Si.jsx("p",{className:"text-xs text-gray-500",children:"licenses"})]})]})},e.id)))}),Si.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[Si.jsxs("div",{className:"flex justify-between text-sm",children:[Si.jsx("span",{className:"text-gray-600",children:"Total Allocated:"}),Si.jsxs("span",{className:"font-medium text-blue-600",children:[t.toLocaleString()," licenses"]})]}),Si.jsxs("div",{className:"flex justify-between text-sm",children:[Si.jsx("span",{className:"text-gray-600",children:"Remaining Available:"}),Si.jsxs("span",{className:"font-medium "+(e.availableLicenses>0?"text-green-600":"text-red-600"),children:[e.availableLicenses.toLocaleString()," licenses"]})]})]})]}):Si.jsxs("div",{className:"text-center py-6",children:[Si.jsx($r,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),Si.jsx("p",{className:"text-sm text-gray-500",children:"No client allocations yet"}),Si.jsxs("p",{className:"text-xs text-gray-400",children:["All ",e.totalLicenses," licenses are available for allocation"]})]})})})})]},e.id)}))})]})})})]})]})]})]})})}var mS="Progress",[hS,xS]=Ni(mS),[pS,fS]=hS(mS),gS=$n.forwardRef(((e,s)=>{const{__scopeProgress:t,value:a=null,max:i,getValueLabel:n=yS,...r}=e;(i||0===i)&&wS(i);const l=wS(i)?i:100;null!==a&&CS(a,l);const c=CS(a,l)?a:null,o=NS(c)?n(c,l):void 0;return Si.jsx(pS,{scope:t,value:c,max:l,children:Si.jsx(ki.div,{"aria-valuemax":l,"aria-valuemin":0,"aria-valuenow":NS(c)?c:void 0,"aria-valuetext":o,role:"progressbar","data-state":bS(c,l),"data-value":c??void 0,"data-max":l,...r,ref:s})})}));gS.displayName=mS;var jS="ProgressIndicator",vS=$n.forwardRef(((e,s)=>{const{__scopeProgress:t,...a}=e,i=fS(jS,t);return Si.jsx(ki.div,{"data-state":bS(i.value,i.max),"data-value":i.value??void 0,"data-max":i.max,...a,ref:s})}));function yS(e,s){return`${Math.round(e/s*100)}%`}function bS(e,s){return null==e?"indeterminate":e===s?"complete":"loading"}function NS(e){return"number"==typeof e}function wS(e){return NS(e)&&!isNaN(e)&&e>0}function CS(e,s){return NS(e)&&!isNaN(e)&&e<=s&&e>=0}vS.displayName=jS;var SS=gS,TS=vS;const kS=$n.forwardRef((({className:e,value:s,...t},a)=>Si.jsx(SS,{ref:a,className:Lu("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...t,children:Si.jsx(TS,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})})));function DS(){const{id:e}=Ro(),[,s]=Oo(),{toast:t}=sd(),a=dh(),[i,n]=$n.useState(!1),[r,l]=$n.useState(!1),{data:c,isLoading:o}=fh({queryKey:[`/api/license-pools/${e}/stats`],queryFn:async()=>(await vh("GET",`/api/license-pools/${e}/stats`)).json(),enabled:!!e}),{data:d=[],isLoading:u}=fh({queryKey:[`/api/license-pools/${e}/assignments`],queryFn:async()=>(await vh("GET",`/api/license-pools/${e}/assignments`)).json(),enabled:!!e}),{data:m}=fh({queryKey:[`/api/license-pools/${e}/usage-stats`],queryFn:async()=>(await vh("GET",`/api/license-pools/${e}/usage-stats`)).json(),enabled:!!e}),h=gh({mutationFn:async s=>(await vh("PUT",`/api/license-pools/${e}`,s)).json(),onSuccess:()=>{a.invalidateQueries({queryKey:[`/api/license-pools/${e}/stats`]}),a.invalidateQueries({queryKey:["/api/license-pools"]}),n(!1),t({title:"Success",description:"License pool updated successfully"})},onError:()=>{t({title:"Error",description:"Failed to update license pool",variant:"destructive"})}}),x=gh({mutationFn:async s=>(await vh("POST",`/api/clients/${s.clientId}/licenses`,{licensePoolId:parseInt(e),assignedLicenses:s.assignedLicenses,notes:s.notes})).json(),onSuccess:()=>{a.invalidateQueries({queryKey:[`/api/license-pools/${e}/assignments`]}),a.invalidateQueries({queryKey:[`/api/license-pools/${e}/stats`]}),a.invalidateQueries({queryKey:["/api/license-pools"]}),l(!1),t({title:"Success",description:"License assigned successfully"})},onError:()=>{t({title:"Error",description:"Failed to assign license",variant:"destructive"})}}),p=e=>new Intl.NumberFormat("en-US").format(e);return o?Si.jsx(vf,{children:Si.jsx("div",{className:"container mx-auto p-6",children:Si.jsxs("div",{className:"animate-pulse",children:[Si.jsx("div",{className:"h-8 bg-gray-200 rounded mb-4"}),Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[1,2,3,4].map((e=>Si.jsx("div",{className:"h-32 bg-gray-200 rounded"},e)))}),Si.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})})}):c?Si.jsx(vf,{children:Si.jsxs("div",{className:"container mx-auto p-6",children:[Si.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Si.jsxs("div",{className:"flex items-center space-x-4",children:[Si.jsx(Ex,{variant:"ghost",onClick:()=>s("/assets"),children:Si.jsx(dl,{className:"h-4 w-4"})}),Si.jsxs("div",{children:[Si.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:c.name}),Si.jsxs("p",{className:"text-gray-600",children:[c.vendor," ",c.productName]})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{className:`${(e=>{switch(e){case"healthy":return"text-green-600 bg-green-50 border-green-200";case"warning":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"critical":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}})(c.status)}`,children:c.status}),Si.jsxs(Sp,{open:i,onOpenChange:n,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{variant:"outline",children:[Si.jsx(rc,{className:"h-4 w-4 mr-2"}),"Edit Pool"]})}),Si.jsxs(Ep,{className:"max-w-2xl max-h-[85vh] overflow-hidden",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Edit License Pool"})}),Si.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:Si.jsx(cS,{licensePool:c,onSubmit:e=>h.mutate(e),onCancel:()=>n(!1),isLoading:h.isPending})})]})]}),Si.jsxs(Sp,{open:r,onOpenChange:l,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Assign License"]})}),Si.jsxs(Ep,{className:"max-w-lg",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Assign License to Client"})}),Si.jsx(oC,{clientId:0,licensePoolId:parseInt(e),onSubmit:e=>x.mutate(e),onCancel:()=>l(!1),isLoading:x.isPending})]})]})]})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Total Licenses"}),Si.jsx(nc,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:p(c.totalLicenses)}),Si.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ordered: ",p(c.orderedLicenses)]})]})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Available"}),Si.jsx(Dl,{className:"h-4 w-4 text-green-500"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:p(c.availableLicenses)}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:"Ready for assignment"})]})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Assigned"}),Si.jsx($r,{className:"h-4 w-4 text-blue-500"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:p(c.assignedLicenses)}),Si.jsxs("p",{className:"text-xs text-muted-foreground",children:["To ",d.length," client",1!==d.length?"s":""]})]})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Utilization"}),Si.jsx(yl,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsxs(Lx,{children:[Si.jsxs("div",{className:"text-2xl font-bold",children:[c.utilizationPercentage.toFixed(1),"%"]}),Si.jsx(kS,{value:c.utilizationPercentage,className:"mt-2"})]})]})]}),Si.jsxs(Mp,{defaultValue:"overview",className:"space-y-6",children:[Si.jsxs(Vp,{children:[Si.jsx(Up,{value:"overview",children:"Overview"}),Si.jsxs(Up,{value:"assignments",children:["Assignments (",d.length,")"]}),Si.jsx(Up,{value:"analytics",children:"Analytics"}),Si.jsx(Up,{value:"details",children:"Details"})]}),Si.jsxs($p,{value:"overview",className:"space-y-6",children:[Si.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(nc,{className:"h-5 w-5 mr-2"}),"License Summary"]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"space-y-2",children:[Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-sm text-muted-foreground",children:"License Type:"}),Si.jsx(Sx,{variant:"outline",children:c.licenseType})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-sm text-muted-foreground",children:"Status:"}),Si.jsxs("div",{className:"flex items-center space-x-1",children:[(e=>{switch(e){case"healthy":return Si.jsx(Dl,{className:"h-4 w-4 text-green-500"});case"warning":return Si.jsx(ol,{className:"h-4 w-4 text-yellow-500"});case"critical":return Si.jsx(zl,{className:"h-4 w-4 text-red-500"});default:return Si.jsx(zr,{className:"h-4 w-4 text-gray-500"})}})(c.status),Si.jsx("span",{className:"text-sm font-medium",children:c.status})]})]}),c.renewalDate&&Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-sm text-muted-foreground",children:"Renewal Date:"}),Si.jsx("span",{className:"text-sm font-medium",children:Ru(c.renewalDate)})]})]}),Si.jsxs("div",{className:"border-t pt-4",children:[Si.jsx("h4",{className:"font-medium mb-2",children:"License Distribution"}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsxs("div",{className:"flex justify-between items-center",children:[Si.jsx("span",{className:"text-sm",children:"Available"}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:Si.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:c.availableLicenses/c.totalLicenses*100+"%"}})}),Si.jsx("span",{className:"text-sm font-medium",children:c.availableLicenses})]})]}),Si.jsxs("div",{className:"flex justify-between items-center",children:[Si.jsx("span",{className:"text-sm",children:"Assigned"}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:Si.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:c.assignedLicenses/c.totalLicenses*100+"%"}})}),Si.jsx("span",{className:"text-sm font-medium",children:c.assignedLicenses})]})]})]})]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Ur,{className:"h-5 w-5 mr-2"}),"Financial Information"]})}),Si.jsx(Lx,{className:"space-y-4",children:c.costPerLicense&&Si.jsxs(Si.Fragment,{children:[Si.jsxs("div",{className:"space-y-2",children:[Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-sm text-muted-foreground",children:"Cost per License:"}),Si.jsx("span",{className:"text-sm font-medium",children:qu(c.costPerLicense)})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Pool Value:"}),Si.jsx("span",{className:"text-lg font-bold",children:qu(c.totalLicenses*c.costPerLicense)})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-sm text-muted-foreground",children:"Assigned Value:"}),Si.jsx("span",{className:"text-sm font-medium",children:qu(c.assignedLicenses*c.costPerLicense)})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-sm text-muted-foreground",children:"Available Value:"}),Si.jsx("span",{className:"text-sm font-medium",children:qu(c.availableLicenses*c.costPerLicense)})]})]}),Si.jsxs("div",{className:"border-t pt-4",children:[Si.jsx("h4",{className:"font-medium mb-2",children:"Purchase Information"}),Si.jsxs("div",{className:"space-y-1 text-sm",children:[c.purchaseRequestNumber&&Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-muted-foreground",children:"PR Number:"}),Si.jsx("span",{className:"font-medium",children:c.purchaseRequestNumber})]}),c.purchaseOrderNumber&&Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-muted-foreground",children:"PO Number:"}),Si.jsx("span",{className:"font-medium",children:c.purchaseOrderNumber})]})]})]})]})})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Nl,{className:"h-5 w-5 mr-2"}),"Recent Assignments"]})}),Si.jsx(Lx,{children:d.length>0?Si.jsxs("div",{className:"space-y-2",children:[d.slice(0,5).map((e=>Si.jsxs("div",{className:"flex items-center justify-between py-2 border-b last:border-b-0",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"font-medium",children:e.clientName}),Si.jsxs("p",{className:"text-sm text-muted-foreground",children:["Assigned ",Ru(e.assignedDate)]})]}),Si.jsxs("div",{className:"text-right",children:[Si.jsx("p",{className:"font-medium",children:p(e.assignedLicenses)}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"licenses"})]})]},e.id))),d.length>5&&Si.jsx("div",{className:"text-center pt-2",children:Si.jsxs(Ex,{variant:"ghost",size:"sm",children:["View all ",d.length," assignments"]})})]}):Si.jsxs("div",{className:"text-center py-8",children:[Si.jsx($r,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),Si.jsx("p",{className:"text-muted-foreground",children:"No assignments yet"})]})})]})]}),Si.jsx($p,{value:"assignments",className:"space-y-6",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"License Assignments"})}),Si.jsx(Lx,{children:u?Si.jsx("div",{className:"text-center py-8",children:"Loading assignments..."}):d.length>0?Si.jsxs(Wj,{children:[Si.jsx(Hj,{children:Si.jsxs(Jj,{children:[Si.jsx(Xj,{children:"Client"}),Si.jsx(Xj,{children:"Assigned Licenses"}),Si.jsx(Xj,{children:"Assignment Date"}),Si.jsx(Xj,{children:"Notes"}),Si.jsx(Xj,{children:"Actions"})]})}),Si.jsx(Yj,{children:d.map((e=>Si.jsxs(Jj,{children:[Si.jsx(Zj,{className:"font-medium",children:e.clientName}),Si.jsx(Zj,{children:p(e.assignedLicenses)}),Si.jsx(Zj,{children:Ru(e.assignedDate)}),Si.jsx(Zj,{children:e.notes||"-"}),Si.jsx(Zj,{children:Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>s(`/clients/${e.clientId}`),children:Si.jsx(Tl,{className:"h-4 w-4"})})})]},e.id)))})]}):Si.jsxs("div",{className:"text-center py-8",children:[Si.jsx($r,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),Si.jsx("p",{className:"text-muted-foreground",children:"No assignments found"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:'Click "Assign License" to get started'})]})})]})}),Si.jsx($p,{value:"analytics",className:"space-y-6",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Usage Analytics"})}),Si.jsx(Lx,{children:Si.jsxs("div",{className:"text-center py-8",children:[Si.jsx(yl,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),Si.jsx("p",{className:"text-muted-foreground",children:"Analytics coming soon"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Track license usage patterns and trends over time"})]})})]})}),Si.jsx($p,{value:"details",className:"space-y-6",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Pool Details"})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium mb-2",children:"Basic Information"}),Si.jsxs("div",{className:"space-y-2 text-sm",children:[Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-muted-foreground",children:"Name:"}),Si.jsx("span",{className:"font-medium",children:c.name})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-muted-foreground",children:"Vendor:"}),Si.jsx("span",{className:"font-medium",children:c.vendor})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-muted-foreground",children:"Product:"}),Si.jsx("span",{className:"font-medium",children:c.productName})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-muted-foreground",children:"Type:"}),Si.jsx("span",{className:"font-medium",children:c.licenseType})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-muted-foreground",children:"Active:"}),Si.jsx("span",{className:"font-medium",children:c.isActive?"Yes":"No"})]})]})]}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium mb-2",children:"Timestamps"}),Si.jsxs("div",{className:"space-y-2 text-sm",children:[Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-muted-foreground",children:"Created:"}),Si.jsx("span",{className:"font-medium",children:Ru(c.createdAt)})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-muted-foreground",children:"Updated:"}),Si.jsx("span",{className:"font-medium",children:Ru(c.updatedAt)})]}),c.renewalDate&&Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("span",{className:"text-muted-foreground",children:"Renewal:"}),Si.jsx("span",{className:"font-medium",children:Ru(c.renewalDate)})]})]})]})]}),c.notes&&Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium mb-2",children:"Notes"}),Si.jsx("div",{className:"bg-gray-50 p-3 rounded-md",children:Si.jsx("p",{className:"text-sm",children:c.notes})})]})]})]})})]})]})}):Si.jsx(vf,{children:Si.jsx("div",{className:"container mx-auto p-6",children:Si.jsxs("div",{className:"text-center py-12",children:[Si.jsx(nc,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),Si.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"License Pool Not Found"}),Si.jsx("p",{className:"text-gray-500 mb-4",children:"The license pool you're looking for doesn't exist or you don't have permission to view it."}),Si.jsxs(Ex,{onClick:()=>s("/assets"),children:[Si.jsx(dl,{className:"h-4 w-4 mr-2"}),"Back to Assets"]})]})})})}kS.displayName=SS.displayName;const ES=Wc({firstName:Vc().min(1,"First name is required"),lastName:Vc().min(1,"Last name is required"),email:Vc().email("Invalid email address"),role:eo(["admin","manager","engineer","user"]),username:Vc().min(3,"Username must be at least 3 characters"),password:Vc().min(6,"Password must be at least 6 characters")}),AS=Wc({userId:Vc().min(1,"Please select a team member"),clientId:Vc().min(1,"Please select a client"),role:Vc().min(1,"Please specify the role")});function PS(){const[e,s]=$n.useState([]),[t,a]=$n.useState(!0),[i,n]=$n.useState(""),[r,l]=$n.useState("all"),[c,o]=$n.useState(!1),[d,u]=$n.useState(!1),[m,h]=$n.useState(!1),[x,p]=$n.useState(null),[f,g]=$n.useState(null),{toast:j}=sd(),{data:v=[],isLoading:y,refetch:b}=fh({queryKey:["/api/users"]}),{data:N=[],isLoading:w,refetch:C}=fh({queryKey:["/api/team-assignments"]}),{data:S=[]}=fh({queryKey:["/api/clients"]}),T=Zc({resolver:bv(ES),defaultValues:{firstName:"",lastName:"",email:"",role:"user",username:"",password:""}}),k=Zc({resolver:bv(AS),defaultValues:{userId:"",clientId:"",role:""}});$n.useEffect((()=>{D()}),[]);const D=async()=>{try{const e=await fetch("/api/users",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch team members");const t=await e.json();s(t)}catch(e){j({title:"Error",description:"Failed to load team members",variant:"destructive"})}finally{a(!1)}},E=e.filter((e=>{var s,t,a,n;const l=(null==(s=e.username)?void 0:s.toLowerCase().includes(i.toLowerCase()))||(null==(t=e.email)?void 0:t.toLowerCase().includes(i.toLowerCase()))||(null==(a=e.firstName)?void 0:a.toLowerCase().includes(i.toLowerCase()))||(null==(n=e.lastName)?void 0:n.toLowerCase().includes(i.toLowerCase())),c="all"===r||e.role===r;return l&&c}));return t?Si.jsx("div",{className:"flex items-center justify-center h-64",children:Si.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Si.jsx(vf,{title:"Team Management",subtitle:"Manage team members and client assignments",children:Si.jsxs("main",{className:"flex-1 overflow-auto p-6 pt-16 md:pt-6",children:[Si.jsxs(Mp,{defaultValue:"team",className:"space-y-6",children:[Si.jsxs(Vp,{children:[Si.jsx(Up,{value:"team",children:"Team Members"}),Si.jsx(Up,{value:"assignments",children:"Client Assignments"})]}),Si.jsx($p,{value:"team",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx($r,{className:"h-5 w-5 mr-2"}),"Team Members"]}),Si.jsxs(Ex,{onClick:()=>{o(!0)},children:[Si.jsx(Er,{className:"h-4 w-4 mr-2"}),"Add Team Member"]})]})}),Si.jsxs(Lx,{children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{className:"pb-3",children:Si.jsx(_x,{className:"text-sm font-medium",children:"Total Members"})}),Si.jsx(Lx,{children:Si.jsx("div",{className:"text-2xl font-bold",children:e.length})})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{className:"pb-3",children:Si.jsx(_x,{className:"text-sm font-medium",children:"Active Members"})}),Si.jsx(Lx,{children:Si.jsx("div",{className:"text-2xl font-bold",children:e.filter((e=>e.isActive)).length})})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{className:"pb-3",children:Si.jsx(_x,{className:"text-sm font-medium",children:"Administrators"})}),Si.jsx(Lx,{children:Si.jsx("div",{className:"text-2xl font-bold",children:e.filter((e=>"admin"===e.role)).length})})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{className:"pb-3",children:Si.jsx(_x,{className:"text-sm font-medium",children:"Engineers"})}),Si.jsx(Lx,{children:Si.jsx("div",{className:"text-2xl font-bold",children:e.filter((e=>"engineer"===e.role)).length})})]})]}),Si.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[Si.jsxs("div",{className:"relative flex-1",children:[Si.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),Si.jsx(kx,{placeholder:"Search team members...",value:i,onChange:e=>n(e.target.value),className:"pl-10"})]}),Si.jsx("div",{className:"flex gap-2",children:Si.jsxs("select",{className:"px-3 py-2 border rounded-md",value:r,onChange:e=>l(e.target.value),children:[Si.jsx("option",{value:"all",children:"All Roles"}),Si.jsx("option",{value:"admin",children:"Admin"}),Si.jsx("option",{value:"manager",children:"Manager"}),Si.jsx("option",{value:"engineer",children:"Engineer"}),Si.jsx("option",{value:"user",children:"User"})]})})]}),0===E.length?Si.jsxs("div",{className:"text-center py-12",children:[Si.jsx($r,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),Si.jsx("p",{className:"text-muted-foreground",children:"No team members found"})]}):Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map((e=>{var s,t,a,i;return Si.jsx(Ax,{className:"hover:shadow-md transition-shadow",children:Si.jsxs(Lx,{className:"p-6",children:[Si.jsxs("div",{className:"flex items-start justify-between mb-4",children:[Si.jsxs("div",{className:"flex items-center gap-3",children:[Si.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:Si.jsxs("span",{className:"text-lg font-semibold",children:[null==(s=e.firstName)?void 0:s[0],null==(t=e.lastName)?void 0:t[0]]})}),Si.jsxs("div",{children:[Si.jsxs("h3",{className:"font-semibold",children:[e.firstName," ",e.lastName]}),Si.jsxs("p",{className:"text-sm text-muted-foreground",children:["@",e.username]})]})]}),(i=e.isActive,Si.jsx(Sx,{variant:i?"default":"secondary",children:i?"Active":"Inactive"}))]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx(Gr,{className:"h-4 w-4 text-muted-foreground"}),(a=e.role,Si.jsx(Sx,{className:{admin:"bg-red-100 text-red-800",manager:"bg-blue-100 text-blue-800",engineer:"bg-green-100 text-green-800",user:"bg-gray-100 text-gray-800"}[a]||"bg-gray-100 text-gray-800",children:a}))]}),Si.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[Si.jsx(lc,{className:"h-4 w-4 text-muted-foreground"}),Si.jsx("a",{href:`mailto:${e.email}`,className:"hover:underline",children:e.email})]}),e.phone&&Si.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[Si.jsx(cc,{className:"h-4 w-4 text-muted-foreground"}),Si.jsx("a",{href:`tel:${e.phone}`,className:"hover:underline",children:e.phone})]})]}),Si.jsxs("div",{className:"flex gap-2 mt-4 pt-4 border-t",children:[Si.jsxs(Ex,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>(e=>{const s=v.find((s=>s.id.toString()===e));s&&(T.reset({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email,role:s.role,username:s.username,password:""}),p(e),u(!0))})(e.id.toString()),children:[Si.jsx(tl,{className:"h-4 w-4 mr-1"}),"Edit"]}),Si.jsx(Ex,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>window.location.href=`/clients?assignedTo=${e.id}`,children:"View Clients"})]})]})},e.id)}))})]})]})}),Si.jsx($p,{value:"assignments",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Qr,{className:"h-5 w-5 mr-2"}),"Client Assignments"]}),Si.jsxs(Ex,{onClick:()=>{h(!0)},children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"New Assignment"]})]})}),Si.jsx(Lx,{children:Si.jsx("div",{className:"border rounded-lg",children:Si.jsxs(Wj,{children:[Si.jsx(Hj,{children:Si.jsxs(Jj,{children:[Si.jsx(Xj,{children:"Team Member"}),Si.jsx(Xj,{children:"Client"}),Si.jsx(Xj,{children:"Role"}),Si.jsx(Xj,{children:"Assigned Date"}),Si.jsx(Xj,{className:"text-right",children:"Actions"})]})}),Si.jsx(Yj,{children:w?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:5,className:"text-center py-8",children:"Loading assignments..."})}):0===(N||[]).length?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:5,className:"text-center py-8",children:Si.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[Si.jsx(Qr,{className:"h-8 w-8 text-gray-400"}),Si.jsx("p",{className:"text-gray-500",children:"No assignments found"}),Si.jsx("p",{className:"text-sm text-gray-400",children:"Create your first team assignment to get started"})]})})}):(N||[]).map((e=>{var s,t;const a=(v||[]).find((s=>s.id===e.userId));return Si.jsxs(Jj,{children:[Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:Si.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[(null==(s=null==a?void 0:a.firstName)?void 0:s.charAt(0))||"",(null==(t=null==a?void 0:a.lastName)?void 0:t.charAt(0))||""]})}),Si.jsxs("div",{children:[Si.jsxs("p",{className:"font-medium",children:[(null==a?void 0:a.firstName)||""," ",(null==a?void 0:a.lastName)||""]}),Si.jsx("p",{className:"text-sm text-gray-500",children:(null==a?void 0:a.email)||""})]})]})}),Si.jsx(Zj,{children:Si.jsx("p",{className:"font-medium",children:getClientName(e.clientId)})}),Si.jsx(Zj,{children:Si.jsx(Sx,{variant:"outline",className:"capitalize",children:e.role})}),Si.jsx(Zj,{children:Si.jsx("span",{className:"text-sm text-gray-500",children:new Date(e.assignedDate).toLocaleDateString()})}),Si.jsx(Zj,{className:"text-right",children:Si.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(e=>{const s=N.find((s=>s.id.toString()===e));s&&(k.reset({userId:s.userId.toString(),clientId:s.clientId.toString(),role:s.role}),g(e),h(!0))})(e.id.toString()),children:"Edit"}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>(async e=>{if(confirm("Are you sure you want to remove this assignment?"))try{if(!(await fetch(`/api/team-assignments/${e}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Delete assignment failed");C(),j({title:"Assignment Removed",description:"Team assignment has been removed successfully."})}catch(s){j({title:"Error",description:"Failed to remove assignment. Please try again.",variant:"destructive"})}})(e.id.toString()),children:"Remove"})]})})]},e.id)}))})]})})})]})})]}),Si.jsx(Sp,{open:c,onOpenChange:o,children:Si.jsxs(Ep,{className:"sm:max-w-[425px]",children:[Si.jsxs(Ap,{children:[Si.jsx(_p,{children:"Add Team Member"}),Si.jsx(Fp,{children:"Add a new team member to your organization."})]}),Si.jsx($w,{...T,children:Si.jsxs("form",{onSubmit:T.handleSubmit((async e=>{try{if(!(await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)})).ok)throw new Error("Failed to add team member");j({title:"Success",description:"Team member added successfully!"}),o(!1),T.reset(),b()}catch(s){j({title:"Error",description:"Failed to add team member. Please try again.",variant:"destructive"})}})),className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:T.control,name:"firstName",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"First Name"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"John",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:T.control,name:"lastName",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Last Name"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"Doe",...e})}),Si.jsx(Jw,{})]})})]}),Si.jsx(Bw,{control:T.control,name:"email",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Email"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"john.doe@company.com",type:"email",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:T.control,name:"username",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Username"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"johndoe",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:T.control,name:"password",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Password"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"••••••••",type:"password",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:T.control,name:"role",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Role"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a role"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"user",children:"User"}),Si.jsx(Hp,{value:"engineer",children:"Engineer"}),Si.jsx(Hp,{value:"manager",children:"Manager"}),Si.jsx(Hp,{value:"admin",children:"Admin"})]})]}),Si.jsx(Jw,{})]})}),Si.jsxs(Pp,{children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:()=>o(!1),children:"Cancel"}),Si.jsx(Ex,{type:"submit",children:"Add Member"})]})]})})]})}),Si.jsx(Sp,{open:m,onOpenChange:h,children:Si.jsxs(Ep,{className:"sm:max-w-[425px]",children:[Si.jsxs(Ap,{children:[Si.jsx(_p,{children:f?"Edit Assignment":"New Assignment"}),Si.jsx(Fp,{children:f?"Update the team assignment details.":"Assign a team member to a client."})]}),Si.jsx($w,{...k,children:Si.jsxs("form",{onSubmit:k.handleSubmit((async e=>{try{if(!(await fetch("/api/team-assignments",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({...e,userId:parseInt(e.userId),clientId:parseInt(e.clientId),assignedDate:(new Date).toISOString()})})).ok)throw new Error("Failed to create assignment");j({title:"Success",description:"Assignment created successfully!"}),h(!1),k.reset(),C()}catch(s){j({title:"Error",description:"Failed to create assignment. Please try again.",variant:"destructive"})}})),className:"space-y-4",children:[Si.jsx(Bw,{control:k.control,name:"userId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Team Member"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a team member"})})}),Si.jsx(Wp,{children:v.map((e=>Si.jsxs(Hp,{value:e.id.toString(),children:[e.firstName," ",e.lastName," (",e.email,")"]},e.id)))})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:k.control,name:"clientId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Client"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a client"})})}),Si.jsx(Wp,{children:S.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:Ou(e)},e.id)))})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:k.control,name:"role",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Assignment Role"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"e.g., Primary Contact, Technical Lead",...e})}),Si.jsx(Jw,{})]})}),Si.jsxs(Pp,{children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:()=>{h(!1),g(null),k.reset()},children:"Cancel"}),Si.jsx(Ex,{type:"submit",children:f?"Update Assignment":"Create Assignment"})]})]})})]})})]})})}const _S=Wc({type:eo(["revenue","cost"]),amount:Vc().min(1,"Amount is required"),status:eo(["pending","completed","failed","cancelled"]),description:Vc().min(1,"Description is required"),clientId:Uc().optional(),transactionDate:Vc().min(1,"Transaction date is required")});function FS(){const[e,s]=$n.useState([]),[t,a]=$n.useState(!0),[i,n]=$n.useState(""),[r,l]=$n.useState("all"),[c,o]=$n.useState("all"),[d,u]=$n.useState(!1),m=dh(),{toast:h}=sd(),{format:x,getSymbol:p}=Vh(),{data:f=[],isLoading:g}=fh({queryKey:["/api/financial-transactions"]}),{data:j=[]}=fh({queryKey:["/api/clients"]}),v=Zc({resolver:bv(_S),defaultValues:{type:"revenue",amount:"",description:"",clientId:void 0,status:"pending",transactionDate:""}}),y=gh({mutationFn:async e=>{const s={type:e.type,amount:parseFloat(e.amount).toString(),description:e.description,clientId:e.clientId,status:e.status,transactionDate:new Date(e.transactionDate)};return(await vh("POST","/api/financial-transactions",s)).json()},onSuccess:()=>{m.invalidateQueries({queryKey:["/api/financial-transactions"]}),u(!1),v.reset(),h({title:"Success",description:"Financial transaction created successfully"})},onError:()=>{h({title:"Error",description:"Failed to create financial transaction",variant:"destructive"})}});$n.useEffect((()=>{b()}),[]);const b=async()=>{try{const e=await fetch("/api/financial-transactions",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch transactions");const t=await e.json();s(t)}catch(e){h({title:"Error",description:"Failed to load financial transactions",variant:"destructive"})}finally{a(!1)}},N=e.filter((e=>{var s,t,a;const n=(null==(s=e.description)?void 0:s.toLowerCase().includes(i.toLowerCase()))||(null==(t=e.clientName)?void 0:t.toLowerCase().includes(i.toLowerCase()))||(null==(a=e.referenceNumber)?void 0:a.toLowerCase().includes(i.toLowerCase())),l="all"===r||e.type===r,o="all"===c||e.status===c;return n&&l&&o})),w=e=>{switch(e){case"invoice":return Si.jsx(Kr,{className:"h-4 w-4"});case"payment":return Si.jsx(dc,{className:"h-4 w-4"});case"credit":return Si.jsx(yl,{className:"h-4 w-4 text-green-500"});case"debit":return Si.jsx(bl,{className:"h-4 w-4 text-red-500"});default:return Si.jsx(Ur,{className:"h-4 w-4"})}},C=(()=>{const s={revenue:0,pending:0,invoiced:0};return e.forEach((e=>{const t=parseFloat(e.amount);"payment"===e.type&&"completed"===e.status?s.revenue+=t:"pending"===e.status&&(s.pending+=t),"invoice"===e.type&&(s.invoiced+=t)})),s})(),S=p();return t?Si.jsx("div",{className:"flex items-center justify-center h-64",children:Si.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Si.jsx(vf,{title:"Financial Management",subtitle:"Track revenue, costs, and financial reporting",children:Si.jsx("main",{className:"flex-1 overflow-auto p-6 pt-16 md:pt-6",children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[Si.jsx(Ax,{children:Si.jsx(Lx,{className:"p-6",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Revenue"}),Si.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:x(C.revenue)})]}),Si.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:Si.jsx(yl,{className:"h-6 w-6 text-green-600"})})]})})}),Si.jsx(Ax,{children:Si.jsx(Lx,{className:"p-6",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Costs"}),Si.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:x(C.invoiced-C.revenue)})]}),Si.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:Si.jsx(bl,{className:"h-6 w-6 text-red-600"})})]})})}),Si.jsx(Ax,{children:Si.jsx(Lx,{className:"p-6",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Amount"}),Si.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:x(C.pending)})]}),Si.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:Si.jsx(oc,{className:"h-6 w-6 text-yellow-600"})})]})})}),Si.jsx(Ax,{children:Si.jsx(Lx,{className:"p-6",children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Net Profit"}),Si.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:x(C.revenue-(C.invoiced-C.revenue))})]}),Si.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:Si.jsx(Ur,{className:"h-6 w-6 text-blue-600"})})]})})})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx(_x,{children:"Transactions"}),Si.jsxs(Sp,{open:d,onOpenChange:u,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Transaction"]})}),Si.jsxs(Ep,{className:"max-w-md max-h-[85vh] overflow-hidden",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Create Financial Transaction"})}),Si.jsx($w,{...v,children:Si.jsxs("form",{onSubmit:v.handleSubmit((e=>{y.mutate(e)})),className:"flex flex-col h-full",children:[Si.jsx(Lp,{children:Si.jsxs("div",{className:"space-y-4",children:[Si.jsx(Bw,{control:v.control,name:"type",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Transaction Type"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select type"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"revenue",children:"Revenue"}),Si.jsx(Hp,{value:"cost",children:"Cost"})]})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:v.control,name:"clientId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Client (Optional)"}),Si.jsxs(zp,{onValueChange:s=>e.onChange(s?parseInt(s):void 0),children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select client"})})}),Si.jsx(Wp,{children:j.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:Ou(e)},e.id)))})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:v.control,name:"amount",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsxs(Ww,{children:["Amount (",S,")"]}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"0.00",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:v.control,name:"status",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Status"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select status"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"pending",children:"Pending"}),Si.jsx(Hp,{value:"completed",children:"Completed"}),Si.jsx(Hp,{value:"failed",children:"Failed"}),Si.jsx(Hp,{value:"cancelled",children:"Cancelled"})]})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:v.control,name:"transactionDate",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Transaction Date"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"date",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:v.control,name:"description",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Description"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Transaction description...",...e})}),Si.jsx(Jw,{})]})})]})}),Si.jsxs(Pp,{children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancel"}),Si.jsx(Ex,{type:"submit",disabled:y.isPending,children:y.isPending?"Creating...":"Create Transaction"})]})]})})]})]})]})}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"mb-6",children:Si.jsxs("div",{className:"relative",children:[Si.jsx(Xr,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),Si.jsx(kx,{placeholder:"Search transactions...",value:i,onChange:e=>n(e.target.value),className:"pl-10"})]})}),Si.jsx("div",{className:"border rounded-lg",children:Si.jsxs(Wj,{children:[Si.jsx(Hj,{children:Si.jsxs(Jj,{children:[Si.jsx(Xj,{children:"Transaction"}),Si.jsx(Xj,{children:"Client"}),Si.jsx(Xj,{children:"Type"}),Si.jsx(Xj,{children:"Amount"}),Si.jsx(Xj,{children:"Status"}),Si.jsx(Xj,{children:"Date"})]})}),Si.jsx(Yj,{children:g?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:6,className:"text-center py-8",children:"Loading transactions..."})}):0===N.length?Si.jsx(Jj,{children:Si.jsx(Zj,{colSpan:6,className:"text-center py-8",children:Si.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[Si.jsx(Ur,{className:"h-8 w-8 text-gray-400"}),Si.jsx("p",{className:"text-gray-500",children:"No transactions found"}),Si.jsx("p",{className:"text-sm text-gray-400",children:i?"Try adjusting your search":"Create your first transaction to get started"})]})})}):N.map((e=>{const s=(j||[]).find((s=>s.id===e.clientId));return Si.jsxs(Jj,{children:[Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:w(e.type)}),Si.jsx("div",{children:Si.jsx("p",{className:"font-medium",children:e.description||"Transaction"})})]})}),Si.jsx(Zj,{children:(null==s?void 0:s.name)||"N/A"}),Si.jsx(Zj,{className:"capitalize",children:e.type}),Si.jsx(Zj,{className:"font-mono",children:x(e.amount)}),Si.jsx(Zj,{children:(t=e.status,Si.jsx(Sx,{variant:{completed:"default",pending:"secondary",failed:"destructive",cancelled:"outline"}[t]||"default",children:t}))}),Si.jsx(Zj,{children:Ru(e.transactionDate)})]},e.id);var t}))})]})})]})]})]})})})}function LS(){const[e,s]=$n.useState(""),[t,a]=$n.useState("all"),[i,n]=$n.useState("all"),[r,l]=$n.useState(!1),[c,o]=$n.useState([]),[d,u]=$n.useState(!1),[m,h]=$n.useState(!1),x=$n.useRef(null),{toast:p}=sd(),[f,g]=$n.useState([]),[j,v]=$n.useState(!0),{data:y=[],isLoading:b}=fh({queryKey:["/api/documents"]}),{data:N=[]}=fh({queryKey:["/api/clients"]});$n.useEffect((()=>{w()}),[]);const w=async()=>{try{const e=await fetch("/api/documents",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch documents");const s=await e.json();g(s)}catch(e){p({title:"Error",description:"Failed to load documents",variant:"destructive"})}finally{v(!1)}},C=$n.useCallback((e=>{const s=Array.from(e),t=[];s.forEach((e=>{const s=(e=>["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain","text/csv","image/jpeg","image/png","image/gif","application/zip","application/x-zip-compressed"].includes(e.type)?e.size>10485760?{valid:!1,error:"File size must be less than 10MB"}:{valid:!0}:{valid:!1,error:"File type not supported. Please upload PDF, Word, Excel, PowerPoint, text, image, or ZIP files only."})(e);t.push({file:e,id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,progress:0,status:s.valid?"pending":"error",error:s.error,name:e.name,documentType:"general",clientId:void 0})})),o((e=>[...e,...t]))}),[]),S=$n.useCallback((e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?u(!0):"dragleave"===e.type&&u(!1)}),[]),T=$n.useCallback((e=>{e.preventDefault(),e.stopPropagation(),u(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&C(e.dataTransfer.files)}),[C]),k=(e,s)=>{o((t=>t.map((t=>t.id===e?{...t,...s}:t))))},D=e=>{switch(e){case"success":return Si.jsx(Dl,{className:"h-4 w-4 text-green-600"});case"error":return Si.jsx(vl,{className:"h-4 w-4 text-red-600"});case"uploading":return Si.jsx("div",{className:"h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"});default:return Si.jsx(Kr,{className:"h-4 w-4 text-gray-400"})}},E=f.filter((s=>{var a,n;const r=s.name.toLowerCase().includes(e.toLowerCase())||(null==(a=s.description)?void 0:a.toLowerCase().includes(e.toLowerCase())),l="all"===t||s.documentType===t,c="all"===i||(null==(n=s.clientId)?void 0:n.toString())===i;return r&&l&&c})),A=E.reduce(((e,s)=>{const t=s.documentType;return e[t]||(e[t]=[]),e[t].push(s),e}),{}),P=async e=>{try{const s=await fetch(`/api/documents/${e.id}/download`,{credentials:"include"});if(!s.ok)throw new Error("Failed to download document");const t=await s.blob(),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=e.name,i.click(),window.URL.revokeObjectURL(a)}catch(s){p({title:"Error",description:"Failed to download document",variant:"destructive"})}},_=async e=>{try{window.open(`/api/documents/${e.id}/preview`,"_blank")}catch(s){p({title:"Error",description:"Failed to preview document",variant:"destructive"})}},F=e=>["application/pdf","image/jpeg","image/png","image/gif","text/plain"].includes(e),L=async e=>{try{const s=`${window.location.origin}/documents/${e.id}/shared?token=${btoa(e.id.toString())}`;navigator.share?(await navigator.share({title:`Document: ${e.name}`,text:"Shared document from MSSP Client Manager",url:s}),p({title:"Document Shared",description:`"${e.name}" has been shared successfully.`})):(await navigator.clipboard.writeText(s),p({title:"Link Copied",description:`Shareable link for "${e.name}" has been copied to clipboard.`})),await fetch("/api/documents/share",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({documentId:e.id,shareMethod:navigator.share?"native":"clipboard",shareUrl:s})})}catch(s){try{const s=`${window.location.origin}/documents/${e.id}/shared?token=${btoa(e.id.toString())}`;await navigator.clipboard.writeText(s),p({title:"Link Copied",description:`Shareable link for "${e.name}" copied to clipboard.`})}catch(t){p({title:"Share Failed",description:"Unable to create shareable link. Please try downloading the document instead.",variant:"destructive"})}}},I=async e=>{if(confirm("Are you sure you want to delete this document?"))try{if(!(await fetch(`/api/documents/${e}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to delete document");p({title:"Success",description:"Document deleted successfully"}),w()}catch(s){p({title:"Error",description:"Failed to delete document",variant:"destructive"})}};return j?Si.jsx("div",{className:"flex items-center justify-center h-64",children:Si.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Si.jsx(vf,{title:"Document Management",subtitle:"Manage client documents, compliance files, and technical documentation",children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("div",{className:"flex-1"}),Si.jsxs(Sp,{open:r,onOpenChange:l,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{children:[Si.jsx(nl,{className:"mr-2 h-4 w-4"}),"Upload Documents"]})}),Si.jsxs(Ep,{className:"sm:max-w-[800px] max-h-[85vh] overflow-hidden",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Upload Documents"})}),Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"relative border-2 border-dashed rounded-lg p-8 text-center transition-colors "+(d?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragEnter:S,onDragLeave:S,onDragOver:S,onDrop:T,children:[Si.jsx(Lr,{className:"mx-auto h-12 w-12 "+(d?"text-blue-500":"text-gray-400")}),Si.jsxs("div",{className:"mt-4",children:[Si.jsx("p",{className:"text-lg font-medium text-gray-900",children:"Drop files here or click to browse"}),Si.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Supports PDF, Word, Excel, PowerPoint, text, images, and ZIP files (Max 10MB each)"})]}),Si.jsx("input",{ref:x,type:"file",multiple:!0,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",accept:".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.csv,.jpg,.jpeg,.png,.gif,.zip",onChange:e=>{e.target.files&&e.target.files.length>0&&C(e.target.files)}}),Si.jsx("div",{className:"mt-4",children:Si.jsx(Ex,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=x.current)?void 0:e.click()},children:"Select Files"})})]}),c.length>0&&Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("h3",{className:"text-lg font-medium",children:["Files to Upload (",c.length,")"]}),Si.jsxs("div",{className:"space-x-2",children:[Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>{o([])},disabled:m,children:"Clear All"}),Si.jsx(Ex,{onClick:async()=>{const e=c.filter((e=>"pending"===e.status));if(0===e.length)return void p({title:"No files to upload",description:"Please add some files first",variant:"destructive"});h(!0);let s=0,t=0;const a=e.map((async(e,a)=>{await new Promise((e=>setTimeout(e,100*a)));try{await(async e=>{try{k(e.id,{status:"uploading",progress:0});const s=new FormData;s.append("file",e.file),s.append("name",e.name),s.append("documentType",e.documentType),e.clientId&&s.append("clientId",e.clientId);const t=new XMLHttpRequest;return new Promise(((a,i)=>{t.upload.addEventListener("progress",(s=>{if(s.lengthComputable){const t=Math.round(s.loaded/s.total*100);k(e.id,{progress:t})}})),t.addEventListener("load",(()=>{if(200===t.status||201===t.status)k(e.id,{status:"success",progress:100}),a(!0);else{const s=t.responseText||"Upload failed";k(e.id,{status:"error",error:s}),i(new Error(s))}})),t.addEventListener("error",(()=>{k(e.id,{status:"error",error:"Network error during upload"}),i(new Error("Network error"))})),t.open("POST","/api/documents/upload"),t.setRequestHeader("credentials","include"),t.send(s)}))}catch(s){return k(e.id,{status:"error",error:s.message||"Upload failed"}),!1}})(e)?s++:t++}catch(i){t++}}));await Promise.all(a),h(!1),s>0&&(p({title:"Upload Complete",description:`${s} file(s) uploaded successfully${t>0?`, ${t} failed`:""}`}),Nh.invalidateQueries({queryKey:["/api/documents"]}),setTimeout((()=>{o((e=>e.filter((e=>"success"!==e.status))))}),2e3)),t>0&&0===s&&p({title:"Upload Failed",description:`${t} file(s) failed to upload`,variant:"destructive"})},disabled:m||c.every((e=>"pending"!==e.status)),children:m?"Uploading...":"Upload All"})]})]}),Si.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:c.map((e=>Si.jsxs("div",{className:"flex items-center space-x-3 p-3 border rounded-lg",children:[Si.jsx("div",{className:"flex-shrink-0",children:D(e.status)}),Si.jsxs("div",{className:"flex-1 min-w-0",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.name}),Si.jsx("p",{className:"text-xs text-gray-500",children:Iu(e.file.size)})]}),"uploading"===e.status&&Si.jsxs("div",{className:"mt-1",children:[Si.jsx(kS,{value:e.progress,className:"h-1"}),Si.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[e.progress,"% uploaded"]})]}),"error"===e.status&&Si.jsx("p",{className:"text-xs text-red-600 mt-1",children:e.error}),"success"===e.status&&Si.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Upload successful"}),"pending"===e.status&&Si.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2",children:[Si.jsxs(zp,{value:e.documentType,onValueChange:s=>k(e.id,{documentType:s}),children:[Si.jsx(Kp,{className:"h-8 text-xs",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"general",children:"General"}),Si.jsx(Hp,{value:"contract",children:"Contract"}),Si.jsx(Hp,{value:"compliance",children:"Compliance"}),Si.jsx(Hp,{value:"technical",children:"Technical"})]})]}),Si.jsxs(zp,{value:e.clientId||"",onValueChange:s=>k(e.id,{clientId:s||void 0}),children:[Si.jsx(Kp,{className:"h-8 text-xs",children:Si.jsx(Bp,{placeholder:"Client (optional)"})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"none",children:"No Client"}),N.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:Ou(e)},e.id)))]})]})]})]}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>{return s=e.id,void o((e=>e.filter((e=>e.id!==s))));var s},disabled:"uploading"===e.status,className:"flex-shrink-0",children:Si.jsx(Tr,{className:"h-4 w-4"})})]},e.id)))})]}),Si.jsx("div",{className:"flex justify-end space-x-2",children:Si.jsx(Ex,{type:"button",variant:"outline",onClick:()=>{l(!1),o([])},children:"Close"})})]})]})]})]}),Si.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[Si.jsxs("div",{className:"relative flex-1",children:[Si.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),Si.jsx(kx,{placeholder:"Search documents...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]}),Si.jsxs(zp,{value:t,onValueChange:a,children:[Si.jsx(Kp,{className:"sm:max-w-[180px]",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Types"}),Si.jsx(Hp,{value:"contract",children:"Contracts"}),Si.jsx(Hp,{value:"compliance",children:"Compliance"}),Si.jsx(Hp,{value:"technical",children:"Technical"}),Si.jsx(Hp,{value:"general",children:"General"})]})]}),Si.jsxs(zp,{value:i,onValueChange:n,children:[Si.jsx(Kp,{className:"sm:max-w-[180px]",children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Clients"}),(N||[]).map((e=>Si.jsx(Hp,{value:e.id.toString(),children:Ou(e)},e.id)))]})]})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Total Documents"}),Si.jsx(Kr,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsx(Lx,{children:Si.jsx("div",{className:"text-2xl font-bold",children:f.length})})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Total Size"}),Si.jsx(Kr,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsx(Lx,{children:Si.jsx("div",{className:"text-2xl font-bold",children:Iu(f.reduce(((e,s)=>e+s.fileSize),0))})})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Document Types"}),Si.jsx(Kr,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsx(Lx,{children:Si.jsx("div",{className:"text-2xl font-bold",children:new Set(f.map((e=>e.documentType))).size})})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Active Documents"}),Si.jsx(Kr,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsx(Lx,{children:Si.jsx("div",{className:"text-2xl font-bold",children:f.filter((e=>e.isActive)).length})})]})]}),Si.jsxs(Mp,{defaultValue:"all",className:"space-y-4",children:[Si.jsxs(Vp,{children:[Si.jsx(Up,{value:"all",children:"All Documents"}),Si.jsx(Up,{value:"contract",children:"Contracts"}),Si.jsx(Up,{value:"compliance",children:"Compliance"}),Si.jsx(Up,{value:"technical",children:"Technical"}),Si.jsx(Up,{value:"general",children:"General"})]}),Si.jsx($p,{value:"all",className:"space-y-4",children:0===E.length?Si.jsx(Ax,{children:Si.jsx(Lx,{className:"pt-6",children:Si.jsxs("div",{className:"text-center text-muted-foreground",children:[Si.jsx(Rr,{className:"mx-auto h-12 w-12 mb-4"}),Si.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No documents found"}),Si.jsx("p",{children:"Upload your first document to get started."})]})})}):Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map((e=>{return Si.jsxs(Ax,{className:"hover:shadow-lg transition-shadow",children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-start justify-between mb-4",children:[Si.jsxs("div",{className:"flex items-center gap-3",children:[Si.jsx("div",{className:"text-3xl",children:(s=e.mimeType,s.startsWith("image/")?"🖼️":"application/pdf"===s?"📄":s.includes("word")||s.includes("document")?"📝":s.includes("sheet")||s.includes("excel")||s.includes("presentation")||s.includes("powerpoint")?"📊":s.includes("zip")||s.includes("compressed")?"📦":s.startsWith("text/")?"📃":"📎")}),Si.jsxs("div",{className:"flex-1",children:[Si.jsx("h3",{className:"font-semibold truncate",children:e.name}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:Iu(e.fileSize)})]})]}),Si.jsx(Sx,{variant:e.isActive?"default":"secondary",children:e.documentType})]})}),Si.jsxs(Lx,{className:"space-y-3",children:[e.description&&Si.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.description}),Si.jsxs("div",{className:"space-y-1 text-sm",children:[e.entityName&&Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx("span",{className:"text-muted-foreground",children:"Related to:"}),Si.jsx("span",{children:e.entityName})]}),Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx("span",{className:"text-muted-foreground",children:"Uploaded:"}),Si.jsx("span",{children:Ru(e.createdAt)})]}),e.uploadedByName&&Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx("span",{className:"text-muted-foreground",children:"By:"}),Si.jsx("span",{children:e.uploadedByName})]})]}),Si.jsx(Cp,{}),Si.jsxs("div",{className:"flex justify-between gap-2",children:[Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>P(e),children:[Si.jsx(Rl,{className:"mr-1 h-3 w-3"}),"Download"]}),F(e.mimeType)&&Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>_(e),children:[Si.jsx(Sl,{className:"mr-1 h-3 w-3"}),"Preview"]}),Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>L(e),children:[Si.jsx(uc,{className:"mr-1 h-3 w-3"}),"Share"]}),Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>I(e.id),className:"text-destructive hover:text-destructive",children:Si.jsx(al,{className:"h-4 w-4"})})]})]})]},e.id);var s}))})}),Object.entries(A).map((([e,s])=>Si.jsx($p,{value:e,className:"space-y-4",children:Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map((e=>Si.jsxs(Ax,{className:"hover:shadow-lg transition-shadow",children:[Si.jsx(Px,{children:Si.jsx(_x,{className:"text-sm font-medium truncate",children:e.name})}),Si.jsxs(Lx,{className:"space-y-3",children:[e.description&&Si.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.description}),Si.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[Si.jsx(Kr,{className:"mr-1 h-3 w-3"}),e.fileName]}),Si.jsxs("div",{className:"flex items-center text-xs text-muted-foreground",children:[Si.jsx(Wr,{className:"mr-1 h-3 w-3"}),"Version ",e.version," • ",Iu(e.fileSize)]}),Si.jsx(Cp,{}),Si.jsxs("div",{className:"flex justify-between gap-2",children:[Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>P(e),children:[Si.jsx(Rl,{className:"mr-1 h-3 w-3"}),"Download"]}),F(e.mimeType)&&Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>_(e),children:[Si.jsx(Sl,{className:"mr-1 h-3 w-3"}),"Preview"]}),Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>L(e),children:[Si.jsx(uc,{className:"mr-1 h-3 w-3"}),"Share"]}),Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>I(e.id),className:"text-destructive hover:text-destructive",children:Si.jsx(al,{className:"h-4 w-4"})})]})]})]},e.id)))})},e)))]})]})})}const IS=Wc({currentPassword:Vc().min(1,"Current password is required"),newPassword:Vc().min(8,"Password must be at least 8 characters").regex(/[A-Z]/,"Password must contain at least one uppercase letter").regex(/[a-z]/,"Password must contain at least one lowercase letter").regex(/[0-9]/,"Password must contain at least one number").regex(/[^A-Za-z0-9]/,"Password must contain at least one special character"),confirmPassword:Vc().min(1,"Please confirm your password")}).refine((e=>e.newPassword===e.confirmPassword),{message:"Passwords do not match",path:["confirmPassword"]});function RS({children:e}){const{toast:s}=sd(),[t,a]=$n.useState(!1),[i,n]=$n.useState(!1),[r,l]=$n.useState(!1),[c,o]=$n.useState(!1),d=Zc({resolver:bv(IS),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),u=d.watch("newPassword"),m=[{label:"At least 8 characters",check:u.length>=8},{label:"Contains uppercase letter",check:/[A-Z]/.test(u)},{label:"Contains lowercase letter",check:/[a-z]/.test(u)},{label:"Contains number",check:/[0-9]/.test(u)},{label:"Contains special character",check:/[^A-Za-z0-9]/.test(u)}],h=m.filter((e=>e.check)).length,x=gh({mutationFn:async e=>(await vh("PUT","/api/user/change-password",{currentPassword:e.currentPassword,newPassword:e.newPassword})).json(),onSuccess:()=>{s({title:"Password changed successfully",description:"Your password has been updated. You will receive a confirmation email."}),d.reset(),a(!1)},onError:e=>{s({title:"Password change failed",description:e.message,variant:"destructive"})}});return Si.jsxs(Sp,{open:t,onOpenChange:a,children:[Si.jsx(Tp,{asChild:!0,children:e}),Si.jsxs(Ep,{className:"sm:max-w-md max-h-[85vh] overflow-hidden",children:[Si.jsxs(Ap,{children:[Si.jsxs(_p,{className:"flex items-center",children:[Si.jsx(Ul,{className:"h-5 w-5 mr-2"}),"Change Password"]}),Si.jsx(Fp,{children:"Enter your current password and choose a new secure password."})]}),Si.jsx($w,{...d,children:Si.jsxs("form",{onSubmit:d.handleSubmit((e=>{x.mutate(e)})),className:"space-y-4",children:[Si.jsx(Bw,{control:d.control,name:"currentPassword",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Current Password"}),Si.jsx(Hw,{children:Si.jsxs("div",{className:"relative",children:[Si.jsx(kx,{...e,type:i?"text":"password",placeholder:"Enter current password",className:"pr-10"}),Si.jsx(Ex,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>n(!i),children:i?Si.jsx(tc,{className:"h-4 w-4"}):Si.jsx(Sl,{className:"h-4 w-4"})})]})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:d.control,name:"newPassword",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"New Password"}),Si.jsx(Hw,{children:Si.jsxs("div",{className:"relative",children:[Si.jsx(kx,{...e,type:r?"text":"password",placeholder:"Enter new password",className:"pr-10"}),Si.jsx(Ex,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>l(!r),children:r?Si.jsx(tc,{className:"h-4 w-4"}):Si.jsx(Sl,{className:"h-4 w-4"})})]})}),Si.jsx(Jw,{}),u&&Si.jsxs("div",{className:"mt-2 space-y-2",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("span",{className:"text-sm font-medium",children:"Password strength:"}),Si.jsxs("span",{className:"text-sm font-medium "+(h<2?"text-red-600":h<4?"text-yellow-600":"text-green-600"),children:[h<2&&"Weak",h>=2&&h<4&&"Medium",h>=4&&"Strong"]})]}),Si.jsx("div",{className:"space-y-1",children:m.map(((e,s)=>Si.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.check?Si.jsx(Jr,{className:"h-3 w-3 text-green-600"}):Si.jsx(Tr,{className:"h-3 w-3 text-gray-400"}),Si.jsx("span",{className:e.check?"text-green-600":"text-gray-500",children:e.label})]},s)))})]})]})}),Si.jsx(Bw,{control:d.control,name:"confirmPassword",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Confirm New Password"}),Si.jsx(Hw,{children:Si.jsxs("div",{className:"relative",children:[Si.jsx(kx,{...e,type:c?"text":"password",placeholder:"Confirm new password",className:"pr-10"}),Si.jsx(Ex,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>o(!c),children:c?Si.jsx(tc,{className:"h-4 w-4"}):Si.jsx(Sl,{className:"h-4 w-4"})})]})}),Si.jsx(Jw,{})]})}),Si.jsx(Nx,{children:Si.jsx(wx,{className:"text-sm",children:"Your password will be securely encrypted and you'll receive an email confirmation. Make sure to save your new password in a secure location."})}),Si.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:()=>{d.reset(),a(!1)},children:"Cancel"}),Si.jsx(Ex,{type:"submit",disabled:x.isPending||h<5,children:x.isPending?"Changing...":"Change Password"})]})]})})]})]})}function qS(){const{data:e,isLoading:s}=fh({queryKey:["/api/version"],queryFn:async()=>(await vh("GET","/api/version")).json()});if(s)return Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(kr,{className:"h-4 w-4 animate-spin"}),Si.jsx("span",{className:"text-sm text-muted-foreground",children:"Loading version information..."})]});if(!e)return Si.jsx("div",{className:"text-sm text-muted-foreground",children:"Version information unavailable"});return Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsxs("div",{className:"space-y-3",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("span",{className:"text-sm font-medium flex items-center",children:[Si.jsx(_l,{className:"h-4 w-4 mr-2 text-green-500"}),"Application Version"]}),Si.jsxs(Sx,{variant:"outline",children:["v",e.version]})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("span",{className:"text-sm font-medium flex items-center",children:[Si.jsx(ql,{className:"h-4 w-4 mr-2 text-blue-500"}),"Environment"]}),Si.jsx(Sx,{variant:(e=>{switch(e){case"production":return"default";case"development":default:return"secondary";case"testing":return"outline"}})(e.environment),children:e.environment})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("span",{className:"text-sm font-medium flex items-center",children:[Si.jsx(zr,{className:"h-4 w-4 mr-2 text-purple-500"}),"Node.js Version"]}),Si.jsx("span",{className:"text-sm text-muted-foreground",children:e.nodeVersion})]})]}),Si.jsxs("div",{className:"space-y-3",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("span",{className:"text-sm font-medium flex items-center",children:[Si.jsx(Wr,{className:"h-4 w-4 mr-2 text-orange-500"}),"Server Uptime"]}),Si.jsx("span",{className:"text-sm text-muted-foreground",children:(e=>{const s=Math.floor(e/86400),t=Math.floor(e%86400/3600),a=Math.floor(e%3600/60);return s>0?`${s}d ${t}h ${a}m`:t>0?`${t}h ${a}m`:`${a}m`})(e.uptime)})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("span",{className:"text-sm font-medium flex items-center",children:[Si.jsx(kl,{className:"h-4 w-4 mr-2 text-cyan-500"}),"Application Name"]}),Si.jsx("span",{className:"text-sm text-muted-foreground",children:e.name})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm font-medium",children:"Last Updated"}),Si.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(e.timestamp).toLocaleString()})]})]})]})}function OS(){const{user:e}=Ah(),{theme:s,toggleTheme:t}=function(){const e=$n.useContext(Ph);if(void 0===e)throw new Error("useTheme must be used within a ThemeProvider");return e}(),{currency:a,setCurrency:i,getSupportedCurrencies:n}=Vh(),{toast:r}=sd(),l=$n.useRef(null),c=n(),[o,d]=$n.useState({firstName:(null==e?void 0:e.firstName)||"",lastName:(null==e?void 0:e.lastName)||"",email:(null==e?void 0:e.email)||"",username:(null==e?void 0:e.username)||""}),[u,m]=$n.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[h,x]=$n.useState(null),[p,f]=$n.useState(""),[g,j]=$n.useState("MSSP Platform"),[v,y]=$n.useState({ldapEnabled:!1,ldapUrl:"",ldapBindDn:"",ldapBindPassword:"",ldapSearchBase:"",ldapSearchFilter:"(uid={{username}})",ldapUsernameAttribute:"uid",ldapEmailAttribute:"mail",ldapFirstNameAttribute:"givenName",ldapLastNameAttribute:"sn",ldapDefaultRole:"user",ldapGroupSearchBase:"",ldapGroupSearchFilter:"",ldapAdminGroup:"",ldapManagerGroup:"",ldapEngineerGroup:"",ldapConnectionTimeout:5e3,ldapSearchTimeout:1e4,ldapCertificateVerification:!0}),{data:b,isLoading:N}=fh({queryKey:["/api/user/settings"],enabled:!!e}),{data:w,refetch:C}=fh({queryKey:["/api/company/settings"],queryFn:async()=>(await vh("GET","/api/company/settings")).json()}),[S,T]=$n.useState({});$n.useEffect((()=>{b&&T(b)}),[b]),$n.useEffect((()=>{w&&(j(w.companyName||"MSSP Platform"),w.logoUrl&&f(w.logoUrl),y({ldapEnabled:w.ldapEnabled||!1,ldapUrl:w.ldapUrl||"",ldapBindDn:w.ldapBindDn||"",ldapBindPassword:w.ldapBindPassword||"",ldapSearchBase:w.ldapSearchBase||"",ldapSearchFilter:w.ldapSearchFilter||"(uid={{username}})",ldapUsernameAttribute:w.ldapUsernameAttribute||"uid",ldapEmailAttribute:w.ldapEmailAttribute||"mail",ldapFirstNameAttribute:w.ldapFirstNameAttribute||"givenName",ldapLastNameAttribute:w.ldapLastNameAttribute||"sn",ldapDefaultRole:w.ldapDefaultRole||"user",ldapGroupSearchBase:w.ldapGroupSearchBase||"",ldapGroupSearchFilter:w.ldapGroupSearchFilter||"",ldapAdminGroup:w.ldapAdminGroup||"",ldapManagerGroup:w.ldapManagerGroup||"",ldapEngineerGroup:w.ldapEngineerGroup||"",ldapConnectionTimeout:w.ldapConnectionTimeout||5e3,ldapSearchTimeout:w.ldapSearchTimeout||1e4,ldapCertificateVerification:!1!==w.ldapCertificateVerification}))}),[w]);const k=gh({mutationFn:async e=>{const s=await vh("PUT","/api/user/settings",e);return await s.json()},onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/user/settings"]}),r({title:"Settings Updated",description:"Your preferences have been saved successfully."})},onError:e=>{r({title:"Update Failed",description:e.message,variant:"destructive"})}}),D=gh({mutationFn:async e=>{const s=await fetch("/api/company/settings",{method:"PUT",body:e,credentials:"include"}),t=await s.json();if(!s.ok)throw new Error(t.message||"Failed to update company settings");return t},onSuccess:e=>{var s,t;C(),r({title:"Company Settings Updated",description:"Logo and company name have been updated successfully."}),x(null),l.current&&(l.current.value=""),(null==(s=e.settings)?void 0:s.companyName)&&j(e.settings.companyName),(null==(t=e.settings)?void 0:t.logoUrl)&&f(e.settings.logoUrl)},onError:e=>{r({title:"Update Failed",description:e.message,variant:"destructive"})}}),E=gh({mutationFn:async e=>{const s=await vh("PUT","/api/company/settings",e);return await s.json()},onSuccess:()=>{Nh.invalidateQueries({queryKey:["/api/company/settings"]}),r({title:"LDAP Settings Updated",description:"LDAP configuration has been saved successfully."})},onError:e=>{r({title:"LDAP Update Failed",description:e.message,variant:"destructive"})}}),A=gh({mutationFn:async e=>{const s=await vh("POST","/api/company/settings/ldap/test",e);return await s.json()},onSuccess:e=>{r({title:e.success?"LDAP Test Successful":"LDAP Test Failed",description:e.message,variant:e.success?"default":"destructive"})},onError:e=>{r({title:"LDAP Test Failed",description:e.message,variant:"destructive"})}}),P=(e,s)=>{if(e in v){const t={...v,[e]:s};y(t),E.mutate(t)}else{const t={...S,[e]:s};T(t),k.mutate(t)}},_=(e,s)=>{if(e in v){const t={...v,[e]:["ldapConnectionTimeout","ldapSearchTimeout"].includes(e)?parseInt(s)||0:s};y(t)}else{const t={...S,[e]:s};T(t),k.mutate(t)}};return N?Si.jsx(vf,{title:"Settings",subtitle:"Loading your preferences...",children:Si.jsx("main",{className:"flex-1 overflow-auto p-6 pt-16 md:pt-6",children:Si.jsx("div",{className:"flex items-center justify-center min-h-screen",children:Si.jsx(kr,{className:"h-8 w-8 animate-spin text-border"})})})}):Si.jsx(vf,{title:"Settings",subtitle:"Manage your account and application preferences",children:Si.jsx("main",{className:"flex-1 overflow-auto p-6 pt-16 md:pt-6",children:Si.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(xl,{className:"h-5 w-5 mr-2"}),"Profile Information"]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"firstName",children:"First Name"}),Si.jsx(kx,{id:"firstName",defaultValue:(null==e?void 0:e.firstName)||""})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"lastName",children:"Last Name"}),Si.jsx(kx,{id:"lastName",defaultValue:(null==e?void 0:e.lastName)||""})]})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"email",children:"Email Address"}),Si.jsx(kx,{id:"email",type:"email",defaultValue:(null==e?void 0:e.email)||""})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"username",children:"Username"}),Si.jsx(kx,{id:"username",defaultValue:(null==e?void 0:e.username)||""})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{variant:(null==e?void 0:e.isActive)?"default":"secondary",children:(null==e?void 0:e.isActive)?"Active":"Inactive"}),Si.jsx(Sx,{variant:"outline",children:null==e?void 0:e.role})]}),Si.jsxs(Ex,{className:"w-fit",onClick:()=>{var e,s,t,a;const i={firstName:(null==(e=document.getElementById("firstName"))?void 0:e.value)||"",lastName:(null==(s=document.getElementById("lastName"))?void 0:s.value)||"",email:(null==(t=document.getElementById("email"))?void 0:t.value)||"",username:(null==(a=document.getElementById("username"))?void 0:a.value)||""};i.email&&i.firstName&&i.lastName?k.mutate(i,{onSuccess:()=>{r({title:"Profile Updated",description:"Your profile changes have been saved successfully."})},onError:e=>{r({title:"Update Failed",description:e instanceof Error?e.message:"Failed to update profile",variant:"destructive"})}}):r({title:"Validation Error",description:"Please fill in all required fields",variant:"destructive"})},children:[Si.jsx(Zr,{className:"h-4 w-4 mr-2"}),"Save Profile Changes"]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(mc,{className:"h-5 w-5 mr-2"}),"Company Branding"]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"companyName",children:"Company Name"}),Si.jsx(kx,{id:"companyName",value:g,onChange:e=>j(e.target.value),placeholder:"Enter your company name"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"This name will appear in the sidebar header"})]}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsx(Op,{children:"Company Logo"}),Si.jsxs("div",{className:"flex items-start space-x-4",children:[Si.jsx("div",{className:"flex-shrink-0",children:Si.jsx("div",{className:"w-24 h-24 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center overflow-hidden bg-gray-50",children:p?Si.jsx("img",{src:p,alt:"Logo preview",className:"max-w-full max-h-full object-contain"}):Si.jsxs("div",{className:"text-center",children:[Si.jsx(mc,{className:"h-8 w-8 mx-auto text-gray-400"}),Si.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"No logo"})]})})}),Si.jsxs("div",{className:"flex-1 space-y-3",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx("input",{ref:l,type:"file",accept:"image/*",onChange:e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t){if(!t.type.startsWith("image/"))return void r({title:"Invalid File Type",description:"Please select a valid image file (PNG, JPG, SVG, etc.)",variant:"destructive"});if(t.size>2097152)return void r({title:"File Too Large",description:"Please select an image smaller than 2MB",variant:"destructive"});x(t);const e=new FileReader;e.onload=e=>{var s;f(null==(s=e.target)?void 0:s.result)},e.readAsDataURL(t)}},className:"hidden"}),Si.jsxs(Ex,{variant:"outline",onClick:()=>{var e;return null==(e=l.current)?void 0:e.click()},disabled:D.isPending,children:[Si.jsx(Lr,{className:"h-4 w-4 mr-2"}),"Select Logo"]}),p&&Si.jsx(Ex,{variant:"outline",size:"sm",onClick:()=>{x(null),f(""),l.current&&(l.current.value="")},disabled:D.isPending,children:Si.jsx(Tr,{className:"h-4 w-4"})})]}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload a PNG, JPG, or SVG file (max 2MB). The logo will appear in the top-left corner of the sidebar."}),h&&Si.jsxs("p",{className:"text-sm text-green-600",children:["Selected: ",h.name," (",(h.size/1024).toFixed(1)," KB)"]})]})]}),Si.jsxs(Ex,{onClick:()=>{if(!h&&!g)return void r({title:"No Changes",description:"Please select a logo or enter a company name",variant:"destructive"});const e=new FormData;h&&e.append("logo",h),e.append("companyName",g),D.mutate(e)},disabled:D.isPending,className:"w-fit",children:[D.isPending?Si.jsx(kr,{className:"h-4 w-4 mr-2 animate-spin"}):Si.jsx(Zr,{className:"h-4 w-4 mr-2"}),"Save Branding Changes"]})]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Gr,{className:"h-5 w-5 mr-2"}),"Security & Authentication"]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsx(Op,{className:"text-base",children:"Session Timeout"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically log out after 24 hours of inactivity"})]}),Si.jsx(df,{checked:S.sessionTimeout||!1,onCheckedChange:e=>P("sessionTimeout",e)})]}),Si.jsx(Cp,{}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsx("h4",{className:"text-sm font-medium",children:"Password Management"}),Si.jsx(RS,{children:Si.jsxs(Ex,{variant:"outline",className:"w-fit",children:[Si.jsx(Ul,{className:"h-4 w-4 mr-2"}),"Change Password"]})})]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(zr,{className:"h-5 w-5 mr-2"}),"LDAP Configuration"]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsx(Op,{className:"text-base",children:"LDAP Enabled"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Enable LDAP authentication"})]}),Si.jsx(df,{checked:v.ldapEnabled,onCheckedChange:e=>P("ldapEnabled",e)})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapUrl",children:"LDAP URL"}),Si.jsx(kx,{id:"ldapUrl",value:v.ldapUrl,onChange:e=>_("ldapUrl",e.target.value),placeholder:"Enter LDAP server URL"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapBindDn",children:"LDAP Bind DN"}),Si.jsx(kx,{id:"ldapBindDn",value:v.ldapBindDn,onChange:e=>_("ldapBindDn",e.target.value),placeholder:"Enter LDAP bind DN"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapBindPassword",children:"LDAP Bind Password"}),Si.jsx(kx,{id:"ldapBindPassword",value:v.ldapBindPassword,onChange:e=>_("ldapBindPassword",e.target.value),placeholder:"Enter LDAP bind password"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapSearchBase",children:"LDAP Search Base"}),Si.jsx(kx,{id:"ldapSearchBase",value:v.ldapSearchBase,onChange:e=>_("ldapSearchBase",e.target.value),placeholder:"Enter LDAP search base"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapSearchFilter",children:"LDAP Search Filter"}),Si.jsx(kx,{id:"ldapSearchFilter",value:v.ldapSearchFilter,onChange:e=>_("ldapSearchFilter",e.target.value),placeholder:"Enter LDAP search filter"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapUsernameAttribute",children:"LDAP Username Attribute"}),Si.jsx(kx,{id:"ldapUsernameAttribute",value:v.ldapUsernameAttribute,onChange:e=>_("ldapUsernameAttribute",e.target.value),placeholder:"Enter LDAP username attribute"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapEmailAttribute",children:"LDAP Email Attribute"}),Si.jsx(kx,{id:"ldapEmailAttribute",value:v.ldapEmailAttribute,onChange:e=>_("ldapEmailAttribute",e.target.value),placeholder:"Enter LDAP email attribute"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapFirstNameAttribute",children:"LDAP First Name Attribute"}),Si.jsx(kx,{id:"ldapFirstNameAttribute",value:v.ldapFirstNameAttribute,onChange:e=>_("ldapFirstNameAttribute",e.target.value),placeholder:"Enter LDAP first name attribute"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapLastNameAttribute",children:"LDAP Last Name Attribute"}),Si.jsx(kx,{id:"ldapLastNameAttribute",value:v.ldapLastNameAttribute,onChange:e=>_("ldapLastNameAttribute",e.target.value),placeholder:"Enter LDAP last name attribute"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapDefaultRole",children:"LDAP Default Role"}),Si.jsx(kx,{id:"ldapDefaultRole",value:v.ldapDefaultRole,onChange:e=>_("ldapDefaultRole",e.target.value),placeholder:"Enter LDAP default role"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapGroupSearchBase",children:"LDAP Group Search Base"}),Si.jsx(kx,{id:"ldapGroupSearchBase",value:v.ldapGroupSearchBase,onChange:e=>_("ldapGroupSearchBase",e.target.value),placeholder:"Enter LDAP group search base"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapGroupSearchFilter",children:"LDAP Group Search Filter"}),Si.jsx(kx,{id:"ldapGroupSearchFilter",value:v.ldapGroupSearchFilter,onChange:e=>_("ldapGroupSearchFilter",e.target.value),placeholder:"Enter LDAP group search filter"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapAdminGroup",children:"LDAP Admin Group"}),Si.jsx(kx,{id:"ldapAdminGroup",value:v.ldapAdminGroup,onChange:e=>_("ldapAdminGroup",e.target.value),placeholder:"Enter LDAP admin group"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapManagerGroup",children:"LDAP Manager Group"}),Si.jsx(kx,{id:"ldapManagerGroup",value:v.ldapManagerGroup,onChange:e=>_("ldapManagerGroup",e.target.value),placeholder:"Enter LDAP manager group"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapEngineerGroup",children:"LDAP Engineer Group"}),Si.jsx(kx,{id:"ldapEngineerGroup",value:v.ldapEngineerGroup,onChange:e=>_("ldapEngineerGroup",e.target.value),placeholder:"Enter LDAP engineer group"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapConnectionTimeout",children:"LDAP Connection Timeout"}),Si.jsx(kx,{id:"ldapConnectionTimeout",value:v.ldapConnectionTimeout.toString(),onChange:e=>_("ldapConnectionTimeout",e.target.value),placeholder:"Enter LDAP connection timeout in milliseconds"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapSearchTimeout",children:"LDAP Search Timeout"}),Si.jsx(kx,{id:"ldapSearchTimeout",value:v.ldapSearchTimeout.toString(),onChange:e=>_("ldapSearchTimeout",e.target.value),placeholder:"Enter LDAP search timeout in milliseconds"})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"ldapCertificateVerification",children:"LDAP Certificate Verification"}),Si.jsx(df,{checked:v.ldapCertificateVerification,onCheckedChange:e=>P("ldapCertificateVerification",e)}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Verify SSL/TLS certificates when connecting to LDAP server"})]}),v.ldapEnabled&&Si.jsxs(Nx,{children:[Si.jsx(vl,{className:"h-4 w-4"}),Si.jsx(wx,{children:"LDAP authentication is enabled. Users will be able to log in using their LDAP credentials. Make sure to test the connection before enabling in production."})]}),Si.jsxs("div",{className:"flex items-center space-x-4 pt-4",children:[Si.jsxs(Ex,{onClick:()=>{E.mutate(v)},disabled:E.isPending,className:"w-fit",children:[E.isPending?Si.jsx(kr,{className:"h-4 w-4 mr-2 animate-spin"}):Si.jsx(Zr,{className:"h-4 w-4 mr-2"}),"Save LDAP Settings"]}),Si.jsxs(Ex,{variant:"outline",onClick:()=>{A.mutate({ldapUrl:v.ldapUrl,ldapBindDn:v.ldapBindDn,ldapBindPassword:v.ldapBindPassword,ldapSearchBase:v.ldapSearchBase})},disabled:A.isPending||!v.ldapUrl||!v.ldapSearchBase,className:"w-fit",children:[A.isPending?Si.jsx(kr,{className:"h-4 w-4 mr-2 animate-spin"}):Si.jsx(hc,{className:"h-4 w-4 mr-2"}),"Test Connection"]})]}),Si.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[Si.jsxs("p",{children:[Si.jsx("strong",{children:"Note:"})," LDAP settings require manager or admin privileges to modify."]}),Si.jsx("p",{children:"Changes to LDAP configuration will take effect after the next server restart."}),Si.jsx("p",{children:"Test the connection before enabling LDAP authentication to ensure proper configuration."})]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(xc,{className:"h-5 w-5 mr-2"}),"Notification Preferences"]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsxs(Op,{className:"text-base flex items-center",children:[Si.jsx(lc,{className:"h-4 w-4 mr-2"}),"Email Notifications"]}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive email updates about client activities and system alerts"})]}),Si.jsx(df,{checked:S.emailNotifications||!1,onCheckedChange:e=>P("emailNotifications",e)})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsxs(Op,{className:"text-base flex items-center",children:[Si.jsx(pc,{className:"h-4 w-4 mr-2"}),"Push Notifications"]}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Get real-time notifications for urgent matters"})]}),Si.jsx(df,{checked:S.pushNotifications||!1,onCheckedChange:e=>P("pushNotifications",e)})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsx(Op,{className:"text-base",children:"Contract Reminders"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Notifications about contract renewals and expirations"})]}),Si.jsx(df,{checked:S.contractReminders||!1,onCheckedChange:e=>P("contractReminders",e)})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsx(Op,{className:"text-base",children:"Financial Alerts"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Alerts for payment due dates and invoice updates"})]}),Si.jsx(df,{checked:S.financialAlerts||!1,onCheckedChange:e=>P("financialAlerts",e)})]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(ql,{className:"h-5 w-5 mr-2"}),"System Preferences"]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsx(Op,{className:"text-base",children:"Dark Mode"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Switch between light and dark theme"})]}),Si.jsx(df,{checked:"dark"===s,onCheckedChange:e=>{P("darkMode",e),t()}})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"timezone",children:"Timezone"}),Si.jsxs("select",{id:"timezone",className:"w-full p-2 border border-gray-300 rounded-md bg-background",value:S.timezone||"America/New_York",onChange:e=>_("timezone",e.target.value),children:[Si.jsx("option",{value:"America/New_York",children:"Eastern Time (ET)"}),Si.jsx("option",{value:"America/Chicago",children:"Central Time (CT)"}),Si.jsx("option",{value:"America/Denver",children:"Mountain Time (MT)"}),Si.jsx("option",{value:"America/Los_Angeles",children:"Pacific Time (PT)"}),Si.jsx("option",{value:"UTC",children:"UTC"})]})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"language",children:"Language"}),Si.jsxs("select",{id:"language",className:"w-full p-2 border border-gray-300 rounded-md bg-background",value:S.language||"en",onChange:e=>_("language",e.target.value),children:[Si.jsx("option",{value:"en",children:"English"}),Si.jsx("option",{value:"es",children:"Spanish"}),Si.jsx("option",{value:"fr",children:"French"}),Si.jsx("option",{value:"de",children:"German"})]})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsxs(Op,{htmlFor:"currency",className:"flex items-center",children:[Si.jsx(Ur,{className:"h-4 w-4 mr-2"}),"Currency"]}),Si.jsx("select",{id:"currency",className:"w-full p-2 border border-gray-300 rounded-md bg-background",value:a,onChange:e=>{return s=e.target.value,_("currency",s),void i(s);var s},children:c.map((e=>Si.jsxs("option",{value:e.code,children:[e.symbol," ",e.name," (",e.code,")"]},e.code)))}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Changes how monetary values are displayed throughout the application"})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsx(Op,{className:"text-base",children:"Auto-save Forms"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically save form data as you type"})]}),Si.jsx(df,{checked:S.autoSaveForms||!1,onCheckedChange:e=>P("autoSaveForms",e)})]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(kl,{className:"h-5 w-5 mr-2"}),"Data & Integrations"]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsx(Op,{className:"text-base",children:"Data Export"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow automatic data exports for compliance"})]}),Si.jsx(df,{checked:S.dataExport||!1,onCheckedChange:e=>P("dataExport",e)})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{className:"space-y-0.5",children:[Si.jsx(Op,{className:"text-base",children:"API Access"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:"Enable third-party integrations via API"})]}),Si.jsx(df,{checked:S.apiAccess||!1,onCheckedChange:e=>P("apiAccess",e)})]}),Si.jsxs("div",{className:"space-y-2",children:[Si.jsx(Op,{htmlFor:"dataRetention",children:"Data Retention Period"}),Si.jsxs("select",{id:"dataRetention",className:"w-full p-2 border border-gray-300 rounded-md bg-background",value:S.dataRetentionPeriod||"5years",onChange:e=>_("dataRetentionPeriod",e.target.value),children:[Si.jsx("option",{value:"1year",children:"1 Year"}),Si.jsx("option",{value:"3years",children:"3 Years"}),Si.jsx("option",{value:"5years",children:"5 Years"}),Si.jsx("option",{value:"7years",children:"7 Years"}),Si.jsx("option",{value:"forever",children:"Indefinite"})]})]}),Si.jsxs(Ex,{className:"w-fit",variant:"outline",children:[Si.jsx(kl,{className:"h-4 w-4 mr-2"}),"Backup Data"]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(zr,{className:"h-5 w-5 mr-2"}),"Application Information"]})}),Si.jsx(Lx,{className:"space-y-4",children:Si.jsx(qS,{})})]}),Si.jsxs("div",{className:"flex justify-end space-x-4",children:[Si.jsx(Ex,{variant:"outline",children:"Cancel Changes"}),Si.jsxs(Ex,{onClick:()=>{k.mutate(S)},children:[Si.jsx(Zr,{className:"h-4 w-4 mr-2"}),"Save All Settings"]})]})]})})})}function MS(){const{toast:e}=sd(),s=async()=>{e({title:"Export Started",description:"Security Reports are being generated..."});try{const s=await fetch("/api/reports/security-analysis",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({format:"xlsx",includeIncidents:!0,includeCompliance:!0})});if(!s.ok)throw new Error("Export failed");{const t=await s.blob(),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`security-reports-${(new Date).toISOString().split("T")[0]}.xlsx`,i.click(),window.URL.revokeObjectURL(a),e({title:"Export Complete",description:"Security Reports have been downloaded."})}}catch(s){e({title:"Export Failed",description:"Could not generate security reports.",variant:"destructive"})}},t=e=>{window.location.href=`/reports/${e}`};return Si.jsx(vf,{title:"Reports & Analytics",subtitle:"Generate comprehensive reports and analytics",children:Si.jsx("main",{className:"flex-1 overflow-auto p-6 pt-16 md:pt-6",children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Revenue"}),Si.jsx(Ur,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:"$45,231.89"}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:"+20.1% from last month"})]})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Clients"}),Si.jsx(Qr,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:"12"}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:"+2 new this month"})]})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Active Contracts"}),Si.jsx(yl,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:"8"}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:"+3 this quarter"})]})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Team Members"}),Si.jsx($r,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:"6"}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:"Full team capacity"})]})]})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(fc,{className:"h-5 w-5 mr-2"}),"Financial Reports"]})}),Si.jsxs(Lx,{className:"space-y-3",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm",children:"Revenue Analysis"}),Si.jsxs(Ex,{size:"sm",variant:"outline",onClick:async()=>{e({title:"Export Started",description:"Revenue Analysis report is being generated..."});try{const s=await fetch("/api/reports/revenue-analysis",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({format:"xlsx",dateRange:"last_12_months"})});if(!s.ok)throw new Error("Export failed");{const t=await s.blob(),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`revenue-analysis-${(new Date).toISOString().split("T")[0]}.xlsx`,i.click(),window.URL.revokeObjectURL(a),e({title:"Export Complete",description:"Revenue Analysis report has been downloaded."})}}catch(s){e({title:"Export Failed",description:"Could not generate revenue analysis report.",variant:"destructive"})}},children:[Si.jsx(Rl,{className:"h-4 w-4 mr-1"}),"Export"]})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm",children:"Invoice Summary"}),Si.jsxs(Ex,{size:"sm",variant:"outline",onClick:async()=>{e({title:"Export Started",description:"Invoice Summary report is being generated..."});try{const s=await fetch("/api/reports/invoice-summary",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({format:"xlsx",dateRange:"current_year"})});if(!s.ok)throw new Error("Export failed");{const t=await s.blob(),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`invoice-summary-${(new Date).toISOString().split("T")[0]}.xlsx`,i.click(),window.URL.revokeObjectURL(a),e({title:"Export Complete",description:"Invoice Summary report has been downloaded."})}}catch(s){e({title:"Export Failed",description:"Could not generate invoice summary report.",variant:"destructive"})}},children:[Si.jsx(Rl,{className:"h-4 w-4 mr-1"}),"Export"]})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm",children:"Payment History"}),Si.jsxs(Ex,{size:"sm",variant:"outline",onClick:async()=>{e({title:"Export Started",description:"Payment History report is being generated..."});try{const s=await fetch("/api/reports/payment-history",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({format:"xlsx",dateRange:"last_24_months"})});if(!s.ok)throw new Error("Export failed");{const t=await s.blob(),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`payment-history-${(new Date).toISOString().split("T")[0]}.xlsx`,i.click(),window.URL.revokeObjectURL(a),e({title:"Export Complete",description:"Payment History report has been downloaded."})}}catch(s){e({title:"Export Failed",description:"Could not generate payment history report.",variant:"destructive"})}},children:[Si.jsx(Rl,{className:"h-4 w-4 mr-1"}),"Export"]})]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Pl,{className:"h-5 w-5 mr-2"}),"Client Reports"]})}),Si.jsxs(Lx,{className:"space-y-3",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm",children:"Client Portfolio"}),Si.jsxs(Ex,{size:"sm",variant:"outline",onClick:async()=>{e({title:"Export Started",description:"Client Reports are being generated..."});try{const s=await fetch("/api/reports/client-analysis",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({format:"xlsx",includeContacts:!0,includeContracts:!0,includeServices:!0})});if(!s.ok)throw new Error("Export failed");{const t=await s.blob(),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`client-reports-${(new Date).toISOString().split("T")[0]}.xlsx`,i.click(),window.URL.revokeObjectURL(a),e({title:"Export Complete",description:"Client Reports have been downloaded."})}}catch(s){e({title:"Export Failed",description:"Could not generate client reports.",variant:"destructive"})}},children:[Si.jsx(Rl,{className:"h-4 w-4 mr-1"}),"Export"]})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm",children:"Service Utilization"}),Si.jsxs(Ex,{size:"sm",variant:"outline",onClick:async()=>{e({title:"Export Started",description:"Service Reports are being generated..."});try{const s=await fetch("/api/reports/service-analysis",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({format:"xlsx",includePerformance:!0,includeSLA:!0})});if(!s.ok)throw new Error("Export failed");{const t=await s.blob(),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`service-reports-${(new Date).toISOString().split("T")[0]}.xlsx`,i.click(),window.URL.revokeObjectURL(a),e({title:"Export Complete",description:"Service Reports have been downloaded."})}}catch(s){e({title:"Export Failed",description:"Could not generate service reports.",variant:"destructive"})}},children:[Si.jsx(Rl,{className:"h-4 w-4 mr-1"}),"Export"]})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm",children:"Contract Status"}),Si.jsxs(Ex,{size:"sm",variant:"outline",onClick:async()=>{e({title:"Export Started",description:"Contract Reports are being generated..."});try{const s=await fetch("/api/reports/contract-analysis",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({format:"xlsx",includeFinancials:!0,includeRenewals:!0})});if(!s.ok)throw new Error("Export failed");{const t=await s.blob(),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`contract-reports-${(new Date).toISOString().split("T")[0]}.xlsx`,i.click(),window.URL.revokeObjectURL(a),e({title:"Export Complete",description:"Contract Reports have been downloaded."})}}catch(s){e({title:"Export Failed",description:"Could not generate contract reports.",variant:"destructive"})}},children:[Si.jsx(Rl,{className:"h-4 w-4 mr-1"}),"Export"]})]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center",children:[Si.jsx(Al,{className:"h-5 w-5 mr-2"}),"Security Reports"]})}),Si.jsxs(Lx,{className:"space-y-3",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm",children:"Incident Summary"}),Si.jsxs(Ex,{size:"sm",variant:"outline",onClick:s,children:[Si.jsx(Rl,{className:"h-4 w-4 mr-1"}),"Export"]})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm",children:"Threat Analysis"}),Si.jsxs(Ex,{size:"sm",variant:"outline",onClick:s,children:[Si.jsx(Rl,{className:"h-4 w-4 mr-1"}),"Export"]})]}),Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("span",{className:"text-sm",children:"Compliance Report"}),Si.jsxs(Ex,{size:"sm",variant:"outline",onClick:async()=>{e({title:"Export Started",description:"Compliance Reports are being generated..."});try{const s=await fetch("/api/reports/compliance-analysis",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({format:"xlsx",includeAudits:!0,includeCertifications:!0})});if(!s.ok)throw new Error("Export failed");{const t=await s.blob(),a=window.URL.createObjectURL(t),i=document.createElement("a");i.href=a,i.download=`compliance-reports-${(new Date).toISOString().split("T")[0]}.xlsx`,i.click(),window.URL.revokeObjectURL(a),e({title:"Export Complete",description:"Compliance Reports have been downloaded."})}}catch(s){e({title:"Export Failed",description:"Could not generate compliance reports.",variant:"destructive"})}},children:[Si.jsx(Rl,{className:"h-4 w-4 mr-1"}),"Export"]})]})]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsx(_x,{children:"Recent Reports"})}),Si.jsx(Lx,{children:Si.jsxs("div",{className:"space-y-3",children:[Si.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx(jl,{className:"h-4 w-4 text-gray-500"}),Si.jsxs("div",{children:[Si.jsx("p",{className:"font-medium",children:"Monthly Financial Summary - December 2024"}),Si.jsx("p",{className:"text-sm text-gray-500",children:"Generated on Dec 31, 2024"})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{variant:"secondary",children:"Financial"}),Si.jsx(Ex,{size:"sm",variant:"ghost",onClick:()=>t("financial-q4-2024"),children:Si.jsx(Rl,{className:"h-4 w-4"})})]})]}),Si.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx(jl,{className:"h-4 w-4 text-gray-500"}),Si.jsxs("div",{children:[Si.jsx("p",{className:"font-medium",children:"Client Service Analysis - Q4 2024"}),Si.jsx("p",{className:"text-sm text-gray-500",children:"Generated on Dec 28, 2024"})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{variant:"secondary",children:"Client"}),Si.jsx(Ex,{size:"sm",variant:"ghost",onClick:()=>t("client-service-q4-2024"),children:Si.jsx(Rl,{className:"h-4 w-4"})})]})]}),Si.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx(jl,{className:"h-4 w-4 text-gray-500"}),Si.jsxs("div",{children:[Si.jsx("p",{className:"font-medium",children:"Security Incident Report - December"}),Si.jsx("p",{className:"text-sm text-gray-500",children:"Generated on Dec 25, 2024"})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{variant:"secondary",children:"Security"}),Si.jsx(Ex,{size:"sm",variant:"ghost",onClick:()=>t("security-incident-dec-2024"),children:Si.jsx(Rl,{className:"h-4 w-4"})})]})]})]})})]})]})})})}function VS(){var e;const{data:s=[],isLoading:t,error:a,refetch:i}=fh({queryKey:["plugins"],queryFn:async()=>{const e=await fetch("/api/plugins",{credentials:"include"});if(!e.ok){const s=await e.json();throw new Error(s.message||"Failed to fetch plugins")}return(await e.json()).plugins||[]}}),{data:n=[]}=fh({queryKey:["plugin-types"],queryFn:async()=>{const e=await fetch("/api/plugins/types",{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch plugin types");return(await e.json()).pluginTypes||[]}}),[r,l]=$n.useState(""),[c,o]=$n.useState(!1),[d,u]=$n.useState(null),[m,h]=$n.useState({}),[x,p]=$n.useState(null),{toast:f}=sd(),g=async()=>{i()},j=e=>{var t;const a=`${null==(t=s.find((s=>s.config.instances.includes(e))))?void 0:t.systemName}-${e.id}`,i=m[a];return(null==x?void 0:x.instance)===e.id?Si.jsx(kr,{className:"h-4 w-4 animate-spin text-blue-500"}):i?i.connected?Si.jsx(Dl,{className:"h-4 w-4 text-green-500"}):Si.jsx(vl,{className:"h-4 w-4 text-red-500"}):e.isActive?Si.jsx(ec,{className:"h-4 w-4 text-green-500"}):Si.jsx(sc,{className:"h-4 w-4 text-gray-400"})},v=({instance:e,pluginName:s})=>{var t,a,i,n,r,l,c,o;const[m,h]=$n.useState(e);return Si.jsx(Sp,{open:(null==d?void 0:d.id)===e.id,onOpenChange:()=>u(null),children:Si.jsxs(Ep,{className:"max-w-2xl",children:[Si.jsxs(Ap,{children:[Si.jsxs(_p,{children:["Configure ",e.name]}),Si.jsx(Fp,{children:"Update the configuration settings for this plugin instance."})]}),Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"name",children:"Instance Name"}),Si.jsx(kx,{id:"name",value:m.name,onChange:e=>h({...m,name:e.target.value})})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"baseUrl",children:"Base URL"}),Si.jsx(kx,{id:"baseUrl",value:m.baseUrl,onChange:e=>h({...m,baseUrl:e.target.value}),placeholder:"https://api.example.com"})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"authType",children:"Authentication Type"}),Si.jsxs("select",{id:"authType",value:m.authType,onChange:e=>h({...m,authType:e.target.value}),className:"w-full p-2 border rounded",children:[Si.jsx("option",{value:"none",children:"None"}),Si.jsx("option",{value:"basic",children:"Basic Auth"}),Si.jsx("option",{value:"bearer",children:"Bearer Token"}),Si.jsx("option",{value:"api_key",children:"API Key"})]})]}),"basic"===m.authType&&Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"username",children:"Username"}),Si.jsx(kx,{id:"username",value:(null==(t=m.authConfig)?void 0:t.username)||"",onChange:e=>h({...m,authConfig:{...m.authConfig,username:e.target.value}})})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"password",children:"Password"}),Si.jsx(kx,{id:"password",type:"password",value:(null==(a=m.authConfig)?void 0:a.password)||"",onChange:e=>h({...m,authConfig:{...m.authConfig,password:e.target.value}})})]})]}),"bearer"===m.authType&&Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"token",children:"Bearer Token"}),Si.jsx(kx,{id:"token",type:"password",value:(null==(i=m.authConfig)?void 0:i.token)||"",onChange:e=>h({...m,authConfig:{...m.authConfig,token:e.target.value}})})]}),"api_key"===m.authType&&Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"key",children:"API Key"}),Si.jsx(kx,{id:"key",type:"password",value:(null==(n=m.authConfig)?void 0:n.key)||"",onChange:e=>h({...m,authConfig:{...m.authConfig,key:e.target.value}})})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"header",children:"Header Name"}),Si.jsx(kx,{id:"header",value:(null==(r=m.authConfig)?void 0:r.header)||"Authorization",onChange:e=>h({...m,authConfig:{...m.authConfig,header:e.target.value}})})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"tags",children:"Tags (comma-separated)"}),Si.jsx(kx,{id:"tags",value:(null==(l=m.tags)?void 0:l.join(", "))||"",onChange:e=>h({...m,tags:e.target.value.split(",").map((e=>e.trim())).filter(Boolean)}),placeholder:"production, firewall, security"})]}),Si.jsxs("div",{className:"border-t pt-4",children:[Si.jsx("h3",{className:"text-lg font-medium mb-3",children:"SSL/TLS Configuration"}),Si.jsxs("div",{className:"space-y-3",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(df,{checked:!(null==(c=m.sslConfig)?void 0:c.rejectUnauthorized),onCheckedChange:e=>h({...m,sslConfig:{...m.sslConfig,rejectUnauthorized:!e,allowSelfSigned:e}})}),Si.jsx(Op,{children:"Allow Self-Signed Certificates"}),Si.jsx("span",{className:"text-sm text-gray-500",children:"(Disable SSL verification)"})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"edit-timeout",children:"Connection Timeout (ms)"}),Si.jsx(kx,{id:"edit-timeout",type:"number",value:(null==(o=m.sslConfig)?void 0:o.timeout)||3e4,onChange:e=>h({...m,sslConfig:{...m.sslConfig,timeout:parseInt(e.target.value)||3e4}}),placeholder:"30000",min:"1000",max:"300000"}),Si.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Timeout for HTTP requests (1-300 seconds)"})]})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(df,{checked:m.isActive,onCheckedChange:e=>h({...m,isActive:e})}),Si.jsx(Op,{children:"Active"})]}),Si.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2",children:[Si.jsx(Ex,{variant:"outline",onClick:()=>u(null),className:"w-full sm:w-auto",children:"Cancel"}),Si.jsxs(Ex,{onClick:()=>{(async(e,s,t)=>{try{const a=await fetch(`/api/plugins/instances/${e}/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),i=await a.json();if(!i.success)throw new Error(i.message);await g(),u(null),f({title:"Instance Updated",description:`${s} configuration has been updated.`})}catch(a){f({title:"Update Failed",description:a instanceof Error?a.message:"Failed to update instance configuration",variant:"destructive"})}})(s,e.id,m)},className:"w-full sm:w-auto",children:[Si.jsx(Zr,{className:"h-4 w-4 mr-2"}),"Save Configuration"]})]})]})]})})};if(t)return Si.jsx(vf,{title:"Plugin Management",children:Si.jsx("div",{className:"flex items-center justify-center h-64",children:Si.jsx(kr,{className:"w-8 h-8 animate-spin"})})});if(a)return Si.jsx(vf,{title:"Plugin Management",children:Si.jsx("div",{className:"flex items-center justify-center h-64",children:Si.jsxs("div",{className:"text-center",children:[Si.jsx(vl,{className:"w-8 h-8 mx-auto mb-2 text-red-500"}),Si.jsx("p",{className:"text-red-600",children:"Failed to load plugins"}),Si.jsx("p",{className:"text-sm text-gray-500",children:a instanceof Error?a.message:"Unknown error"})]})})});const y=s.reduce(((e,s)=>e+s.config.instances.length),0),b=s.reduce(((e,s)=>e+s.config.instances.filter((e=>e.isActive)).length),0);return Si.jsxs(vf,{title:"Plugin Management",children:[Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[Si.jsxs("div",{children:[Si.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Plugin Management"}),Si.jsx("p",{className:"text-gray-600 mt-1 text-sm md:text-base",children:"Manage external system connectors and test connections"})]}),Si.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[Si.jsxs(Sp,{open:c,onOpenChange:o,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{className:"w-full sm:w-auto",children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Instance"]})}),Si.jsxs(Ep,{className:"max-w-2xl",children:[Si.jsxs(Ap,{children:[Si.jsx(_p,{children:"Add New Plugin Instance"}),Si.jsx(Fp,{children:"Create a new instance of a plugin to connect to an external system."})]}),Si.jsx(US,{pluginTypes:n,selectedPluginType:r,setSelectedPluginType:l,onSubmit:async e=>{try{const s=await fetch(`/api/plugins/instances/${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await s.json();if(!t.success)throw new Error(t.message);await g(),o(!1),l(""),f({title:"Instance Created",description:t.message})}catch(s){f({title:"Creation Failed",description:s instanceof Error?s.message:"Failed to create instance",variant:"destructive"})}},onCancel:()=>{o(!1),l("")}})]})]}),Si.jsxs("div",{className:"flex gap-4 md:gap-6 text-sm",children:[Si.jsxs("div",{className:"text-center",children:[Si.jsx("div",{className:"text-xl md:text-2xl font-bold text-blue-600",children:s.length}),Si.jsx("div",{className:"text-gray-500 text-xs md:text-sm",children:"Plugins"})]}),Si.jsxs("div",{className:"text-center",children:[Si.jsx("div",{className:"text-xl md:text-2xl font-bold text-green-600",children:b}),Si.jsx("div",{className:"text-gray-500 text-xs md:text-sm",children:"Active"})]}),Si.jsxs("div",{className:"text-center",children:[Si.jsx("div",{className:"text-xl md:text-2xl font-bold text-gray-600",children:y}),Si.jsx("div",{className:"text-gray-500 text-xs md:text-sm",children:"Total"})]})]})]})]}),0===s.length?Si.jsx(Ax,{children:Si.jsxs(Lx,{className:"text-center py-12",children:[Si.jsx(Pr,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),Si.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Plugins Available"}),Si.jsx("p",{className:"text-gray-500",children:"No plugins are currently registered in the system."})]})}):Si.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4 md:gap-6",children:s.map((e=>Si.jsxs(Ax,{className:"overflow-hidden flex flex-col",children:[Si.jsx(Px,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 pb-4",children:Si.jsxs("div",{className:"flex items-start justify-between gap-3",children:[Si.jsxs("div",{className:"min-w-0 flex-1",children:[Si.jsx(_x,{className:"text-lg md:text-xl truncate",children:e.systemName}),Si.jsxs("p",{className:"text-gray-600 mt-1 text-sm",children:[e.config.instances.length," instance",1!==e.config.instances.length?"s":""," configured"]})]}),Si.jsx(Sx,{variant:"outline",className:"bg-white shrink-0 text-xs",children:e.systemName})]})}),Si.jsx(Lx,{className:"p-4 md:p-6 flex-1",children:Si.jsx("div",{className:"space-y-3 md:space-y-4",children:e.config.instances.map((s=>{var t;return Si.jsx("div",{className:"border rounded-lg p-3 md:p-4 bg-gray-50",children:Si.jsxs("div",{className:"space-y-3",children:[Si.jsxs("div",{className:"flex items-start space-x-3",children:[j(s),Si.jsxs("div",{className:"min-w-0 flex-1",children:[Si.jsx("h4",{className:"font-medium truncate",children:s.name}),Si.jsx("p",{className:"text-sm text-gray-600 truncate",children:s.baseUrl}),Si.jsxs("div",{className:"flex flex-wrap items-center gap-1 mt-1",children:[Si.jsx(Sx,{variant:"outline",className:"text-xs",children:s.authType}),null==(t=s.tags)?void 0:t.map((e=>Si.jsx(Sx,{variant:"secondary",className:"text-xs",children:e},e)))]})]})]}),Si.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[Si.jsxs("div",{className:"flex gap-2 flex-1",children:[Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>(async(e,s)=>{p({plugin:e,instance:s});try{const t=await fetch(`/api/plugins/instances/${e}/${s}/test`,{method:"POST",headers:{"Content-Type":"application/json"}}),a=await t.json();h((t=>({...t,[`${e}-${s}`]:a}))),f({title:a.connected?"Connection Successful":"Connection Failed",description:a.message,variant:a.connected?"default":"destructive"})}catch(t){h((t=>({...t,[`${e}-${s}`]:{success:!1,connected:!1,message:"Test failed"}}))),f({title:"Test Failed",description:"Failed to test connection",variant:"destructive"})}finally{p(null)}})(e.systemName,s.id),disabled:(null==x?void 0:x.instance)===s.id,className:"flex-1 sm:flex-none",children:[(null==x?void 0:x.instance)===s.id?Si.jsx(kr,{className:"h-4 w-4 animate-spin"}):Si.jsx(hc,{className:"h-4 w-4"}),Si.jsx("span",{className:"ml-1 hidden sm:inline",children:"Test"})]}),Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>u(s),className:"flex-1 sm:flex-none",children:[Si.jsx(Mr,{className:"h-4 w-4"}),Si.jsx("span",{className:"ml-1 hidden sm:inline",children:"Config"})]}),Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>(async(e,s,t)=>{if(window.confirm(`Are you sure you want to delete the instance "${t}"?`))try{const t=await fetch(`/api/plugins/instances/${e}/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),a=await t.json();if(!a.success)throw new Error(a.message);await g(),f({title:"Instance Deleted",description:a.message})}catch(a){f({title:"Deletion Failed",description:a instanceof Error?a.message:"Failed to delete instance",variant:"destructive"})}})(e.systemName,s.id,s.name),className:"flex-1 sm:flex-none text-red-600 hover:text-red-700",children:[Si.jsx(al,{className:"h-4 w-4"}),Si.jsx("span",{className:"ml-1 hidden sm:inline",children:"Delete"})]})]}),Si.jsx(Ex,{variant:s.isActive?"destructive":"default",size:"sm",onClick:()=>(async(e,s,t)=>{try{const a=await fetch(`/api/plugins/instances/${e}/${s}/toggle`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:t})}),i=await a.json();if(!i.success)throw new Error(i.message);await g(),f({title:t?"Instance Activated":"Instance Deactivated",description:`${s} is now ${t?"active":"inactive"}.`})}catch(a){f({title:"Toggle Failed",description:a instanceof Error?a.message:"Failed to toggle instance status",variant:"destructive"})}})(e.systemName,s.id,!s.isActive),className:"w-full sm:w-auto",children:s.isActive?Si.jsxs(Si.Fragment,{children:[Si.jsx(sc,{className:"h-4 w-4"}),Si.jsx("span",{className:"ml-1",children:"Disable"})]}):Si.jsxs(Si.Fragment,{children:[Si.jsx(ec,{className:"h-4 w-4"}),Si.jsx("span",{className:"ml-1",children:"Enable"})]})})]})]})},s.id)}))})})]},e.systemName)))})]}),d&&Si.jsx(v,{instance:d,pluginName:(null==(e=s.find((e=>e.config.instances.some((e=>e.id===d.id)))))?void 0:e.systemName)||""})]})}function US({pluginTypes:e,selectedPluginType:s,setSelectedPluginType:t,onSubmit:a,onCancel:i}){const[n,r]=$n.useState({name:"",baseUrl:"",authType:"none",authConfig:{username:"",password:"",token:"",key:"",header:"Authorization"},tags:"",isActive:!0,sslConfig:{rejectUnauthorized:!0,allowSelfSigned:!1,timeout:3e4}}),l=e.find((e=>e.systemName===s));return Si.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!s||!n.name||!n.baseUrl)return;const t={...n,tags:n.tags.split(",").map((e=>e.trim())).filter(Boolean)};a(t)},className:"space-y-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"plugin-type",children:"Plugin Type *"}),Si.jsxs("select",{id:"plugin-type",value:s,onChange:e=>t(e.target.value),className:"w-full p-2 border rounded",required:!0,children:[Si.jsx("option",{value:"",children:"Select a plugin type"}),e.map((e=>Si.jsxs("option",{value:e.systemName,children:[e.displayName," (",e.currentInstances," instances)"]},e.systemName)))]}),l&&Si.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[l.description," • ",l.defaultQueries," default queries available"]})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"instance-name",children:"Instance Name *"}),Si.jsx(kx,{id:"instance-name",value:n.name,onChange:e=>r({...n,name:e.target.value}),placeholder:"My Production Instance",required:!0})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"base-url",children:"Base URL *"}),Si.jsx(kx,{id:"base-url",value:n.baseUrl,onChange:e=>r({...n,baseUrl:e.target.value}),placeholder:"https://api.example.com",required:!0})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"auth-type",children:"Authentication Type"}),Si.jsxs("select",{id:"auth-type",value:n.authType,onChange:e=>r({...n,authType:e.target.value}),className:"w-full p-2 border rounded",children:[Si.jsx("option",{value:"none",children:"None"}),Si.jsx("option",{value:"basic",children:"Basic Auth"}),Si.jsx("option",{value:"bearer",children:"Bearer Token"}),Si.jsx("option",{value:"api_key",children:"API Key"})]})]}),"basic"===n.authType&&Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"username",children:"Username"}),Si.jsx(kx,{id:"username",value:n.authConfig.username||"",onChange:e=>r({...n,authConfig:{...n.authConfig,username:e.target.value}})})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"password",children:"Password"}),Si.jsx(kx,{id:"password",type:"password",value:n.authConfig.password||"",onChange:e=>r({...n,authConfig:{...n.authConfig,password:e.target.value}})})]})]}),"bearer"===n.authType&&Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"token",children:"Bearer Token"}),Si.jsx(kx,{id:"token",type:"password",value:n.authConfig.token||"",onChange:e=>r({...n,authConfig:{...n.authConfig,token:e.target.value}})})]}),"api_key"===n.authType&&Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"api-key",children:"API Key"}),Si.jsx(kx,{id:"api-key",type:"password",value:n.authConfig.key||"",onChange:e=>r({...n,authConfig:{...n.authConfig,key:e.target.value}})})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"header-name",children:"Header Name"}),Si.jsx(kx,{id:"header-name",value:n.authConfig.header||"Authorization",onChange:e=>r({...n,authConfig:{...n.authConfig,header:e.target.value}})})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"tags",children:"Tags (comma-separated)"}),Si.jsx(kx,{id:"tags",value:n.tags,onChange:e=>r({...n,tags:e.target.value}),placeholder:"production, firewall, security"})]}),Si.jsxs("div",{className:"border-t pt-4",children:[Si.jsx("h3",{className:"text-lg font-medium mb-3",children:"SSL/TLS Configuration"}),Si.jsxs("div",{className:"space-y-3",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(df,{checked:!n.sslConfig.rejectUnauthorized,onCheckedChange:e=>r({...n,sslConfig:{...n.sslConfig,rejectUnauthorized:!e,allowSelfSigned:e}})}),Si.jsx(Op,{children:"Allow Self-Signed Certificates"}),Si.jsx("span",{className:"text-sm text-gray-500",children:"(Disable SSL verification for self-signed certs)"})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"timeout",children:"Connection Timeout (ms)"}),Si.jsx(kx,{id:"timeout",type:"number",value:n.sslConfig.timeout,onChange:e=>r({...n,sslConfig:{...n.sslConfig,timeout:parseInt(e.target.value)||3e4}}),placeholder:"30000",min:"1000",max:"300000"}),Si.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Timeout for HTTP requests (1-300 seconds)"})]})]})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(df,{checked:n.isActive,onCheckedChange:e=>r({...n,isActive:e})}),Si.jsx(Op,{children:"Start as Active"})]}),Si.jsxs("div",{className:"flex flex-col sm:flex-row justify-end gap-2 pt-4",children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:i,className:"w-full sm:w-auto",children:"Cancel"}),Si.jsxs(Ex,{type:"submit",className:"w-full sm:w-auto",disabled:!s||!n.name||!n.baseUrl,children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Create Instance"]})]})]})}const $S={clients:{name:{description:"Client company name (Required)",dataType:"text",required:!0,example:"Acme Corporation"},shortName:{description:"Client abbreviated name",dataType:"text",required:!1,example:"ACME"},domain:{description:"Company domain",dataType:"text",required:!1,example:"acme.com"},industry:{description:"Industry sector",dataType:"text",required:!1,example:"Technology"},companySize:{description:"Company size category",dataType:"text",required:!1,example:"Mid-market (100-999 employees)"},status:{description:"Client status",dataType:"text",required:!1,example:"active, prospect, inactive"},source:{description:"How they found us",dataType:"text",required:!1,example:"Referral, Website, Cold Call"},website:{description:"Company website URL",type:"string",optional:!0,examples:["https://company.com","www.company.com"]},notes:{description:"Additional notes about the client",type:"string",optional:!0,examples:["Key technology partner","Requires HIPAA compliance"]}},contacts:{name:{description:"Contact full name (Required)",dataType:"text",required:!0,example:"John Smith"},email:{description:"Contact email address (Required)",dataType:"email",required:!0,example:"john.smith@acme.com"},phone:{description:"Contact phone number",dataType:"text",required:!1,example:"+1-555-123-4567"},title:{description:"Job title",dataType:"text",required:!1,example:"IT Director"},isPrimary:{description:"Is primary contact",dataType:"boolean",required:!1,example:"true, false"},isActive:{description:"Is active contact",dataType:"boolean",required:!1,example:"true, false"}},contracts:{name:{description:"Contract name/title (Required)",dataType:"text",required:!0,example:"Annual Security Services Agreement"},startDate:{description:"Contract start date (Required)",dataType:"date",required:!0,example:"2024-01-01"},endDate:{description:"Contract end date (Required)",dataType:"date",required:!0,example:"2024-12-31"},autoRenewal:{description:"Auto-renewal enabled",dataType:"boolean",required:!1,example:"true, false"},renewalTerms:{description:"Renewal terms",dataType:"text",required:!1,example:"Annual automatic renewal"},totalValue:{description:"Total contract value",dataType:"number",required:!1,example:"120000.00"},status:{description:"Contract status",dataType:"text",required:!1,example:"draft, active, expired"},documentUrl:{description:"Contract document URL",dataType:"text",required:!1,example:"https://docs.company.com/contract123.pdf"},notes:{description:"Contract notes",dataType:"text",required:!1,example:"Special terms and conditions"}},licenses:{assignedLicenses:{description:"Number of assigned licenses (Required)",dataType:"integer",required:!0,example:"25"},notes:{description:"License assignment notes",dataType:"text",required:!1,example:"SIEM EPS allocation for Q1"}},services:{name:{description:"Service name (Required)",dataType:"text",required:!0,example:"SIEM Monitoring"},category:{description:"Service category (Required)",dataType:"text",required:!0,example:"Security Operations, Network Security, Compliance"},description:{description:"Service description",dataType:"text",required:!1,example:"Real-time security event monitoring and analysis"},deliveryModel:{description:"Service delivery model (Required)",dataType:"text",required:!0,example:"Serverless, On-Prem Engineer, Hybrid"},basePrice:{description:"Base service price",dataType:"number",required:!1,example:"5000.00"},pricingUnit:{description:"Pricing unit",dataType:"text",required:!1,example:"per endpoint, per month, per GB/day"},isActive:{description:"Is service active",dataType:"boolean",required:!1,example:"true, false"}},serviceScopes:{scopeDefinition:{description:"Service scope parameters (JSON format)",dataType:"text",required:!1,example:'{"service_level": "Standard", "monitoring_hours": "24/7", "response_time": "30 minutes"}'},startDate:{description:"Service scope start date",dataType:"date",required:!1,example:"2024-01-01"},endDate:{description:"Service scope end date",dataType:"date",required:!1,example:"2024-12-31"},status:{description:"Service scope status",dataType:"text",required:!1,example:"active, pending, completed, cancelled"},monthlyValue:{description:"Monthly service value",dataType:"number",required:!1,example:"15000.00"},notes:{description:"Service scope notes",dataType:"text",required:!1,example:"Custom requirements or SLA details"}},hardware:{name:{description:"Hardware asset name (Required)",dataType:"text",required:!0,example:"Firewall Device #1"},serialNumber:{description:"Hardware serial number (Required)",dataType:"text",required:!0,example:"FW-2024-001-ABC123"},manufacturer:{description:"Hardware manufacturer",dataType:"text",required:!1,example:"Cisco, Fortinet, Palo Alto"},model:{description:"Hardware model",dataType:"text",required:!1,example:"ASA-5516-X"},category:{description:"Hardware category",dataType:"text",required:!1,example:"Firewall, Server, Network Equipment"},purchaseDate:{description:"Purchase date",dataType:"date",required:!1,example:"2024-01-15"},warrantyExpiryDate:{description:"Warranty expiry date",dataType:"date",required:!1,example:"2027-01-15"},status:{description:"Hardware status",dataType:"text",required:!1,example:"active, maintenance, retired"},installationLocation:{description:"Installation location",dataType:"text",required:!1,example:"Data Center Rack A1"},location:{description:"General location (alias for installationLocation)",dataType:"text",required:!1,example:"Main Office"},notes:{description:"Hardware notes",dataType:"text",required:!1,example:"Configured for client network segmentation"}}};function zS(){const[e,s]=$n.useState(""),[t,a]=$n.useState(null),[i,n]=$n.useState([]),[r,l]=$n.useState(!1),[c,o]=$n.useState(null),[d,u]=$n.useState("input"),[m,h]=$n.useState("update"),[x,p]=$n.useState("name_only"),{toast:f}=sd(),g=e=>e.map((e=>{const s=e.toLowerCase().trim();let t="",a="",i=!1,n="text";return s.includes("client")||s.includes("company")?(a="clients",s.includes("name")?(t="name",i=!0,n="text"):s.includes("short")?t="shortName":s.includes("domain")?t="domain":s.includes("industry")?t="industry":s.includes("size")?t="companySize":s.includes("status")?t="status":s.includes("source")?t="source":s.includes("website")?t="website":s.includes("note")&&(t="notes")):s.includes("contact")||s.includes("person")?(a="contacts",s.includes("name")?(t="name",i=!0,n="text"):s.includes("email")?(t="email",i=!0,n="email"):s.includes("phone")?t="phone":s.includes("title")||s.includes("position")?t="title":s.includes("primary")?(t="isPrimary",n="boolean"):s.includes("active")&&(t="isActive",n="boolean")):s.includes("contract")?(a="contracts",s.includes("name")||s.includes("title")?(t="name",i=!0,n="text"):s.includes("start")?(t="startDate",i=!0,n="date"):s.includes("end")?(t="endDate",i=!0,n="date"):s.includes("value")||s.includes("amount")?(t="totalValue",n="number"):s.includes("status")?t="status":s.includes("renewal")?s.includes("auto")?(t="autoRenewal",n="boolean"):t="renewalTerms":s.includes("document")||s.includes("url")?t="documentUrl":s.includes("note")&&(t="notes")):s.includes("service")?(a="services",s.includes("name")?(t="name",i=!0,n="text"):s.includes("category")?(t="category",i=!0,n="text"):s.includes("description")?t="description":s.includes("delivery")&&s.includes("model")?(t="deliveryModel",i=!0,n="text"):s.includes("price")||s.includes("base")?(t="basePrice",n="number"):s.includes("pricing")&&s.includes("unit")?t="pricingUnit":s.includes("active")&&(t="isActive",n="boolean")):s.includes("scope")?(a="serviceScopes",s.includes("definition")?(t="scopeDefinition",n="text"):s.includes("start")&&s.includes("date")?(t="startDate",n="date"):s.includes("end")&&s.includes("date")?(t="endDate",n="date"):s.includes("status")?t="status":s.includes("monthly")&&s.includes("value")?(t="monthlyValue",n="number"):s.includes("note")&&(t="notes")):s.includes("license")?(a="licenses",s.includes("quantity")||s.includes("count")||s.includes("assigned")?(t="assignedLicenses",i=!0,n="integer"):s.includes("note")&&(t="notes")):s.includes("serial")?(a="hardware",t="serialNumber",i=!0,n="text"):s.includes("hardware")||s.includes("asset")||s.includes("device")?(a="hardware",s.includes("name")?(t="name",i=!0,n="text"):s.includes("serial")?(t="serialNumber",i=!0,n="text"):s.includes("manufacturer")||s.includes("vendor")?t="manufacturer":s.includes("model")?t="model":s.includes("category")||s.includes("type")?t="category":s.includes("purchase")&&s.includes("date")?(t="purchaseDate",n="date"):s.includes("warranty")?(t="warrantyExpiryDate",n="date"):s.includes("status")&&(t="status")):s.includes("saf")?(a="saf",s.includes("number")||s.includes("no")?(t="safNumber",i=!0):s.includes("title")||s.includes("name")?(t="title",i=!0):s.includes("start")?(t="startDate",n="date"):s.includes("end")?(t="endDate",n="date"):(s.includes("signed")||s.includes("status")||s.includes("approved"))&&(t="signed",n="boolean")):s.includes("coc")?(a="coc",s.includes("number")||s.includes("no")?(t="cocNumber",i=!0):s.includes("title")||s.includes("name")?(t="title",i=!0):s.includes("issue")||s.includes("issued")?(t="issueDate",n="date"):s.includes("expiry")||s.includes("end")?(t="expiryDate",n="date"):(s.includes("signed")||s.includes("status")||s.includes("approved"))&&(t="signed",n="boolean")):(a="",t=""),{sourceColumn:e,targetField:t,entityType:a,required:i,dataType:n}})),j=(e,s,t)=>{var a,r;const l=[...i];if("targetField"===s)if("skip-column"===t)l[e].targetField="",l[e].entityType="",l[e].required=!1,l[e].dataType="text";else if(t.includes(".")){const[s,i]=t.split(".");l[e].targetField=i,l[e].entityType=s;const n=null==(a=$S[s])?void 0:a[i];n&&(l[e].required=n.required,l[e].dataType=n.dataType)}else{l[e].targetField=t;const s=l[e].entityType,a=null==(r=$S[s])?void 0:r[t];a&&(l[e].required=a.required,l[e].dataType=a.dataType)}else l[e][s]=t;n(l)},v=()=>{s(""),a(null),n([]),o(null),u("input")},y=e=>{switch(e){case"input":return!0;case"mapping":return!!t;case"preview":return!!t&&i.length>0;case"results":return!!c;default:return!1}},b=e=>{switch(e){case"clients":case"contacts":return Si.jsx($r,{className:"h-4 w-4"});case"contracts":return Si.jsx(Kr,{className:"h-4 w-4"});case"services":default:return Si.jsx(Vr,{className:"h-4 w-4"});case"serviceScopes":return Si.jsx(Mr,{className:"h-4 w-4"});case"licenses":return Si.jsx(Ul,{className:"h-4 w-4"});case"hardware":return Si.jsx(_r,{className:"h-4 w-4"})}},N=e=>{switch(e){case"input":return Si.jsx(El,{className:"h-4 w-4"});case"mapping":return Si.jsx(Ol,{className:"h-4 w-4"});case"preview":return Si.jsx(Sl,{className:"h-4 w-4"});case"results":return Si.jsx(Dl,{className:"h-4 w-4"});default:return Si.jsx(gc,{className:"h-4 w-4"})}};return Si.jsx(vf,{title:"Comprehensive Bulk Import",subtitle:"Import clients, contacts, contracts, licenses, and hardware from pasted data",children:Si.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[Si.jsx(Ax,{children:Si.jsx(Lx,{className:"pt-6",children:Si.jsx("div",{className:"flex items-center justify-between",children:["input","mapping","preview","results"].map(((e,s)=>Si.jsxs("div",{className:"flex items-center",children:[Si.jsxs("button",{onClick:()=>(e=>{("mapping"!==e||t)&&("preview"!==e||t&&i.length)&&("results"!==e||c)&&u(e)})(e),disabled:!y(e),className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-200 ${d===e?"bg-blue-100 text-blue-700 ring-2 ring-blue-200":["input","mapping","preview","results"].indexOf(d)>s?"bg-green-100 text-green-700 hover:bg-green-200":y(e)?"bg-gray-100 text-gray-600 hover:bg-gray-200 cursor-pointer":"bg-gray-100 text-gray-400 cursor-not-allowed"} ${y(e)?"focus:outline-none focus:ring-2 focus:ring-blue-300":""}`,children:[N(e),Si.jsx("span",{className:"font-medium capitalize",children:e}),y(e)&&d!==e&&Si.jsx("span",{className:"text-xs opacity-60",children:"(click to go)"})]}),s<3&&Si.jsx("div",{className:"w-8 h-px mx-2 transition-colors duration-200 "+(["input","mapping","preview","results"].indexOf(d)>s?"bg-green-300":"bg-gray-300")})]},e)))})})}),"input"===d&&Si.jsxs(Ax,{children:[Si.jsxs(Px,{children:[Si.jsxs(_x,{className:"flex items-center space-x-2",children:[Si.jsx(El,{className:"h-5 w-5"}),Si.jsx("span",{children:"Step 1: Paste Your Data"})]}),Si.jsx(Fx,{children:"Copy and paste data from Excel, Google Sheets, or any spreadsheet. Data should be tab-separated or comma-separated."})]}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"flex space-x-2",children:[Si.jsxs(Ex,{variant:"outline",onClick:()=>{s("Client Name\tShort Name\tDomain\tIndustry\tCompany Size\tStatus\tSource\tWebsite\tContact Name\tContact Email\tContact Phone\tContact Title\tContract Name\tContract Start Date\tContract End Date\tContract Value\tService Name\tService Category\tService Description\tService Delivery Model\tHardware Name\tHardware Category\tHardware Model\tHardware Manufacturer\tHardware Serial Number\tLicense Name\tLicense Vendor\tLicense Type\tLicense Quantity\tSAF Number\tSAF Title\tSAF Start Date\tSAF End Date\tSAF Signed\tCOC Number\tCOC Title\tCOC Issued Date\tCOC Signed\nCustomer Apps\tCustomer Apps\tC003\tTechnology\tLarge\tactive\tnca\tKing Fahd Road, Riyadh 12345, Saudi Arabia\thttps://customerapps.com\tJohn Smith\tjohn.smith@customerapps.com\t+966-11-234-5678\tChief Information Security Officer\tAnnual SIEM Monitoring Contract 2024\t2024-01-01\t2024-12-31\t180000\tSIEM Monitoring\tSecurity Operations\tReal-time security event monitoring and analysis\tServerless\tFirewall Primary - Customer Apps\tNetwork Security\tFortinet\tFortiGate 600E\tFG600E-C003-001\tSIEM EPS Pool\tIBM\tEPS-based\t5000\tSAF-2024-001\tPrimary SIEM Monitoring SAF\t2024-01-01\t2024-12-31\ttrue\tCOC-2024-001\tCustomer Apps SIEM Monitoring COC\t2024-12-31\ttrue\nSaudi Information Technology Company\tSITE\tC004\tTechnology\tLarge\tactive\tdirect\tKing Abdul Aziz Road, Riyadh 11564, Saudi Arabia\thttps://site.sa\tAhmed Ali\tahmed.ali@site.sa\t+966-11-345-6789\tDirector of Cybersecurity\tComprehensive IT Security Services 2024\t2024-01-01\t2024-12-31\t250000\tVulnerability Assessment\tNetwork Security\tComprehensive vulnerability scanning and reporting\tOn-Prem Engineer\tSOC Server - SITE\tServer Hardware\tDell\tPowerEdge R740\tDELL-R740-C004-001\tSIEM EPS Pool\tIBM\tEPS-based\t10000\tSAF-2024-002\tSITE Vulnerability Assessment SAF\t2024-01-15\t2024-12-31\tfalse\tCOC-2024-002\tSITE Vulnerability Assessment COC\t2024-12-31\ttrue\nRed Sea Development Company\tRed Sea Dev\tR001\tReal Estate\tLarge\tactive\tboth\tRed Sea Project, NEOM 49643, Saudi Arabia\thttps://theredsea.sa\tSarah Ahmed\tsarah.ahmed@theredsea.sa\t+966-12-456-7890\tChief Technology Officer\tSmart Infrastructure Security Services 2024\t2024-01-01\t2024-12-31\t320000\tIncident Response\tSecurity Operations\t24/7 incident response and forensics\tHybrid\tSecurity Gateway - Red Sea\tNetwork Security\tCisco\tASA 5585-X\tCISCO-ASA-R001-001\tSIEM EPS Pool\tIBM\tEPS-based\t7500\tSAF-2024-003\tRed Sea Incident Response SAF\t2024-02-01\t2024-12-31\ttrue\tCOC-2024-003\tRed Sea Incident Response COC\t2024-12-31\ttrue"),f({title:"Sample Data Loaded",description:"Sample data has been loaded. Click 'Parse Data' to continue."})},children:[Si.jsx(Rl,{className:"h-4 w-4 mr-2"}),"Load Sample Data"]}),Si.jsxs(Ex,{variant:"outline",onClick:v,children:[Si.jsx(ul,{className:"h-4 w-4 mr-2"}),"Reset"]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{htmlFor:"pastedData",children:"Paste your data here:"}),Si.jsx(Yp,{id:"pastedData",placeholder:"Paste your tabular data here (from Excel, Google Sheets, etc.)...",value:e,onChange:e=>s(e.target.value),className:"min-h-[200px] font-mono"})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsx("div",{className:"text-sm text-gray-500",children:e.trim()&&Si.jsxs(Si.Fragment,{children:["Detected ",e.trim().split("\n").length," lines"]})}),Si.jsx("div",{className:"flex space-x-2",children:Si.jsxs(Ex,{onClick:()=>{if(e.trim())try{const s=e.trim().split("\n"),t=s[0].split(/\t|,/).map((e=>e.trim().replace(/"/g,""))),i=s.slice(1).map((e=>e.split(/\t|,/).map((e=>e.trim().replace(/"/g,"")))));a({headers:t,rows:i.filter((e=>e.some((e=>e.length>0)))),totalRows:i.length});const r=g(t);n(r),u("mapping"),f({title:"Data Parsed Successfully",description:`Found ${t.length} columns and ${i.length} data rows`})}catch(s){f({title:"Parse Error",description:"Failed to parse the data. Please check the format.",variant:"destructive"})}else f({title:"No Data",description:"Please paste some data first",variant:"destructive"})},disabled:!e.trim(),children:["Parse Data & Continue",Si.jsx(ll,{className:"h-4 w-4 ml-2"})]})})]})]})]}),"mapping"===d&&t&&Si.jsxs(Ax,{children:[Si.jsxs(Px,{children:[Si.jsxs(_x,{className:"flex items-center space-x-2",children:[Si.jsx(Ol,{className:"h-5 w-5"}),Si.jsx("span",{children:"Step 2: Map Columns to Database Fields"})]}),Si.jsx(Fx,{children:"Map your data columns to the appropriate database fields. Required fields are marked with *."})]}),Si.jsxs(Lx,{children:[Si.jsx(jp,{className:"h-[400px]",children:Si.jsx("div",{className:"space-y-4",children:i.map(((e,s)=>{var t,a;return Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 border rounded-lg",children:[Si.jsxs("div",{children:[Si.jsx(Op,{className:"text-sm font-medium",children:"Source Column"}),Si.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded text-sm",children:e.sourceColumn})]}),Si.jsxs("div",{children:[Si.jsx(Op,{className:"text-sm font-medium",children:"Entity Type"}),Si.jsxs(zp,{value:e.entityType,onValueChange:e=>j(s,"entityType",e),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"clients",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx($r,{className:"h-4 w-4"}),Si.jsx("span",{children:"Clients"})]})}),Si.jsx(Hp,{value:"contacts",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx($r,{className:"h-4 w-4"}),Si.jsx("span",{children:"Contacts"})]})}),Si.jsx(Hp,{value:"contracts",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Kr,{className:"h-4 w-4"}),Si.jsx("span",{children:"Contracts"})]})}),Si.jsx(Hp,{value:"services",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Vr,{className:"h-4 w-4"}),Si.jsx("span",{children:"Services"})]})}),Si.jsx(Hp,{value:"serviceScopes",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Mr,{className:"h-4 w-4"}),Si.jsx("span",{children:"Service Scopes"})]})}),Si.jsx(Hp,{value:"licenses",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Ul,{className:"h-4 w-4"}),Si.jsx("span",{children:"Licenses"})]})}),Si.jsx(Hp,{value:"hardware",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(_r,{className:"h-4 w-4"}),Si.jsx("span",{children:"Hardware"})]})})]})]})]}),Si.jsxs("div",{children:[Si.jsxs(Op,{className:"text-sm font-medium",children:["Target Field ",e.required&&Si.jsx("span",{className:"text-red-500",children:"*"})]}),Si.jsxs(zp,{value:e.targetField||"skip-column",onValueChange:e=>j(s,"targetField","skip-column"===e?"":e),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select field..."})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"skip-column",children:"-- Skip Column --"}),Object.entries($S).map((([e,s])=>Si.jsxs("div",{children:[Si.jsx("div",{className:"px-2 py-1 text-xs font-semibold text-gray-500 uppercase bg-gray-50",children:e.charAt(0).toUpperCase()+e.slice(1)}),Object.entries(s).map((([s,t])=>Si.jsxs(Hp,{value:`${e}.${s}`,className:"pl-6",children:[Si.jsxs("div",{className:"flex items-center justify-between w-full",children:[Si.jsxs("span",{className:"flex items-center gap-2",children:[t.required&&Si.jsx("span",{className:"text-red-500 text-xs",children:"*"}),s]}),Si.jsx("span",{className:"text-xs text-gray-500 ml-2",children:t.dataType})]}),Si.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t.description})]},`${e}.${s}`)))]},e)))]})]}),e.targetField&&Si.jsx("div",{className:"text-xs text-gray-500 mt-1",children:null==(a=null==(t=$S[e.entityType])?void 0:t[e.targetField])?void 0:a.description})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sx,{variant:e.required?"destructive":"secondary",children:e.dataType}),e.required&&Si.jsx(Sx,{variant:"outline",children:"Required"})]})]},s)}))})}),Si.jsx(Cp,{className:"my-4"}),Si.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[Si.jsxs("h4",{className:"font-medium flex items-center space-x-2",children:[Si.jsx(Mr,{className:"h-4 w-4"}),Si.jsx("span",{children:"Import Settings"})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx(Op,{className:"text-sm font-medium",children:"How to handle duplicate clients?"}),Si.jsxs(zp,{value:m,onValueChange:e=>h(e),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"update",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(ul,{className:"h-4 w-4"}),Si.jsxs("div",{children:[Si.jsx("div",{children:"Update existing clients"}),Si.jsx("div",{className:"text-xs text-gray-500",children:"Overwrite data for existing clients"})]})]})}),Si.jsx(Hp,{value:"skip",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Sl,{className:"h-4 w-4"}),Si.jsxs("div",{children:[Si.jsx("div",{children:"Skip duplicates"}),Si.jsx("div",{className:"text-xs text-gray-500",children:"Keep existing data, skip importing duplicates"})]})]})}),Si.jsx(Hp,{value:"create_new",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(El,{className:"h-4 w-4"}),Si.jsxs("div",{children:[Si.jsx("div",{children:"Create new entries"}),Si.jsx("div",{className:"text-xs text-gray-500",children:"Create new clients with modified names"})]})]})})]})]})]}),Si.jsxs("div",{children:[Si.jsx(Op,{className:"text-sm font-medium",children:"How to identify duplicate clients?"}),Si.jsxs(zp,{value:x,onValueChange:e=>p(e),children:[Si.jsx(Kp,{children:Si.jsx(Bp,{})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"name_only",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx($r,{className:"h-4 w-4"}),Si.jsxs("div",{children:[Si.jsx("div",{children:"By name only"}),Si.jsx("div",{className:"text-xs text-gray-500",children:"Match clients by name field"})]})]})}),Si.jsx(Hp,{value:"name_and_domain",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Gr,{className:"h-4 w-4"}),Si.jsxs("div",{children:[Si.jsx("div",{children:"By name and domain"}),Si.jsx("div",{className:"text-xs text-gray-500",children:"Match by both name and domain ID"})]})]})}),Si.jsx(Hp,{value:"email",children:Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx($r,{className:"h-4 w-4"}),Si.jsxs("div",{children:[Si.jsx("div",{children:"By contact email"}),Si.jsx("div",{className:"text-xs text-gray-500",children:"Match by primary contact email"})]})]})})]})]})]})]}),Si.jsxs(Nx,{children:[Si.jsx(gc,{className:"h-4 w-4"}),Si.jsxs(wx,{className:"text-sm",children:[Si.jsx("strong",{children:"Duplicate Handling:"}),"update"===m&&" Existing client records will be updated with new data from your import.","skip"===m&&" Duplicate clients will be skipped, keeping existing data unchanged.","create_new"===m&&" New client records will be created with modified names to avoid conflicts.",Si.jsx("br",{}),Si.jsx("strong",{children:"Client Matching:"}),"name_only"===x&&" Clients are considered duplicates if they have the same name.","name_and_domain"===x&&" Clients are considered duplicates if they have the same name AND domain ID.","email"===x&&" Clients are considered duplicates if they have contacts with matching email addresses."]})]})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsxs(Ex,{variant:"outline",onClick:()=>u("input"),children:[Si.jsx(dl,{className:"h-4 w-4 mr-2"}),"Back to Data Input"]}),Si.jsx(Ex,{onClick:async()=>{if(!t||0===i.length)return void f({title:"No Data to Import",description:"Please parse data and configure mappings first",variant:"destructive"});const e=i.filter((e=>e.required&&!e.targetField));if(e.length>0)f({title:"Missing Required Mappings",description:`Please map these required fields: ${e.map((e=>e.sourceColumn)).join(", ")}`,variant:"destructive"});else{l(!0),u("preview");try{const e={headers:t.headers,rows:t.rows,mappings:i.filter((e=>e.targetField)),duplicateHandling:m,clientMatchStrategy:x},s=await fetch("/api/bulk-import/comprehensive-paste",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"}),a=await s.json();o(a),u("results"),a.success?f({title:"Import Successful",description:`Successfully imported ${a.recordsSuccessful} records`}):f({title:"Import Completed with Issues",description:`${a.recordsSuccessful} successful, ${a.recordsFailed} failed`,variant:"destructive"})}catch(s){f({title:"Import Failed",description:"An error occurred during import",variant:"destructive"}),u("mapping")}finally{l(!1)}}},disabled:r,children:r?Si.jsxs(Si.Fragment,{children:[Si.jsx(ul,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):Si.jsxs(Si.Fragment,{children:["Preview & Import",Si.jsx(ll,{className:"h-4 w-4 ml-2"})]})})]})]})]}),"preview"===d&&Si.jsxs(Ax,{children:[Si.jsxs(Px,{children:[Si.jsxs(_x,{className:"flex items-center space-x-2",children:[Si.jsx(Sl,{className:"h-5 w-5"}),Si.jsx("span",{children:"Step 3: Processing Import"})]}),Si.jsx(Fx,{children:"Your data is being processed and imported into the database..."})]}),Si.jsx(Lx,{children:Si.jsxs("div",{className:"space-y-4",children:[Si.jsx(kS,{value:r?50:100,className:"w-full"}),Si.jsx("div",{className:"text-center text-gray-600",children:r?"Processing your data...":"Import completed!"}),!r&&Si.jsxs("div",{className:"flex justify-between mt-4",children:[Si.jsxs(Ex,{variant:"outline",onClick:()=>u("mapping"),children:[Si.jsx(dl,{className:"h-4 w-4 mr-2"}),"Back to Mapping"]}),Si.jsxs(Ex,{onClick:()=>u("results"),children:["View Results",Si.jsx(ll,{className:"h-4 w-4 ml-2"})]})]})]})})]}),"results"===d&&c&&Si.jsxs(Ax,{children:[Si.jsxs(Px,{children:[Si.jsxs(_x,{className:"flex items-center space-x-2",children:[Si.jsx(Dl,{className:"h-5 w-5"}),Si.jsx("span",{children:"Step 4: Import Results"})]}),Si.jsx(Fx,{children:"Review the results of your data import"})]}),Si.jsxs(Lx,{className:"space-y-6",children:[Si.jsxs(Nx,{className:c.success?"border-green-200 bg-green-50":"border-yellow-200 bg-yellow-50",children:[Si.jsx(vl,{className:"h-4 w-4"}),Si.jsx(wx,{children:Si.jsxs("div",{className:"space-y-2",children:[Si.jsx("div",{className:"font-medium",children:c.message}),Si.jsxs("div",{className:"text-sm",children:[Si.jsx("strong",{children:"Processed:"})," ",c.recordsProcessed," records |",Si.jsx("strong",{className:"text-green-600 ml-2",children:"Successful:"})," ",c.recordsSuccessful," |",Si.jsx("strong",{className:"text-red-600 ml-2",children:"Failed:"})," ",c.recordsFailed,c.recordsSkipped>0&&Si.jsxs(Si.Fragment,{children:["| ",Si.jsx("strong",{className:"text-yellow-600 ml-2",children:"Skipped:"})," ",c.recordsSkipped]})]})]})})]}),Si.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:Object.entries(c.details).map((([e,s])=>Si.jsx(Ax,{children:Si.jsxs(Lx,{className:"pt-4",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[b(e),Si.jsx("span",{className:"font-medium capitalize",children:e})]}),Si.jsxs("div",{className:"mt-2 text-sm text-gray-600",children:[Si.jsxs("div",{children:["Created: ",Si.jsx("span",{className:"font-medium text-green-600",children:s.created})]}),Si.jsxs("div",{children:["Updated: ",Si.jsx("span",{className:"font-medium text-blue-600",children:s.updated})]}),"skipped"in s&&s.skipped>0&&Si.jsxs("div",{children:["Skipped: ",Si.jsx("span",{className:"font-medium text-yellow-600",children:s.skipped})]})]})]})},e)))}),c.warnings&&c.warnings.length>0&&Si.jsxs("div",{children:[Si.jsx("h3",{className:"font-medium mb-2 text-yellow-600",children:"Warnings:"}),Si.jsx(jp,{className:"h-32",children:Si.jsx("div",{className:"space-y-1",children:c.warnings.map(((e,s)=>Si.jsx("div",{className:"text-sm text-yellow-700 bg-yellow-50 p-2 rounded",children:e},s)))})})]}),c.errors&&c.errors.length>0&&Si.jsxs("div",{children:[Si.jsx("h3",{className:"font-medium mb-2 text-red-600",children:"Errors:"}),Si.jsx(jp,{className:"h-32",children:Si.jsx("div",{className:"space-y-1",children:c.errors.map(((e,s)=>Si.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-2 rounded",children:e},s)))})})]}),Si.jsxs("div",{className:"flex justify-between",children:[Si.jsxs("div",{className:"flex space-x-2",children:[Si.jsxs(Ex,{variant:"outline",onClick:()=>u("mapping"),children:[Si.jsx(dl,{className:"h-4 w-4 mr-2"}),"Back to Mapping"]}),Si.jsxs(Ex,{variant:"outline",onClick:v,children:[Si.jsx(ul,{className:"h-4 w-4 mr-2"}),"Import More Data"]})]}),Si.jsxs(Ex,{onClick:()=>window.location.href="/clients",children:["View Imported Clients",Si.jsx($r,{className:"h-4 w-4 ml-2"})]})]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center space-x-2",children:[Si.jsx(gc,{className:"h-5 w-5"}),Si.jsx("span",{children:"Navigation & Tips"})]})}),Si.jsx(Lx,{children:Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium mb-2",children:"Step Navigation:"}),Si.jsxs("ul",{className:"text-sm text-gray-600 space-y-1 ml-4",children:[Si.jsx("li",{children:"• Click on any completed step in the progress bar to go back"}),Si.jsx("li",{children:"• Use the Back/Next buttons at the bottom of each step"}),Si.jsx("li",{children:"• You can always go back to fix mapping issues after seeing results"}),Si.jsx("li",{children:"• Changes to mapping will require re-running the import"})]})]}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium mb-2",children:"Import Process:"}),Si.jsxs("ul",{className:"text-sm text-gray-600 space-y-1 ml-4",children:[Si.jsx("li",{children:"• Data is parsed and mapped to the database"}),Si.jsx("li",{children:"• Duplicate handling and client matching are configured"}),Si.jsx("li",{children:"• Data is processed and imported"}),Si.jsx("li",{children:"• Results are reviewed and imported data is saved"})]})]}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium mb-2",children:"Error Recovery:"}),Si.jsxs("ul",{className:"text-sm text-gray-600 space-y-1 ml-4",children:[Si.jsx("li",{children:"• If import fails, check the error messages in the Results step"}),Si.jsx("li",{children:"• Go back to Mapping to fix field assignments"}),Si.jsx("li",{children:"• Go back to Input to correct data format issues"}),Si.jsx("li",{children:"• Missing required fields (like email for contacts) will be skipped"})]})]}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-medium mb-2",children:"Data Format Requirements:"}),Si.jsxs("ul",{className:"text-sm text-gray-600 space-y-1 ml-4",children:[Si.jsx("li",{children:"• First row should contain column headers"}),Si.jsx("li",{children:"• Data can be tab-separated (from Excel) or comma-separated"}),Si.jsx("li",{children:"• Client Name is required for creating records"}),Si.jsx("li",{children:"• Contact Email is required for creating contacts"}),Si.jsx("li",{children:"• Dates should be in YYYY-MM-DD format"}),Si.jsx("li",{children:"• Boolean fields accept: true/false, yes/no, 1/0"})]})]})]})})]})]})})}const BS=[{tableName:"clients",displayName:"Clients",category:"core",fields:[{fieldName:"name",label:"Client Name",isVisible:!0,isRequired:!0},{fieldName:"shortName",label:"Short Name",isVisible:!0},{fieldName:"domain",label:"Domain",isVisible:!0},{fieldName:"industry",label:"Industry",isVisible:!0},{fieldName:"companySize",label:"Company Size",isVisible:!0},{fieldName:"status",label:"Status",isVisible:!0},{fieldName:"source",label:"Source",isVisible:!0},{fieldName:"address",label:"Address",isVisible:!0},{fieldName:"website",label:"Website",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"clientContacts",displayName:"Client Contacts",category:"core",fields:[{fieldName:"name",label:"Contact Name",isVisible:!0,isRequired:!0},{fieldName:"email",label:"Email",isVisible:!0,isRequired:!0},{fieldName:"phone",label:"Phone",isVisible:!0},{fieldName:"title",label:"Title",isVisible:!0},{fieldName:"isPrimary",label:"Primary Contact",isVisible:!0},{fieldName:"isActive",label:"Active",isVisible:!0}]},{tableName:"contracts",displayName:"Contracts",category:"core",fields:[{fieldName:"name",label:"Contract Name",isVisible:!0,isRequired:!0},{fieldName:"startDate",label:"Start Date",isVisible:!0,isRequired:!0},{fieldName:"endDate",label:"End Date",isVisible:!0,isRequired:!0},{fieldName:"autoRenewal",label:"Auto Renewal",isVisible:!0},{fieldName:"renewalTerms",label:"Renewal Terms",isVisible:!0},{fieldName:"totalValue",label:"Total Value",isVisible:!0},{fieldName:"status",label:"Status",isVisible:!0},{fieldName:"documentUrl",label:"Document URL",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"services",displayName:"Services",category:"core",fields:[{fieldName:"name",label:"Service Name",isVisible:!0,isRequired:!0},{fieldName:"category",label:"Category",isVisible:!0,isRequired:!0},{fieldName:"description",label:"Description",isVisible:!0},{fieldName:"deliveryModel",label:"Delivery Model",isVisible:!0,isRequired:!0},{fieldName:"basePrice",label:"Base Price",isVisible:!0},{fieldName:"pricingUnit",label:"Pricing Unit",isVisible:!0},{fieldName:"scopeDefinitionTemplate",label:"Scope Definition Template",isVisible:!0},{fieldName:"isActive",label:"Active",isVisible:!0}]},{tableName:"serviceScopes",displayName:"Service Scopes",category:"core",fields:[{fieldName:"scopeDefinition",label:"Scope Definition",isVisible:!0},{fieldName:"safDocumentUrl",label:"SAF Document URL",isVisible:!0},{fieldName:"safStartDate",label:"SAF Start Date",isVisible:!0},{fieldName:"safEndDate",label:"SAF End Date",isVisible:!0},{fieldName:"safStatus",label:"SAF Status",isVisible:!0},{fieldName:"startDate",label:"Start Date",isVisible:!0},{fieldName:"endDate",label:"End Date",isVisible:!0},{fieldName:"status",label:"Status",isVisible:!0},{fieldName:"monthlyValue",label:"Monthly Value",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"proposals",displayName:"Proposals",category:"core",fields:[{fieldName:"type",label:"Proposal Type",isVisible:!0,isRequired:!0},{fieldName:"version",label:"Version",isVisible:!0},{fieldName:"status",label:"Status",isVisible:!0},{fieldName:"documentUrl",label:"Document URL",isVisible:!0},{fieldName:"proposedValue",label:"Proposed Value",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"licensePools",displayName:"License Pools",category:"licensing",fields:[{fieldName:"name",label:"Pool Name",isVisible:!0,isRequired:!0},{fieldName:"vendor",label:"Vendor",isVisible:!0,isRequired:!0},{fieldName:"productName",label:"Product Name",isVisible:!0,isRequired:!0},{fieldName:"licenseType",label:"License Type",isVisible:!0},{fieldName:"totalLicenses",label:"Total Licenses",isVisible:!0,isRequired:!0},{fieldName:"availableLicenses",label:"Available Licenses",isVisible:!0},{fieldName:"orderedLicenses",label:"Ordered Licenses",isVisible:!0},{fieldName:"costPerLicense",label:"Cost per License",isVisible:!0},{fieldName:"renewalDate",label:"Renewal Date",isVisible:!0},{fieldName:"purchaseRequestNumber",label:"Purchase Request Number",isVisible:!0},{fieldName:"purchaseOrderNumber",label:"Purchase Order Number",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0},{fieldName:"isActive",label:"Active",isVisible:!0}]},{tableName:"clientLicenses",displayName:"Client License Assignments",category:"licensing",fields:[{fieldName:"assignedLicenses",label:"Assigned Licenses",isVisible:!0,isRequired:!0},{fieldName:"assignedDate",label:"Assigned Date",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"individualLicenses",displayName:"Individual Licenses",category:"licensing",fields:[{fieldName:"name",label:"License Name",isVisible:!0,isRequired:!0},{fieldName:"vendor",label:"Vendor",isVisible:!0,isRequired:!0},{fieldName:"productName",label:"Product Name",isVisible:!0,isRequired:!0},{fieldName:"licenseKey",label:"License Key",isVisible:!0},{fieldName:"licenseType",label:"License Type",isVisible:!0},{fieldName:"quantity",label:"Quantity",isVisible:!0},{fieldName:"costPerLicense",label:"Cost per License",isVisible:!0},{fieldName:"purchaseDate",label:"Purchase Date",isVisible:!0},{fieldName:"expiryDate",label:"Expiry Date",isVisible:!0},{fieldName:"renewalDate",label:"Renewal Date",isVisible:!0},{fieldName:"purchaseRequestNumber",label:"Purchase Request Number",isVisible:!0},{fieldName:"purchaseOrderNumber",label:"Purchase Order Number",isVisible:!0},{fieldName:"documentUrl",label:"Document URL",isVisible:!0},{fieldName:"status",label:"Status",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"hardwareAssets",displayName:"Hardware Assets",category:"hardware",fields:[{fieldName:"name",label:"Asset Name",isVisible:!0,isRequired:!0},{fieldName:"category",label:"Category",isVisible:!0,isRequired:!0},{fieldName:"manufacturer",label:"Manufacturer",isVisible:!0},{fieldName:"model",label:"Model",isVisible:!0},{fieldName:"serialNumber",label:"Serial Number",isVisible:!0},{fieldName:"purchaseDate",label:"Purchase Date",isVisible:!0},{fieldName:"purchaseCost",label:"Purchase Cost",isVisible:!0},{fieldName:"warrantyExpiry",label:"Warranty Expiry",isVisible:!0},{fieldName:"status",label:"Status",isVisible:!0},{fieldName:"location",label:"Location",isVisible:!0},{fieldName:"purchaseRequestNumber",label:"Purchase Request Number",isVisible:!0},{fieldName:"purchaseOrderNumber",label:"Purchase Order Number",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"clientHardwareAssignments",displayName:"Client Hardware Assignments",category:"hardware",fields:[{fieldName:"assignedDate",label:"Assigned Date",isVisible:!0},{fieldName:"returnedDate",label:"Returned Date",isVisible:!0},{fieldName:"installationLocation",label:"Installation Location",isVisible:!0},{fieldName:"status",label:"Status",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"financialTransactions",displayName:"Financial Transactions",category:"financial",fields:[{fieldName:"type",label:"Transaction Type",isVisible:!0,isRequired:!0},{fieldName:"amount",label:"Amount",isVisible:!0,isRequired:!0},{fieldName:"description",label:"Description",isVisible:!0,isRequired:!0},{fieldName:"status",label:"Status",isVisible:!0},{fieldName:"transactionDate",label:"Transaction Date",isVisible:!0,isRequired:!0},{fieldName:"category",label:"Category",isVisible:!0},{fieldName:"reference",label:"Reference",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"serviceAuthorizationForms",displayName:"Service Authorization Forms (SAF)",category:"compliance",fields:[{fieldName:"safNumber",label:"SAF Number",isVisible:!0,isRequired:!0},{fieldName:"description",label:"Description",isVisible:!0},{fieldName:"status",label:"Status",isVisible:!0},{fieldName:"requestedDate",label:"Requested Date",isVisible:!0,isRequired:!0},{fieldName:"approvedDate",label:"Approved Date",isVisible:!0},{fieldName:"expiryDate",label:"Expiry Date",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"certificatesOfCompliance",displayName:"Certificates of Compliance (COC)",category:"compliance",fields:[{fieldName:"cocNumber",label:"COC Number",isVisible:!0,isRequired:!0},{fieldName:"title",label:"Title",isVisible:!0,isRequired:!0},{fieldName:"description",label:"Description",isVisible:!0},{fieldName:"complianceType",label:"Compliance Type",isVisible:!0,isRequired:!0},{fieldName:"issueDate",label:"Issue Date",isVisible:!0,isRequired:!0},{fieldName:"expiryDate",label:"Expiry Date",isVisible:!0},{fieldName:"status",label:"Status",isVisible:!0},{fieldName:"documentUrl",label:"Document URL",isVisible:!0},{fieldName:"auditDate",label:"Audit Date",isVisible:!0},{fieldName:"nextAuditDate",label:"Next Audit Date",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"users",displayName:"Users",category:"admin",fields:[{fieldName:"username",label:"Username",isVisible:!0,isRequired:!0},{fieldName:"email",label:"Email",isVisible:!0,isRequired:!0},{fieldName:"firstName",label:"First Name",isVisible:!0,isRequired:!0},{fieldName:"lastName",label:"Last Name",isVisible:!0,isRequired:!0},{fieldName:"role",label:"Role",isVisible:!0},{fieldName:"authProvider",label:"Auth Provider",isVisible:!0},{fieldName:"ldapId",label:"LDAP ID",isVisible:!0},{fieldName:"isActive",label:"Active",isVisible:!0}]},{tableName:"userSettings",displayName:"User Settings",category:"admin",fields:[{fieldName:"emailNotifications",label:"Email Notifications",isVisible:!0},{fieldName:"pushNotifications",label:"Push Notifications",isVisible:!0},{fieldName:"contractReminders",label:"Contract Reminders",isVisible:!0},{fieldName:"financialAlerts",label:"Financial Alerts",isVisible:!0},{fieldName:"sessionTimeout",label:"Session Timeout",isVisible:!0},{fieldName:"darkMode",label:"Dark Mode",isVisible:!0},{fieldName:"timezone",label:"Timezone",isVisible:!0},{fieldName:"language",label:"Language",isVisible:!0},{fieldName:"currency",label:"Currency",isVisible:!0},{fieldName:"autoSaveForms",label:"Auto Save Forms",isVisible:!0},{fieldName:"dataExport",label:"Data Export",isVisible:!0},{fieldName:"apiAccess",label:"API Access",isVisible:!0},{fieldName:"dataRetentionPeriod",label:"Data Retention Period",isVisible:!0}]},{tableName:"clientTeamAssignments",displayName:"Client Team Assignments",category:"admin",fields:[{fieldName:"role",label:"Role",isVisible:!0,isRequired:!0},{fieldName:"assignedDate",label:"Assigned Date",isVisible:!0},{fieldName:"isActive",label:"Active",isVisible:!0},{fieldName:"notes",label:"Notes",isVisible:!0}]},{tableName:"documents",displayName:"Documents",category:"documents",fields:[{fieldName:"title",label:"Document Title",isVisible:!0,isRequired:!0},{fieldName:"description",label:"Description",isVisible:!0},{fieldName:"category",label:"Category",isVisible:!0},{fieldName:"tags",label:"Tags",isVisible:!0},{fieldName:"fileUrl",label:"File URL",isVisible:!0},{fieldName:"fileSize",label:"File Size",isVisible:!0},{fieldName:"mimeType",label:"MIME Type",isVisible:!0},{fieldName:"isPublic",label:"Public",isVisible:!0},{fieldName:"expiryDate",label:"Expiry Date",isVisible:!0},{fieldName:"status",label:"Status",isVisible:!0}]},{tableName:"customFields",displayName:"Custom Fields",category:"configuration",fields:[{fieldName:"entityType",label:"Entity Type",isVisible:!0,isRequired:!0},{fieldName:"fieldName",label:"Field Name",isVisible:!0,isRequired:!0},{fieldName:"fieldType",label:"Field Type",isVisible:!0,isRequired:!0},{fieldName:"fieldOptions",label:"Field Options",isVisible:!0},{fieldName:"isRequired",label:"Required",isVisible:!0},{fieldName:"isActive",label:"Active",isVisible:!0}]},{tableName:"customFieldValues",displayName:"Custom Field Values",category:"configuration",fields:[{fieldName:"entityId",label:"Entity ID",isVisible:!0,isRequired:!0},{fieldName:"value",label:"Value",isVisible:!0}]},{tableName:"auditLogs",displayName:"Audit Logs",category:"system",fields:[{fieldName:"action",label:"Action",isVisible:!0,isRequired:!0},{fieldName:"entityType",label:"Entity Type",isVisible:!0},{fieldName:"entityId",label:"Entity ID",isVisible:!0},{fieldName:"entityName",label:"Entity Name",isVisible:!0},{fieldName:"description",label:"Description",isVisible:!0},{fieldName:"ipAddress",label:"IP Address",isVisible:!0},{fieldName:"userAgent",label:"User Agent",isVisible:!0},{fieldName:"severity",label:"Severity",isVisible:!0},{fieldName:"category",label:"Category",isVisible:!0},{fieldName:"metadata",label:"Metadata",isVisible:!0}]},{tableName:"securityEvents",displayName:"Security Events",category:"system",fields:[{fieldName:"eventType",label:"Event Type",isVisible:!0,isRequired:!0},{fieldName:"source",label:"Source",isVisible:!0},{fieldName:"ipAddress",label:"IP Address",isVisible:!0},{fieldName:"userAgent",label:"User Agent",isVisible:!0},{fieldName:"location",label:"Location",isVisible:!0},{fieldName:"deviceFingerprint",label:"Device Fingerprint",isVisible:!0},{fieldName:"success",label:"Success",isVisible:!0},{fieldName:"failureReason",label:"Failure Reason",isVisible:!0},{fieldName:"riskScore",label:"Risk Score",isVisible:!0},{fieldName:"blocked",label:"Blocked",isVisible:!0},{fieldName:"metadata",label:"Metadata",isVisible:!0}]}];function KS(){var e;const[s,t]=$n.useState(BS),[a,i]=$n.useState(!1),[n,r]=$n.useState(!1),[l,c]=$n.useState(""),[o,d]=$n.useState("all"),u=["all",...Array.from(new Set(BS.map((e=>e.category))))],m=s.filter((e=>{const s=e.displayName.toLowerCase().includes(l.toLowerCase())||e.tableName.toLowerCase().includes(l.toLowerCase()),t="all"===o||e.category===o;return s&&t}));$n.useEffect((()=>{(async()=>{i(!0);try{const e=await fetch("/api/field-visibility");if(!e.ok)throw new Error("Failed to load field visibility configurations");const a=await e.json(),i=s.map((e=>({...e,fields:e.fields.map((s=>{const t=a.find((t=>t.table_name===e.tableName&&t.field_name===s.fieldName&&"form"===t.context));return{...s,isVisible:!t||t.is_visible}}))})));t(i)}catch(e){im.error("Failed to load field visibility configurations")}finally{i(!1)}})()}),[]);const h=e=>e.fields.filter((e=>e.isVisible)).length,x=e=>e.fields.length;return a?Si.jsx(vf,{title:"Field Visibility Manager",subtitle:"Loading configurations...",children:Si.jsx("div",{className:"flex items-center justify-center h-64",children:Si.jsx("div",{className:"text-lg",children:"Loading field visibility configurations..."})})}):Si.jsx(vf,{title:"Field Visibility Manager",subtitle:"Configure which fields are visible in forms",children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs(Nx,{children:[Si.jsx(vl,{className:"h-4 w-4"}),Si.jsx(wx,{children:"Required fields cannot be hidden as they are essential for data integrity. Changes take effect immediately and apply to all users. Use the search and category filters to find specific forms quickly."})]}),Si.jsxs("div",{className:"flex gap-4 items-center",children:[Si.jsx("div",{className:"flex-1",children:Si.jsx(kx,{placeholder:"Search forms...",value:l,onChange:e=>c(e.target.value)})}),Si.jsx("div",{className:"w-48",children:Si.jsx("select",{value:o,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:u.map((e=>Si.jsx("option",{value:e,children:"all"===e?"All Categories":e.charAt(0).toUpperCase()+e.slice(1)},e)))})})]}),Si.jsxs(Mp,{defaultValue:null==(e=m[0])?void 0:e.tableName,className:"w-full",children:[Si.jsx(Vp,{className:"grid w-full grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-1 h-auto",children:m.slice(0,24).map((e=>Si.jsxs(Up,{value:e.tableName,className:"text-xs p-2 flex flex-col items-center",children:[Si.jsx("span",{className:"truncate w-full text-center",children:e.displayName}),Si.jsxs(Sx,{variant:"secondary",className:"mt-1 text-xs",children:[h(e),"/",x(e)]})]},e.tableName)))}),m.map((e=>Si.jsx($p,{value:e.tableName,children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsxs("div",{children:[Si.jsxs(_x,{className:"flex items-center gap-2",children:[e.displayName," Form Fields",Si.jsx(Sx,{variant:"outline",className:"capitalize",children:e.category})]}),Si.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[h(e)," of ",x(e)," fields visible"]})]}),Si.jsx(Ex,{variant:"outline",onClick:()=>(async e=>{r(!0);try{const a=s.find((s=>s.tableName===e));if(!a)return;await Promise.all(a.fields.map((s=>fetch(`/api/field-visibility/${e}/${s.fieldName}?context=form`,{method:"DELETE"})))),t((s=>s.map((s=>s.tableName===e?{...s,fields:s.fields.map((e=>({...e,isVisible:!0})))}:s)))),im.success(`All fields for ${a.displayName} are now visible`)}catch(a){im.error("Failed to reset table configuration")}finally{r(!1)}})(e.tableName),disabled:n,children:"Reset All to Visible"})]})}),Si.jsx(Lx,{children:Si.jsx("div",{className:"space-y-4",children:e.fields.map(((s,a)=>Si.jsxs("div",{children:[Si.jsxs("div",{className:"flex items-center justify-between py-3",children:[Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsxs("div",{className:"flex items-center space-x-2",children:[s.isVisible?Si.jsx(Sl,{className:"h-4 w-4 text-green-600"}):Si.jsx(tc,{className:"h-4 w-4 text-gray-400"}),Si.jsx(Op,{className:"text-sm font-medium",children:s.label})]}),s.isRequired&&Si.jsx(Sx,{variant:"destructive",className:"text-xs",children:"Required"})]}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsx(Op,{htmlFor:`${e.tableName}-${s.fieldName}`,className:"text-sm",children:s.isVisible?"Visible":"Hidden"}),Si.jsx(df,{id:`${e.tableName}-${s.fieldName}`,checked:s.isVisible,disabled:s.isRequired,onCheckedChange:a=>(async(e,s,a)=>{try{if(!(await fetch("/api/field-visibility",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableName:e,fieldName:s,isVisible:a,context:"form"})})).ok)throw new Error("Failed to update field visibility");t((t=>t.map((t=>t.tableName===e?{...t,fields:t.fields.map((e=>e.fieldName===s?{...e,isVisible:a}:e))}:t)))),im.success(`Field visibility updated for ${s}`)}catch(i){im.error("Failed to update field visibility")}})(e.tableName,s.fieldName,a)})]})]}),a<e.fields.length-1&&Si.jsx(Cp,{})]},s.fieldName)))})})]})},e.tableName)))]}),0===m.length&&Si.jsx("div",{className:"text-center py-8",children:Si.jsx("p",{className:"text-muted-foreground",children:"No forms found matching your search criteria."})})]})})}const QS=Wc({contractId:Vc().min(1,"Contract is required"),serviceId:Vc().min(1,"Service is required"),description:Vc().min(1,"Description is required"),deliverables:Vc().min(1,"Deliverables are required"),hoursBudget:Vc().optional(),hourlyRate:Vc().optional(),status:Vc().optional()});function GS(){var e,s;const{toast:t}=sd(),a=dh(),{format:i}=Vh(),[n,r]=$n.useState(""),[l,c]=$n.useState("all"),[o,d]=$n.useState("table"),[u,m]=$n.useState(!1),[h,x]=$n.useState(!1),[p,f]=$n.useState(!1),[g,j]=$n.useState(!1),[v,y]=$n.useState(null),[b,N]=$n.useState("all"),[w,C]=$n.useState("all"),[S,T]=$n.useState(""),[k,D]=$n.useState(""),[E,A]=$n.useState(""),[P,_]=$n.useState(""),[F,L]=$n.useState(""),[I,R]=$n.useState(""),q=function(e,s){const[t,a]=$n.useState(e);return $n.useEffect((()=>{const t=setTimeout((()=>{a(e)}),s);return()=>{clearTimeout(t)}}),[e,s]),t}(n,300),O=$n.useMemo((()=>{const e=new URLSearchParams;return q.trim()&&e.append("q",q.trim()),"all"!==l&&e.append("status",l),"all"!==b&&e.append("serviceTier",b),"all"!==w&&e.append("coverageHours",w),S.trim()&&e.append("epsMin",S.trim()),k.trim()&&e.append("epsMax",k.trim()),E.trim()&&e.append("endpointsMin",E.trim()),P.trim()&&e.append("endpointsMax",P.trim()),F.trim()&&e.append("responseTimeMin",F.trim()),I.trim()&&e.append("responseTimeMax",I.trim()),e.toString()}),[q,l,b,w,S,k,E,P,F,I]),{data:M=[]}=fh({queryKey:["/api/contracts"]}),{data:V=[]}=fh({queryKey:["/api/services"]}),{data:U=[]}=fh({queryKey:["/api/clients"]}),$=O?`/api/service-scopes/search?${O}`:"/api/service-scopes",{data:z=[],isLoading:B}=fh({queryKey:["/api/service-scopes",O],queryFn:async()=>{const e=await fetch($,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch service scopes");const s=await e.json();return s.data||s},staleTime:5e3,gcTime:1e4}),K=Zc({resolver:bv(QS),defaultValues:{contractId:"",serviceId:"",description:"",deliverables:"",hoursBudget:"",hourlyRate:"",status:"planning"}}),Q=Zc({resolver:bv(QS),defaultValues:{contractId:"",serviceId:"",description:"",deliverables:"",hoursBudget:"",hourlyRate:"",status:"planning"}}),G=gh({mutationFn:async e=>(await vh("POST",`/api/contracts/${e.contractId}/service-scopes`,{serviceId:parseInt(e.serviceId),description:e.description,deliverables:e.deliverables.split(",").map((e=>e.trim())),hoursBudget:e.hoursBudget?parseInt(e.hoursBudget):void 0,hourlyRate:e.hourlyRate?parseFloat(e.hourlyRate):void 0,status:e.status||"planning"})).json(),onSuccess:()=>{t({title:"Success",description:"Service scope created successfully"}),a.invalidateQueries({queryKey:["/api/service-scopes"]}),K.reset(),x(!1)},onError:e=>{t({title:"Error",description:e.message||"Failed to create service scope",variant:"destructive"})}}),W=gh({mutationFn:async e=>(await vh("PUT",`/api/contracts/${e.contractId}/service-scopes/${e.id}`,{serviceId:parseInt(e.serviceId),description:e.description,deliverables:e.deliverables.split(",").map((e=>e.trim())),hoursBudget:e.hoursBudget?parseInt(e.hoursBudget):void 0,hourlyRate:e.hourlyRate?parseFloat(e.hourlyRate):void 0,status:e.status||"planning"})).json(),onSuccess:()=>{t({title:"Success",description:"Service scope updated successfully"}),a.invalidateQueries({queryKey:["/api/service-scopes"]}),j(!1),y(null)},onError:e=>{t({title:"Error",description:e.message||"Failed to update service scope",variant:"destructive"})}}),H=$n.useCallback((async e=>{if(confirm("Are you sure you want to delete this service scope?"))try{if(!(await fetch(`/api/service-scopes/${e}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("Failed to delete service scope");t({title:"Success",description:"Service scope deleted successfully"}),a.invalidateQueries({queryKey:["/api/service-scopes"]})}catch(s){t({title:"Error",description:"Failed to delete service scope",variant:"destructive"})}}),[t,a]),Y=$n.useCallback((e=>{y(e),f(!0)}),[]),J=$n.useCallback((e=>{var s,t;y(e);const a=e.description||"",i=e.deliverables||[];let n="";Array.isArray(i)&&(n=i.join(", ")),Q.reset({contractId:e.contractId.toString(),serviceId:e.serviceId.toString(),description:a,deliverables:n,hoursBudget:(null==(s=e.hoursBudget)?void 0:s.toString())||"",hourlyRate:(null==(t=e.hourlyRate)?void 0:t.toString())||"",status:e.status||"planning"}),j(!0)}),[Q]),X=$n.useCallback((e=>{G.mutate(e)}),[G]),Z=$n.useCallback((e=>{v&&W.mutate({...e,id:v.id})}),[v,W]),ee=$n.useCallback((()=>{N("all"),C("all"),T(""),D(""),A(""),_(""),L(""),R("")}),[]),se=$n.useCallback((e=>{const s=U.find((s=>s.id===e));return(null==s?void 0:s.name)||`Client ${e}`}),[U]),te=$n.useCallback((e=>{const s=V.find((s=>s.id===e));return(null==s?void 0:s.name)||`Service ${e}`}),[V]),ae=$n.useCallback((e=>{switch(e){case"active":return Si.jsx(Dl,{className:"h-4 w-4 text-green-600"});case"pending":return Si.jsx(Wr,{className:"h-4 w-4 text-yellow-600"});case"on_hold":return Si.jsx(ol,{className:"h-4 w-4 text-orange-600"});default:return Si.jsx(Gr,{className:"h-4 w-4 text-gray-600"})}}),[]),ie=$n.useCallback((e=>Si.jsx(Sx,{variant:{active:"default",pending:"secondary",completed:"outline",cancelled:"destructive"}[e]||"default",children:e})),[]);return B?Si.jsx(vf,{title:"Service Scopes",subtitle:"Define and manage service delivery scopes for contracts",children:Si.jsx("div",{className:"flex items-center justify-center h-64",children:Si.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):Si.jsxs(vf,{title:"Service Scopes",subtitle:"Define and manage service delivery scopes for contracts",children:[Si.jsx("main",{className:"flex-1 overflow-auto p-6 pt-16 md:pt-6",children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"flex items-center justify-between",children:[Si.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Service Scopes"}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>d("table"===o?"cards":"table"),children:["table"===o?Si.jsx(Ar,{className:"h-4 w-4"}):Si.jsx(jc,{className:"h-4 w-4"}),"table"===o?"Card View":"Table View"]}),Si.jsxs(Sp,{open:h,onOpenChange:x,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"Add Service Scope"]})}),Si.jsxs(Ep,{className:"max-w-2xl",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Create Service Scope"})}),Si.jsx($w,{...K,children:Si.jsxs("form",{onSubmit:K.handleSubmit(X),className:"space-y-4",children:[Si.jsx(Bw,{control:K.control,name:"contractId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Contract"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value,children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a contract"})})}),Si.jsx(Wp,{children:M.map((e=>Si.jsxs(Hp,{value:e.id.toString(),children:[se(e.clientId)," - ",e.name]},e.id)))})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:K.control,name:"serviceId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Service"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value,children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a service"})})}),Si.jsx(Wp,{children:V.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:e.name},e.id)))})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:K.control,name:"description",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Description"}),Si.jsx(Hw,{children:Si.jsx(Yp,{...e,placeholder:"Describe the scope of work"})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:K.control,name:"deliverables",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Deliverables (comma-separated)"}),Si.jsx(Hw,{children:Si.jsx(Yp,{...e,placeholder:"List deliverables separated by commas"})}),Si.jsx(Jw,{})]})}),Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:K.control,name:"hoursBudget",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Hours Budget"}),Si.jsx(Hw,{children:Si.jsx(kx,{...e,type:"number",placeholder:"Total hours"})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:K.control,name:"hourlyRate",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Hourly Rate"}),Si.jsx(Hw,{children:Si.jsx(kx,{...e,type:"number",step:"0.01",placeholder:"Rate per hour"})}),Si.jsx(Jw,{})]})})]}),Si.jsx(Bw,{control:K.control,name:"status",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Status"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value,children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select status"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"planning",children:"Planning"}),Si.jsx(Hp,{value:"active",children:"Active"}),Si.jsx(Hp,{value:"pending",children:"Pending"}),Si.jsx(Hp,{value:"on_hold",children:"On Hold"}),Si.jsx(Hp,{value:"completed",children:"Completed"}),Si.jsx(Hp,{value:"cancelled",children:"Cancelled"})]})]}),Si.jsx(Jw,{})]})}),Si.jsxs("div",{className:"flex justify-end space-x-2",children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:()=>x(!1),children:"Cancel"}),Si.jsx(Ex,{type:"submit",children:"Create Service Scope"})]})]})})]})]})]})]}),Si.jsx(Ax,{children:Si.jsx(Lx,{className:"p-4",children:Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"flex items-center space-x-4",children:[Si.jsxs("div",{className:"relative flex-1",children:[Si.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),Si.jsx(kx,{type:"text",placeholder:"Search service scopes, clients, services...",value:n,onChange:e=>r(e.target.value),className:"pl-10",autoComplete:"off"})]}),Si.jsxs(zp,{value:l,onValueChange:c,children:[Si.jsx(Kp,{className:"w-[180px]",children:Si.jsx(Bp,{placeholder:"Filter by status"})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Status"}),Si.jsx(Hp,{value:"active",children:"Active"}),Si.jsx(Hp,{value:"pending",children:"Pending"}),Si.jsx(Hp,{value:"on_hold",children:"On Hold"}),Si.jsx(Hp,{value:"completed",children:"Completed"}),Si.jsx(Hp,{value:"cancelled",children:"Cancelled"})]})]}),Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:()=>m(!u),children:[Si.jsx(rl,{className:"h-4 w-4 mr-2"}),"Advanced Filters",Si.jsx(Hr,{className:"h-4 w-4 ml-2 transition-transform "+(u?"rotate-180":"")})]})]}),Si.jsx(TC,{open:u,children:Si.jsx(DC,{children:Si.jsx("div",{className:"pt-4 border-t",children:Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Service Tier"}),Si.jsxs(zp,{value:b,onValueChange:N,children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"All Tiers"})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Tiers"}),Si.jsx(Hp,{value:"basic",children:"Basic"}),Si.jsx(Hp,{value:"standard",children:"Standard"}),Si.jsx(Hp,{value:"premium",children:"Premium"}),Si.jsx(Hp,{value:"enterprise",children:"Enterprise"})]})]})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Coverage Hours"}),Si.jsxs(zp,{value:w,onValueChange:C,children:[Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"All Coverage"})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"all",children:"All Coverage"}),Si.jsx(Hp,{value:"8x5",children:"8x5"}),Si.jsx(Hp,{value:"24x5",children:"24x5"}),Si.jsx(Hp,{value:"24x7",children:"24x7"})]})]})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium mb-1 block",children:"EPS Range"}),Si.jsxs("div",{className:"flex space-x-2",children:[Si.jsx(kx,{type:"number",placeholder:"Min",value:S,onChange:e=>T(e.target.value)}),Si.jsx(kx,{type:"number",placeholder:"Max",value:k,onChange:e=>D(e.target.value)})]})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Endpoints Range"}),Si.jsxs("div",{className:"flex space-x-2",children:[Si.jsx(kx,{type:"number",placeholder:"Min",value:E,onChange:e=>A(e.target.value)}),Si.jsx(kx,{type:"number",placeholder:"Max",value:P,onChange:e=>_(e.target.value)})]})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Response Time (min)"}),Si.jsxs("div",{className:"flex space-x-2",children:[Si.jsx(kx,{type:"number",placeholder:"Min",value:F,onChange:e=>L(e.target.value)}),Si.jsx(kx,{type:"number",placeholder:"Max",value:I,onChange:e=>R(e.target.value)})]})]}),Si.jsx("div",{className:"flex items-end",children:Si.jsxs(Ex,{variant:"outline",size:"sm",onClick:ee,className:"w-full",children:[Si.jsx(Tr,{className:"h-4 w-4 mr-2"}),"Clear Filters"]})})]})})})})]})})}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{children:["Service Scopes (",z.length,")"]})}),Si.jsx(Lx,{children:z&&0===z.length?Si.jsx("div",{className:"text-center py-8",children:Si.jsx("p",{className:"text-gray-500",children:"No service scopes found"})}):Si.jsxs(Wj,{children:[Si.jsx(Hj,{children:Si.jsxs(Jj,{children:[Si.jsx(Xj,{children:"Client"}),Si.jsx(Xj,{children:"Service"}),Si.jsx(Xj,{children:"Description"}),Si.jsx(Xj,{children:"Status"}),Si.jsx(Xj,{children:"Timeline"}),Si.jsx(Xj,{className:"w-[100px]",children:"Actions"})]})}),Si.jsx(Yj,{children:z.map((e=>{var s;return Si.jsxs(Jj,{children:[Si.jsx(Zj,{className:"font-medium",children:se((null==(s=e.contract)?void 0:s.clientId)||e.clientId)}),Si.jsx(Zj,{children:te(e.serviceId)}),Si.jsx(Zj,{className:"max-w-xs truncate",children:e.description}),Si.jsx(Zj,{children:ie(e.status)}),Si.jsx(Zj,{children:e.startDate&&e.endDate?Si.jsxs("span",{className:"text-sm text-gray-600",children:[Ru(e.startDate)," - ",Ru(e.endDate)]}):Si.jsx("span",{className:"text-sm text-gray-400",children:"Not set"})}),Si.jsx(Zj,{children:Si.jsxs("div",{className:"flex items-center space-x-1",children:[Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>Y(e),children:Si.jsx(Sl,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>J(e),children:Si.jsx(tl,{className:"h-4 w-4"})}),Si.jsx(Ex,{variant:"ghost",size:"sm",onClick:()=>H(e.id),children:Si.jsx(al,{className:"h-4 w-4"})})]})})]},e.id)}))})]})})]})]})}),Si.jsx(Sp,{open:p,onOpenChange:f,children:Si.jsxs(Ep,{className:"max-w-3xl",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Service Scope Details"})}),v&&Si.jsxs("div",{className:"space-y-4",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-semibold text-sm text-gray-600",children:"Client"}),Si.jsx("p",{children:se((null==(e=v.contract)?void 0:e.clientId)||v.clientId)})]}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-semibold text-sm text-gray-600",children:"Service"}),Si.jsx("p",{children:te(v.serviceId)})]}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-semibold text-sm text-gray-600",children:"Status"}),Si.jsxs("div",{className:"flex items-center space-x-2",children:[ae(v.status),Si.jsx("span",{children:v.status})]})]}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-semibold text-sm text-gray-600",children:"Budget"}),Si.jsxs("p",{children:[v.hoursBudget?`${v.hoursBudget} hours`:"Not set",v.hourlyRate&&` @ ${i(v.hourlyRate)}/hr`]})]})]}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-semibold text-sm text-gray-600",children:"Description"}),Si.jsx("p",{className:"mt-1",children:v.description})]}),Si.jsxs("div",{children:[Si.jsx("h4",{className:"font-semibold text-sm text-gray-600",children:"Deliverables"}),Si.jsx("ul",{className:"mt-1 list-disc list-inside",children:null==(s=v.deliverables)?void 0:s.map(((e,s)=>Si.jsx("li",{children:e},s)))})]})]})]})}),Si.jsx(Sp,{open:g,onOpenChange:j,children:Si.jsxs(Ep,{className:"max-w-2xl",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Edit Service Scope"})}),Si.jsx($w,{...Q,children:Si.jsxs("form",{onSubmit:Q.handleSubmit(Z),className:"space-y-4",children:[Si.jsx(Bw,{control:Q.control,name:"contractId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Contract"}),Si.jsxs(zp,{onValueChange:e.onChange,value:e.value,children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a contract"})})}),Si.jsx(Wp,{children:M.map((e=>Si.jsxs(Hp,{value:e.id.toString(),children:[se(e.clientId)," - ",e.name]},e.id)))})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:Q.control,name:"serviceId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Service"}),Si.jsxs(zp,{onValueChange:e.onChange,value:e.value,children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a service"})})}),Si.jsx(Wp,{children:V.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:e.name},e.id)))})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:Q.control,name:"description",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Description"}),Si.jsx(Hw,{children:Si.jsx(Yp,{...e,placeholder:"Describe the scope of work"})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:Q.control,name:"deliverables",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Deliverables (comma-separated)"}),Si.jsx(Hw,{children:Si.jsx(Yp,{...e,placeholder:"List deliverables separated by commas"})}),Si.jsx(Jw,{})]})}),Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:Q.control,name:"hoursBudget",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Hours Budget"}),Si.jsx(Hw,{children:Si.jsx(kx,{...e,type:"number",placeholder:"Total hours"})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:Q.control,name:"hourlyRate",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Hourly Rate"}),Si.jsx(Hw,{children:Si.jsx(kx,{...e,type:"number",step:"0.01",placeholder:"Rate per hour"})}),Si.jsx(Jw,{})]})})]}),Si.jsx(Bw,{control:Q.control,name:"status",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Status"}),Si.jsxs(zp,{onValueChange:e.onChange,value:e.value,children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select status"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"planning",children:"Planning"}),Si.jsx(Hp,{value:"active",children:"Active"}),Si.jsx(Hp,{value:"pending",children:"Pending"}),Si.jsx(Hp,{value:"on_hold",children:"On Hold"}),Si.jsx(Hp,{value:"completed",children:"Completed"}),Si.jsx(Hp,{value:"cancelled",children:"Cancelled"})]})]}),Si.jsx(Jw,{})]})}),Si.jsxs("div",{className:"flex justify-end space-x-2",children:[Si.jsx(Ex,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),Si.jsx(Ex,{type:"submit",children:"Update Service Scope"})]})]})})]})})]})}const WS=Wc({contractId:Vc().min(1,"Contract is required"),type:eo(["technical","financial"],{required_error:"Please select a proposal type"}),notes:Vc().min(1,"Notes are required"),status:Vc().default("draft"),documentUrl:Vc().optional(),proposedValue:Vc().optional()}).refine((e=>{if("financial"===e.type){if(!e.proposedValue||parseFloat(e.proposedValue)<=0)return!1;if(e.notes.trim().length<50)return!1}return!0}),{message:"Financial proposals require a valid proposed value > 0 and detailed notes (minimum 50 characters)",path:["type"]});function HS(){const{user:e}=Ah(),[s,t]=$n.useState(!1),[a,i]=$n.useState(null),[n,r]=$n.useState(!1),[l,c]=$n.useState(null),[o,d]=$n.useState(!1),[u,m]=$n.useState(!1),{toast:h}=sd(),x=dh(),p=Zc({resolver:bv(WS),defaultValues:{contractId:"",type:"technical",notes:"",status:"draft",documentUrl:"",proposedValue:""}}),{data:f=[],isLoading:g}=fh({queryKey:["/api/proposals"],enabled:!!e}),{data:j=[],isLoading:v}=fh({queryKey:["/api/contracts"],enabled:!!e}),{data:y=[],isLoading:b}=fh({queryKey:["/api/clients"],enabled:!!e}),N=gh({mutationFn:async e=>(await vh("POST",`/api/contracts/${e.contractId}/proposals`,{type:e.type,notes:e.notes,status:e.status,documentUrl:(null==a?void 0:a.url)||e.documentUrl||null,proposedValue:e.proposedValue?parseFloat(e.proposedValue):null})).json(),onSuccess:()=>{h({title:"Success",description:"Proposal created successfully"}),x.invalidateQueries({queryKey:["/api/proposals"]}),p.reset(),i(null),r(!1)},onError:e=>{h({title:"Error",description:e.message||"Failed to create proposal",variant:"destructive"})}}),w=gh({mutationFn:async e=>(await vh("PUT",`/api/proposals/${e.id}`,{type:e.type,notes:e.notes,status:e.status,documentUrl:(null==a?void 0:a.url)||e.documentUrl||null,proposedValue:e.proposedValue?parseFloat(e.proposedValue):null})).json(),onSuccess:()=>{h({title:"Success",description:"Proposal updated successfully"}),x.invalidateQueries({queryKey:["/api/proposals"]}),p.reset(),i(null),m(!1),c(null)},onError:e=>{h({title:"Error",description:e.message||"Failed to update proposal",variant:"destructive"})}});if(!e||g||v||b)return Si.jsx(vf,{title:"Proposals",subtitle:"Manage service proposals and contract agreements",children:Si.jsx("div",{className:"flex items-center justify-center h-64",children:Si.jsxs("div",{className:"text-center",children:[Si.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"}),Si.jsx("p",{className:"mt-4 text-muted-foreground",children:"Loading proposals..."})]})})});const C=e=>{const s=j.find((s=>s.id===e));return(null==s?void 0:s.name)||"Unknown Contract"},S=e=>{const s=y.find((s=>s.id===e));return(null==s?void 0:s.name)||"Unknown Client"},T=e=>{const s=j.find((s=>s.id===e));return null==s?void 0:s.clientId};return Si.jsxs(vf,{title:"Proposals",subtitle:"Manage service proposals and contract agreements",children:[Si.jsx("main",{className:"flex-1 overflow-auto p-6",children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[Si.jsx("div",{className:"flex items-center space-x-4",children:Si.jsxs("div",{className:"relative",children:[Si.jsx(Xr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),Si.jsx(kx,{placeholder:"Search proposals...",className:"pl-10 w-64"})]})}),Si.jsxs(Sp,{open:n,onOpenChange:r,children:[Si.jsx(Tp,{asChild:!0,children:Si.jsxs(Ex,{children:[Si.jsx(nl,{className:"h-4 w-4 mr-2"}),"New Proposal"]})}),Si.jsxs(Ep,{className:"max-w-3xl max-h-[90vh] flex flex-col",children:[Si.jsx(Ap,{className:"flex-shrink-0",children:Si.jsx(_p,{children:u?"Edit Proposal":"Create New Proposal"})}),Si.jsx("div",{className:"flex-1 overflow-y-auto pr-2 -mr-2",children:Si.jsx($w,{...p,children:Si.jsxs("form",{onSubmit:p.handleSubmit((e=>{l&&u?w.mutate({id:l.id,...e}):N.mutate(e)})),className:"space-y-6",children:[Si.jsx(Bw,{control:p.control,name:"contractId",render:({field:e})=>{var s,t,a,i,n;return Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Contract"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a contract"})})}),Si.jsx(Wp,{children:j.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:Si.jsxs("div",{className:"flex flex-col",children:[Si.jsx("span",{className:"font-medium",children:e.name}),Si.jsxs("span",{className:"text-xs text-gray-500",children:["Client: ",S(e.clientId)," | Status: ",e.status]}),Si.jsxs("span",{className:"text-xs text-blue-600",children:["Value: ",e.totalValue?qu(e.totalValue.toString()):"N/A"]})]})},e.id)))})]}),Si.jsx(Jw,{}),e.value&&Si.jsxs("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded text-sm",children:[Si.jsx("div",{className:"font-medium text-blue-900 mb-1",children:"Contract & Client Relationship"}),Si.jsxs("div",{className:"space-y-1 text-xs",children:[Si.jsxs("div",{children:[Si.jsx("strong",{children:"Contract:"})," ",null==(s=j.find((s=>s.id.toString()===e.value)))?void 0:s.name]}),Si.jsxs("div",{children:[Si.jsx("strong",{children:"Client:"})," ",S((null==(t=j.find((s=>s.id.toString()===e.value)))?void 0:t.clientId)||0)]}),Si.jsxs("div",{children:[Si.jsx("strong",{children:"Contract Value:"})," ",(null==(a=j.find((s=>s.id.toString()===e.value)))?void 0:a.totalValue)?qu((null==(n=null==(i=j.find((s=>s.id.toString()===e.value)))?void 0:i.totalValue)?void 0:n.toString())||"0"):"N/A"]})]}),Si.jsx("div",{className:"mt-2 text-blue-700 font-medium",children:"⚠️ This proposal will be permanently associated with this client only and cannot be transferred to another client."})]})]})}}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[Si.jsx(Bw,{control:p.control,name:"type",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Proposal Type"}),Si.jsxs(zp,{onValueChange:e.onChange,defaultValue:e.value,children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a proposal type"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"technical",children:"Technical"}),Si.jsx(Hp,{value:"financial",children:"Financial"})]})]}),Si.jsx(Jw,{})]})}),"financial"===p.watch("type")&&Si.jsx(Bw,{control:p.control,name:"proposedValue",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Proposed Value ($)"}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"number",step:"0.01",min:"0",placeholder:"0.00",...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]}),Si.jsx(Bw,{control:p.control,name:"notes",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Notes"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Add detailed notes for the proposal...",rows:5,...e})}),Si.jsx(Jw,{})]})}),Si.jsxs("div",{children:[Si.jsx(Ww,{children:"Attach Document (Optional)"}),Si.jsx("div",{className:"mt-2",children:a?Si.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[Si.jsxs("div",{className:"flex items-center space-x-3",children:[Si.jsx(Kr,{className:"h-5 w-5 text-muted-foreground"}),Si.jsxs("div",{className:"text-sm",children:[Si.jsx("p",{className:"font-medium",children:a.name}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:(e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]})(a.size)})]})]}),Si.jsx(Ex,{variant:"ghost",size:"icon",onClick:()=>{i(null),p.setValue("documentUrl","")},children:Si.jsx(Tr,{className:"h-4 w-4"})})]}):Si.jsx("div",{className:"flex items-center justify-center w-full",children:Si.jsxs("label",{htmlFor:"file-upload",className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer bg-muted/50 hover:bg-muted",children:[Si.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[Si.jsx(Lr,{className:"w-8 h-8 mb-4 text-muted-foreground"}),Si.jsxs("p",{className:"mb-2 text-sm text-muted-foreground",children:[Si.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:"PDF, DOC, XLS, PPT, TXT (MAX. 10MB)"})]}),Si.jsx("input",{id:"file-upload",type:"file",className:"hidden",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];if(a){if(a.size>10485760)return void h({title:"Error",description:"File size must be less than 10MB",variant:"destructive"});if(!["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain"].includes(a.type))return void h({title:"Error",description:"Only PDF, Word, Excel, PowerPoint, and text files are allowed",variant:"destructive"});(async e=>{t(!0);try{const s=new FormData;s.append("file",e);const t=p.watch("contractId"),a=T(parseInt(t)),n=p.watch("type");t&&s.append("contractId",t),a&&s.append("clientId",a.toString());const r=a?S(a):"client",l=t?C(parseInt(t)):"contract";s.append("name",`${e.name} - ${n||"Proposal"} Document`),s.append("description",`${n||"Proposal"} document for ${r} - ${l}`);const c=await fetch("/api/upload/proposal-document",{method:"POST",body:s,credentials:"include"});if(!c.ok){const e=await c.json();throw new Error(e.message||"Upload failed")}const o=await c.json();i({name:o.fileName,url:o.fileUrl,size:o.fileSize}),p.setValue("documentUrl",o.fileUrl),h({title:"Success",description:"Proposal document uploaded successfully"})}catch(s){h({title:"Error",description:s.message||"Failed to upload document",variant:"destructive"})}finally{t(!1)}})(a)}}})]})})})]}),Si.jsx("div",{className:"flex justify-end pt-4",children:Si.jsx(Ex,{type:"submit",disabled:N.isPending||w.isPending,children:N.isPending||w.isPending?"Saving...":u?"Update Proposal":"Create Proposal"})})]})})})]})]})]}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Total Proposals"}),Si.jsx(Kr,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:f.length}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:"Active service proposals"})]})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Pending Review"}),Si.jsx(Wr,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:f.filter((e=>"pending"===e.status)).length}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting client approval"})]})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Approved"}),Si.jsx(Dl,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:f.filter((e=>"approved"===e.status)).length}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:"Approved proposals"})]})]}),Si.jsxs(Ax,{children:[Si.jsxs(Px,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[Si.jsx(_x,{className:"text-sm font-medium",children:"Total Value"}),Si.jsx(Ur,{className:"h-4 w-4 text-muted-foreground"})]}),Si.jsxs(Lx,{children:[Si.jsx("div",{className:"text-2xl font-bold",children:qu(f.filter((e=>e.proposedValue)).reduce(((e,s)=>e+parseFloat(s.proposedValue||"0")),0).toString())}),Si.jsx("p",{className:"text-xs text-muted-foreground",children:"Combined proposal value"})]})]})]}),0===f.length?Si.jsxs("div",{className:"text-center py-16 border-2 border-dashed rounded-lg",children:[Si.jsx(Kr,{className:"mx-auto h-12 w-12 text-gray-400"}),Si.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No proposals found"}),Si.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by creating a new proposal."})]}):Si.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:f.map((e=>{const s=j.find((s=>s.id===e.contractId)),t=y.find((e=>e.id===(null==s?void 0:s.clientId))),a=GC(e.status);return Si.jsxs(Ax,{className:"flex flex-col",children:[Si.jsx(Px,{className:"pb-4",children:Si.jsxs("div",{className:"flex justify-between items-start",children:[Si.jsxs("div",{children:[Si.jsx(_x,{className:"text-lg mb-1",children:(null==s?void 0:s.name)||"Unknown Contract"}),Si.jsx("p",{className:"text-sm text-muted-foreground",children:(null==t?void 0:t.name)||"Unknown Client"})]}),Si.jsxs(Sx,{variant:WC(e.status),className:"capitalize",children:[Si.jsx(a,{className:"h-3 w-3 mr-1"}),e.status]})]})}),Si.jsxs(Lx,{className:"flex-grow space-y-3",children:[Si.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[Si.jsx(Kr,{className:"h-4 w-4 mr-2"}),Si.jsxs("span",{className:"capitalize",children:[e.type," Proposal"]})]}),e.proposedValue&&Si.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[Si.jsx(Ur,{className:"h-4 w-4 mr-2"}),Si.jsx("span",{children:qu(e.proposedValue)})]}),Si.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[Si.jsx(jl,{className:"h-4 w-4 mr-2"}),Si.jsxs("span",{children:["Created: ",Ru(e.createdAt)]})]}),Si.jsx("div",{className:"pt-2 text-xs text-muted-foreground truncate",children:e.notes})]}),Si.jsx("div",{className:"p-4 pt-0 mt-auto",children:Si.jsxs(Ex,{variant:"outline",className:"w-full",onClick:()=>(e=>{c(e),d(!0)})(e),children:[Si.jsx(Sl,{className:"h-4 w-4 mr-2"}),"View Details"]})})]},e.id)}))})]})}),Si.jsx(Sp,{open:o,onOpenChange:d,children:Si.jsxs(Ep,{className:"max-w-2xl",children:[Si.jsx(Ap,{children:Si.jsx(_p,{children:"Proposal Details"})}),l&&Si.jsxs("div",{className:"space-y-4 pt-4",children:[Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[Si.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Client"}),Si.jsx("p",{children:S(T(l.contractId)||0)})]}),Si.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[Si.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Contract"}),Si.jsx("p",{children:C(l.contractId)})]})]}),Si.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Si.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[Si.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),Si.jsx("div",{className:"mt-1",children:Si.jsxs(Sx,{variant:WC(l.status),className:"text-sm capitalize",children:[(()=>{const e=GC(l.status);return Si.jsx(e,{className:"h-4 w-4 mr-2"})})(),l.status]})})]}),Si.jsxs("div",{className:"col-span-2 sm:col-span-1",children:[Si.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Type"}),Si.jsx("div",{className:"mt-1",children:Si.jsxs(Sx,{variant:"financial"===l.type?"secondary":"outline",className:"text-sm",children:["financial"===l.type?Si.jsx(Ur,{className:"h-4 w-4 mr-2"}):Si.jsx(Kr,{className:"h-4 w-4 mr-2"}),Si.jsx("span",{className:"capitalize",children:l.type})]})})]})]}),l.proposedValue&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Proposed Value"}),Si.jsx("p",{className:"text-lg font-semibold text-green-600",children:qu(l.proposedValue)})]}),l.documentUrl&&Si.jsxs("div",{children:[Si.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Document"}),Si.jsx(Ex,{variant:"link",className:"p-0 h-auto",asChild:!0,children:Si.jsx("a",{href:l.documentUrl,target:"_blank",rel:"noopener noreferrer",children:"View Document"})})]}),Si.jsxs("div",{className:"col-span-2 text-sm",children:[Si.jsx("p",{className:"font-medium text-muted-foreground",children:"Notes"}),Si.jsx("div",{className:"mt-1 p-3 bg-muted/50 rounded-lg whitespace-pre-wrap",children:l.notes})]})]})]})})]})}function YS(){return Si.jsx(vf,{children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{children:[Si.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Widget Manager"}),Si.jsx("p",{className:"text-muted-foreground",children:"Advanced widget configuration and management for the platform"})]}),Si.jsx(ZC,{})]})})}function JS(){return Si.jsx(vf,{children:Si.jsxs("div",{className:"space-y-6",children:[Si.jsxs("div",{children:[Si.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Global Widgets"}),Si.jsx("p",{className:"text-muted-foreground",children:"Create and manage widgets that can be deployed globally to all client pages"})]}),Si.jsx(ZC,{})]})})}function XS(){const{user:e}=Ah();Oo();const[s,t]=$n.useState(!1),[a,i]=$n.useState(!1);sd();const{cards:n}=rv(),{data:r=[]}=fh({queryKey:["/api/clients"]}),{data:l=[]}=fh({queryKey:["/api/contracts"]}),{data:c=[]}=fh({queryKey:["/api/financial-transactions"]}),o=(r||[]).slice(0,5),d=(c||[]).slice(0,5),u=e=>{switch(e.toLowerCase()){case"active":case"prospect":default:return"default";case"inactive":return"destructive"}},m=n.filter((e=>e.visible)).sort(((e,s)=>e.position-s.position));return Si.jsx(vf,{title:"Dashboard",subtitle:"Welcome to your MSSP management platform",children:Si.jsxs("div",{className:"p-4 sm:p-6 space-y-6 sm:space-y-8",children:[m.length>0&&Si.jsx("div",{className:(h=m.length,1===h?"grid grid-cols-1 max-w-sm mx-auto":2===h?"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-2xl mx-auto":3===h?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4":4===h?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4":h<=6?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4":"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4")+" mb-6 sm:mb-8",children:m.map((e=>Si.jsx(iv,{card:e,onClick:()=>(e=>{const s={clients:"/clients",contracts:"/contracts",users:"/admin/team",license_pools:"/license-pools",hardware_assets:"/hardware-assets",services:"/admin/services",tasks:"/tasks"}[e.dataSource];s&&(window.location.href=s)})(e)},e.id)))}),0===m.length&&Si.jsx(Ax,{className:"border-dashed border-2 border-gray-300 mb-6 sm:mb-8",children:Si.jsxs(Lx,{className:"flex flex-col items-center justify-center py-8 sm:py-12 px-4",children:[Si.jsx(yl,{className:"w-10 h-10 sm:w-12 sm:h-12 text-gray-400 mb-4"}),Si.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2 text-center",children:"No Dashboard Cards"}),Si.jsx("p",{className:"text-gray-600 text-center mb-6 max-w-md text-sm sm:text-base",children:'Your dashboard is empty. Click "Customize Dashboard" to add cards and metrics to track your business performance.'}),Si.jsxs(Ex,{onClick:()=>t(!0),className:"w-full sm:w-auto",children:[Si.jsx(Mr,{className:"w-4 h-4 mr-2"}),"Customize Dashboard"]})]})}),Si.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center text-base sm:text-lg",children:[Si.jsx(Qr,{className:"h-5 w-5 mr-2"}),"Recent Clients"]})}),Si.jsx(Lx,{children:o.length>0?Si.jsx("div",{className:"space-y-3 sm:space-y-4",children:o.map((e=>Si.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[Si.jsxs("div",{className:"min-w-0 flex-1",children:[Si.jsx("p",{className:"font-medium text-sm sm:text-base truncate",children:e.name}),Si.jsx("p",{className:"text-xs sm:text-sm text-gray-600 truncate",children:e.industry})]}),Si.jsx("div",{className:"ml-3 flex-shrink-0",children:Si.jsx(Sx,{variant:u(e.status),className:"text-xs",children:e.status})})]},e.id)))}):Si.jsx("div",{className:"text-center text-gray-500 py-6 sm:py-8",children:Si.jsx("p",{className:"text-sm sm:text-base",children:"No clients found. Add your first client to get started."})})})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center text-base sm:text-lg",children:[Si.jsx(Ur,{className:"h-5 w-5 mr-2"}),"Recent Transactions"]})}),Si.jsx(Lx,{children:d.length>0?Si.jsx("div",{className:"space-y-3 sm:space-y-4",children:d.map((e=>Si.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[Si.jsxs("div",{className:"min-w-0 flex-1",children:[Si.jsx("p",{className:"font-medium text-sm sm:text-base truncate",children:e.description}),Si.jsx("p",{className:"text-xs sm:text-sm text-gray-600",children:new Date(e.transactionDate).toLocaleDateString()})]}),Si.jsx("div",{className:"ml-3 flex-shrink-0",children:Si.jsxs("span",{className:"font-medium text-sm sm:text-base "+("income"===e.type?"text-green-600":"text-red-600"),children:["income"===e.type?"+":"-","$",Math.abs(e.amount).toLocaleString()]})})]},e.id)))}):Si.jsx("div",{className:"text-center text-gray-500 py-6 sm:py-8",children:Si.jsx("p",{className:"text-sm sm:text-base",children:"No recent transactions found."})})})]})]})]})});var h}function ZS(){const[e,s]=$n.useState(""),[t,a]=$n.useState([]),[i,n]=$n.useState(EC.CLIENT),[r,l]=$n.useState(1),{searchEntities:c,useEntitySearch:o,navigateToEntity:d,createEntityReference:u}=((e={})=>{const[s,t]=Oo(),a=dh(),{prefetchRelated:i=!0,cacheTime:n=3e5}=e,r=$n.useCallback((e=>{t(e.url)}),[t]),l=$n.useCallback(((e,s)=>{const a=IC(e,s);t(a)}),[t]),c=$n.useCallback((()=>{const e=s.split("/").filter(Boolean);if(e.length<2)return null;const t={clients:EC.CLIENT,contracts:EC.CONTRACT,"service-scopes":EC.SERVICE_SCOPE,assets:EC.ASSET,safs:EC.SAF,cocs:EC.COC,proposals:EC.PROPOSAL,documents:EC.DOCUMENT,transactions:EC.FINANCIAL_TRANSACTION,"license-pools":EC.LICENSE_POOL,services:EC.SERVICE,users:EC.USER,"audit-logs":EC.AUDIT_LOG}[e[0]],a=parseInt(e[1]);return t&&!isNaN(a)?{type:t,id:a}:null}),[s]),o=$n.useCallback((async(e,s)=>{try{const t=await fetch(`/api/entities/${e}/${s}`);if(!t.ok){if(404===t.status)return null;throw new Error(`Failed to fetch entity: ${t.statusText}`)}return t.json()}catch(t){throw t}}),[]),d=$n.useCallback(((e,s)=>fh({queryKey:["entity",e,s],queryFn:()=>o(e,s),staleTime:n,retry:(e,s)=>{var t;return!(null==(t=null==s?void 0:s.message)?void 0:t.includes("404"))&&e<3}})),[o,n]),u=$n.useCallback(((e,s,t={})=>fh({queryKey:["entity-relationships",e,s,t],queryFn:async()=>{var a,i;const n=new URLSearchParams;(null==(a=t.includeTypes)?void 0:a.length)&&n.append("includeTypes",t.includeTypes.join(",")),(null==(i=t.excludeTypes)?void 0:i.length)&&n.append("excludeTypes",t.excludeTypes.join(",")),t.limit&&n.append("limit",t.limit.toString());const r=n.toString(),l=`/api/entities/${e}/${s}/relationships${r?`?${r}`:""}`,c=await fetch(l);if(!c.ok)throw new Error(`Failed to fetch relationships: ${c.statusText}`);return c.json()},staleTime:n,enabled:!isNaN(s)&&s>0})),[n]),m=$n.useCallback((async(e,s,t,a)=>{try{const i=new URLSearchParams;a&&i.append("relationshipType",a);const n=i.toString(),r=`/api/entities/${e}/${s}/related/${t}${n?`?${n}`:""}`,l=await fetch(r);if(!l.ok)throw new Error(`Failed to fetch related entities: ${l.statusText}`);return l.json()}catch(i){throw i}}),[]),h=$n.useCallback((async e=>{var s,t;try{const a=new URLSearchParams;e.query&&a.append("query",e.query),(null==(s=e.entityTypes)?void 0:s.length)&&a.append("entityTypes",e.entityTypes.join(",")),(null==(t=e.relationshipTypes)?void 0:t.length)&&a.append("relationshipTypes",e.relationshipTypes.join(",")),e.limit&&a.append("limit",e.limit.toString()),e.offset&&a.append("offset",e.offset.toString());const i=await fetch(`/api/entities/search?${a.toString()}`);if(!i.ok)throw new Error(`Search failed: ${i.statusText}`);return i.json()}catch(a){throw a}}),[]),x=$n.useCallback((e=>{var s;return fh({queryKey:["entity-search",e],queryFn:()=>h(e),staleTime:3e4,enabled:!(!e.query&&!(null==(s=e.entityTypes)?void 0:s.length)),keepPreviousData:!0})}),[h]),p=$n.useCallback(((e,s,t)=>{const a=LC(e);return{id:s,type:e,name:t[a.primaryField]||`${a.displayName} ${s}`,url:IC(e,s),status:a.statusField?t[a.statusField]:void 0,icon:a.icon,metadata:{secondaryText:a.secondaryField?t[a.secondaryField]:void 0,...t}}}),[]),f=$n.useCallback((e=>LC(e).displayName),[]),g=$n.useCallback(((e,s)=>{e&&s?(a.invalidateQueries({queryKey:["entity",e,s]}),a.invalidateQueries({queryKey:["entity-relationships",e,s]})):e?(a.invalidateQueries({queryKey:["entity",e]}),a.invalidateQueries({queryKey:["entity-relationships",e]})):(a.invalidateQueries({queryKey:["entity"]}),a.invalidateQueries({queryKey:["entity-relationships"]}),a.invalidateQueries({queryKey:["entity-search"]}))}),[a]),j=c();return Bn.useEffect((()=>{i&&j&&a.prefetchQuery({queryKey:["entity-relationships",j.type,j.id],queryFn:async()=>(await fetch(`/api/entities/${j.type}/${j.id}/relationships`)).json(),staleTime:n})}),[j,i,a,n]),$n.useMemo((()=>({navigateToEntity:r,navigateToEntityByTypeAndId:l,getCurrentEntity:c,getEntity:o,useEntity:d,useEntityRelationships:u,getRelatedEntities:m,searchEntities:h,useEntitySearch:x,createEntityReference:p,getEntityDisplayName:f,invalidateEntityCache:g})),[r,l,c,o,d,u,m,h,x,p,f,g])})(),m={query:e,entityTypes:t.length>0?t:void 0,limit:10},{data:h}=o(m),x=[{id:1,type:EC.CLIENT,name:"Acme Corporation",url:"/clients/1",status:"active",icon:"Building",metadata:{secondaryText:"Technology Company",industry:"Technology"}},{id:2,type:EC.CONTRACT,name:"Enterprise Support Agreement",url:"/contracts/2",status:"active",icon:"FileText",metadata:{secondaryText:"$50,000/year",totalValue:5e4}},{id:3,type:EC.ASSET,name:"Dell PowerEdge R750",url:"/assets/3",status:"deployed",icon:"Monitor",metadata:{secondaryText:"Production Server",model:"PowerEdge R750"}},{id:4,type:EC.SAF,name:"SAF-2024-001",url:"/safs/4",status:"approved",icon:"Shield",metadata:{secondaryText:"Security Authorization",safNumber:"SAF-2024-001"}}];return Si.jsx(vf,{title:"Entity Navigation Demo",children:Si.jsxs("div",{className:"space-y-8",children:[Si.jsxs("div",{className:"text-center",children:[Si.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Entity Relational Navigation"}),Si.jsx("p",{className:"text-lg text-muted-foreground mt-2",children:"Experience Jira-style internal linking and relationship management"}),Si.jsxs("div",{className:"flex items-center justify-center gap-6 mt-6 text-sm text-muted-foreground",children:[Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx(vc,{className:"h-4 w-4"}),Si.jsx("span",{children:"Bidirectional Relationships"})]}),Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx(Kl,{className:"h-4 w-4"}),Si.jsx("span",{children:"Smart Entity Linking"})]}),Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx(Xr,{className:"h-4 w-4"}),Si.jsx("span",{children:"Global Entity Search"})]}),Si.jsxs("div",{className:"flex items-center gap-2",children:[Si.jsx(yc,{className:"h-4 w-4"}),Si.jsx("span",{children:"Clean URL Navigation"})]})]})]}),Si.jsxs(Mp,{defaultValue:"entity-links",className:"space-y-6",children:[Si.jsxs(Vp,{className:"grid w-full grid-cols-5",children:[Si.jsx(Up,{value:"entity-links",children:"Entity Links"}),Si.jsx(Up,{value:"relationships",children:"Relationships"}),Si.jsx(Up,{value:"search",children:"Entity Search"}),Si.jsx(Up,{value:"navigation",children:"Navigation"}),Si.jsx(Up,{value:"system-info",children:"System Info"})]}),Si.jsx($p,{value:"entity-links",className:"space-y-6",children:Si.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(Kl,{className:"h-5 w-5"}),"Entity Link Variants"]})}),Si.jsxs(Lx,{className:"space-y-6",children:[Si.jsxs("div",{className:"space-y-3",children:[Si.jsx("h4",{className:"font-medium text-sm",children:"Default Style"}),x.map((e=>Si.jsx(VC,{entity:e,variant:"default"},e.id)))]}),Si.jsx(Cp,{}),Si.jsxs("div",{className:"space-y-3",children:[Si.jsx("h4",{className:"font-medium text-sm",children:"Compact Style"}),Si.jsx("div",{className:"space-y-1",children:x.map((e=>Si.jsx(VC,{entity:e,variant:"compact"},e.id)))})]}),Si.jsx(Cp,{}),Si.jsxs("div",{className:"space-y-3",children:[Si.jsx("h4",{className:"font-medium text-sm",children:"Card Style"}),x.slice(0,2).map((e=>Si.jsx(VC,{entity:e,variant:"card"},e.id)))]})]})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(yc,{className:"h-5 w-5"}),"Inline References"]})}),Si.jsx(Lx,{className:"space-y-4",children:Si.jsxs("div",{className:"prose prose-sm max-w-none",children:[Si.jsxs("p",{children:["The ",Si.jsx(VC,{entity:x[0],variant:"inline"})," has an active"," ",Si.jsx(VC,{entity:x[1],variant:"inline"})," that includes"," ","managed ",Si.jsx(VC,{entity:x[2],variant:"inline"})," resources."]}),Si.jsxs("p",{className:"mt-4",children:["Security compliance is managed through"," ",Si.jsx(VC,{entity:x[3],variant:"inline"})," which authorizes all service activities and hardware deployments."]}),Si.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[Si.jsx("h5",{className:"font-medium mb-2",children:"Key Features:"}),Si.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm",children:[Si.jsx("li",{children:"Hover tooltips with entity details"}),Si.jsx("li",{children:"Status badges and icons"}),Si.jsx("li",{children:"Clean URL navigation"}),Si.jsx("li",{children:"Contextual secondary information"})]})]})]})})]})]})}),Si.jsx($p,{value:"relationships",className:"space-y-6",children:Si.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[Si.jsxs(Ax,{className:"lg:col-span-1",children:[Si.jsx(Px,{children:Si.jsx(_x,{className:"text-base",children:"Demo Controls"})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium",children:"Entity Type"}),Si.jsx("select",{value:i,onChange:e=>n(e.target.value),className:"w-full mt-1 p-2 border rounded-md",children:Object.values(EC).map((e=>Si.jsx("option",{value:e,children:PC[e].displayName},e)))})]}),Si.jsxs("div",{children:[Si.jsx("label",{className:"text-sm font-medium",children:"Entity ID"}),Si.jsx(kx,{type:"number",value:r,onChange:e=>l(parseInt(e.target.value)||1),className:"mt-1"})]}),Si.jsx("div",{className:"pt-2",children:Si.jsx("p",{className:"text-xs text-muted-foreground",children:"Adjust the entity type and ID to explore different relationship patterns."})})]})]}),Si.jsx("div",{className:"lg:col-span-2",children:Si.jsx(KC,{entityType:i,entityId:r,variant:"full",showSearch:!0,showStats:!0,maxItemsPerGroup:5})})]})}),Si.jsx($p,{value:"search",className:"space-y-6",children:Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(Xr,{className:"h-5 w-5"}),"Global Entity Search"]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsxs("div",{className:"flex gap-4",children:[Si.jsx("div",{className:"flex-1",children:Si.jsx(kx,{placeholder:"Search entities...",value:e,onChange:e=>s(e.target.value)})}),Si.jsx(Ex,{variant:"outline",children:Si.jsx(Xr,{className:"h-4 w-4"})})]}),Si.jsx("div",{className:"flex flex-wrap gap-2",children:Object.values(EC).map((e=>Si.jsx(Sx,{variant:t.includes(e)?"default":"outline",className:"cursor-pointer",onClick:()=>{a((s=>s.includes(e)?s.filter((s=>s!==e)):[...s,e]))},children:PC[e].displayName},e)))}),h&&Si.jsxs("div",{className:"border rounded-lg p-4",children:[Si.jsxs("h4",{className:"font-medium mb-3",children:["Search Results (",h.total," found)"]}),Si.jsx(UC,{entities:h.entities,variant:"default",emptyMessage:"No entities match your search criteria"}),h.hasMore&&Si.jsx(Ex,{variant:"outline",className:"w-full mt-3",children:"Load More Results"})]})]})]})}),Si.jsx($p,{value:"navigation",className:"space-y-6",children:Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(bc,{className:"h-5 w-5"}),"URL Structure"]})}),Si.jsx(Lx,{className:"space-y-4",children:Si.jsx("div",{className:"space-y-3",children:Object.values(EC).map((e=>{const s=PC[e];return Si.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[Si.jsx("span",{className:"font-medium",children:s.displayName}),Si.jsxs("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:[s.urlPath,"/:id"]})]},e)}))})})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(ql,{className:"h-5 w-5"}),"Navigation Examples"]})}),Si.jsxs(Lx,{className:"space-y-4",children:[Si.jsx("div",{className:"space-y-3",children:x.map((e=>Si.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[Si.jsx("div",{className:"flex items-center gap-3",children:Si.jsx(VC,{entity:e,variant:"compact",showTooltip:!1})}),Si.jsx(Ex,{size:"sm",variant:"outline",onClick:()=>d(e),children:Si.jsx(ll,{className:"h-3 w-3"})})]},e.id)))}),Si.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[Si.jsx("h5",{className:"font-medium mb-2",children:"Navigation Features:"}),Si.jsxs("ul",{className:"text-sm space-y-1",children:[Si.jsx("li",{children:"• Clean, RESTful URLs"}),Si.jsx("li",{children:"• Browser history support"}),Si.jsx("li",{children:"• Programmatic navigation"}),Si.jsx("li",{children:"• Deep linking support"})]})]})]})]})]})}),Si.jsx($p,{value:"system-info",className:"space-y-6",children:Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(kl,{className:"h-5 w-5"}),"Supported Entity Types"]})}),Si.jsx(Lx,{children:Si.jsx(jp,{className:"h-96",children:Si.jsx("div",{className:"space-y-3",children:Object.values(EC).map((e=>{const s=PC[e];return Si.jsxs("div",{className:"p-3 border rounded-lg",children:[Si.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[Si.jsx(Sx,{variant:"outline",children:s.icon}),Si.jsx("h4",{className:"font-medium",children:s.displayName})]}),Si.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["URL: ",s.urlPath]}),Si.jsxs("div",{className:"text-xs space-y-1",children:[Si.jsxs("div",{children:[Si.jsx("strong",{children:"Searchable:"})," ",s.searchableFields.join(", ")]}),Si.jsxs("div",{children:[Si.jsx("strong",{children:"Sortable:"})," ",s.sortableFields.join(", ")]})]})]},e)}))})})})]}),Si.jsxs(Ax,{children:[Si.jsx(Px,{children:Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(vc,{className:"h-5 w-5"}),"Relationship Types"]})}),Si.jsx(Lx,{children:Si.jsx(jp,{className:"h-96",children:Si.jsx("div",{className:"space-y-2",children:["owns","belongs_to","contains","part_of","depends_on","blocks","relates_to","references","created_by","assigned_to","approved_by","issued_for","attached_to","supersedes","superseded_by","paid_for","invoiced_to","costs","provides","uses","authorizes","complies_with"].map((e=>Si.jsx("div",{className:"p-2 border rounded text-sm",children:Si.jsx("code",{className:"font-mono",children:e})},e)))})})})]})]})})]})]})})}const eT=Wc({clientId:Uc().min(1,"Client is required"),contractId:Uc().min(1,"Contract is required"),serviceScopeId:Uc().optional(),safNumber:Vc().min(1,"SAF number is required"),title:Vc().min(1,"Title is required"),description:Vc().optional(),requestedDate:Vc().min(1,"Requested date is required"),expiryDate:Vc().optional(),status:Vc().optional(),notes:Vc().optional()});function sT(){const[,e]=Oo(),{toast:s}=sd(),t=dh(),{data:a=[]}=fh({queryKey:["/api/clients"]}),{data:i=[]}=fh({queryKey:["/api/contracts"]}),n=Zc({resolver:bv(eT),defaultValues:{clientId:0,contractId:0,serviceScopeId:void 0,safNumber:"",title:"",description:"",requestedDate:"",expiryDate:"",status:"pending",notes:""}}),r=n.watch("clientId"),l=n.watch("contractId"),{data:c=[]}=fh({queryKey:["/api/contracts","client",r],queryFn:async()=>{if(!r)return[];const e=await fetch(`/api/contracts?clientId=${r}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch client contracts");return e.json()},enabled:!!r}),{data:o=[]}=fh({queryKey:["/api/contracts",l,"service-scopes"],queryFn:async()=>{if(!l)return[];const e=await fetch(`/api/contracts/${l}/service-scopes`,{credentials:"include"});return e.ok?e.json():[]},enabled:!!l}),d=gh({mutationFn:async e=>{const s={clientId:e.clientId,contractId:e.contractId,serviceScopeId:e.serviceScopeId,safNumber:e.safNumber,title:e.title,description:e.description||"",requestedDate:e.requestedDate,expiryDate:e.expiryDate||void 0,status:e.status||"pending",notes:e.notes||""};return(await vh("POST","/api/service-authorization-forms",s)).json()},onSuccess:()=>{s({title:"Success",description:"Service Authorization Form created successfully"}),t.invalidateQueries({queryKey:["/api/service-authorization-forms"]}),e("/service-authorization-forms")},onError:e=>{s({title:"Error",description:e.message||"Failed to create Service Authorization Form",variant:"destructive"})}});return Si.jsx(vf,{children:Si.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[Si.jsx("div",{className:"flex items-center justify-between",children:Si.jsxs("div",{children:[Si.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Create Service Authorization Form"}),Si.jsx("p",{className:"text-muted-foreground",children:"Create a new SAF to authorize service delivery for a client contract"})]})}),Si.jsx("div",{className:"max-w-3xl",children:Si.jsxs(Ax,{children:[Si.jsxs(Px,{children:[Si.jsxs(_x,{className:"flex items-center gap-2",children:[Si.jsx(Kr,{className:"h-5 w-5"}),"SAF Information"]}),Si.jsx(Fx,{children:"Fill out the details for the new Service Authorization Form"})]}),Si.jsx(Lx,{children:Si.jsx($w,{...n,children:Si.jsxs("form",{onSubmit:n.handleSubmit((e=>{d.mutate(e)})),className:"space-y-6",children:[Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[Si.jsx(Bw,{control:n.control,name:"clientId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsxs(Ww,{className:"flex items-center gap-2",children:[Si.jsx(Qr,{className:"h-4 w-4"}),"Client"]}),Si.jsxs(zp,{onValueChange:s=>{e.onChange(parseInt(s)),n.setValue("contractId",0),n.setValue("serviceScopeId",void 0)},value:e.value.toString(),children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a client"})})}),Si.jsx(Wp,{children:a.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:Ou(e)},e.id)))})]}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:n.control,name:"contractId",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsxs(Ww,{className:"flex items-center gap-2",children:[Si.jsx(Gr,{className:"h-4 w-4"}),"Contract"]}),Si.jsxs(zp,{onValueChange:s=>{e.onChange(parseInt(s)),n.setValue("serviceScopeId",void 0)},value:e.value.toString(),disabled:!r,children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a contract"})})}),Si.jsx(Wp,{children:c.map((e=>Si.jsx(Hp,{value:e.id.toString(),children:e.name},e.id)))})]}),Si.jsx(Jw,{})]})})]}),o.length>0&&Si.jsx(Bw,{control:n.control,name:"serviceScopeId",render:({field:e})=>{var s;return Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Service Scope (Optional)"}),Si.jsxs(zp,{onValueChange:s=>e.onChange(parseInt(s)),value:(null==(s=e.value)?void 0:s.toString())||"",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select a service scope"})})}),Si.jsx(Wp,{children:o.map((e=>Si.jsxs(Hp,{value:e.id.toString(),children:[e.serviceName||`Service ${e.serviceId}`," - ",e.status]},e.id)))})]}),Si.jsx(Jw,{})]})}}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[Si.jsx(Bw,{control:n.control,name:"safNumber",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"SAF Number"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"SAF-2024-001",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:n.control,name:"status",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Status"}),Si.jsxs(zp,{onValueChange:e.onChange,value:e.value||"pending",children:[Si.jsx(Hw,{children:Si.jsx(Kp,{children:Si.jsx(Bp,{placeholder:"Select status"})})}),Si.jsxs(Wp,{children:[Si.jsx(Hp,{value:"pending",children:"Pending"}),Si.jsx(Hp,{value:"approved",children:"Approved"}),Si.jsx(Hp,{value:"active",children:"Active"}),Si.jsx(Hp,{value:"completed",children:"Completed"}),Si.jsx(Hp,{value:"cancelled",children:"Cancelled"})]})]}),Si.jsx(Jw,{})]})})]}),Si.jsx(Bw,{control:n.control,name:"title",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Title"}),Si.jsx(Hw,{children:Si.jsx(kx,{placeholder:"Enter SAF title",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:n.control,name:"description",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Description"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Enter SAF description",rows:4,...e})}),Si.jsx(Jw,{})]})}),Si.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[Si.jsx(Bw,{control:n.control,name:"requestedDate",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsxs(Ww,{className:"flex items-center gap-2",children:[Si.jsx(jl,{className:"h-4 w-4"}),"Start Date"]}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"date",...e})}),Si.jsx(Jw,{})]})}),Si.jsx(Bw,{control:n.control,name:"expiryDate",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsxs(Ww,{className:"flex items-center gap-2",children:[Si.jsx(jl,{className:"h-4 w-4"}),"End Date"]}),Si.jsx(Hw,{children:Si.jsx(kx,{type:"date",...e,value:e.value||""})}),Si.jsx(Jw,{})]})})]}),Si.jsx(Bw,{control:n.control,name:"notes",render:({field:e})=>Si.jsxs(Gw,{children:[Si.jsx(Ww,{children:"Notes"}),Si.jsx(Hw,{children:Si.jsx(Yp,{placeholder:"Additional notes or comments",rows:3,...e})}),Si.jsx(Jw,{})]})}),Si.jsxs("div",{className:"flex justify-end gap-4",children:[Si.jsxs(Ex,{type:"button",variant:"outline",onClick:()=>{e("/service-authorization-forms")},disabled:d.isPending,children:[Si.jsx(Tr,{className:"h-4 w-4 mr-2"}),"Cancel"]}),Si.jsxs(Ex,{type:"submit",disabled:d.isPending,children:[Si.jsx(Zr,{className:"h-4 w-4 mr-2"}),d.isPending?"Creating...":"Create SAF"]})]})]})})})]})})]})})}function tT({children:e}){const{captureError:s}=(()=>{const e=$n.useContext(wf);if(!e)throw new Error("useGlobalError must be used within a GlobalErrorProvider");return e})(),[t]=Bn.useState((()=>bh(s)));return Si.jsx(uh,{client:t,children:e})}function aT(){return Si.jsx(Nf,{children:Si.jsx(Sf,{children:Si.jsx(tT,{children:Si.jsx(Eh,{children:Si.jsx(_h,{defaultTheme:"light",storageKey:"mssp-ui-theme",children:Si.jsx(Mh,{children:Si.jsxs(hx,{children:[Si.jsx("div",{className:"min-h-screen bg-background",children:Si.jsxs(Ko,{children:[Si.jsx($o,{path:"/login",component:zf}),Si.jsx($o,{path:"/register",component:Bf}),Si.jsx($o,{path:"/",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/",children:Si.jsx(vv,{})})})}),Si.jsx($o,{path:"/clients",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/clients",children:Si.jsx(lC,{})})})}),Si.jsx($o,{path:"/clients/:id",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/clients",children:Si.jsx(eS,{})})})}),Si.jsx($o,{path:"/onboarding",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/onboarding",children:Si.jsx(XS,{})})})}),Si.jsx($o,{path:"/contracts",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/contracts",children:Si.jsx(aS,{})})})}),Si.jsx($o,{path:"/contracts/:id",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/contracts",children:Si.jsx(iS,{})})})}),Si.jsx($o,{path:"/services",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/services",children:Si.jsx(rS,{})})})}),Si.jsx($o,{path:"/service-scopes",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/service-scopes",children:Si.jsx(GS,{})})})}),Si.jsx($o,{path:"/proposals",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/proposals",children:Si.jsx(HS,{})})})}),Si.jsx($o,{path:"/assets",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/assets",children:Si.jsx(uS,{})})})}),Si.jsx($o,{path:"/license-pools/:id",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/assets",children:Si.jsx(DS,{})})})}),Si.jsx($o,{path:"/team",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/team",children:Si.jsx(PS,{})})})}),Si.jsx($o,{path:"/financial",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/financial",children:Si.jsx(FS,{})})})}),Si.jsx($o,{path:"/documents",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/documents",children:Si.jsx(LS,{})})})}),Si.jsx($o,{path:"/comprehensive-bulk-import",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/comprehensive-bulk-import",children:Si.jsx(zS,{})})})}),Si.jsx($o,{path:"/reports",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/reports",children:Si.jsx(MS,{})})})}),Si.jsx($o,{path:"/field-visibility",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/field-visibility",children:Si.jsx(KS,{})})})}),Si.jsx($o,{path:"/settings",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/settings",children:Si.jsx(OS,{})})})}),Si.jsx($o,{path:"/entity-navigation-demo",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/entity-navigation-demo",children:Si.jsx(ZS,{})})})}),Si.jsx($o,{path:"/create-saf",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/create-saf",children:Si.jsx(sT,{})})})}),Si.jsx($o,{path:"/global-widgets",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/global-widgets",children:Si.jsx(JS,{})})})}),Si.jsx($o,{path:"/widget-manager",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/widget-manager",children:Si.jsx(YS,{})})})}),Si.jsx($o,{path:"/plugins",component:()=>Si.jsx(gx,{children:Si.jsx(bf,{pageUrl:"/plugins",children:Si.jsx(VS,{})})})}),Si.jsx($o,{path:"*",component:()=>Si.jsx(gx,{children:Si.jsx(vv,{})})})]})}),Si.jsx(Qu,{}),Si.jsx(mm,{})]})})})})})})})}mi(document.getElementById("root")).render(Si.jsx(aT,{}));
